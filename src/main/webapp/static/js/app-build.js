(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\node_modules\\angular-file-upload\\dist\\angular-file-upload.min.js":[function(require,module,exports){
/*! 1.6.4 */
!function(){var a=angular.module("angularFileUpload",[]);a.service("$upload",["$http","$q","$timeout",function(a,b,c){function d(d){d.method=d.method||"POST",d.headers=d.headers||{},d.transformRequest=d.transformRequest||function(b,c){return window.ArrayBuffer&&b instanceof window.ArrayBuffer?b:a.defaults.transformRequest[0](b,c)};var e=b.defer();window.XMLHttpRequest.__isShim&&(d.headers.__setXHR_=function(){return function(a){a&&(d.__XHR=a,d.xhrFn&&d.xhrFn(a),a.upload.addEventListener("progress",function(a){e.notify(a)},!1),a.upload.addEventListener("load",function(a){a.lengthComputable&&e.notify(a)},!1))}}),a(d).then(function(a){e.resolve(a)},function(a){e.reject(a)},function(a){e.notify(a)});var f=e.promise;return f.success=function(a){return f.then(function(b){a(b.data,b.status,b.headers,d)}),f},f.error=function(a){return f.then(null,function(b){a(b.data,b.status,b.headers,d)}),f},f.progress=function(a){return f.then(null,null,function(b){a(b)}),f},f.abort=function(){return d.__XHR&&c(function(){d.__XHR.abort()}),f},f.xhr=function(a){return d.xhrFn=function(b){return function(){b&&b.apply(f,arguments),a.apply(f,arguments)}}(d.xhrFn),f},f}this.upload=function(b){b.headers=b.headers||{},b.headers["Content-Type"]=void 0,b.transformRequest=b.transformRequest||a.defaults.transformRequest;var c=new FormData,e=b.transformRequest,f=b.data;return b.transformRequest=function(a,c){if(f)if(b.formDataAppender)for(var d in f){var g=f[d];b.formDataAppender(a,d,g)}else for(var d in f){var g=f[d];if("function"==typeof e)g=e(g,c);else for(var h=0;h<e.length;h++){var i=e[h];"function"==typeof i&&(g=i(g,c))}a.append(d,g)}if(null!=b.file){var j=b.fileFormDataName||"file";if("[object Array]"===Object.prototype.toString.call(b.file))for(var k="[object String]"===Object.prototype.toString.call(j),h=0;h<b.file.length;h++)a.append(k?j:j[h],b.file[h],b.fileName&&b.fileName[h]||b.file[h].name);else a.append(j,b.file,b.fileName||b.file.name)}return a},b.data=c,d(b)},this.http=function(a){return d(a)}}]),a.directive("ngFileSelect",["$parse","$timeout",function(a,b){return function(c,d,e){var f=a(e.ngFileSelect);if("input"!==d[0].tagName.toLowerCase()||"file"!==(d.attr("type")&&d.attr("type").toLowerCase())){for(var g=angular.element('<input type="file">'),h=0;h<d[0].attributes.length;h++)g.attr(d[0].attributes[h].name,d[0].attributes[h].value);d.attr("data-multiple")&&g.attr("multiple","true"),g.css("top",0).css("bottom",0).css("left",0).css("right",0).css("width","100%").css("opacity",0).css("position","absolute").css("filter","alpha(opacity=0)"),d.append(g),(""===d.css("position")||"static"===d.css("position"))&&d.css("position","relative"),d=g}d.bind("change",function(a){var d,e,g=[];if(d=a.__files_||a.target.files,null!=d)for(e=0;e<d.length;e++)g.push(d.item(e));b(function(){f(c,{$files:g,$event:a})})})}}]),a.directive("ngFileDropAvailable",["$parse","$timeout",function(a,b){return function(c,d,e){if("draggable"in document.createElement("span")){var f=a(e.ngFileDropAvailable);b(function(){f(c)})}}}]),a.directive("ngFileDrop",["$parse","$timeout","$location",function(a,b,c){return function(d,e,f){function g(a){return/^[\000-\177]*$/.test(a)}function h(a,d){var e=[],f=a.dataTransfer.items;if(f&&f.length>0&&f[0].webkitGetAsEntry&&"file"!=c.protocol()&&f[0].webkitGetAsEntry().isDirectory)for(var h=0;h<f.length;h++){var j=f[h].webkitGetAsEntry();null!=j&&(g(j.name)?i(e,j):e.push(f[h].getAsFile()))}else{var k=a.dataTransfer.files;if(null!=k)for(var h=0;h<k.length;h++)e.push(k.item(h))}!function m(a){b(function(){l?m(10):d(e)},a||0)}()}function i(a,b){if(null!=b)if(b.isDirectory){var c=b.createReader();l++,c.readEntries(function(b){for(var c=0;c<b.length;c++)i(a,b[c]);l--})}else l++,b.file(function(b){l--,a.push(b)})}if("draggable"in document.createElement("span")){var j=null;e[0].addEventListener("dragover",function(c){if(c.stopPropagation(),c.preventDefault(),b.cancel(j),!e[0].__drag_over_class_)if(f.ngFileDragOverClass.search(/\) *$/)>-1){dragOverClassFn=a(f.ngFileDragOverClass);var g=dragOverClassFn(d,{$event:c});e[0].__drag_over_class_=g}else e[0].__drag_over_class_=f.ngFileDragOverClass||"dragover";e.addClass(e[0].__drag_over_class_)},!1),e[0].addEventListener("dragenter",function(a){a.stopPropagation(),a.preventDefault()},!1),e[0].addEventListener("dragleave",function(){j=b(function(){e.removeClass(e[0].__drag_over_class_),e[0].__drag_over_class_=null},f.ngFileDragOverDelay||1)},!1);var k=a(f.ngFileDrop);e[0].addEventListener("drop",function(a){a.stopPropagation(),a.preventDefault(),e.removeClass(e[0].__drag_over_class_),e[0].__drag_over_class_=null,h(a,function(b){k(d,{$files:b,$event:a})})},!1);var l=0}}}])}();
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\node_modules\\angular-ui-router\\release\\angular-ui-router.js":[function(require,module,exports){
/**
 * State-based routing for AngularJS
 * @version v0.2.13
 * @link http://angular-ui.github.com/
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

/* commonjs package manager support (eg componentjs) */
if (typeof module !== "undefined" && typeof exports !== "undefined" && module.exports === exports){
  module.exports = 'ui.router';
}

(function (window, angular, undefined) {
/*jshint globalstrict:true*/
/*global angular:false*/
'use strict';

var isDefined = angular.isDefined,
    isFunction = angular.isFunction,
    isString = angular.isString,
    isObject = angular.isObject,
    isArray = angular.isArray,
    forEach = angular.forEach,
    extend = angular.extend,
    copy = angular.copy;

function inherit(parent, extra) {
  return extend(new (extend(function() {}, { prototype: parent }))(), extra);
}

function merge(dst) {
  forEach(arguments, function(obj) {
    if (obj !== dst) {
      forEach(obj, function(value, key) {
        if (!dst.hasOwnProperty(key)) dst[key] = value;
      });
    }
  });
  return dst;
}

/**
 * Finds the common ancestor path between two states.
 *
 * @param {Object} first The first state.
 * @param {Object} second The second state.
 * @return {Array} Returns an array of state names in descending order, not including the root.
 */
function ancestors(first, second) {
  var path = [];

  for (var n in first.path) {
    if (first.path[n] !== second.path[n]) break;
    path.push(first.path[n]);
  }
  return path;
}

/**
 * IE8-safe wrapper for `Object.keys()`.
 *
 * @param {Object} object A JavaScript object.
 * @return {Array} Returns the keys of the object as an array.
 */
function objectKeys(object) {
  if (Object.keys) {
    return Object.keys(object);
  }
  var result = [];

  angular.forEach(object, function(val, key) {
    result.push(key);
  });
  return result;
}

/**
 * IE8-safe wrapper for `Array.prototype.indexOf()`.
 *
 * @param {Array} array A JavaScript array.
 * @param {*} value A value to search the array for.
 * @return {Number} Returns the array index value of `value`, or `-1` if not present.
 */
function indexOf(array, value) {
  if (Array.prototype.indexOf) {
    return array.indexOf(value, Number(arguments[2]) || 0);
  }
  var len = array.length >>> 0, from = Number(arguments[2]) || 0;
  from = (from < 0) ? Math.ceil(from) : Math.floor(from);

  if (from < 0) from += len;

  for (; from < len; from++) {
    if (from in array && array[from] === value) return from;
  }
  return -1;
}

/**
 * Merges a set of parameters with all parameters inherited between the common parents of the
 * current state and a given destination state.
 *
 * @param {Object} currentParams The value of the current state parameters ($stateParams).
 * @param {Object} newParams The set of parameters which will be composited with inherited params.
 * @param {Object} $current Internal definition of object representing the current state.
 * @param {Object} $to Internal definition of object representing state to transition to.
 */
function inheritParams(currentParams, newParams, $current, $to) {
  var parents = ancestors($current, $to), parentParams, inherited = {}, inheritList = [];

  for (var i in parents) {
    if (!parents[i].params) continue;
    parentParams = objectKeys(parents[i].params);
    if (!parentParams.length) continue;

    for (var j in parentParams) {
      if (indexOf(inheritList, parentParams[j]) >= 0) continue;
      inheritList.push(parentParams[j]);
      inherited[parentParams[j]] = currentParams[parentParams[j]];
    }
  }
  return extend({}, inherited, newParams);
}

/**
 * Performs a non-strict comparison of the subset of two objects, defined by a list of keys.
 *
 * @param {Object} a The first object.
 * @param {Object} b The second object.
 * @param {Array} keys The list of keys within each object to compare. If the list is empty or not specified,
 *                     it defaults to the list of keys in `a`.
 * @return {Boolean} Returns `true` if the keys match, otherwise `false`.
 */
function equalForKeys(a, b, keys) {
  if (!keys) {
    keys = [];
    for (var n in a) keys.push(n); // Used instead of Object.keys() for IE8 compatibility
  }

  for (var i=0; i<keys.length; i++) {
    var k = keys[i];
    if (a[k] != b[k]) return false; // Not '===', values aren't necessarily normalized
  }
  return true;
}

/**
 * Returns the subset of an object, based on a list of keys.
 *
 * @param {Array} keys
 * @param {Object} values
 * @return {Boolean} Returns a subset of `values`.
 */
function filterByKeys(keys, values) {
  var filtered = {};

  forEach(keys, function (name) {
    filtered[name] = values[name];
  });
  return filtered;
}

// like _.indexBy
// when you know that your index values will be unique, or you want last-one-in to win
function indexBy(array, propName) {
  var result = {};
  forEach(array, function(item) {
    result[item[propName]] = item;
  });
  return result;
}

// extracted from underscore.js
// Return a copy of the object only containing the whitelisted properties.
function pick(obj) {
  var copy = {};
  var keys = Array.prototype.concat.apply(Array.prototype, Array.prototype.slice.call(arguments, 1));
  forEach(keys, function(key) {
    if (key in obj) copy[key] = obj[key];
  });
  return copy;
}

// extracted from underscore.js
// Return a copy of the object omitting the blacklisted properties.
function omit(obj) {
  var copy = {};
  var keys = Array.prototype.concat.apply(Array.prototype, Array.prototype.slice.call(arguments, 1));
  for (var key in obj) {
    if (indexOf(keys, key) == -1) copy[key] = obj[key];
  }
  return copy;
}

function pluck(collection, key) {
  var result = isArray(collection) ? [] : {};

  forEach(collection, function(val, i) {
    result[i] = isFunction(key) ? key(val) : val[key];
  });
  return result;
}

function filter(collection, callback) {
  var array = isArray(collection);
  var result = array ? [] : {};
  forEach(collection, function(val, i) {
    if (callback(val, i)) {
      result[array ? result.length : i] = val;
    }
  });
  return result;
}

function map(collection, callback) {
  var result = isArray(collection) ? [] : {};

  forEach(collection, function(val, i) {
    result[i] = callback(val, i);
  });
  return result;
}

/**
 * @ngdoc overview
 * @name ui.router.util
 *
 * @description
 * # ui.router.util sub-module
 *
 * This module is a dependency of other sub-modules. Do not include this module as a dependency
 * in your angular app (use {@link ui.router} module instead).
 *
 */
angular.module('ui.router.util', ['ng']);

/**
 * @ngdoc overview
 * @name ui.router.router
 * 
 * @requires ui.router.util
 *
 * @description
 * # ui.router.router sub-module
 *
 * This module is a dependency of other sub-modules. Do not include this module as a dependency
 * in your angular app (use {@link ui.router} module instead).
 */
angular.module('ui.router.router', ['ui.router.util']);

/**
 * @ngdoc overview
 * @name ui.router.state
 * 
 * @requires ui.router.router
 * @requires ui.router.util
 *
 * @description
 * # ui.router.state sub-module
 *
 * This module is a dependency of the main ui.router module. Do not include this module as a dependency
 * in your angular app (use {@link ui.router} module instead).
 * 
 */
angular.module('ui.router.state', ['ui.router.router', 'ui.router.util']);

/**
 * @ngdoc overview
 * @name ui.router
 *
 * @requires ui.router.state
 *
 * @description
 * # ui.router
 * 
 * ## The main module for ui.router 
 * There are several sub-modules included with the ui.router module, however only this module is needed
 * as a dependency within your angular app. The other modules are for organization purposes. 
 *
 * The modules are:
 * * ui.router - the main "umbrella" module
 * * ui.router.router - 
 * 
 * *You'll need to include **only** this module as the dependency within your angular app.*
 * 
 * <pre>
 * <!doctype html>
 * <html ng-app="myApp">
 * <head>
 *   <script src="js/angular.js"></script>
 *   <!-- Include the ui-router script -->
 *   <script src="js/angular-ui-router.min.js"></script>
 *   <script>
 *     // ...and add 'ui.router' as a dependency
 *     var myApp = angular.module('myApp', ['ui.router']);
 *   </script>
 * </head>
 * <body>
 * </body>
 * </html>
 * </pre>
 */
angular.module('ui.router', ['ui.router.state']);

angular.module('ui.router.compat', ['ui.router']);

/**
 * @ngdoc object
 * @name ui.router.util.$resolve
 *
 * @requires $q
 * @requires $injector
 *
 * @description
 * Manages resolution of (acyclic) graphs of promises.
 */
$Resolve.$inject = ['$q', '$injector'];
function $Resolve(  $q,    $injector) {
  
  var VISIT_IN_PROGRESS = 1,
      VISIT_DONE = 2,
      NOTHING = {},
      NO_DEPENDENCIES = [],
      NO_LOCALS = NOTHING,
      NO_PARENT = extend($q.when(NOTHING), { $$promises: NOTHING, $$values: NOTHING });
  

  /**
   * @ngdoc function
   * @name ui.router.util.$resolve#study
   * @methodOf ui.router.util.$resolve
   *
   * @description
   * Studies a set of invocables that are likely to be used multiple times.
   * <pre>
   * $resolve.study(invocables)(locals, parent, self)
   * </pre>
   * is equivalent to
   * <pre>
   * $resolve.resolve(invocables, locals, parent, self)
   * </pre>
   * but the former is more efficient (in fact `resolve` just calls `study` 
   * internally).
   *
   * @param {object} invocables Invocable objects
   * @return {function} a function to pass in locals, parent and self
   */
  this.study = function (invocables) {
    if (!isObject(invocables)) throw new Error("'invocables' must be an object");
    var invocableKeys = objectKeys(invocables || {});
    
    // Perform a topological sort of invocables to build an ordered plan
    var plan = [], cycle = [], visited = {};
    function visit(value, key) {
      if (visited[key] === VISIT_DONE) return;
      
      cycle.push(key);
      if (visited[key] === VISIT_IN_PROGRESS) {
        cycle.splice(0, indexOf(cycle, key));
        throw new Error("Cyclic dependency: " + cycle.join(" -> "));
      }
      visited[key] = VISIT_IN_PROGRESS;
      
      if (isString(value)) {
        plan.push(key, [ function() { return $injector.get(value); }], NO_DEPENDENCIES);
      } else {
        var params = $injector.annotate(value);
        forEach(params, function (param) {
          if (param !== key && invocables.hasOwnProperty(param)) visit(invocables[param], param);
        });
        plan.push(key, value, params);
      }
      
      cycle.pop();
      visited[key] = VISIT_DONE;
    }
    forEach(invocables, visit);
    invocables = cycle = visited = null; // plan is all that's required
    
    function isResolve(value) {
      return isObject(value) && value.then && value.$$promises;
    }
    
    return function (locals, parent, self) {
      if (isResolve(locals) && self === undefined) {
        self = parent; parent = locals; locals = null;
      }
      if (!locals) locals = NO_LOCALS;
      else if (!isObject(locals)) {
        throw new Error("'locals' must be an object");
      }       
      if (!parent) parent = NO_PARENT;
      else if (!isResolve(parent)) {
        throw new Error("'parent' must be a promise returned by $resolve.resolve()");
      }
      
      // To complete the overall resolution, we have to wait for the parent
      // promise and for the promise for each invokable in our plan.
      var resolution = $q.defer(),
          result = resolution.promise,
          promises = result.$$promises = {},
          values = extend({}, locals),
          wait = 1 + plan.length/3,
          merged = false;
          
      function done() {
        // Merge parent values we haven't got yet and publish our own $$values
        if (!--wait) {
          if (!merged) merge(values, parent.$$values); 
          result.$$values = values;
          result.$$promises = result.$$promises || true; // keep for isResolve()
          delete result.$$inheritedValues;
          resolution.resolve(values);
        }
      }
      
      function fail(reason) {
        result.$$failure = reason;
        resolution.reject(reason);
      }

      // Short-circuit if parent has already failed
      if (isDefined(parent.$$failure)) {
        fail(parent.$$failure);
        return result;
      }
      
      if (parent.$$inheritedValues) {
        merge(values, omit(parent.$$inheritedValues, invocableKeys));
      }

      // Merge parent values if the parent has already resolved, or merge
      // parent promises and wait if the parent resolve is still in progress.
      extend(promises, parent.$$promises);
      if (parent.$$values) {
        merged = merge(values, omit(parent.$$values, invocableKeys));
        result.$$inheritedValues = omit(parent.$$values, invocableKeys);
        done();
      } else {
        if (parent.$$inheritedValues) {
          result.$$inheritedValues = omit(parent.$$inheritedValues, invocableKeys);
        }        
        parent.then(done, fail);
      }
      
      // Process each invocable in the plan, but ignore any where a local of the same name exists.
      for (var i=0, ii=plan.length; i<ii; i+=3) {
        if (locals.hasOwnProperty(plan[i])) done();
        else invoke(plan[i], plan[i+1], plan[i+2]);
      }
      
      function invoke(key, invocable, params) {
        // Create a deferred for this invocation. Failures will propagate to the resolution as well.
        var invocation = $q.defer(), waitParams = 0;
        function onfailure(reason) {
          invocation.reject(reason);
          fail(reason);
        }
        // Wait for any parameter that we have a promise for (either from parent or from this
        // resolve; in that case study() will have made sure it's ordered before us in the plan).
        forEach(params, function (dep) {
          if (promises.hasOwnProperty(dep) && !locals.hasOwnProperty(dep)) {
            waitParams++;
            promises[dep].then(function (result) {
              values[dep] = result;
              if (!(--waitParams)) proceed();
            }, onfailure);
          }
        });
        if (!waitParams) proceed();
        function proceed() {
          if (isDefined(result.$$failure)) return;
          try {
            invocation.resolve($injector.invoke(invocable, self, values));
            invocation.promise.then(function (result) {
              values[key] = result;
              done();
            }, onfailure);
          } catch (e) {
            onfailure(e);
          }
        }
        // Publish promise synchronously; invocations further down in the plan may depend on it.
        promises[key] = invocation.promise;
      }
      
      return result;
    };
  };
  
  /**
   * @ngdoc function
   * @name ui.router.util.$resolve#resolve
   * @methodOf ui.router.util.$resolve
   *
   * @description
   * Resolves a set of invocables. An invocable is a function to be invoked via 
   * `$injector.invoke()`, and can have an arbitrary number of dependencies. 
   * An invocable can either return a value directly,
   * or a `$q` promise. If a promise is returned it will be resolved and the 
   * resulting value will be used instead. Dependencies of invocables are resolved 
   * (in this order of precedence)
   *
   * - from the specified `locals`
   * - from another invocable that is part of this `$resolve` call
   * - from an invocable that is inherited from a `parent` call to `$resolve` 
   *   (or recursively
   * - from any ancestor `$resolve` of that parent).
   *
   * The return value of `$resolve` is a promise for an object that contains 
   * (in this order of precedence)
   *
   * - any `locals` (if specified)
   * - the resolved return values of all injectables
   * - any values inherited from a `parent` call to `$resolve` (if specified)
   *
   * The promise will resolve after the `parent` promise (if any) and all promises 
   * returned by injectables have been resolved. If any invocable 
   * (or `$injector.invoke`) throws an exception, or if a promise returned by an 
   * invocable is rejected, the `$resolve` promise is immediately rejected with the 
   * same error. A rejection of a `parent` promise (if specified) will likewise be 
   * propagated immediately. Once the `$resolve` promise has been rejected, no 
   * further invocables will be called.
   * 
   * Cyclic dependencies between invocables are not permitted and will caues `$resolve`
   * to throw an error. As a special case, an injectable can depend on a parameter 
   * with the same name as the injectable, which will be fulfilled from the `parent` 
   * injectable of the same name. This allows inherited values to be decorated. 
   * Note that in this case any other injectable in the same `$resolve` with the same
   * dependency would see the decorated value, not the inherited value.
   *
   * Note that missing dependencies -- unlike cyclic dependencies -- will cause an 
   * (asynchronous) rejection of the `$resolve` promise rather than a (synchronous) 
   * exception.
   *
   * Invocables are invoked eagerly as soon as all dependencies are available. 
   * This is true even for dependencies inherited from a `parent` call to `$resolve`.
   *
   * As a special case, an invocable can be a string, in which case it is taken to 
   * be a service name to be passed to `$injector.get()`. This is supported primarily 
   * for backwards-compatibility with the `resolve` property of `$routeProvider` 
   * routes.
   *
   * @param {object} invocables functions to invoke or 
   * `$injector` services to fetch.
   * @param {object} locals  values to make available to the injectables
   * @param {object} parent  a promise returned by another call to `$resolve`.
   * @param {object} self  the `this` for the invoked methods
   * @return {object} Promise for an object that contains the resolved return value
   * of all invocables, as well as any inherited and local values.
   */
  this.resolve = function (invocables, locals, parent, self) {
    return this.study(invocables)(locals, parent, self);
  };
}

angular.module('ui.router.util').service('$resolve', $Resolve);


/**
 * @ngdoc object
 * @name ui.router.util.$templateFactory
 *
 * @requires $http
 * @requires $templateCache
 * @requires $injector
 *
 * @description
 * Service. Manages loading of templates.
 */
$TemplateFactory.$inject = ['$http', '$templateCache', '$injector'];
function $TemplateFactory(  $http,   $templateCache,   $injector) {

  /**
   * @ngdoc function
   * @name ui.router.util.$templateFactory#fromConfig
   * @methodOf ui.router.util.$templateFactory
   *
   * @description
   * Creates a template from a configuration object. 
   *
   * @param {object} config Configuration object for which to load a template. 
   * The following properties are search in the specified order, and the first one 
   * that is defined is used to create the template:
   *
   * @param {string|object} config.template html string template or function to 
   * load via {@link ui.router.util.$templateFactory#fromString fromString}.
   * @param {string|object} config.templateUrl url to load or a function returning 
   * the url to load via {@link ui.router.util.$templateFactory#fromUrl fromUrl}.
   * @param {Function} config.templateProvider function to invoke via 
   * {@link ui.router.util.$templateFactory#fromProvider fromProvider}.
   * @param {object} params  Parameters to pass to the template function.
   * @param {object} locals Locals to pass to `invoke` if the template is loaded 
   * via a `templateProvider`. Defaults to `{ params: params }`.
   *
   * @return {string|object}  The template html as a string, or a promise for 
   * that string,or `null` if no template is configured.
   */
  this.fromConfig = function (config, params, locals) {
    return (
      isDefined(config.template) ? this.fromString(config.template, params) :
      isDefined(config.templateUrl) ? this.fromUrl(config.templateUrl, params) :
      isDefined(config.templateProvider) ? this.fromProvider(config.templateProvider, params, locals) :
      null
    );
  };

  /**
   * @ngdoc function
   * @name ui.router.util.$templateFactory#fromString
   * @methodOf ui.router.util.$templateFactory
   *
   * @description
   * Creates a template from a string or a function returning a string.
   *
   * @param {string|object} template html template as a string or function that 
   * returns an html template as a string.
   * @param {object} params Parameters to pass to the template function.
   *
   * @return {string|object} The template html as a string, or a promise for that 
   * string.
   */
  this.fromString = function (template, params) {
    return isFunction(template) ? template(params) : template;
  };

  /**
   * @ngdoc function
   * @name ui.router.util.$templateFactory#fromUrl
   * @methodOf ui.router.util.$templateFactory
   * 
   * @description
   * Loads a template from the a URL via `$http` and `$templateCache`.
   *
   * @param {string|Function} url url of the template to load, or a function 
   * that returns a url.
   * @param {Object} params Parameters to pass to the url function.
   * @return {string|Promise.<string>} The template html as a string, or a promise 
   * for that string.
   */
  this.fromUrl = function (url, params) {
    if (isFunction(url)) url = url(params);
    if (url == null) return null;
    else return $http
        .get(url, { cache: $templateCache, headers: { Accept: 'text/html' }})
        .then(function(response) { return response.data; });
  };

  /**
   * @ngdoc function
   * @name ui.router.util.$templateFactory#fromProvider
   * @methodOf ui.router.util.$templateFactory
   *
   * @description
   * Creates a template by invoking an injectable provider function.
   *
   * @param {Function} provider Function to invoke via `$injector.invoke`
   * @param {Object} params Parameters for the template.
   * @param {Object} locals Locals to pass to `invoke`. Defaults to 
   * `{ params: params }`.
   * @return {string|Promise.<string>} The template html as a string, or a promise 
   * for that string.
   */
  this.fromProvider = function (provider, params, locals) {
    return $injector.invoke(provider, null, locals || { params: params });
  };
}

angular.module('ui.router.util').service('$templateFactory', $TemplateFactory);

var $$UMFP; // reference to $UrlMatcherFactoryProvider

/**
 * @ngdoc object
 * @name ui.router.util.type:UrlMatcher
 *
 * @description
 * Matches URLs against patterns and extracts named parameters from the path or the search
 * part of the URL. A URL pattern consists of a path pattern, optionally followed by '?' and a list
 * of search parameters. Multiple search parameter names are separated by '&'. Search parameters
 * do not influence whether or not a URL is matched, but their values are passed through into
 * the matched parameters returned by {@link ui.router.util.type:UrlMatcher#methods_exec exec}.
 * 
 * Path parameter placeholders can be specified using simple colon/catch-all syntax or curly brace
 * syntax, which optionally allows a regular expression for the parameter to be specified:
 *
 * * `':'` name - colon placeholder
 * * `'*'` name - catch-all placeholder
 * * `'{' name '}'` - curly placeholder
 * * `'{' name ':' regexp|type '}'` - curly placeholder with regexp or type name. Should the
 *   regexp itself contain curly braces, they must be in matched pairs or escaped with a backslash.
 *
 * Parameter names may contain only word characters (latin letters, digits, and underscore) and
 * must be unique within the pattern (across both path and search parameters). For colon 
 * placeholders or curly placeholders without an explicit regexp, a path parameter matches any
 * number of characters other than '/'. For catch-all placeholders the path parameter matches
 * any number of characters.
 * 
 * Examples:
 * 
 * * `'/hello/'` - Matches only if the path is exactly '/hello/'. There is no special treatment for
 *   trailing slashes, and patterns have to match the entire path, not just a prefix.
 * * `'/user/:id'` - Matches '/user/bob' or '/user/1234!!!' or even '/user/' but not '/user' or
 *   '/user/bob/details'. The second path segment will be captured as the parameter 'id'.
 * * `'/user/{id}'` - Same as the previous example, but using curly brace syntax.
 * * `'/user/{id:[^/]*}'` - Same as the previous example.
 * * `'/user/{id:[0-9a-fA-F]{1,8}}'` - Similar to the previous example, but only matches if the id
 *   parameter consists of 1 to 8 hex digits.
 * * `'/files/{path:.*}'` - Matches any URL starting with '/files/' and captures the rest of the
 *   path into the parameter 'path'.
 * * `'/files/*path'` - ditto.
 * * `'/calendar/{start:date}'` - Matches "/calendar/2014-11-12" (because the pattern defined
 *   in the built-in  `date` Type matches `2014-11-12`) and provides a Date object in $stateParams.start
 *
 * @param {string} pattern  The pattern to compile into a matcher.
 * @param {Object} config  A configuration object hash:
 * @param {Object=} parentMatcher Used to concatenate the pattern/config onto
 *   an existing UrlMatcher
 *
 * * `caseInsensitive` - `true` if URL matching should be case insensitive, otherwise `false`, the default value (for backward compatibility) is `false`.
 * * `strict` - `false` if matching against a URL with a trailing slash should be treated as equivalent to a URL without a trailing slash, the default value is `true`.
 *
 * @property {string} prefix  A static prefix of this pattern. The matcher guarantees that any
 *   URL matching this matcher (i.e. any string for which {@link ui.router.util.type:UrlMatcher#methods_exec exec()} returns
 *   non-null) will start with this prefix.
 *
 * @property {string} source  The pattern that was passed into the constructor
 *
 * @property {string} sourcePath  The path portion of the source property
 *
 * @property {string} sourceSearch  The search portion of the source property
 *
 * @property {string} regex  The constructed regex that will be used to match against the url when 
 *   it is time to determine which url will match.
 *
 * @returns {Object}  New `UrlMatcher` object
 */
function UrlMatcher(pattern, config, parentMatcher) {
  config = extend({ params: {} }, isObject(config) ? config : {});

  // Find all placeholders and create a compiled pattern, using either classic or curly syntax:
  //   '*' name
  //   ':' name
  //   '{' name '}'
  //   '{' name ':' regexp '}'
  // The regular expression is somewhat complicated due to the need to allow curly braces
  // inside the regular expression. The placeholder regexp breaks down as follows:
  //    ([:*])([\w\[\]]+)              - classic placeholder ($1 / $2) (search version has - for snake-case)
  //    \{([\w\[\]]+)(?:\:( ... ))?\}  - curly brace placeholder ($3) with optional regexp/type ... ($4) (search version has - for snake-case
  //    (?: ... | ... | ... )+         - the regexp consists of any number of atoms, an atom being either
  //    [^{}\\]+                       - anything other than curly braces or backslash
  //    \\.                            - a backslash escape
  //    \{(?:[^{}\\]+|\\.)*\}          - a matched set of curly braces containing other atoms
  var placeholder       = /([:*])([\w\[\]]+)|\{([\w\[\]]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,
      searchPlaceholder = /([:]?)([\w\[\]-]+)|\{([\w\[\]-]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,
      compiled = '^', last = 0, m,
      segments = this.segments = [],
      parentParams = parentMatcher ? parentMatcher.params : {},
      params = this.params = parentMatcher ? parentMatcher.params.$$new() : new $$UMFP.ParamSet(),
      paramNames = [];

  function addParameter(id, type, config, location) {
    paramNames.push(id);
    if (parentParams[id]) return parentParams[id];
    if (!/^\w+(-+\w+)*(?:\[\])?$/.test(id)) throw new Error("Invalid parameter name '" + id + "' in pattern '" + pattern + "'");
    if (params[id]) throw new Error("Duplicate parameter name '" + id + "' in pattern '" + pattern + "'");
    params[id] = new $$UMFP.Param(id, type, config, location);
    return params[id];
  }

  function quoteRegExp(string, pattern, squash) {
    var surroundPattern = ['',''], result = string.replace(/[\\\[\]\^$*+?.()|{}]/g, "\\$&");
    if (!pattern) return result;
    switch(squash) {
      case false: surroundPattern = ['(', ')'];   break;
      case true:  surroundPattern = ['?(', ')?']; break;
      default:    surroundPattern = ['(' + squash + "|", ')?'];  break;
    }
    return result + surroundPattern[0] + pattern + surroundPattern[1];
  }

  this.source = pattern;

  // Split into static segments separated by path parameter placeholders.
  // The number of segments is always 1 more than the number of parameters.
  function matchDetails(m, isSearch) {
    var id, regexp, segment, type, cfg, arrayMode;
    id          = m[2] || m[3]; // IE[78] returns '' for unmatched groups instead of null
    cfg         = config.params[id];
    segment     = pattern.substring(last, m.index);
    regexp      = isSearch ? m[4] : m[4] || (m[1] == '*' ? '.*' : null);
    type        = $$UMFP.type(regexp || "string") || inherit($$UMFP.type("string"), { pattern: new RegExp(regexp) });
    return {
      id: id, regexp: regexp, segment: segment, type: type, cfg: cfg
    };
  }

  var p, param, segment;
  while ((m = placeholder.exec(pattern))) {
    p = matchDetails(m, false);
    if (p.segment.indexOf('?') >= 0) break; // we're into the search part

    param = addParameter(p.id, p.type, p.cfg, "path");
    compiled += quoteRegExp(p.segment, param.type.pattern.source, param.squash);
    segments.push(p.segment);
    last = placeholder.lastIndex;
  }
  segment = pattern.substring(last);

  // Find any search parameter names and remove them from the last segment
  var i = segment.indexOf('?');

  if (i >= 0) {
    var search = this.sourceSearch = segment.substring(i);
    segment = segment.substring(0, i);
    this.sourcePath = pattern.substring(0, last + i);

    if (search.length > 0) {
      last = 0;
      while ((m = searchPlaceholder.exec(search))) {
        p = matchDetails(m, true);
        param = addParameter(p.id, p.type, p.cfg, "search");
        last = placeholder.lastIndex;
        // check if ?&
      }
    }
  } else {
    this.sourcePath = pattern;
    this.sourceSearch = '';
  }

  compiled += quoteRegExp(segment) + (config.strict === false ? '\/?' : '') + '$';
  segments.push(segment);

  this.regexp = new RegExp(compiled, config.caseInsensitive ? 'i' : undefined);
  this.prefix = segments[0];
  this.$$paramNames = paramNames;
}

/**
 * @ngdoc function
 * @name ui.router.util.type:UrlMatcher#concat
 * @methodOf ui.router.util.type:UrlMatcher
 *
 * @description
 * Returns a new matcher for a pattern constructed by appending the path part and adding the
 * search parameters of the specified pattern to this pattern. The current pattern is not
 * modified. This can be understood as creating a pattern for URLs that are relative to (or
 * suffixes of) the current pattern.
 *
 * @example
 * The following two matchers are equivalent:
 * <pre>
 * new UrlMatcher('/user/{id}?q').concat('/details?date');
 * new UrlMatcher('/user/{id}/details?q&date');
 * </pre>
 *
 * @param {string} pattern  The pattern to append.
 * @param {Object} config  An object hash of the configuration for the matcher.
 * @returns {UrlMatcher}  A matcher for the concatenated pattern.
 */
UrlMatcher.prototype.concat = function (pattern, config) {
  // Because order of search parameters is irrelevant, we can add our own search
  // parameters to the end of the new pattern. Parse the new pattern by itself
  // and then join the bits together, but it's much easier to do this on a string level.
  var defaultConfig = {
    caseInsensitive: $$UMFP.caseInsensitive(),
    strict: $$UMFP.strictMode(),
    squash: $$UMFP.defaultSquashPolicy()
  };
  return new UrlMatcher(this.sourcePath + pattern + this.sourceSearch, extend(defaultConfig, config), this);
};

UrlMatcher.prototype.toString = function () {
  return this.source;
};

/**
 * @ngdoc function
 * @name ui.router.util.type:UrlMatcher#exec
 * @methodOf ui.router.util.type:UrlMatcher
 *
 * @description
 * Tests the specified path against this matcher, and returns an object containing the captured
 * parameter values, or null if the path does not match. The returned object contains the values
 * of any search parameters that are mentioned in the pattern, but their value may be null if
 * they are not present in `searchParams`. This means that search parameters are always treated
 * as optional.
 *
 * @example
 * <pre>
 * new UrlMatcher('/user/{id}?q&r').exec('/user/bob', {
 *   x: '1', q: 'hello'
 * });
 * // returns { id: 'bob', q: 'hello', r: null }
 * </pre>
 *
 * @param {string} path  The URL path to match, e.g. `$location.path()`.
 * @param {Object} searchParams  URL search parameters, e.g. `$location.search()`.
 * @returns {Object}  The captured parameter values.
 */
UrlMatcher.prototype.exec = function (path, searchParams) {
  var m = this.regexp.exec(path);
  if (!m) return null;
  searchParams = searchParams || {};

  var paramNames = this.parameters(), nTotal = paramNames.length,
    nPath = this.segments.length - 1,
    values = {}, i, j, cfg, paramName;

  if (nPath !== m.length - 1) throw new Error("Unbalanced capture group in route '" + this.source + "'");

  function decodePathArray(string) {
    function reverseString(str) { return str.split("").reverse().join(""); }
    function unquoteDashes(str) { return str.replace(/\\-/, "-"); }

    var split = reverseString(string).split(/-(?!\\)/);
    var allReversed = map(split, reverseString);
    return map(allReversed, unquoteDashes).reverse();
  }

  for (i = 0; i < nPath; i++) {
    paramName = paramNames[i];
    var param = this.params[paramName];
    var paramVal = m[i+1];
    // if the param value matches a pre-replace pair, replace the value before decoding.
    for (j = 0; j < param.replace; j++) {
      if (param.replace[j].from === paramVal) paramVal = param.replace[j].to;
    }
    if (paramVal && param.array === true) paramVal = decodePathArray(paramVal);
    values[paramName] = param.value(paramVal);
  }
  for (/**/; i < nTotal; i++) {
    paramName = paramNames[i];
    values[paramName] = this.params[paramName].value(searchParams[paramName]);
  }

  return values;
};

/**
 * @ngdoc function
 * @name ui.router.util.type:UrlMatcher#parameters
 * @methodOf ui.router.util.type:UrlMatcher
 *
 * @description
 * Returns the names of all path and search parameters of this pattern in an unspecified order.
 * 
 * @returns {Array.<string>}  An array of parameter names. Must be treated as read-only. If the
 *    pattern has no parameters, an empty array is returned.
 */
UrlMatcher.prototype.parameters = function (param) {
  if (!isDefined(param)) return this.$$paramNames;
  return this.params[param] || null;
};

/**
 * @ngdoc function
 * @name ui.router.util.type:UrlMatcher#validate
 * @methodOf ui.router.util.type:UrlMatcher
 *
 * @description
 * Checks an object hash of parameters to validate their correctness according to the parameter
 * types of this `UrlMatcher`.
 *
 * @param {Object} params The object hash of parameters to validate.
 * @returns {boolean} Returns `true` if `params` validates, otherwise `false`.
 */
UrlMatcher.prototype.validates = function (params) {
  return this.params.$$validates(params);
};

/**
 * @ngdoc function
 * @name ui.router.util.type:UrlMatcher#format
 * @methodOf ui.router.util.type:UrlMatcher
 *
 * @description
 * Creates a URL that matches this pattern by substituting the specified values
 * for the path and search parameters. Null values for path parameters are
 * treated as empty strings.
 *
 * @example
 * <pre>
 * new UrlMatcher('/user/{id}?q').format({ id:'bob', q:'yes' });
 * // returns '/user/bob?q=yes'
 * </pre>
 *
 * @param {Object} values  the values to substitute for the parameters in this pattern.
 * @returns {string}  the formatted URL (path and optionally search part).
 */
UrlMatcher.prototype.format = function (values) {
  values = values || {};
  var segments = this.segments, params = this.parameters(), paramset = this.params;
  if (!this.validates(values)) return null;

  var i, search = false, nPath = segments.length - 1, nTotal = params.length, result = segments[0];

  function encodeDashes(str) { // Replace dashes with encoded "\-"
    return encodeURIComponent(str).replace(/-/g, function(c) { return '%5C%' + c.charCodeAt(0).toString(16).toUpperCase(); });
  }

  for (i = 0; i < nTotal; i++) {
    var isPathParam = i < nPath;
    var name = params[i], param = paramset[name], value = param.value(values[name]);
    var isDefaultValue = param.isOptional && param.type.equals(param.value(), value);
    var squash = isDefaultValue ? param.squash : false;
    var encoded = param.type.encode(value);

    if (isPathParam) {
      var nextSegment = segments[i + 1];
      if (squash === false) {
        if (encoded != null) {
          if (isArray(encoded)) {
            result += map(encoded, encodeDashes).join("-");
          } else {
            result += encodeURIComponent(encoded);
          }
        }
        result += nextSegment;
      } else if (squash === true) {
        var capture = result.match(/\/$/) ? /\/?(.*)/ : /(.*)/;
        result += nextSegment.match(capture)[1];
      } else if (isString(squash)) {
        result += squash + nextSegment;
      }
    } else {
      if (encoded == null || (isDefaultValue && squash !== false)) continue;
      if (!isArray(encoded)) encoded = [ encoded ];
      encoded = map(encoded, encodeURIComponent).join('&' + name + '=');
      result += (search ? '&' : '?') + (name + '=' + encoded);
      search = true;
    }
  }

  return result;
};

/**
 * @ngdoc object
 * @name ui.router.util.type:Type
 *
 * @description
 * Implements an interface to define custom parameter types that can be decoded from and encoded to
 * string parameters matched in a URL. Used by {@link ui.router.util.type:UrlMatcher `UrlMatcher`}
 * objects when matching or formatting URLs, or comparing or validating parameter values.
 *
 * See {@link ui.router.util.$urlMatcherFactory#methods_type `$urlMatcherFactory#type()`} for more
 * information on registering custom types.
 *
 * @param {Object} config  A configuration object which contains the custom type definition.  The object's
 *        properties will override the default methods and/or pattern in `Type`'s public interface.
 * @example
 * <pre>
 * {
 *   decode: function(val) { return parseInt(val, 10); },
 *   encode: function(val) { return val && val.toString(); },
 *   equals: function(a, b) { return this.is(a) && a === b; },
 *   is: function(val) { return angular.isNumber(val) isFinite(val) && val % 1 === 0; },
 *   pattern: /\d+/
 * }
 * </pre>
 *
 * @property {RegExp} pattern The regular expression pattern used to match values of this type when
 *           coming from a substring of a URL.
 *
 * @returns {Object}  Returns a new `Type` object.
 */
function Type(config) {
  extend(this, config);
}

/**
 * @ngdoc function
 * @name ui.router.util.type:Type#is
 * @methodOf ui.router.util.type:Type
 *
 * @description
 * Detects whether a value is of a particular type. Accepts a native (decoded) value
 * and determines whether it matches the current `Type` object.
 *
 * @param {*} val  The value to check.
 * @param {string} key  Optional. If the type check is happening in the context of a specific
 *        {@link ui.router.util.type:UrlMatcher `UrlMatcher`} object, this is the name of the
 *        parameter in which `val` is stored. Can be used for meta-programming of `Type` objects.
 * @returns {Boolean}  Returns `true` if the value matches the type, otherwise `false`.
 */
Type.prototype.is = function(val, key) {
  return true;
};

/**
 * @ngdoc function
 * @name ui.router.util.type:Type#encode
 * @methodOf ui.router.util.type:Type
 *
 * @description
 * Encodes a custom/native type value to a string that can be embedded in a URL. Note that the
 * return value does *not* need to be URL-safe (i.e. passed through `encodeURIComponent()`), it
 * only needs to be a representation of `val` that has been coerced to a string.
 *
 * @param {*} val  The value to encode.
 * @param {string} key  The name of the parameter in which `val` is stored. Can be used for
 *        meta-programming of `Type` objects.
 * @returns {string}  Returns a string representation of `val` that can be encoded in a URL.
 */
Type.prototype.encode = function(val, key) {
  return val;
};

/**
 * @ngdoc function
 * @name ui.router.util.type:Type#decode
 * @methodOf ui.router.util.type:Type
 *
 * @description
 * Converts a parameter value (from URL string or transition param) to a custom/native value.
 *
 * @param {string} val  The URL parameter value to decode.
 * @param {string} key  The name of the parameter in which `val` is stored. Can be used for
 *        meta-programming of `Type` objects.
 * @returns {*}  Returns a custom representation of the URL parameter value.
 */
Type.prototype.decode = function(val, key) {
  return val;
};

/**
 * @ngdoc function
 * @name ui.router.util.type:Type#equals
 * @methodOf ui.router.util.type:Type
 *
 * @description
 * Determines whether two decoded values are equivalent.
 *
 * @param {*} a  A value to compare against.
 * @param {*} b  A value to compare against.
 * @returns {Boolean}  Returns `true` if the values are equivalent/equal, otherwise `false`.
 */
Type.prototype.equals = function(a, b) {
  return a == b;
};

Type.prototype.$subPattern = function() {
  var sub = this.pattern.toString();
  return sub.substr(1, sub.length - 2);
};

Type.prototype.pattern = /.*/;

Type.prototype.toString = function() { return "{Type:" + this.name + "}"; };

/*
 * Wraps an existing custom Type as an array of Type, depending on 'mode'.
 * e.g.:
 * - urlmatcher pattern "/path?{queryParam[]:int}"
 * - url: "/path?queryParam=1&queryParam=2
 * - $stateParams.queryParam will be [1, 2]
 * if `mode` is "auto", then
 * - url: "/path?queryParam=1 will create $stateParams.queryParam: 1
 * - url: "/path?queryParam=1&queryParam=2 will create $stateParams.queryParam: [1, 2]
 */
Type.prototype.$asArray = function(mode, isSearch) {
  if (!mode) return this;
  if (mode === "auto" && !isSearch) throw new Error("'auto' array mode is for query parameters only");
  return new ArrayType(this, mode);

  function ArrayType(type, mode) {
    function bindTo(type, callbackName) {
      return function() {
        return type[callbackName].apply(type, arguments);
      };
    }

    // Wrap non-array value as array
    function arrayWrap(val) { return isArray(val) ? val : (isDefined(val) ? [ val ] : []); }
    // Unwrap array value for "auto" mode. Return undefined for empty array.
    function arrayUnwrap(val) {
      switch(val.length) {
        case 0: return undefined;
        case 1: return mode === "auto" ? val[0] : val;
        default: return val;
      }
    }
    function falsey(val) { return !val; }

    // Wraps type (.is/.encode/.decode) functions to operate on each value of an array
    function arrayHandler(callback, allTruthyMode) {
      return function handleArray(val) {
        val = arrayWrap(val);
        var result = map(val, callback);
        if (allTruthyMode === true)
          return filter(result, falsey).length === 0;
        return arrayUnwrap(result);
      };
    }

    // Wraps type (.equals) functions to operate on each value of an array
    function arrayEqualsHandler(callback) {
      return function handleArray(val1, val2) {
        var left = arrayWrap(val1), right = arrayWrap(val2);
        if (left.length !== right.length) return false;
        for (var i = 0; i < left.length; i++) {
          if (!callback(left[i], right[i])) return false;
        }
        return true;
      };
    }

    this.encode = arrayHandler(bindTo(type, 'encode'));
    this.decode = arrayHandler(bindTo(type, 'decode'));
    this.is     = arrayHandler(bindTo(type, 'is'), true);
    this.equals = arrayEqualsHandler(bindTo(type, 'equals'));
    this.pattern = type.pattern;
    this.$arrayMode = mode;
  }
};



/**
 * @ngdoc object
 * @name ui.router.util.$urlMatcherFactory
 *
 * @description
 * Factory for {@link ui.router.util.type:UrlMatcher `UrlMatcher`} instances. The factory
 * is also available to providers under the name `$urlMatcherFactoryProvider`.
 */
function $UrlMatcherFactory() {
  $$UMFP = this;

  var isCaseInsensitive = false, isStrictMode = true, defaultSquashPolicy = false;

  function valToString(val) { return val != null ? val.toString().replace(/\//g, "%2F") : val; }
  function valFromString(val) { return val != null ? val.toString().replace(/%2F/g, "/") : val; }
//  TODO: in 1.0, make string .is() return false if value is undefined by default.
//  function regexpMatches(val) { /*jshint validthis:true */ return isDefined(val) && this.pattern.test(val); }
  function regexpMatches(val) { /*jshint validthis:true */ return this.pattern.test(val); }

  var $types = {}, enqueue = true, typeQueue = [], injector, defaultTypes = {
    string: {
      encode: valToString,
      decode: valFromString,
      is: regexpMatches,
      pattern: /[^/]*/
    },
    int: {
      encode: valToString,
      decode: function(val) { return parseInt(val, 10); },
      is: function(val) { return isDefined(val) && this.decode(val.toString()) === val; },
      pattern: /\d+/
    },
    bool: {
      encode: function(val) { return val ? 1 : 0; },
      decode: function(val) { return parseInt(val, 10) !== 0; },
      is: function(val) { return val === true || val === false; },
      pattern: /0|1/
    },
    date: {
      encode: function (val) {
        if (!this.is(val))
          return undefined;
        return [ val.getFullYear(),
          ('0' + (val.getMonth() + 1)).slice(-2),
          ('0' + val.getDate()).slice(-2)
        ].join("-");
      },
      decode: function (val) {
        if (this.is(val)) return val;
        var match = this.capture.exec(val);
        return match ? new Date(match[1], match[2] - 1, match[3]) : undefined;
      },
      is: function(val) { return val instanceof Date && !isNaN(val.valueOf()); },
      equals: function (a, b) { return this.is(a) && this.is(b) && a.toISOString() === b.toISOString(); },
      pattern: /[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])/,
      capture: /([0-9]{4})-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])/
    },
    json: {
      encode: angular.toJson,
      decode: angular.fromJson,
      is: angular.isObject,
      equals: angular.equals,
      pattern: /[^/]*/
    },
    any: { // does not encode/decode
      encode: angular.identity,
      decode: angular.identity,
      is: angular.identity,
      equals: angular.equals,
      pattern: /.*/
    }
  };

  function getDefaultConfig() {
    return {
      strict: isStrictMode,
      caseInsensitive: isCaseInsensitive
    };
  }

  function isInjectable(value) {
    return (isFunction(value) || (isArray(value) && isFunction(value[value.length - 1])));
  }

  /**
   * [Internal] Get the default value of a parameter, which may be an injectable function.
   */
  $UrlMatcherFactory.$$getDefaultValue = function(config) {
    if (!isInjectable(config.value)) return config.value;
    if (!injector) throw new Error("Injectable functions cannot be called at configuration time");
    return injector.invoke(config.value);
  };

  /**
   * @ngdoc function
   * @name ui.router.util.$urlMatcherFactory#caseInsensitive
   * @methodOf ui.router.util.$urlMatcherFactory
   *
   * @description
   * Defines whether URL matching should be case sensitive (the default behavior), or not.
   *
   * @param {boolean} value `false` to match URL in a case sensitive manner; otherwise `true`;
   * @returns {boolean} the current value of caseInsensitive
   */
  this.caseInsensitive = function(value) {
    if (isDefined(value))
      isCaseInsensitive = value;
    return isCaseInsensitive;
  };

  /**
   * @ngdoc function
   * @name ui.router.util.$urlMatcherFactory#strictMode
   * @methodOf ui.router.util.$urlMatcherFactory
   *
   * @description
   * Defines whether URLs should match trailing slashes, or not (the default behavior).
   *
   * @param {boolean=} value `false` to match trailing slashes in URLs, otherwise `true`.
   * @returns {boolean} the current value of strictMode
   */
  this.strictMode = function(value) {
    if (isDefined(value))
      isStrictMode = value;
    return isStrictMode;
  };

  /**
   * @ngdoc function
   * @name ui.router.util.$urlMatcherFactory#defaultSquashPolicy
   * @methodOf ui.router.util.$urlMatcherFactory
   *
   * @description
   * Sets the default behavior when generating or matching URLs with default parameter values.
   *
   * @param {string} value A string that defines the default parameter URL squashing behavior.
   *    `nosquash`: When generating an href with a default parameter value, do not squash the parameter value from the URL
   *    `slash`: When generating an href with a default parameter value, squash (remove) the parameter value, and, if the
   *             parameter is surrounded by slashes, squash (remove) one slash from the URL
   *    any other string, e.g. "~": When generating an href with a default parameter value, squash (remove)
   *             the parameter value from the URL and replace it with this string.
   */
  this.defaultSquashPolicy = function(value) {
    if (!isDefined(value)) return defaultSquashPolicy;
    if (value !== true && value !== false && !isString(value))
      throw new Error("Invalid squash policy: " + value + ". Valid policies: false, true, arbitrary-string");
    defaultSquashPolicy = value;
    return value;
  };

  /**
   * @ngdoc function
   * @name ui.router.util.$urlMatcherFactory#compile
   * @methodOf ui.router.util.$urlMatcherFactory
   *
   * @description
   * Creates a {@link ui.router.util.type:UrlMatcher `UrlMatcher`} for the specified pattern.
   *
   * @param {string} pattern  The URL pattern.
   * @param {Object} config  The config object hash.
   * @returns {UrlMatcher}  The UrlMatcher.
   */
  this.compile = function (pattern, config) {
    return new UrlMatcher(pattern, extend(getDefaultConfig(), config));
  };

  /**
   * @ngdoc function
   * @name ui.router.util.$urlMatcherFactory#isMatcher
   * @methodOf ui.router.util.$urlMatcherFactory
   *
   * @description
   * Returns true if the specified object is a `UrlMatcher`, or false otherwise.
   *
   * @param {Object} object  The object to perform the type check against.
   * @returns {Boolean}  Returns `true` if the object matches the `UrlMatcher` interface, by
   *          implementing all the same methods.
   */
  this.isMatcher = function (o) {
    if (!isObject(o)) return false;
    var result = true;

    forEach(UrlMatcher.prototype, function(val, name) {
      if (isFunction(val)) {
        result = result && (isDefined(o[name]) && isFunction(o[name]));
      }
    });
    return result;
  };

  /**
   * @ngdoc function
   * @name ui.router.util.$urlMatcherFactory#type
   * @methodOf ui.router.util.$urlMatcherFactory
   *
   * @description
   * Registers a custom {@link ui.router.util.type:Type `Type`} object that can be used to
   * generate URLs with typed parameters.
   *
   * @param {string} name  The type name.
   * @param {Object|Function} definition   The type definition. See
   *        {@link ui.router.util.type:Type `Type`} for information on the values accepted.
   * @param {Object|Function} definitionFn (optional) A function that is injected before the app
   *        runtime starts.  The result of this function is merged into the existing `definition`.
   *        See {@link ui.router.util.type:Type `Type`} for information on the values accepted.
   *
   * @returns {Object}  Returns `$urlMatcherFactoryProvider`.
   *
   * @example
   * This is a simple example of a custom type that encodes and decodes items from an
   * array, using the array index as the URL-encoded value:
   *
   * <pre>
   * var list = ['John', 'Paul', 'George', 'Ringo'];
   *
   * $urlMatcherFactoryProvider.type('listItem', {
   *   encode: function(item) {
   *     // Represent the list item in the URL using its corresponding index
   *     return list.indexOf(item);
   *   },
   *   decode: function(item) {
   *     // Look up the list item by index
   *     return list[parseInt(item, 10)];
   *   },
   *   is: function(item) {
   *     // Ensure the item is valid by checking to see that it appears
   *     // in the list
   *     return list.indexOf(item) > -1;
   *   }
   * });
   *
   * $stateProvider.state('list', {
   *   url: "/list/{item:listItem}",
   *   controller: function($scope, $stateParams) {
   *     console.log($stateParams.item);
   *   }
   * });
   *
   * // ...
   *
   * // Changes URL to '/list/3', logs "Ringo" to the console
   * $state.go('list', { item: "Ringo" });
   * </pre>
   *
   * This is a more complex example of a type that relies on dependency injection to
   * interact with services, and uses the parameter name from the URL to infer how to
   * handle encoding and decoding parameter values:
   *
   * <pre>
   * // Defines a custom type that gets a value from a service,
   * // where each service gets different types of values from
   * // a backend API:
   * $urlMatcherFactoryProvider.type('dbObject', {}, function(Users, Posts) {
   *
   *   // Matches up services to URL parameter names
   *   var services = {
   *     user: Users,
   *     post: Posts
   *   };
   *
   *   return {
   *     encode: function(object) {
   *       // Represent the object in the URL using its unique ID
   *       return object.id;
   *     },
   *     decode: function(value, key) {
   *       // Look up the object by ID, using the parameter
   *       // name (key) to call the correct service
   *       return services[key].findById(value);
   *     },
   *     is: function(object, key) {
   *       // Check that object is a valid dbObject
   *       return angular.isObject(object) && object.id && services[key];
   *     }
   *     equals: function(a, b) {
   *       // Check the equality of decoded objects by comparing
   *       // their unique IDs
   *       return a.id === b.id;
   *     }
   *   };
   * });
   *
   * // In a config() block, you can then attach URLs with
   * // type-annotated parameters:
   * $stateProvider.state('users', {
   *   url: "/users",
   *   // ...
   * }).state('users.item', {
   *   url: "/{user:dbObject}",
   *   controller: function($scope, $stateParams) {
   *     // $stateParams.user will now be an object returned from
   *     // the Users service
   *   },
   *   // ...
   * });
   * </pre>
   */
  this.type = function (name, definition, definitionFn) {
    if (!isDefined(definition)) return $types[name];
    if ($types.hasOwnProperty(name)) throw new Error("A type named '" + name + "' has already been defined.");

    $types[name] = new Type(extend({ name: name }, definition));
    if (definitionFn) {
      typeQueue.push({ name: name, def: definitionFn });
      if (!enqueue) flushTypeQueue();
    }
    return this;
  };

  // `flushTypeQueue()` waits until `$urlMatcherFactory` is injected before invoking the queued `definitionFn`s
  function flushTypeQueue() {
    while(typeQueue.length) {
      var type = typeQueue.shift();
      if (type.pattern) throw new Error("You cannot override a type's .pattern at runtime.");
      angular.extend($types[type.name], injector.invoke(type.def));
    }
  }

  // Register default types. Store them in the prototype of $types.
  forEach(defaultTypes, function(type, name) { $types[name] = new Type(extend({name: name}, type)); });
  $types = inherit($types, {});

  /* No need to document $get, since it returns this */
  this.$get = ['$injector', function ($injector) {
    injector = $injector;
    enqueue = false;
    flushTypeQueue();

    forEach(defaultTypes, function(type, name) {
      if (!$types[name]) $types[name] = new Type(type);
    });
    return this;
  }];

  this.Param = function Param(id, type, config, location) {
    var self = this;
    config = unwrapShorthand(config);
    type = getType(config, type, location);
    var arrayMode = getArrayMode();
    type = arrayMode ? type.$asArray(arrayMode, location === "search") : type;
    if (type.name === "string" && !arrayMode && location === "path" && config.value === undefined)
      config.value = ""; // for 0.2.x; in 0.3.0+ do not automatically default to ""
    var isOptional = config.value !== undefined;
    var squash = getSquashPolicy(config, isOptional);
    var replace = getReplace(config, arrayMode, isOptional, squash);

    function unwrapShorthand(config) {
      var keys = isObject(config) ? objectKeys(config) : [];
      var isShorthand = indexOf(keys, "value") === -1 && indexOf(keys, "type") === -1 &&
                        indexOf(keys, "squash") === -1 && indexOf(keys, "array") === -1;
      if (isShorthand) config = { value: config };
      config.$$fn = isInjectable(config.value) ? config.value : function () { return config.value; };
      return config;
    }

    function getType(config, urlType, location) {
      if (config.type && urlType) throw new Error("Param '"+id+"' has two type configurations.");
      if (urlType) return urlType;
      if (!config.type) return (location === "config" ? $types.any : $types.string);
      return config.type instanceof Type ? config.type : new Type(config.type);
    }

    // array config: param name (param[]) overrides default settings.  explicit config overrides param name.
    function getArrayMode() {
      var arrayDefaults = { array: (location === "search" ? "auto" : false) };
      var arrayParamNomenclature = id.match(/\[\]$/) ? { array: true } : {};
      return extend(arrayDefaults, arrayParamNomenclature, config).array;
    }

    /**
     * returns false, true, or the squash value to indicate the "default parameter url squash policy".
     */
    function getSquashPolicy(config, isOptional) {
      var squash = config.squash;
      if (!isOptional || squash === false) return false;
      if (!isDefined(squash) || squash == null) return defaultSquashPolicy;
      if (squash === true || isString(squash)) return squash;
      throw new Error("Invalid squash policy: '" + squash + "'. Valid policies: false, true, or arbitrary string");
    }

    function getReplace(config, arrayMode, isOptional, squash) {
      var replace, configuredKeys, defaultPolicy = [
        { from: "",   to: (isOptional || arrayMode ? undefined : "") },
        { from: null, to: (isOptional || arrayMode ? undefined : "") }
      ];
      replace = isArray(config.replace) ? config.replace : [];
      if (isString(squash))
        replace.push({ from: squash, to: undefined });
      configuredKeys = map(replace, function(item) { return item.from; } );
      return filter(defaultPolicy, function(item) { return indexOf(configuredKeys, item.from) === -1; }).concat(replace);
    }

    /**
     * [Internal] Get the default value of a parameter, which may be an injectable function.
     */
    function $$getDefaultValue() {
      if (!injector) throw new Error("Injectable functions cannot be called at configuration time");
      return injector.invoke(config.$$fn);
    }

    /**
     * [Internal] Gets the decoded representation of a value if the value is defined, otherwise, returns the
     * default value, which may be the result of an injectable function.
     */
    function $value(value) {
      function hasReplaceVal(val) { return function(obj) { return obj.from === val; }; }
      function $replace(value) {
        var replacement = map(filter(self.replace, hasReplaceVal(value)), function(obj) { return obj.to; });
        return replacement.length ? replacement[0] : value;
      }
      value = $replace(value);
      return isDefined(value) ? self.type.decode(value) : $$getDefaultValue();
    }

    function toString() { return "{Param:" + id + " " + type + " squash: '" + squash + "' optional: " + isOptional + "}"; }

    extend(this, {
      id: id,
      type: type,
      location: location,
      array: arrayMode,
      squash: squash,
      replace: replace,
      isOptional: isOptional,
      value: $value,
      dynamic: undefined,
      config: config,
      toString: toString
    });
  };

  function ParamSet(params) {
    extend(this, params || {});
  }

  ParamSet.prototype = {
    $$new: function() {
      return inherit(this, extend(new ParamSet(), { $$parent: this}));
    },
    $$keys: function () {
      var keys = [], chain = [], parent = this,
        ignore = objectKeys(ParamSet.prototype);
      while (parent) { chain.push(parent); parent = parent.$$parent; }
      chain.reverse();
      forEach(chain, function(paramset) {
        forEach(objectKeys(paramset), function(key) {
            if (indexOf(keys, key) === -1 && indexOf(ignore, key) === -1) keys.push(key);
        });
      });
      return keys;
    },
    $$values: function(paramValues) {
      var values = {}, self = this;
      forEach(self.$$keys(), function(key) {
        values[key] = self[key].value(paramValues && paramValues[key]);
      });
      return values;
    },
    $$equals: function(paramValues1, paramValues2) {
      var equal = true, self = this;
      forEach(self.$$keys(), function(key) {
        var left = paramValues1 && paramValues1[key], right = paramValues2 && paramValues2[key];
        if (!self[key].type.equals(left, right)) equal = false;
      });
      return equal;
    },
    $$validates: function $$validate(paramValues) {
      var result = true, isOptional, val, param, self = this;

      forEach(this.$$keys(), function(key) {
        param = self[key];
        val = paramValues[key];
        isOptional = !val && param.isOptional;
        result = result && (isOptional || !!param.type.is(val));
      });
      return result;
    },
    $$parent: undefined
  };

  this.ParamSet = ParamSet;
}

// Register as a provider so it's available to other providers
angular.module('ui.router.util').provider('$urlMatcherFactory', $UrlMatcherFactory);
angular.module('ui.router.util').run(['$urlMatcherFactory', function($urlMatcherFactory) { }]);

/**
 * @ngdoc object
 * @name ui.router.router.$urlRouterProvider
 *
 * @requires ui.router.util.$urlMatcherFactoryProvider
 * @requires $locationProvider
 *
 * @description
 * `$urlRouterProvider` has the responsibility of watching `$location`. 
 * When `$location` changes it runs through a list of rules one by one until a 
 * match is found. `$urlRouterProvider` is used behind the scenes anytime you specify 
 * a url in a state configuration. All urls are compiled into a UrlMatcher object.
 *
 * There are several methods on `$urlRouterProvider` that make it useful to use directly
 * in your module config.
 */
$UrlRouterProvider.$inject = ['$locationProvider', '$urlMatcherFactoryProvider'];
function $UrlRouterProvider(   $locationProvider,   $urlMatcherFactory) {
  var rules = [], otherwise = null, interceptDeferred = false, listener;

  // Returns a string that is a prefix of all strings matching the RegExp
  function regExpPrefix(re) {
    var prefix = /^\^((?:\\[^a-zA-Z0-9]|[^\\\[\]\^$*+?.()|{}]+)*)/.exec(re.source);
    return (prefix != null) ? prefix[1].replace(/\\(.)/g, "$1") : '';
  }

  // Interpolates matched values into a String.replace()-style pattern
  function interpolate(pattern, match) {
    return pattern.replace(/\$(\$|\d{1,2})/, function (m, what) {
      return match[what === '$' ? 0 : Number(what)];
    });
  }

  /**
   * @ngdoc function
   * @name ui.router.router.$urlRouterProvider#rule
   * @methodOf ui.router.router.$urlRouterProvider
   *
   * @description
   * Defines rules that are used by `$urlRouterProvider` to find matches for
   * specific URLs.
   *
   * @example
   * <pre>
   * var app = angular.module('app', ['ui.router.router']);
   *
   * app.config(function ($urlRouterProvider) {
   *   // Here's an example of how you might allow case insensitive urls
   *   $urlRouterProvider.rule(function ($injector, $location) {
   *     var path = $location.path(),
   *         normalized = path.toLowerCase();
   *
   *     if (path !== normalized) {
   *       return normalized;
   *     }
   *   });
   * });
   * </pre>
   *
   * @param {object} rule Handler function that takes `$injector` and `$location`
   * services as arguments. You can use them to return a valid path as a string.
   *
   * @return {object} `$urlRouterProvider` - `$urlRouterProvider` instance
   */
  this.rule = function (rule) {
    if (!isFunction(rule)) throw new Error("'rule' must be a function");
    rules.push(rule);
    return this;
  };

  /**
   * @ngdoc object
   * @name ui.router.router.$urlRouterProvider#otherwise
   * @methodOf ui.router.router.$urlRouterProvider
   *
   * @description
   * Defines a path that is used when an invalid route is requested.
   *
   * @example
   * <pre>
   * var app = angular.module('app', ['ui.router.router']);
   *
   * app.config(function ($urlRouterProvider) {
   *   // if the path doesn't match any of the urls you configured
   *   // otherwise will take care of routing the user to the
   *   // specified url
   *   $urlRouterProvider.otherwise('/index');
   *
   *   // Example of using function rule as param
   *   $urlRouterProvider.otherwise(function ($injector, $location) {
   *     return '/a/valid/url';
   *   });
   * });
   * </pre>
   *
   * @param {string|object} rule The url path you want to redirect to or a function 
   * rule that returns the url path. The function version is passed two params: 
   * `$injector` and `$location` services, and must return a url string.
   *
   * @return {object} `$urlRouterProvider` - `$urlRouterProvider` instance
   */
  this.otherwise = function (rule) {
    if (isString(rule)) {
      var redirect = rule;
      rule = function () { return redirect; };
    }
    else if (!isFunction(rule)) throw new Error("'rule' must be a function");
    otherwise = rule;
    return this;
  };


  function handleIfMatch($injector, handler, match) {
    if (!match) return false;
    var result = $injector.invoke(handler, handler, { $match: match });
    return isDefined(result) ? result : true;
  }

  /**
   * @ngdoc function
   * @name ui.router.router.$urlRouterProvider#when
   * @methodOf ui.router.router.$urlRouterProvider
   *
   * @description
   * Registers a handler for a given url matching. if handle is a string, it is
   * treated as a redirect, and is interpolated according to the syntax of match
   * (i.e. like `String.replace()` for `RegExp`, or like a `UrlMatcher` pattern otherwise).
   *
   * If the handler is a function, it is injectable. It gets invoked if `$location`
   * matches. You have the option of inject the match object as `$match`.
   *
   * The handler can return
   *
   * - **falsy** to indicate that the rule didn't match after all, then `$urlRouter`
   *   will continue trying to find another one that matches.
   * - **string** which is treated as a redirect and passed to `$location.url()`
   * - **void** or any **truthy** value tells `$urlRouter` that the url was handled.
   *
   * @example
   * <pre>
   * var app = angular.module('app', ['ui.router.router']);
   *
   * app.config(function ($urlRouterProvider) {
   *   $urlRouterProvider.when($state.url, function ($match, $stateParams) {
   *     if ($state.$current.navigable !== state ||
   *         !equalForKeys($match, $stateParams) {
   *      $state.transitionTo(state, $match, false);
   *     }
   *   });
   * });
   * </pre>
   *
   * @param {string|object} what The incoming path that you want to redirect.
   * @param {string|object} handler The path you want to redirect your user to.
   */
  this.when = function (what, handler) {
    var redirect, handlerIsString = isString(handler);
    if (isString(what)) what = $urlMatcherFactory.compile(what);

    if (!handlerIsString && !isFunction(handler) && !isArray(handler))
      throw new Error("invalid 'handler' in when()");

    var strategies = {
      matcher: function (what, handler) {
        if (handlerIsString) {
          redirect = $urlMatcherFactory.compile(handler);
          handler = ['$match', function ($match) { return redirect.format($match); }];
        }
        return extend(function ($injector, $location) {
          return handleIfMatch($injector, handler, what.exec($location.path(), $location.search()));
        }, {
          prefix: isString(what.prefix) ? what.prefix : ''
        });
      },
      regex: function (what, handler) {
        if (what.global || what.sticky) throw new Error("when() RegExp must not be global or sticky");

        if (handlerIsString) {
          redirect = handler;
          handler = ['$match', function ($match) { return interpolate(redirect, $match); }];
        }
        return extend(function ($injector, $location) {
          return handleIfMatch($injector, handler, what.exec($location.path()));
        }, {
          prefix: regExpPrefix(what)
        });
      }
    };

    var check = { matcher: $urlMatcherFactory.isMatcher(what), regex: what instanceof RegExp };

    for (var n in check) {
      if (check[n]) return this.rule(strategies[n](what, handler));
    }

    throw new Error("invalid 'what' in when()");
  };

  /**
   * @ngdoc function
   * @name ui.router.router.$urlRouterProvider#deferIntercept
   * @methodOf ui.router.router.$urlRouterProvider
   *
   * @description
   * Disables (or enables) deferring location change interception.
   *
   * If you wish to customize the behavior of syncing the URL (for example, if you wish to
   * defer a transition but maintain the current URL), call this method at configuration time.
   * Then, at run time, call `$urlRouter.listen()` after you have configured your own
   * `$locationChangeSuccess` event handler.
   *
   * @example
   * <pre>
   * var app = angular.module('app', ['ui.router.router']);
   *
   * app.config(function ($urlRouterProvider) {
   *
   *   // Prevent $urlRouter from automatically intercepting URL changes;
   *   // this allows you to configure custom behavior in between
   *   // location changes and route synchronization:
   *   $urlRouterProvider.deferIntercept();
   *
   * }).run(function ($rootScope, $urlRouter, UserService) {
   *
   *   $rootScope.$on('$locationChangeSuccess', function(e) {
   *     // UserService is an example service for managing user state
   *     if (UserService.isLoggedIn()) return;
   *
   *     // Prevent $urlRouter's default handler from firing
   *     e.preventDefault();
   *
   *     UserService.handleLogin().then(function() {
   *       // Once the user has logged in, sync the current URL
   *       // to the router:
   *       $urlRouter.sync();
   *     });
   *   });
   *
   *   // Configures $urlRouter's listener *after* your custom listener
   *   $urlRouter.listen();
   * });
   * </pre>
   *
   * @param {boolean} defer Indicates whether to defer location change interception. Passing
            no parameter is equivalent to `true`.
   */
  this.deferIntercept = function (defer) {
    if (defer === undefined) defer = true;
    interceptDeferred = defer;
  };

  /**
   * @ngdoc object
   * @name ui.router.router.$urlRouter
   *
   * @requires $location
   * @requires $rootScope
   * @requires $injector
   * @requires $browser
   *
   * @description
   *
   */
  this.$get = $get;
  $get.$inject = ['$location', '$rootScope', '$injector', '$browser'];
  function $get(   $location,   $rootScope,   $injector,   $browser) {

    var baseHref = $browser.baseHref(), location = $location.url(), lastPushedUrl;

    function appendBasePath(url, isHtml5, absolute) {
      if (baseHref === '/') return url;
      if (isHtml5) return baseHref.slice(0, -1) + url;
      if (absolute) return baseHref.slice(1) + url;
      return url;
    }

    // TODO: Optimize groups of rules with non-empty prefix into some sort of decision tree
    function update(evt) {
      if (evt && evt.defaultPrevented) return;
      var ignoreUpdate = lastPushedUrl && $location.url() === lastPushedUrl;
      lastPushedUrl = undefined;
      if (ignoreUpdate) return true;

      function check(rule) {
        var handled = rule($injector, $location);

        if (!handled) return false;
        if (isString(handled)) $location.replace().url(handled);
        return true;
      }
      var n = rules.length, i;

      for (i = 0; i < n; i++) {
        if (check(rules[i])) return;
      }
      // always check otherwise last to allow dynamic updates to the set of rules
      if (otherwise) check(otherwise);
    }

    function listen() {
      listener = listener || $rootScope.$on('$locationChangeSuccess', update);
      return listener;
    }

    if (!interceptDeferred) listen();

    return {
      /**
       * @ngdoc function
       * @name ui.router.router.$urlRouter#sync
       * @methodOf ui.router.router.$urlRouter
       *
       * @description
       * Triggers an update; the same update that happens when the address bar url changes, aka `$locationChangeSuccess`.
       * This method is useful when you need to use `preventDefault()` on the `$locationChangeSuccess` event,
       * perform some custom logic (route protection, auth, config, redirection, etc) and then finally proceed
       * with the transition by calling `$urlRouter.sync()`.
       *
       * @example
       * <pre>
       * angular.module('app', ['ui.router'])
       *   .run(function($rootScope, $urlRouter) {
       *     $rootScope.$on('$locationChangeSuccess', function(evt) {
       *       // Halt state change from even starting
       *       evt.preventDefault();
       *       // Perform custom logic
       *       var meetsRequirement = ...
       *       // Continue with the update and state transition if logic allows
       *       if (meetsRequirement) $urlRouter.sync();
       *     });
       * });
       * </pre>
       */
      sync: function() {
        update();
      },

      listen: function() {
        return listen();
      },

      update: function(read) {
        if (read) {
          location = $location.url();
          return;
        }
        if ($location.url() === location) return;

        $location.url(location);
        $location.replace();
      },

      push: function(urlMatcher, params, options) {
        $location.url(urlMatcher.format(params || {}));
        lastPushedUrl = options && options.$$avoidResync ? $location.url() : undefined;
        if (options && options.replace) $location.replace();
      },

      /**
       * @ngdoc function
       * @name ui.router.router.$urlRouter#href
       * @methodOf ui.router.router.$urlRouter
       *
       * @description
       * A URL generation method that returns the compiled URL for a given
       * {@link ui.router.util.type:UrlMatcher `UrlMatcher`}, populated with the provided parameters.
       *
       * @example
       * <pre>
       * $bob = $urlRouter.href(new UrlMatcher("/about/:person"), {
       *   person: "bob"
       * });
       * // $bob == "/about/bob";
       * </pre>
       *
       * @param {UrlMatcher} urlMatcher The `UrlMatcher` object which is used as the template of the URL to generate.
       * @param {object=} params An object of parameter values to fill the matcher's required parameters.
       * @param {object=} options Options object. The options are:
       *
       * - **`absolute`** - {boolean=false},  If true will generate an absolute url, e.g. "http://www.example.com/fullurl".
       *
       * @returns {string} Returns the fully compiled URL, or `null` if `params` fail validation against `urlMatcher`
       */
      href: function(urlMatcher, params, options) {
        if (!urlMatcher.validates(params)) return null;

        var isHtml5 = $locationProvider.html5Mode();
        if (angular.isObject(isHtml5)) {
          isHtml5 = isHtml5.enabled;
        }
        
        var url = urlMatcher.format(params);
        options = options || {};

        if (!isHtml5 && url !== null) {
          url = "#" + $locationProvider.hashPrefix() + url;
        }
        url = appendBasePath(url, isHtml5, options.absolute);

        if (!options.absolute || !url) {
          return url;
        }

        var slash = (!isHtml5 && url ? '/' : ''), port = $location.port();
        port = (port === 80 || port === 443 ? '' : ':' + port);

        return [$location.protocol(), '://', $location.host(), port, slash, url].join('');
      }
    };
  }
}

angular.module('ui.router.router').provider('$urlRouter', $UrlRouterProvider);

/**
 * @ngdoc object
 * @name ui.router.state.$stateProvider
 *
 * @requires ui.router.router.$urlRouterProvider
 * @requires ui.router.util.$urlMatcherFactoryProvider
 *
 * @description
 * The new `$stateProvider` works similar to Angular's v1 router, but it focuses purely
 * on state.
 *
 * A state corresponds to a "place" in the application in terms of the overall UI and
 * navigation. A state describes (via the controller / template / view properties) what
 * the UI looks like and does at that place.
 *
 * States often have things in common, and the primary way of factoring out these
 * commonalities in this model is via the state hierarchy, i.e. parent/child states aka
 * nested states.
 *
 * The `$stateProvider` provides interfaces to declare these states for your app.
 */
$StateProvider.$inject = ['$urlRouterProvider', '$urlMatcherFactoryProvider'];
function $StateProvider(   $urlRouterProvider,   $urlMatcherFactory) {

  var root, states = {}, $state, queue = {}, abstractKey = 'abstract';

  // Builds state properties from definition passed to registerState()
  var stateBuilder = {

    // Derive parent state from a hierarchical name only if 'parent' is not explicitly defined.
    // state.children = [];
    // if (parent) parent.children.push(state);
    parent: function(state) {
      if (isDefined(state.parent) && state.parent) return findState(state.parent);
      // regex matches any valid composite state name
      // would match "contact.list" but not "contacts"
      var compositeName = /^(.+)\.[^.]+$/.exec(state.name);
      return compositeName ? findState(compositeName[1]) : root;
    },

    // inherit 'data' from parent and override by own values (if any)
    data: function(state) {
      if (state.parent && state.parent.data) {
        state.data = state.self.data = extend({}, state.parent.data, state.data);
      }
      return state.data;
    },

    // Build a URLMatcher if necessary, either via a relative or absolute URL
    url: function(state) {
      var url = state.url, config = { params: state.params || {} };

      if (isString(url)) {
        if (url.charAt(0) == '^') return $urlMatcherFactory.compile(url.substring(1), config);
        return (state.parent.navigable || root).url.concat(url, config);
      }

      if (!url || $urlMatcherFactory.isMatcher(url)) return url;
      throw new Error("Invalid url '" + url + "' in state '" + state + "'");
    },

    // Keep track of the closest ancestor state that has a URL (i.e. is navigable)
    navigable: function(state) {
      return state.url ? state : (state.parent ? state.parent.navigable : null);
    },

    // Own parameters for this state. state.url.params is already built at this point. Create and add non-url params
    ownParams: function(state) {
      var params = state.url && state.url.params || new $$UMFP.ParamSet();
      forEach(state.params || {}, function(config, id) {
        if (!params[id]) params[id] = new $$UMFP.Param(id, null, config, "config");
      });
      return params;
    },

    // Derive parameters for this state and ensure they're a super-set of parent's parameters
    params: function(state) {
      return state.parent && state.parent.params ? extend(state.parent.params.$$new(), state.ownParams) : new $$UMFP.ParamSet();
    },

    // If there is no explicit multi-view configuration, make one up so we don't have
    // to handle both cases in the view directive later. Note that having an explicit
    // 'views' property will mean the default unnamed view properties are ignored. This
    // is also a good time to resolve view names to absolute names, so everything is a
    // straight lookup at link time.
    views: function(state) {
      var views = {};

      forEach(isDefined(state.views) ? state.views : { '': state }, function (view, name) {
        if (name.indexOf('@') < 0) name += '@' + state.parent.name;
        views[name] = view;
      });
      return views;
    },

    // Keep a full path from the root down to this state as this is needed for state activation.
    path: function(state) {
      return state.parent ? state.parent.path.concat(state) : []; // exclude root from path
    },

    // Speed up $state.contains() as it's used a lot
    includes: function(state) {
      var includes = state.parent ? extend({}, state.parent.includes) : {};
      includes[state.name] = true;
      return includes;
    },

    $delegates: {}
  };

  function isRelative(stateName) {
    return stateName.indexOf(".") === 0 || stateName.indexOf("^") === 0;
  }

  function findState(stateOrName, base) {
    if (!stateOrName) return undefined;

    var isStr = isString(stateOrName),
        name  = isStr ? stateOrName : stateOrName.name,
        path  = isRelative(name);

    if (path) {
      if (!base) throw new Error("No reference point given for path '"  + name + "'");
      base = findState(base);
      
      var rel = name.split("."), i = 0, pathLength = rel.length, current = base;

      for (; i < pathLength; i++) {
        if (rel[i] === "" && i === 0) {
          current = base;
          continue;
        }
        if (rel[i] === "^") {
          if (!current.parent) throw new Error("Path '" + name + "' not valid for state '" + base.name + "'");
          current = current.parent;
          continue;
        }
        break;
      }
      rel = rel.slice(i).join(".");
      name = current.name + (current.name && rel ? "." : "") + rel;
    }
    var state = states[name];

    if (state && (isStr || (!isStr && (state === stateOrName || state.self === stateOrName)))) {
      return state;
    }
    return undefined;
  }

  function queueState(parentName, state) {
    if (!queue[parentName]) {
      queue[parentName] = [];
    }
    queue[parentName].push(state);
  }

  function flushQueuedChildren(parentName) {
    var queued = queue[parentName] || [];
    while(queued.length) {
      registerState(queued.shift());
    }
  }

  function registerState(state) {
    // Wrap a new object around the state so we can store our private details easily.
    state = inherit(state, {
      self: state,
      resolve: state.resolve || {},
      toString: function() { return this.name; }
    });

    var name = state.name;
    if (!isString(name) || name.indexOf('@') >= 0) throw new Error("State must have a valid name");
    if (states.hasOwnProperty(name)) throw new Error("State '" + name + "'' is already defined");

    // Get parent name
    var parentName = (name.indexOf('.') !== -1) ? name.substring(0, name.lastIndexOf('.'))
        : (isString(state.parent)) ? state.parent
        : (isObject(state.parent) && isString(state.parent.name)) ? state.parent.name
        : '';

    // If parent is not registered yet, add state to queue and register later
    if (parentName && !states[parentName]) {
      return queueState(parentName, state.self);
    }

    for (var key in stateBuilder) {
      if (isFunction(stateBuilder[key])) state[key] = stateBuilder[key](state, stateBuilder.$delegates[key]);
    }
    states[name] = state;

    // Register the state in the global state list and with $urlRouter if necessary.
    if (!state[abstractKey] && state.url) {
      $urlRouterProvider.when(state.url, ['$match', '$stateParams', function ($match, $stateParams) {
        if ($state.$current.navigable != state || !equalForKeys($match, $stateParams)) {
          $state.transitionTo(state, $match, { inherit: true, location: false });
        }
      }]);
    }

    // Register any queued children
    flushQueuedChildren(name);

    return state;
  }

  // Checks text to see if it looks like a glob.
  function isGlob (text) {
    return text.indexOf('*') > -1;
  }

  // Returns true if glob matches current $state name.
  function doesStateMatchGlob (glob) {
    var globSegments = glob.split('.'),
        segments = $state.$current.name.split('.');

    //match greedy starts
    if (globSegments[0] === '**') {
       segments = segments.slice(indexOf(segments, globSegments[1]));
       segments.unshift('**');
    }
    //match greedy ends
    if (globSegments[globSegments.length - 1] === '**') {
       segments.splice(indexOf(segments, globSegments[globSegments.length - 2]) + 1, Number.MAX_VALUE);
       segments.push('**');
    }

    if (globSegments.length != segments.length) {
      return false;
    }

    //match single stars
    for (var i = 0, l = globSegments.length; i < l; i++) {
      if (globSegments[i] === '*') {
        segments[i] = '*';
      }
    }

    return segments.join('') === globSegments.join('');
  }


  // Implicit root state that is always active
  root = registerState({
    name: '',
    url: '^',
    views: null,
    'abstract': true
  });
  root.navigable = null;


  /**
   * @ngdoc function
   * @name ui.router.state.$stateProvider#decorator
   * @methodOf ui.router.state.$stateProvider
   *
   * @description
   * Allows you to extend (carefully) or override (at your own peril) the 
   * `stateBuilder` object used internally by `$stateProvider`. This can be used 
   * to add custom functionality to ui-router, for example inferring templateUrl 
   * based on the state name.
   *
   * When passing only a name, it returns the current (original or decorated) builder
   * function that matches `name`.
   *
   * The builder functions that can be decorated are listed below. Though not all
   * necessarily have a good use case for decoration, that is up to you to decide.
   *
   * In addition, users can attach custom decorators, which will generate new 
   * properties within the state's internal definition. There is currently no clear 
   * use-case for this beyond accessing internal states (i.e. $state.$current), 
   * however, expect this to become increasingly relevant as we introduce additional 
   * meta-programming features.
   *
   * **Warning**: Decorators should not be interdependent because the order of 
   * execution of the builder functions in non-deterministic. Builder functions 
   * should only be dependent on the state definition object and super function.
   *
   *
   * Existing builder functions and current return values:
   *
   * - **parent** `{object}` - returns the parent state object.
   * - **data** `{object}` - returns state data, including any inherited data that is not
   *   overridden by own values (if any).
   * - **url** `{object}` - returns a {@link ui.router.util.type:UrlMatcher UrlMatcher}
   *   or `null`.
   * - **navigable** `{object}` - returns closest ancestor state that has a URL (aka is 
   *   navigable).
   * - **params** `{object}` - returns an array of state params that are ensured to 
   *   be a super-set of parent's params.
   * - **views** `{object}` - returns a views object where each key is an absolute view 
   *   name (i.e. "viewName@stateName") and each value is the config object 
   *   (template, controller) for the view. Even when you don't use the views object 
   *   explicitly on a state config, one is still created for you internally.
   *   So by decorating this builder function you have access to decorating template 
   *   and controller properties.
   * - **ownParams** `{object}` - returns an array of params that belong to the state, 
   *   not including any params defined by ancestor states.
   * - **path** `{string}` - returns the full path from the root down to this state. 
   *   Needed for state activation.
   * - **includes** `{object}` - returns an object that includes every state that 
   *   would pass a `$state.includes()` test.
   *
   * @example
   * <pre>
   * // Override the internal 'views' builder with a function that takes the state
   * // definition, and a reference to the internal function being overridden:
   * $stateProvider.decorator('views', function (state, parent) {
   *   var result = {},
   *       views = parent(state);
   *
   *   angular.forEach(views, function (config, name) {
   *     var autoName = (state.name + '.' + name).replace('.', '/');
   *     config.templateUrl = config.templateUrl || '/partials/' + autoName + '.html';
   *     result[name] = config;
   *   });
   *   return result;
   * });
   *
   * $stateProvider.state('home', {
   *   views: {
   *     'contact.list': { controller: 'ListController' },
   *     'contact.item': { controller: 'ItemController' }
   *   }
   * });
   *
   * // ...
   *
   * $state.go('home');
   * // Auto-populates list and item views with /partials/home/contact/list.html,
   * // and /partials/home/contact/item.html, respectively.
   * </pre>
   *
   * @param {string} name The name of the builder function to decorate. 
   * @param {object} func A function that is responsible for decorating the original 
   * builder function. The function receives two parameters:
   *
   *   - `{object}` - state - The state config object.
   *   - `{object}` - super - The original builder function.
   *
   * @return {object} $stateProvider - $stateProvider instance
   */
  this.decorator = decorator;
  function decorator(name, func) {
    /*jshint validthis: true */
    if (isString(name) && !isDefined(func)) {
      return stateBuilder[name];
    }
    if (!isFunction(func) || !isString(name)) {
      return this;
    }
    if (stateBuilder[name] && !stateBuilder.$delegates[name]) {
      stateBuilder.$delegates[name] = stateBuilder[name];
    }
    stateBuilder[name] = func;
    return this;
  }

  /**
   * @ngdoc function
   * @name ui.router.state.$stateProvider#state
   * @methodOf ui.router.state.$stateProvider
   *
   * @description
   * Registers a state configuration under a given state name. The stateConfig object
   * has the following acceptable properties.
   *
   * @param {string} name A unique state name, e.g. "home", "about", "contacts".
   * To create a parent/child state use a dot, e.g. "about.sales", "home.newest".
   * @param {object} stateConfig State configuration object.
   * @param {string|function=} stateConfig.template
   * <a id='template'></a>
   *   html template as a string or a function that returns
   *   an html template as a string which should be used by the uiView directives. This property 
   *   takes precedence over templateUrl.
   *   
   *   If `template` is a function, it will be called with the following parameters:
   *
   *   - {array.&lt;object&gt;} - state parameters extracted from the current $location.path() by
   *     applying the current state
   *
   * <pre>template:
   *   "<h1>inline template definition</h1>" +
   *   "<div ui-view></div>"</pre>
   * <pre>template: function(params) {
   *       return "<h1>generated template</h1>"; }</pre>
   * </div>
   *
   * @param {string|function=} stateConfig.templateUrl
   * <a id='templateUrl'></a>
   *
   *   path or function that returns a path to an html
   *   template that should be used by uiView.
   *   
   *   If `templateUrl` is a function, it will be called with the following parameters:
   *
   *   - {array.&lt;object&gt;} - state parameters extracted from the current $location.path() by 
   *     applying the current state
   *
   * <pre>templateUrl: "home.html"</pre>
   * <pre>templateUrl: function(params) {
   *     return myTemplates[params.pageId]; }</pre>
   *
   * @param {function=} stateConfig.templateProvider
   * <a id='templateProvider'></a>
   *    Provider function that returns HTML content string.
   * <pre> templateProvider:
   *       function(MyTemplateService, params) {
   *         return MyTemplateService.getTemplate(params.pageId);
   *       }</pre>
   *
   * @param {string|function=} stateConfig.controller
   * <a id='controller'></a>
   *
   *  Controller fn that should be associated with newly
   *   related scope or the name of a registered controller if passed as a string.
   *   Optionally, the ControllerAs may be declared here.
   * <pre>controller: "MyRegisteredController"</pre>
   * <pre>controller:
   *     "MyRegisteredController as fooCtrl"}</pre>
   * <pre>controller: function($scope, MyService) {
   *     $scope.data = MyService.getData(); }</pre>
   *
   * @param {function=} stateConfig.controllerProvider
   * <a id='controllerProvider'></a>
   *
   * Injectable provider function that returns the actual controller or string.
   * <pre>controllerProvider:
   *   function(MyResolveData) {
   *     if (MyResolveData.foo)
   *       return "FooCtrl"
   *     else if (MyResolveData.bar)
   *       return "BarCtrl";
   *     else return function($scope) {
   *       $scope.baz = "Qux";
   *     }
   *   }</pre>
   *
   * @param {string=} stateConfig.controllerAs
   * <a id='controllerAs'></a>
   * 
   * A controller alias name. If present the controller will be
   *   published to scope under the controllerAs name.
   * <pre>controllerAs: "myCtrl"</pre>
   *
   * @param {object=} stateConfig.resolve
   * <a id='resolve'></a>
   *
   * An optional map&lt;string, function&gt; of dependencies which
   *   should be injected into the controller. If any of these dependencies are promises, 
   *   the router will wait for them all to be resolved before the controller is instantiated.
   *   If all the promises are resolved successfully, the $stateChangeSuccess event is fired
   *   and the values of the resolved promises are injected into any controllers that reference them.
   *   If any  of the promises are rejected the $stateChangeError event is fired.
   *
   *   The map object is:
   *   
   *   - key - {string}: name of dependency to be injected into controller
   *   - factory - {string|function}: If string then it is alias for service. Otherwise if function, 
   *     it is injected and return value it treated as dependency. If result is a promise, it is 
   *     resolved before its value is injected into controller.
   *
   * <pre>resolve: {
   *     myResolve1:
   *       function($http, $stateParams) {
   *         return $http.get("/api/foos/"+stateParams.fooID);
   *       }
   *     }</pre>
   *
   * @param {string=} stateConfig.url
   * <a id='url'></a>
   *
   *   A url fragment with optional parameters. When a state is navigated or
   *   transitioned to, the `$stateParams` service will be populated with any 
   *   parameters that were passed.
   *
   * examples:
   * <pre>url: "/home"
   * url: "/users/:userid"
   * url: "/books/{bookid:[a-zA-Z_-]}"
   * url: "/books/{categoryid:int}"
   * url: "/books/{publishername:string}/{categoryid:int}"
   * url: "/messages?before&after"
   * url: "/messages?{before:date}&{after:date}"</pre>
   * url: "/messages/:mailboxid?{before:date}&{after:date}"
   *
   * @param {object=} stateConfig.views
   * <a id='views'></a>
   * an optional map&lt;string, object&gt; which defined multiple views, or targets views
   * manually/explicitly.
   *
   * Examples:
   *
   * Targets three named `ui-view`s in the parent state's template
   * <pre>views: {
   *     header: {
   *       controller: "headerCtrl",
   *       templateUrl: "header.html"
   *     }, body: {
   *       controller: "bodyCtrl",
   *       templateUrl: "body.html"
   *     }, footer: {
   *       controller: "footCtrl",
   *       templateUrl: "footer.html"
   *     }
   *   }</pre>
   *
   * Targets named `ui-view="header"` from grandparent state 'top''s template, and named `ui-view="body" from parent state's template.
   * <pre>views: {
   *     'header@top': {
   *       controller: "msgHeaderCtrl",
   *       templateUrl: "msgHeader.html"
   *     }, 'body': {
   *       controller: "messagesCtrl",
   *       templateUrl: "messages.html"
   *     }
   *   }</pre>
   *
   * @param {boolean=} [stateConfig.abstract=false]
   * <a id='abstract'></a>
   * An abstract state will never be directly activated,
   *   but can provide inherited properties to its common children states.
   * <pre>abstract: true</pre>
   *
   * @param {function=} stateConfig.onEnter
   * <a id='onEnter'></a>
   *
   * Callback function for when a state is entered. Good way
   *   to trigger an action or dispatch an event, such as opening a dialog.
   * If minifying your scripts, make sure to explictly annotate this function,
   * because it won't be automatically annotated by your build tools.
   *
   * <pre>onEnter: function(MyService, $stateParams) {
   *     MyService.foo($stateParams.myParam);
   * }</pre>
   *
   * @param {function=} stateConfig.onExit
   * <a id='onExit'></a>
   *
   * Callback function for when a state is exited. Good way to
   *   trigger an action or dispatch an event, such as opening a dialog.
   * If minifying your scripts, make sure to explictly annotate this function,
   * because it won't be automatically annotated by your build tools.
   *
   * <pre>onExit: function(MyService, $stateParams) {
   *     MyService.cleanup($stateParams.myParam);
   * }</pre>
   *
   * @param {boolean=} [stateConfig.reloadOnSearch=true]
   * <a id='reloadOnSearch'></a>
   *
   * If `false`, will not retrigger the same state
   *   just because a search/query parameter has changed (via $location.search() or $location.hash()). 
   *   Useful for when you'd like to modify $location.search() without triggering a reload.
   * <pre>reloadOnSearch: false</pre>
   *
   * @param {object=} stateConfig.data
   * <a id='data'></a>
   *
   * Arbitrary data object, useful for custom configuration.  The parent state's `data` is
   *   prototypally inherited.  In other words, adding a data property to a state adds it to
   *   the entire subtree via prototypal inheritance.
   *
   * <pre>data: {
   *     requiredRole: 'foo'
   * } </pre>
   *
   * @param {object=} stateConfig.params
   * <a id='params'></a>
   *
   * A map which optionally configures parameters declared in the `url`, or
   *   defines additional non-url parameters.  For each parameter being
   *   configured, add a configuration object keyed to the name of the parameter.
   *
   *   Each parameter configuration object may contain the following properties:
   *
   *   - ** value ** - {object|function=}: specifies the default value for this
   *     parameter.  This implicitly sets this parameter as optional.
   *
   *     When UI-Router routes to a state and no value is
   *     specified for this parameter in the URL or transition, the
   *     default value will be used instead.  If `value` is a function,
   *     it will be injected and invoked, and the return value used.
   *
   *     *Note*: `undefined` is treated as "no default value" while `null`
   *     is treated as "the default value is `null`".
   *
   *     *Shorthand*: If you only need to configure the default value of the
   *     parameter, you may use a shorthand syntax.   In the **`params`**
   *     map, instead mapping the param name to a full parameter configuration
   *     object, simply set map it to the default parameter value, e.g.:
   *
   * <pre>// define a parameter's default value
   * params: {
   *     param1: { value: "defaultValue" }
   * }
   * // shorthand default values
   * params: {
   *     param1: "defaultValue",
   *     param2: "param2Default"
   * }</pre>
   *
   *   - ** array ** - {boolean=}: *(default: false)* If true, the param value will be
   *     treated as an array of values.  If you specified a Type, the value will be
   *     treated as an array of the specified Type.  Note: query parameter values
   *     default to a special `"auto"` mode.
   *
   *     For query parameters in `"auto"` mode, if multiple  values for a single parameter
   *     are present in the URL (e.g.: `/foo?bar=1&bar=2&bar=3`) then the values
   *     are mapped to an array (e.g.: `{ foo: [ '1', '2', '3' ] }`).  However, if
   *     only one value is present (e.g.: `/foo?bar=1`) then the value is treated as single
   *     value (e.g.: `{ foo: '1' }`).
   *
   * <pre>params: {
   *     param1: { array: true }
   * }</pre>
   *
   *   - ** squash ** - {bool|string=}: `squash` configures how a default parameter value is represented in the URL when
   *     the current parameter value is the same as the default value. If `squash` is not set, it uses the
   *     configured default squash policy.
   *     (See {@link ui.router.util.$urlMatcherFactory#methods_defaultSquashPolicy `defaultSquashPolicy()`})
   *
   *   There are three squash settings:
   *
   *     - false: The parameter's default value is not squashed.  It is encoded and included in the URL
   *     - true: The parameter's default value is omitted from the URL.  If the parameter is preceeded and followed
   *       by slashes in the state's `url` declaration, then one of those slashes are omitted.
   *       This can allow for cleaner looking URLs.
   *     - `"<arbitrary string>"`: The parameter's default value is replaced with an arbitrary placeholder of  your choice.
   *
   * <pre>params: {
   *     param1: {
   *       value: "defaultId",
   *       squash: true
   * } }
   * // squash "defaultValue" to "~"
   * params: {
   *     param1: {
   *       value: "defaultValue",
   *       squash: "~"
   * } }
   * </pre>
   *
   *
   * @example
   * <pre>
   * // Some state name examples
   *
   * // stateName can be a single top-level name (must be unique).
   * $stateProvider.state("home", {});
   *
   * // Or it can be a nested state name. This state is a child of the
   * // above "home" state.
   * $stateProvider.state("home.newest", {});
   *
   * // Nest states as deeply as needed.
   * $stateProvider.state("home.newest.abc.xyz.inception", {});
   *
   * // state() returns $stateProvider, so you can chain state declarations.
   * $stateProvider
   *   .state("home", {})
   *   .state("about", {})
   *   .state("contacts", {});
   * </pre>
   *
   */
  this.state = state;
  function state(name, definition) {
    /*jshint validthis: true */
    if (isObject(name)) definition = name;
    else definition.name = name;
    registerState(definition);
    return this;
  }

  /**
   * @ngdoc object
   * @name ui.router.state.$state
   *
   * @requires $rootScope
   * @requires $q
   * @requires ui.router.state.$view
   * @requires $injector
   * @requires ui.router.util.$resolve
   * @requires ui.router.state.$stateParams
   * @requires ui.router.router.$urlRouter
   *
   * @property {object} params A param object, e.g. {sectionId: section.id)}, that 
   * you'd like to test against the current active state.
   * @property {object} current A reference to the state's config object. However 
   * you passed it in. Useful for accessing custom data.
   * @property {object} transition Currently pending transition. A promise that'll 
   * resolve or reject.
   *
   * @description
   * `$state` service is responsible for representing states as well as transitioning
   * between them. It also provides interfaces to ask for current state or even states
   * you're coming from.
   */
  this.$get = $get;
  $get.$inject = ['$rootScope', '$q', '$view', '$injector', '$resolve', '$stateParams', '$urlRouter', '$location', '$urlMatcherFactory'];
  function $get(   $rootScope,   $q,   $view,   $injector,   $resolve,   $stateParams,   $urlRouter,   $location,   $urlMatcherFactory) {

    var TransitionSuperseded = $q.reject(new Error('transition superseded'));
    var TransitionPrevented = $q.reject(new Error('transition prevented'));
    var TransitionAborted = $q.reject(new Error('transition aborted'));
    var TransitionFailed = $q.reject(new Error('transition failed'));

    // Handles the case where a state which is the target of a transition is not found, and the user
    // can optionally retry or defer the transition
    function handleRedirect(redirect, state, params, options) {
      /**
       * @ngdoc event
       * @name ui.router.state.$state#$stateNotFound
       * @eventOf ui.router.state.$state
       * @eventType broadcast on root scope
       * @description
       * Fired when a requested state **cannot be found** using the provided state name during transition.
       * The event is broadcast allowing any handlers a single chance to deal with the error (usually by
       * lazy-loading the unfound state). A special `unfoundState` object is passed to the listener handler,
       * you can see its three properties in the example. You can use `event.preventDefault()` to abort the
       * transition and the promise returned from `go` will be rejected with a `'transition aborted'` value.
       *
       * @param {Object} event Event object.
       * @param {Object} unfoundState Unfound State information. Contains: `to, toParams, options` properties.
       * @param {State} fromState Current state object.
       * @param {Object} fromParams Current state params.
       *
       * @example
       *
       * <pre>
       * // somewhere, assume lazy.state has not been defined
       * $state.go("lazy.state", {a:1, b:2}, {inherit:false});
       *
       * // somewhere else
       * $scope.$on('$stateNotFound',
       * function(event, unfoundState, fromState, fromParams){
       *     console.log(unfoundState.to); // "lazy.state"
       *     console.log(unfoundState.toParams); // {a:1, b:2}
       *     console.log(unfoundState.options); // {inherit:false} + default options
       * })
       * </pre>
       */
      var evt = $rootScope.$broadcast('$stateNotFound', redirect, state, params);

      if (evt.defaultPrevented) {
        $urlRouter.update();
        return TransitionAborted;
      }

      if (!evt.retry) {
        return null;
      }

      // Allow the handler to return a promise to defer state lookup retry
      if (options.$retry) {
        $urlRouter.update();
        return TransitionFailed;
      }
      var retryTransition = $state.transition = $q.when(evt.retry);

      retryTransition.then(function() {
        if (retryTransition !== $state.transition) return TransitionSuperseded;
        redirect.options.$retry = true;
        return $state.transitionTo(redirect.to, redirect.toParams, redirect.options);
      }, function() {
        return TransitionAborted;
      });
      $urlRouter.update();

      return retryTransition;
    }

    root.locals = { resolve: null, globals: { $stateParams: {} } };

    $state = {
      params: {},
      current: root.self,
      $current: root,
      transition: null
    };

    /**
     * @ngdoc function
     * @name ui.router.state.$state#reload
     * @methodOf ui.router.state.$state
     *
     * @description
     * A method that force reloads the current state. All resolves are re-resolved, events are not re-fired, 
     * and controllers reinstantiated (bug with controllers reinstantiating right now, fixing soon).
     *
     * @example
     * <pre>
     * var app angular.module('app', ['ui.router']);
     *
     * app.controller('ctrl', function ($scope, $state) {
     *   $scope.reload = function(){
     *     $state.reload();
     *   }
     * });
     * </pre>
     *
     * `reload()` is just an alias for:
     * <pre>
     * $state.transitionTo($state.current, $stateParams, { 
     *   reload: true, inherit: false, notify: true
     * });
     * </pre>
     *
     * @returns {promise} A promise representing the state of the new transition. See
     * {@link ui.router.state.$state#methods_go $state.go}.
     */
    $state.reload = function reload() {
      return $state.transitionTo($state.current, $stateParams, { reload: true, inherit: false, notify: true });
    };

    /**
     * @ngdoc function
     * @name ui.router.state.$state#go
     * @methodOf ui.router.state.$state
     *
     * @description
     * Convenience method for transitioning to a new state. `$state.go` calls 
     * `$state.transitionTo` internally but automatically sets options to 
     * `{ location: true, inherit: true, relative: $state.$current, notify: true }`. 
     * This allows you to easily use an absolute or relative to path and specify 
     * only the parameters you'd like to update (while letting unspecified parameters 
     * inherit from the currently active ancestor states).
     *
     * @example
     * <pre>
     * var app = angular.module('app', ['ui.router']);
     *
     * app.controller('ctrl', function ($scope, $state) {
     *   $scope.changeState = function () {
     *     $state.go('contact.detail');
     *   };
     * });
     * </pre>
     * <img src='../ngdoc_assets/StateGoExamples.png'/>
     *
     * @param {string} to Absolute state name or relative state path. Some examples:
     *
     * - `$state.go('contact.detail')` - will go to the `contact.detail` state
     * - `$state.go('^')` - will go to a parent state
     * - `$state.go('^.sibling')` - will go to a sibling state
     * - `$state.go('.child.grandchild')` - will go to grandchild state
     *
     * @param {object=} params A map of the parameters that will be sent to the state, 
     * will populate $stateParams. Any parameters that are not specified will be inherited from currently 
     * defined parameters. This allows, for example, going to a sibling state that shares parameters
     * specified in a parent state. Parameter inheritance only works between common ancestor states, I.e.
     * transitioning to a sibling will get you the parameters for all parents, transitioning to a child
     * will get you all current parameters, etc.
     * @param {object=} options Options object. The options are:
     *
     * - **`location`** - {boolean=true|string=} - If `true` will update the url in the location bar, if `false`
     *    will not. If string, must be `"replace"`, which will update url and also replace last history record.
     * - **`inherit`** - {boolean=true}, If `true` will inherit url parameters from current url.
     * - **`relative`** - {object=$state.$current}, When transitioning with relative path (e.g '^'), 
     *    defines which state to be relative from.
     * - **`notify`** - {boolean=true}, If `true` will broadcast $stateChangeStart and $stateChangeSuccess events.
     * - **`reload`** (v0.2.5) - {boolean=false}, If `true` will force transition even if the state or params 
     *    have not changed, aka a reload of the same state. It differs from reloadOnSearch because you'd
     *    use this when you want to force a reload when *everything* is the same, including search params.
     *
     * @returns {promise} A promise representing the state of the new transition.
     *
     * Possible success values:
     *
     * - $state.current
     *
     * <br/>Possible rejection values:
     *
     * - 'transition superseded' - when a newer transition has been started after this one
     * - 'transition prevented' - when `event.preventDefault()` has been called in a `$stateChangeStart` listener
     * - 'transition aborted' - when `event.preventDefault()` has been called in a `$stateNotFound` listener or
     *   when a `$stateNotFound` `event.retry` promise errors.
     * - 'transition failed' - when a state has been unsuccessfully found after 2 tries.
     * - *resolve error* - when an error has occurred with a `resolve`
     *
     */
    $state.go = function go(to, params, options) {
      return $state.transitionTo(to, params, extend({ inherit: true, relative: $state.$current }, options));
    };

    /**
     * @ngdoc function
     * @name ui.router.state.$state#transitionTo
     * @methodOf ui.router.state.$state
     *
     * @description
     * Low-level method for transitioning to a new state. {@link ui.router.state.$state#methods_go $state.go}
     * uses `transitionTo` internally. `$state.go` is recommended in most situations.
     *
     * @example
     * <pre>
     * var app = angular.module('app', ['ui.router']);
     *
     * app.controller('ctrl', function ($scope, $state) {
     *   $scope.changeState = function () {
     *     $state.transitionTo('contact.detail');
     *   };
     * });
     * </pre>
     *
     * @param {string} to State name.
     * @param {object=} toParams A map of the parameters that will be sent to the state,
     * will populate $stateParams.
     * @param {object=} options Options object. The options are:
     *
     * - **`location`** - {boolean=true|string=} - If `true` will update the url in the location bar, if `false`
     *    will not. If string, must be `"replace"`, which will update url and also replace last history record.
     * - **`inherit`** - {boolean=false}, If `true` will inherit url parameters from current url.
     * - **`relative`** - {object=}, When transitioning with relative path (e.g '^'), 
     *    defines which state to be relative from.
     * - **`notify`** - {boolean=true}, If `true` will broadcast $stateChangeStart and $stateChangeSuccess events.
     * - **`reload`** (v0.2.5) - {boolean=false}, If `true` will force transition even if the state or params 
     *    have not changed, aka a reload of the same state. It differs from reloadOnSearch because you'd
     *    use this when you want to force a reload when *everything* is the same, including search params.
     *
     * @returns {promise} A promise representing the state of the new transition. See
     * {@link ui.router.state.$state#methods_go $state.go}.
     */
    $state.transitionTo = function transitionTo(to, toParams, options) {
      toParams = toParams || {};
      options = extend({
        location: true, inherit: false, relative: null, notify: true, reload: false, $retry: false
      }, options || {});

      var from = $state.$current, fromParams = $state.params, fromPath = from.path;
      var evt, toState = findState(to, options.relative);

      if (!isDefined(toState)) {
        var redirect = { to: to, toParams: toParams, options: options };
        var redirectResult = handleRedirect(redirect, from.self, fromParams, options);

        if (redirectResult) {
          return redirectResult;
        }

        // Always retry once if the $stateNotFound was not prevented
        // (handles either redirect changed or state lazy-definition)
        to = redirect.to;
        toParams = redirect.toParams;
        options = redirect.options;
        toState = findState(to, options.relative);

        if (!isDefined(toState)) {
          if (!options.relative) throw new Error("No such state '" + to + "'");
          throw new Error("Could not resolve '" + to + "' from state '" + options.relative + "'");
        }
      }
      if (toState[abstractKey]) throw new Error("Cannot transition to abstract state '" + to + "'");
      if (options.inherit) toParams = inheritParams($stateParams, toParams || {}, $state.$current, toState);
      if (!toState.params.$$validates(toParams)) return TransitionFailed;

      toParams = toState.params.$$values(toParams);
      to = toState;

      var toPath = to.path;

      // Starting from the root of the path, keep all levels that haven't changed
      var keep = 0, state = toPath[keep], locals = root.locals, toLocals = [];

      if (!options.reload) {
        while (state && state === fromPath[keep] && state.ownParams.$$equals(toParams, fromParams)) {
          locals = toLocals[keep] = state.locals;
          keep++;
          state = toPath[keep];
        }
      }

      // If we're going to the same state and all locals are kept, we've got nothing to do.
      // But clear 'transition', as we still want to cancel any other pending transitions.
      // TODO: We may not want to bump 'transition' if we're called from a location change
      // that we've initiated ourselves, because we might accidentally abort a legitimate
      // transition initiated from code?
      if (shouldTriggerReload(to, from, locals, options)) {
        if (to.self.reloadOnSearch !== false) $urlRouter.update();
        $state.transition = null;
        return $q.when($state.current);
      }

      // Filter parameters before we pass them to event handlers etc.
      toParams = filterByKeys(to.params.$$keys(), toParams || {});

      // Broadcast start event and cancel the transition if requested
      if (options.notify) {
        /**
         * @ngdoc event
         * @name ui.router.state.$state#$stateChangeStart
         * @eventOf ui.router.state.$state
         * @eventType broadcast on root scope
         * @description
         * Fired when the state transition **begins**. You can use `event.preventDefault()`
         * to prevent the transition from happening and then the transition promise will be
         * rejected with a `'transition prevented'` value.
         *
         * @param {Object} event Event object.
         * @param {State} toState The state being transitioned to.
         * @param {Object} toParams The params supplied to the `toState`.
         * @param {State} fromState The current state, pre-transition.
         * @param {Object} fromParams The params supplied to the `fromState`.
         *
         * @example
         *
         * <pre>
         * $rootScope.$on('$stateChangeStart',
         * function(event, toState, toParams, fromState, fromParams){
         *     event.preventDefault();
         *     // transitionTo() promise will be rejected with
         *     // a 'transition prevented' error
         * })
         * </pre>
         */
        if ($rootScope.$broadcast('$stateChangeStart', to.self, toParams, from.self, fromParams).defaultPrevented) {
          $urlRouter.update();
          return TransitionPrevented;
        }
      }

      // Resolve locals for the remaining states, but don't update any global state just
      // yet -- if anything fails to resolve the current state needs to remain untouched.
      // We also set up an inheritance chain for the locals here. This allows the view directive
      // to quickly look up the correct definition for each view in the current state. Even
      // though we create the locals object itself outside resolveState(), it is initially
      // empty and gets filled asynchronously. We need to keep track of the promise for the
      // (fully resolved) current locals, and pass this down the chain.
      var resolved = $q.when(locals);

      for (var l = keep; l < toPath.length; l++, state = toPath[l]) {
        locals = toLocals[l] = inherit(locals);
        resolved = resolveState(state, toParams, state === to, resolved, locals, options);
      }

      // Once everything is resolved, we are ready to perform the actual transition
      // and return a promise for the new state. We also keep track of what the
      // current promise is, so that we can detect overlapping transitions and
      // keep only the outcome of the last transition.
      var transition = $state.transition = resolved.then(function () {
        var l, entering, exiting;

        if ($state.transition !== transition) return TransitionSuperseded;

        // Exit 'from' states not kept
        for (l = fromPath.length - 1; l >= keep; l--) {
          exiting = fromPath[l];
          if (exiting.self.onExit) {
            $injector.invoke(exiting.self.onExit, exiting.self, exiting.locals.globals);
          }
          exiting.locals = null;
        }

        // Enter 'to' states not kept
        for (l = keep; l < toPath.length; l++) {
          entering = toPath[l];
          entering.locals = toLocals[l];
          if (entering.self.onEnter) {
            $injector.invoke(entering.self.onEnter, entering.self, entering.locals.globals);
          }
        }

        // Run it again, to catch any transitions in callbacks
        if ($state.transition !== transition) return TransitionSuperseded;

        // Update globals in $state
        $state.$current = to;
        $state.current = to.self;
        $state.params = toParams;
        copy($state.params, $stateParams);
        $state.transition = null;

        if (options.location && to.navigable) {
          $urlRouter.push(to.navigable.url, to.navigable.locals.globals.$stateParams, {
            $$avoidResync: true, replace: options.location === 'replace'
          });
        }

        if (options.notify) {
        /**
         * @ngdoc event
         * @name ui.router.state.$state#$stateChangeSuccess
         * @eventOf ui.router.state.$state
         * @eventType broadcast on root scope
         * @description
         * Fired once the state transition is **complete**.
         *
         * @param {Object} event Event object.
         * @param {State} toState The state being transitioned to.
         * @param {Object} toParams The params supplied to the `toState`.
         * @param {State} fromState The current state, pre-transition.
         * @param {Object} fromParams The params supplied to the `fromState`.
         */
          $rootScope.$broadcast('$stateChangeSuccess', to.self, toParams, from.self, fromParams);
        }
        $urlRouter.update(true);

        return $state.current;
      }, function (error) {
        if ($state.transition !== transition) return TransitionSuperseded;

        $state.transition = null;
        /**
         * @ngdoc event
         * @name ui.router.state.$state#$stateChangeError
         * @eventOf ui.router.state.$state
         * @eventType broadcast on root scope
         * @description
         * Fired when an **error occurs** during transition. It's important to note that if you
         * have any errors in your resolve functions (javascript errors, non-existent services, etc)
         * they will not throw traditionally. You must listen for this $stateChangeError event to
         * catch **ALL** errors.
         *
         * @param {Object} event Event object.
         * @param {State} toState The state being transitioned to.
         * @param {Object} toParams The params supplied to the `toState`.
         * @param {State} fromState The current state, pre-transition.
         * @param {Object} fromParams The params supplied to the `fromState`.
         * @param {Error} error The resolve error object.
         */
        evt = $rootScope.$broadcast('$stateChangeError', to.self, toParams, from.self, fromParams, error);

        if (!evt.defaultPrevented) {
            $urlRouter.update();
        }

        return $q.reject(error);
      });

      return transition;
    };

    /**
     * @ngdoc function
     * @name ui.router.state.$state#is
     * @methodOf ui.router.state.$state
     *
     * @description
     * Similar to {@link ui.router.state.$state#methods_includes $state.includes},
     * but only checks for the full state name. If params is supplied then it will be
     * tested for strict equality against the current active params object, so all params
     * must match with none missing and no extras.
     *
     * @example
     * <pre>
     * $state.$current.name = 'contacts.details.item';
     *
     * // absolute name
     * $state.is('contact.details.item'); // returns true
     * $state.is(contactDetailItemStateObject); // returns true
     *
     * // relative name (. and ^), typically from a template
     * // E.g. from the 'contacts.details' template
     * <div ng-class="{highlighted: $state.is('.item')}">Item</div>
     * </pre>
     *
     * @param {string|object} stateOrName The state name (absolute or relative) or state object you'd like to check.
     * @param {object=} params A param object, e.g. `{sectionId: section.id}`, that you'd like
     * to test against the current active state.
     * @param {object=} options An options object.  The options are:
     *
     * - **`relative`** - {string|object} -  If `stateOrName` is a relative state name and `options.relative` is set, .is will
     * test relative to `options.relative` state (or name).
     *
     * @returns {boolean} Returns true if it is the state.
     */
    $state.is = function is(stateOrName, params, options) {
      options = extend({ relative: $state.$current }, options || {});
      var state = findState(stateOrName, options.relative);

      if (!isDefined(state)) { return undefined; }
      if ($state.$current !== state) { return false; }
      return params ? equalForKeys(state.params.$$values(params), $stateParams) : true;
    };

    /**
     * @ngdoc function
     * @name ui.router.state.$state#includes
     * @methodOf ui.router.state.$state
     *
     * @description
     * A method to determine if the current active state is equal to or is the child of the
     * state stateName. If any params are passed then they will be tested for a match as well.
     * Not all the parameters need to be passed, just the ones you'd like to test for equality.
     *
     * @example
     * Partial and relative names
     * <pre>
     * $state.$current.name = 'contacts.details.item';
     *
     * // Using partial names
     * $state.includes("contacts"); // returns true
     * $state.includes("contacts.details"); // returns true
     * $state.includes("contacts.details.item"); // returns true
     * $state.includes("contacts.list"); // returns false
     * $state.includes("about"); // returns false
     *
     * // Using relative names (. and ^), typically from a template
     * // E.g. from the 'contacts.details' template
     * <div ng-class="{highlighted: $state.includes('.item')}">Item</div>
     * </pre>
     *
     * Basic globbing patterns
     * <pre>
     * $state.$current.name = 'contacts.details.item.url';
     *
     * $state.includes("*.details.*.*"); // returns true
     * $state.includes("*.details.**"); // returns true
     * $state.includes("**.item.**"); // returns true
     * $state.includes("*.details.item.url"); // returns true
     * $state.includes("*.details.*.url"); // returns true
     * $state.includes("*.details.*"); // returns false
     * $state.includes("item.**"); // returns false
     * </pre>
     *
     * @param {string} stateOrName A partial name, relative name, or glob pattern
     * to be searched for within the current state name.
     * @param {object=} params A param object, e.g. `{sectionId: section.id}`,
     * that you'd like to test against the current active state.
     * @param {object=} options An options object.  The options are:
     *
     * - **`relative`** - {string|object=} -  If `stateOrName` is a relative state reference and `options.relative` is set,
     * .includes will test relative to `options.relative` state (or name).
     *
     * @returns {boolean} Returns true if it does include the state
     */
    $state.includes = function includes(stateOrName, params, options) {
      options = extend({ relative: $state.$current }, options || {});
      if (isString(stateOrName) && isGlob(stateOrName)) {
        if (!doesStateMatchGlob(stateOrName)) {
          return false;
        }
        stateOrName = $state.$current.name;
      }

      var state = findState(stateOrName, options.relative);
      if (!isDefined(state)) { return undefined; }
      if (!isDefined($state.$current.includes[state.name])) { return false; }
      return params ? equalForKeys(state.params.$$values(params), $stateParams, objectKeys(params)) : true;
    };


    /**
     * @ngdoc function
     * @name ui.router.state.$state#href
     * @methodOf ui.router.state.$state
     *
     * @description
     * A url generation method that returns the compiled url for the given state populated with the given params.
     *
     * @example
     * <pre>
     * expect($state.href("about.person", { person: "bob" })).toEqual("/about/bob");
     * </pre>
     *
     * @param {string|object} stateOrName The state name or state object you'd like to generate a url from.
     * @param {object=} params An object of parameter values to fill the state's required parameters.
     * @param {object=} options Options object. The options are:
     *
     * - **`lossy`** - {boolean=true} -  If true, and if there is no url associated with the state provided in the
     *    first parameter, then the constructed href url will be built from the first navigable ancestor (aka
     *    ancestor with a valid url).
     * - **`inherit`** - {boolean=true}, If `true` will inherit url parameters from current url.
     * - **`relative`** - {object=$state.$current}, When transitioning with relative path (e.g '^'), 
     *    defines which state to be relative from.
     * - **`absolute`** - {boolean=false},  If true will generate an absolute url, e.g. "http://www.example.com/fullurl".
     * 
     * @returns {string} compiled state url
     */
    $state.href = function href(stateOrName, params, options) {
      options = extend({
        lossy:    true,
        inherit:  true,
        absolute: false,
        relative: $state.$current
      }, options || {});

      var state = findState(stateOrName, options.relative);

      if (!isDefined(state)) return null;
      if (options.inherit) params = inheritParams($stateParams, params || {}, $state.$current, state);
      
      var nav = (state && options.lossy) ? state.navigable : state;

      if (!nav || nav.url === undefined || nav.url === null) {
        return null;
      }
      return $urlRouter.href(nav.url, filterByKeys(state.params.$$keys(), params || {}), {
        absolute: options.absolute
      });
    };

    /**
     * @ngdoc function
     * @name ui.router.state.$state#get
     * @methodOf ui.router.state.$state
     *
     * @description
     * Returns the state configuration object for any specific state or all states.
     *
     * @param {string|object=} stateOrName (absolute or relative) If provided, will only get the config for
     * the requested state. If not provided, returns an array of ALL state configs.
     * @param {string|object=} context When stateOrName is a relative state reference, the state will be retrieved relative to context.
     * @returns {Object|Array} State configuration object or array of all objects.
     */
    $state.get = function (stateOrName, context) {
      if (arguments.length === 0) return map(objectKeys(states), function(name) { return states[name].self; });
      var state = findState(stateOrName, context || $state.$current);
      return (state && state.self) ? state.self : null;
    };

    function resolveState(state, params, paramsAreFiltered, inherited, dst, options) {
      // Make a restricted $stateParams with only the parameters that apply to this state if
      // necessary. In addition to being available to the controller and onEnter/onExit callbacks,
      // we also need $stateParams to be available for any $injector calls we make during the
      // dependency resolution process.
      var $stateParams = (paramsAreFiltered) ? params : filterByKeys(state.params.$$keys(), params);
      var locals = { $stateParams: $stateParams };

      // Resolve 'global' dependencies for the state, i.e. those not specific to a view.
      // We're also including $stateParams in this; that way the parameters are restricted
      // to the set that should be visible to the state, and are independent of when we update
      // the global $state and $stateParams values.
      dst.resolve = $resolve.resolve(state.resolve, locals, dst.resolve, state);
      var promises = [dst.resolve.then(function (globals) {
        dst.globals = globals;
      })];
      if (inherited) promises.push(inherited);

      // Resolve template and dependencies for all views.
      forEach(state.views, function (view, name) {
        var injectables = (view.resolve && view.resolve !== state.resolve ? view.resolve : {});
        injectables.$template = [ function () {
          return $view.load(name, { view: view, locals: locals, params: $stateParams, notify: options.notify }) || '';
        }];

        promises.push($resolve.resolve(injectables, locals, dst.resolve, state).then(function (result) {
          // References to the controller (only instantiated at link time)
          if (isFunction(view.controllerProvider) || isArray(view.controllerProvider)) {
            var injectLocals = angular.extend({}, injectables, locals);
            result.$$controller = $injector.invoke(view.controllerProvider, null, injectLocals);
          } else {
            result.$$controller = view.controller;
          }
          // Provide access to the state itself for internal use
          result.$$state = state;
          result.$$controllerAs = view.controllerAs;
          dst[name] = result;
        }));
      });

      // Wait for all the promises and then return the activation object
      return $q.all(promises).then(function (values) {
        return dst;
      });
    }

    return $state;
  }

  function shouldTriggerReload(to, from, locals, options) {
    if (to === from && ((locals === from.locals && !options.reload) || (to.self.reloadOnSearch === false))) {
      return true;
    }
  }
}

angular.module('ui.router.state')
  .value('$stateParams', {})
  .provider('$state', $StateProvider);


$ViewProvider.$inject = [];
function $ViewProvider() {

  this.$get = $get;
  /**
   * @ngdoc object
   * @name ui.router.state.$view
   *
   * @requires ui.router.util.$templateFactory
   * @requires $rootScope
   *
   * @description
   *
   */
  $get.$inject = ['$rootScope', '$templateFactory'];
  function $get(   $rootScope,   $templateFactory) {
    return {
      // $view.load('full.viewName', { template: ..., controller: ..., resolve: ..., async: false, params: ... })
      /**
       * @ngdoc function
       * @name ui.router.state.$view#load
       * @methodOf ui.router.state.$view
       *
       * @description
       *
       * @param {string} name name
       * @param {object} options option object.
       */
      load: function load(name, options) {
        var result, defaults = {
          template: null, controller: null, view: null, locals: null, notify: true, async: true, params: {}
        };
        options = extend(defaults, options);

        if (options.view) {
          result = $templateFactory.fromConfig(options.view, options.params, options.locals);
        }
        if (result && options.notify) {
        /**
         * @ngdoc event
         * @name ui.router.state.$state#$viewContentLoading
         * @eventOf ui.router.state.$view
         * @eventType broadcast on root scope
         * @description
         *
         * Fired once the view **begins loading**, *before* the DOM is rendered.
         *
         * @param {Object} event Event object.
         * @param {Object} viewConfig The view config properties (template, controller, etc).
         *
         * @example
         *
         * <pre>
         * $scope.$on('$viewContentLoading',
         * function(event, viewConfig){
         *     // Access to all the view config properties.
         *     // and one special property 'targetView'
         *     // viewConfig.targetView
         * });
         * </pre>
         */
          $rootScope.$broadcast('$viewContentLoading', options);
        }
        return result;
      }
    };
  }
}

angular.module('ui.router.state').provider('$view', $ViewProvider);

/**
 * @ngdoc object
 * @name ui.router.state.$uiViewScrollProvider
 *
 * @description
 * Provider that returns the {@link ui.router.state.$uiViewScroll} service function.
 */
function $ViewScrollProvider() {

  var useAnchorScroll = false;

  /**
   * @ngdoc function
   * @name ui.router.state.$uiViewScrollProvider#useAnchorScroll
   * @methodOf ui.router.state.$uiViewScrollProvider
   *
   * @description
   * Reverts back to using the core [`$anchorScroll`](http://docs.angularjs.org/api/ng.$anchorScroll) service for
   * scrolling based on the url anchor.
   */
  this.useAnchorScroll = function () {
    useAnchorScroll = true;
  };

  /**
   * @ngdoc object
   * @name ui.router.state.$uiViewScroll
   *
   * @requires $anchorScroll
   * @requires $timeout
   *
   * @description
   * When called with a jqLite element, it scrolls the element into view (after a
   * `$timeout` so the DOM has time to refresh).
   *
   * If you prefer to rely on `$anchorScroll` to scroll the view to the anchor,
   * this can be enabled by calling {@link ui.router.state.$uiViewScrollProvider#methods_useAnchorScroll `$uiViewScrollProvider.useAnchorScroll()`}.
   */
  this.$get = ['$anchorScroll', '$timeout', function ($anchorScroll, $timeout) {
    if (useAnchorScroll) {
      return $anchorScroll;
    }

    return function ($element) {
      $timeout(function () {
        $element[0].scrollIntoView();
      }, 0, false);
    };
  }];
}

angular.module('ui.router.state').provider('$uiViewScroll', $ViewScrollProvider);

/**
 * @ngdoc directive
 * @name ui.router.state.directive:ui-view
 *
 * @requires ui.router.state.$state
 * @requires $compile
 * @requires $controller
 * @requires $injector
 * @requires ui.router.state.$uiViewScroll
 * @requires $document
 *
 * @restrict ECA
 *
 * @description
 * The ui-view directive tells $state where to place your templates.
 *
 * @param {string=} name A view name. The name should be unique amongst the other views in the
 * same state. You can have views of the same name that live in different states.
 *
 * @param {string=} autoscroll It allows you to set the scroll behavior of the browser window
 * when a view is populated. By default, $anchorScroll is overridden by ui-router's custom scroll
 * service, {@link ui.router.state.$uiViewScroll}. This custom service let's you
 * scroll ui-view elements into view when they are populated during a state activation.
 *
 * *Note: To revert back to old [`$anchorScroll`](http://docs.angularjs.org/api/ng.$anchorScroll)
 * functionality, call `$uiViewScrollProvider.useAnchorScroll()`.*
 *
 * @param {string=} onload Expression to evaluate whenever the view updates.
 * 
 * @example
 * A view can be unnamed or named. 
 * <pre>
 * <!-- Unnamed -->
 * <div ui-view></div> 
 * 
 * <!-- Named -->
 * <div ui-view="viewName"></div>
 * </pre>
 *
 * You can only have one unnamed view within any template (or root html). If you are only using a 
 * single view and it is unnamed then you can populate it like so:
 * <pre>
 * <div ui-view></div> 
 * $stateProvider.state("home", {
 *   template: "<h1>HELLO!</h1>"
 * })
 * </pre>
 * 
 * The above is a convenient shortcut equivalent to specifying your view explicitly with the {@link ui.router.state.$stateProvider#views `views`}
 * config property, by name, in this case an empty name:
 * <pre>
 * $stateProvider.state("home", {
 *   views: {
 *     "": {
 *       template: "<h1>HELLO!</h1>"
 *     }
 *   }    
 * })
 * </pre>
 * 
 * But typically you'll only use the views property if you name your view or have more than one view 
 * in the same template. There's not really a compelling reason to name a view if its the only one, 
 * but you could if you wanted, like so:
 * <pre>
 * <div ui-view="main"></div>
 * </pre> 
 * <pre>
 * $stateProvider.state("home", {
 *   views: {
 *     "main": {
 *       template: "<h1>HELLO!</h1>"
 *     }
 *   }    
 * })
 * </pre>
 * 
 * Really though, you'll use views to set up multiple views:
 * <pre>
 * <div ui-view></div>
 * <div ui-view="chart"></div> 
 * <div ui-view="data"></div> 
 * </pre>
 * 
 * <pre>
 * $stateProvider.state("home", {
 *   views: {
 *     "": {
 *       template: "<h1>HELLO!</h1>"
 *     },
 *     "chart": {
 *       template: "<chart_thing/>"
 *     },
 *     "data": {
 *       template: "<data_thing/>"
 *     }
 *   }    
 * })
 * </pre>
 *
 * Examples for `autoscroll`:
 *
 * <pre>
 * <!-- If autoscroll present with no expression,
 *      then scroll ui-view into view -->
 * <ui-view autoscroll/>
 *
 * <!-- If autoscroll present with valid expression,
 *      then scroll ui-view into view if expression evaluates to true -->
 * <ui-view autoscroll='true'/>
 * <ui-view autoscroll='false'/>
 * <ui-view autoscroll='scopeVariable'/>
 * </pre>
 */
$ViewDirective.$inject = ['$state', '$injector', '$uiViewScroll', '$interpolate'];
function $ViewDirective(   $state,   $injector,   $uiViewScroll,   $interpolate) {

  function getService() {
    return ($injector.has) ? function(service) {
      return $injector.has(service) ? $injector.get(service) : null;
    } : function(service) {
      try {
        return $injector.get(service);
      } catch (e) {
        return null;
      }
    };
  }

  var service = getService(),
      $animator = service('$animator'),
      $animate = service('$animate');

  // Returns a set of DOM manipulation functions based on which Angular version
  // it should use
  function getRenderer(attrs, scope) {
    var statics = function() {
      return {
        enter: function (element, target, cb) { target.after(element); cb(); },
        leave: function (element, cb) { element.remove(); cb(); }
      };
    };

    if ($animate) {
      return {
        enter: function(element, target, cb) {
          var promise = $animate.enter(element, null, target, cb);
          if (promise && promise.then) promise.then(cb);
        },
        leave: function(element, cb) {
          var promise = $animate.leave(element, cb);
          if (promise && promise.then) promise.then(cb);
        }
      };
    }

    if ($animator) {
      var animate = $animator && $animator(scope, attrs);

      return {
        enter: function(element, target, cb) {animate.enter(element, null, target); cb(); },
        leave: function(element, cb) { animate.leave(element); cb(); }
      };
    }

    return statics();
  }

  var directive = {
    restrict: 'ECA',
    terminal: true,
    priority: 400,
    transclude: 'element',
    compile: function (tElement, tAttrs, $transclude) {
      return function (scope, $element, attrs) {
        var previousEl, currentEl, currentScope, latestLocals,
            onloadExp     = attrs.onload || '',
            autoScrollExp = attrs.autoscroll,
            renderer      = getRenderer(attrs, scope);

        scope.$on('$stateChangeSuccess', function() {
          updateView(false);
        });
        scope.$on('$viewContentLoading', function() {
          updateView(false);
        });

        updateView(true);

        function cleanupLastView() {
          if (previousEl) {
            previousEl.remove();
            previousEl = null;
          }

          if (currentScope) {
            currentScope.$destroy();
            currentScope = null;
          }

          if (currentEl) {
            renderer.leave(currentEl, function() {
              previousEl = null;
            });

            previousEl = currentEl;
            currentEl = null;
          }
        }

        function updateView(firstTime) {
          var newScope,
              name            = getUiViewName(scope, attrs, $element, $interpolate),
              previousLocals  = name && $state.$current && $state.$current.locals[name];

          if (!firstTime && previousLocals === latestLocals) return; // nothing to do
          newScope = scope.$new();
          latestLocals = $state.$current.locals[name];

          var clone = $transclude(newScope, function(clone) {
            renderer.enter(clone, $element, function onUiViewEnter() {
              if(currentScope) {
                currentScope.$emit('$viewContentAnimationEnded');
              }

              if (angular.isDefined(autoScrollExp) && !autoScrollExp || scope.$eval(autoScrollExp)) {
                $uiViewScroll(clone);
              }
            });
            cleanupLastView();
          });

          currentEl = clone;
          currentScope = newScope;
          /**
           * @ngdoc event
           * @name ui.router.state.directive:ui-view#$viewContentLoaded
           * @eventOf ui.router.state.directive:ui-view
           * @eventType emits on ui-view directive scope
           * @description           *
           * Fired once the view is **loaded**, *after* the DOM is rendered.
           *
           * @param {Object} event Event object.
           */
          currentScope.$emit('$viewContentLoaded');
          currentScope.$eval(onloadExp);
        }
      };
    }
  };

  return directive;
}

$ViewDirectiveFill.$inject = ['$compile', '$controller', '$state', '$interpolate'];
function $ViewDirectiveFill (  $compile,   $controller,   $state,   $interpolate) {
  return {
    restrict: 'ECA',
    priority: -400,
    compile: function (tElement) {
      var initial = tElement.html();
      return function (scope, $element, attrs) {
        var current = $state.$current,
            name = getUiViewName(scope, attrs, $element, $interpolate),
            locals  = current && current.locals[name];

        if (! locals) {
          return;
        }

        $element.data('$uiView', { name: name, state: locals.$$state });
        $element.html(locals.$template ? locals.$template : initial);

        var link = $compile($element.contents());

        if (locals.$$controller) {
          locals.$scope = scope;
          var controller = $controller(locals.$$controller, locals);
          if (locals.$$controllerAs) {
            scope[locals.$$controllerAs] = controller;
          }
          $element.data('$ngControllerController', controller);
          $element.children().data('$ngControllerController', controller);
        }

        link(scope);
      };
    }
  };
}

/**
 * Shared ui-view code for both directives:
 * Given scope, element, and its attributes, return the view's name
 */
function getUiViewName(scope, attrs, element, $interpolate) {
  var name = $interpolate(attrs.uiView || attrs.name || '')(scope);
  var inherited = element.inheritedData('$uiView');
  return name.indexOf('@') >= 0 ?  name :  (name + '@' + (inherited ? inherited.state.name : ''));
}

angular.module('ui.router.state').directive('uiView', $ViewDirective);
angular.module('ui.router.state').directive('uiView', $ViewDirectiveFill);

function parseStateRef(ref, current) {
  var preparsed = ref.match(/^\s*({[^}]*})\s*$/), parsed;
  if (preparsed) ref = current + '(' + preparsed[1] + ')';
  parsed = ref.replace(/\n/g, " ").match(/^([^(]+?)\s*(\((.*)\))?$/);
  if (!parsed || parsed.length !== 4) throw new Error("Invalid state ref '" + ref + "'");
  return { state: parsed[1], paramExpr: parsed[3] || null };
}

function stateContext(el) {
  var stateData = el.parent().inheritedData('$uiView');

  if (stateData && stateData.state && stateData.state.name) {
    return stateData.state;
  }
}

/**
 * @ngdoc directive
 * @name ui.router.state.directive:ui-sref
 *
 * @requires ui.router.state.$state
 * @requires $timeout
 *
 * @restrict A
 *
 * @description
 * A directive that binds a link (`<a>` tag) to a state. If the state has an associated 
 * URL, the directive will automatically generate & update the `href` attribute via 
 * the {@link ui.router.state.$state#methods_href $state.href()} method. Clicking 
 * the link will trigger a state transition with optional parameters. 
 *
 * Also middle-clicking, right-clicking, and ctrl-clicking on the link will be 
 * handled natively by the browser.
 *
 * You can also use relative state paths within ui-sref, just like the relative 
 * paths passed to `$state.go()`. You just need to be aware that the path is relative
 * to the state that the link lives in, in other words the state that loaded the 
 * template containing the link.
 *
 * You can specify options to pass to {@link ui.router.state.$state#go $state.go()}
 * using the `ui-sref-opts` attribute. Options are restricted to `location`, `inherit`,
 * and `reload`.
 *
 * @example
 * Here's an example of how you'd use ui-sref and how it would compile. If you have the 
 * following template:
 * <pre>
 * <a ui-sref="home">Home</a> | <a ui-sref="about">About</a> | <a ui-sref="{page: 2}">Next page</a>
 * 
 * <ul>
 *     <li ng-repeat="contact in contacts">
 *         <a ui-sref="contacts.detail({ id: contact.id })">{{ contact.name }}</a>
 *     </li>
 * </ul>
 * </pre>
 * 
 * Then the compiled html would be (assuming Html5Mode is off and current state is contacts):
 * <pre>
 * <a href="#/home" ui-sref="home">Home</a> | <a href="#/about" ui-sref="about">About</a> | <a href="#/contacts?page=2" ui-sref="{page: 2}">Next page</a>
 * 
 * <ul>
 *     <li ng-repeat="contact in contacts">
 *         <a href="#/contacts/1" ui-sref="contacts.detail({ id: contact.id })">Joe</a>
 *     </li>
 *     <li ng-repeat="contact in contacts">
 *         <a href="#/contacts/2" ui-sref="contacts.detail({ id: contact.id })">Alice</a>
 *     </li>
 *     <li ng-repeat="contact in contacts">
 *         <a href="#/contacts/3" ui-sref="contacts.detail({ id: contact.id })">Bob</a>
 *     </li>
 * </ul>
 *
 * <a ui-sref="home" ui-sref-opts="{reload: true}">Home</a>
 * </pre>
 *
 * @param {string} ui-sref 'stateName' can be any valid absolute or relative state
 * @param {Object} ui-sref-opts options to pass to {@link ui.router.state.$state#go $state.go()}
 */
$StateRefDirective.$inject = ['$state', '$timeout'];
function $StateRefDirective($state, $timeout) {
  var allowedOptions = ['location', 'inherit', 'reload'];

  return {
    restrict: 'A',
    require: ['?^uiSrefActive', '?^uiSrefActiveEq'],
    link: function(scope, element, attrs, uiSrefActive) {
      var ref = parseStateRef(attrs.uiSref, $state.current.name);
      var params = null, url = null, base = stateContext(element) || $state.$current;
      var newHref = null, isAnchor = element.prop("tagName") === "A";
      var isForm = element[0].nodeName === "FORM";
      var attr = isForm ? "action" : "href", nav = true;

      var options = { relative: base, inherit: true };
      var optionsOverride = scope.$eval(attrs.uiSrefOpts) || {};

      angular.forEach(allowedOptions, function(option) {
        if (option in optionsOverride) {
          options[option] = optionsOverride[option];
        }
      });

      var update = function(newVal) {
        if (newVal) params = angular.copy(newVal);
        if (!nav) return;

        newHref = $state.href(ref.state, params, options);

        var activeDirective = uiSrefActive[1] || uiSrefActive[0];
        if (activeDirective) {
          activeDirective.$$setStateInfo(ref.state, params);
        }
        if (newHref === null) {
          nav = false;
          return false;
        }
        attrs.$set(attr, newHref);
      };

      if (ref.paramExpr) {
        scope.$watch(ref.paramExpr, function(newVal, oldVal) {
          if (newVal !== params) update(newVal);
        }, true);
        params = angular.copy(scope.$eval(ref.paramExpr));
      }
      update();

      if (isForm) return;

      element.bind("click", function(e) {
        var button = e.which || e.button;
        if ( !(button > 1 || e.ctrlKey || e.metaKey || e.shiftKey || element.attr('target')) ) {
          // HACK: This is to allow ng-clicks to be processed before the transition is initiated:
          var transition = $timeout(function() {
            $state.go(ref.state, params, options);
          });
          e.preventDefault();

          // if the state has no URL, ignore one preventDefault from the <a> directive.
          var ignorePreventDefaultCount = isAnchor && !newHref ? 1: 0;
          e.preventDefault = function() {
            if (ignorePreventDefaultCount-- <= 0)
              $timeout.cancel(transition);
          };
        }
      });
    }
  };
}

/**
 * @ngdoc directive
 * @name ui.router.state.directive:ui-sref-active
 *
 * @requires ui.router.state.$state
 * @requires ui.router.state.$stateParams
 * @requires $interpolate
 *
 * @restrict A
 *
 * @description
 * A directive working alongside ui-sref to add classes to an element when the
 * related ui-sref directive's state is active, and removing them when it is inactive.
 * The primary use-case is to simplify the special appearance of navigation menus
 * relying on `ui-sref`, by having the "active" state's menu button appear different,
 * distinguishing it from the inactive menu items.
 *
 * ui-sref-active can live on the same element as ui-sref or on a parent element. The first
 * ui-sref-active found at the same level or above the ui-sref will be used.
 *
 * Will activate when the ui-sref's target state or any child state is active. If you
 * need to activate only when the ui-sref target state is active and *not* any of
 * it's children, then you will use
 * {@link ui.router.state.directive:ui-sref-active-eq ui-sref-active-eq}
 *
 * @example
 * Given the following template:
 * <pre>
 * <ul>
 *   <li ui-sref-active="active" class="item">
 *     <a href ui-sref="app.user({user: 'bilbobaggins'})">@bilbobaggins</a>
 *   </li>
 * </ul>
 * </pre>
 *
 *
 * When the app state is "app.user" (or any children states), and contains the state parameter "user" with value "bilbobaggins",
 * the resulting HTML will appear as (note the 'active' class):
 * <pre>
 * <ul>
 *   <li ui-sref-active="active" class="item active">
 *     <a ui-sref="app.user({user: 'bilbobaggins'})" href="/users/bilbobaggins">@bilbobaggins</a>
 *   </li>
 * </ul>
 * </pre>
 *
 * The class name is interpolated **once** during the directives link time (any further changes to the
 * interpolated value are ignored).
 *
 * Multiple classes may be specified in a space-separated format:
 * <pre>
 * <ul>
 *   <li ui-sref-active='class1 class2 class3'>
 *     <a ui-sref="app.user">link</a>
 *   </li>
 * </ul>
 * </pre>
 */

/**
 * @ngdoc directive
 * @name ui.router.state.directive:ui-sref-active-eq
 *
 * @requires ui.router.state.$state
 * @requires ui.router.state.$stateParams
 * @requires $interpolate
 *
 * @restrict A
 *
 * @description
 * The same as {@link ui.router.state.directive:ui-sref-active ui-sref-active} but will only activate
 * when the exact target state used in the `ui-sref` is active; no child states.
 *
 */
$StateRefActiveDirective.$inject = ['$state', '$stateParams', '$interpolate'];
function $StateRefActiveDirective($state, $stateParams, $interpolate) {
  return  {
    restrict: "A",
    controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {
      var state, params, activeClass;

      // There probably isn't much point in $observing this
      // uiSrefActive and uiSrefActiveEq share the same directive object with some
      // slight difference in logic routing
      activeClass = $interpolate($attrs.uiSrefActiveEq || $attrs.uiSrefActive || '', false)($scope);

      // Allow uiSref to communicate with uiSrefActive[Equals]
      this.$$setStateInfo = function (newState, newParams) {
        state = $state.get(newState, stateContext($element));
        params = newParams;
        update();
      };

      $scope.$on('$stateChangeSuccess', update);

      // Update route state
      function update() {
        if (isMatch()) {
          $element.addClass(activeClass);
        } else {
          $element.removeClass(activeClass);
        }
      }

      function isMatch() {
        if (typeof $attrs.uiSrefActiveEq !== 'undefined') {
          return state && $state.is(state.name, params);
        } else {
          return state && $state.includes(state.name, params);
        }
      }
    }]
  };
}

angular.module('ui.router.state')
  .directive('uiSref', $StateRefDirective)
  .directive('uiSrefActive', $StateRefActiveDirective)
  .directive('uiSrefActiveEq', $StateRefActiveDirective);

/**
 * @ngdoc filter
 * @name ui.router.state.filter:isState
 *
 * @requires ui.router.state.$state
 *
 * @description
 * Translates to {@link ui.router.state.$state#methods_is $state.is("stateName")}.
 */
$IsStateFilter.$inject = ['$state'];
function $IsStateFilter($state) {
  var isFilter = function (state) {
    return $state.is(state);
  };
  isFilter.$stateful = true;
  return isFilter;
}

/**
 * @ngdoc filter
 * @name ui.router.state.filter:includedByState
 *
 * @requires ui.router.state.$state
 *
 * @description
 * Translates to {@link ui.router.state.$state#methods_includes $state.includes('fullOrPartialStateName')}.
 */
$IncludedByStateFilter.$inject = ['$state'];
function $IncludedByStateFilter($state) {
  var includesFilter = function (state) {
    return $state.includes(state);
  };
  includesFilter.$stateful = true;
  return  includesFilter;
}

angular.module('ui.router.state')
  .filter('isState', $IsStateFilter)
  .filter('includedByState', $IncludedByStateFilter);
})(window, window.angular);
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\app.js":[function(require,module,exports){
'use strict';

/*require('./thrift.js');
require('../../gen-js/bedata_types.js');
require('../../gen-js/messageservice_types.js');
require('../../gen-js/MessageService.js');
require('../../gen-js/DialogService.js');
require('../../gen-js/userservice_types.js');
require('../../gen-js/UserService.js');
require('../../gen-js/authservice_types.js');
require('../../gen-js/AuthService.js');
require('../../gen-js/utilityservces_types.js');
require('../../gen-js/UtilityService.js');
require('../../gen-js/fileutils_types.js');
require('../../gen-js/FileService.js');
require('../../gen-js/business_types.js');
require('../../gen-js/BusinessService.js');*/

require('angular-ui-router');
require('angular-file-upload');

require('./directives.js');
require('./services');
require('./controllers');

var main = angular.module('forum', [
  //'ngRoute',
  'ui.router',
  'angularFileUpload',
 /* 'forum.filters',*/
  'forum.services',
  'forum.directives',
  //'forum.controllers',
  'VOControllers'
])
    .config(require('./config'));


},{"./config":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\config.js","./controllers":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\index.js","./directives.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\directives.js","./services":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\services\\index.js","angular-file-upload":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\node_modules\\angular-file-upload\\dist\\angular-file-upload.min.js","angular-ui-router":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\node_modules\\angular-ui-router\\release\\angular-ui-router.js"}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\config.js":[function(require,module,exports){
'use strict';

var config = function($stateProvider, $urlRouterProvider,$locationProvider) {

    $urlRouterProvider.otherwise("/main");

    $stateProvider
        .state('main', {
            url: "/main",
            templateUrl: "/static/partials/main.html",
            controller: 'wallCtrl as lenta'
        })
        .state('wall-single', {
            url: "/wall-single/:topicId",
            templateUrl: "/static/partials/wall-single.html",
            controller: 'wallSingleCtrl as wallSingle'
        })
        .state('talks', {
            url: "/talks",
            templateUrl: "/static/partials/talks.html",
            controller: 'talksCtrl as talks'
        })
        .state('talks-single', {
            url: "/talks-single/:talkId",
            templateUrl: "/static/partials/talks-single.html",
            controller: 'talksSingleCtrl as talks'
        })
        .state('profit', {
            url: "/profit",
            templateUrl: "/static/partials/profit.html",
            controller: 'advertsCtrl as adverts'
        })
        .state('profit-single', {
            url: "/profit-single/:advertId",
            templateUrl: "/static/partials/profit-single.html",
            controller: 'advertsSingleCtrl as adverts'
        })
        .state('dialogs', {
            url: "/dialogs",
            templateUrl: "/static/partials/dialogs.html",
            controller: 'dialogsCtrl as dialogs'
        })
        .state('dialog-single', {
            url: "/dialog-single/:dialogId",
            templateUrl: "/static/partials/dialog-single.html",
            controller: 'dialogCtrl as dialog'
        })
        .state('neighbours', {
            url: "/neighbours",
            templateUrl: "/static/partials/neighbours.html",
            controller: 'neighboursCtrl as neighbours'
        })
        .state('profile', {
            url: "/profile/:userId",
            templateUrl: "/static/partials/profile.html",
            controller: 'profileCtrl as profile'
        })
        .state('profile.change-avatar', {
            url: "/change-avatar",
            templateUrl: "/static/partials/profile.changeAvatar.html",
            controller: 'changeAvatarCtrl as changeAvatar'
        })
        .state('settings', {
            url: "/settings",
            templateUrl: "/static/partials/settings.html",
            controller: 'settingsCtrl as settings'
        })
        .state('maps', {
            url: "/maps",
            templateUrl: "/static/partials/maps.html",
            controller: 'mapsCtrl as maps'
        })
        .state('set-info', {
            url: "/set-info",
            templateUrl: "/static/partials/set-info.html",
            controller: 'setInfoCtrl as setInfo'
        })
        .state('counters', {
            url: "/counters",
            templateUrl: "/static/partials/counters.html",
            controller: 'countersCtrl as counters'
        })
        .state('counters-history', {
            url: "/counters-history/:counterId",
            templateUrl: "/static/partials/counters-history.html",
            controller: 'countersHistoryCtrl as countersHistory'
        })
        .state('important', {
            url: "/important",
            templateUrl: "/static/partials/important.html",
            controller: 'importantCtrl as important'
        })
        .state('nearby', {
            url: "/nearby",
            templateUrl: "/static/partials/nearby.html",
            controller: 'nearbyCtrl as nearby'
        })
        .state('nearby-single', {
            url: "/nearby-single/:nearbyId",
            templateUrl: "/static/partials/nearby-single.html",
            controller: 'nearbySingleCtrl as nearby'
        })
        .state('rubrics', {
            url: "/rubrics/:rubricId",
            templateUrl: "/static/partials/rubrics.html",
            controller: 'rubricsCtrl as talks'
        })
        .state('rubrics-single', {
            url: "/rubric-single/:rubricId",
            templateUrl: "/static/partials/rubrics-single.html",
            controller: 'rubricsSingleCtrl as talks'
        })
        .state('blog', {
            url: "/blog"
        })
        .state('about', {
            url: "/about"
        })
        .state('contacts', {
            url: "/contacts"
        })
        .state('cabinet', {
            url: "/cabinet",
            templateUrl: "/static/partials/business/cabinet.html",
            controller: 'cabinetCtrl as nearby'
        })
        .state('edit', {
            url: "/edit",
            templateUrl: "/static/partials/business/edit.html",
            controller: 'editCtrl as edit'
        })
        .state('statistic', {
            url: "/statistic",
            templateUrl: "/static/partials/business/statistic.html",
            controller: 'statisticCtrl as maps'
        });

    $locationProvider.html5Mode(true);
};

module.exports = [ '$stateProvider','$urlRouterProvider','$locationProvider', config ];

/*main.config(function($locationProvider){
    $locationProvider.html5Mode(true);
});*/

},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\about.js":[function(require,module,exports){
'use strict';

var aboutCtrl = function($rootScope) {

    $rootScope.base.isFooterBottom = true;

    $('.ng-cloak').removeClass('ng-cloak');

};

module.exports = [ '$rootScope', aboutCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\adverts.js":[function(require,module,exports){

var advertsCtrl = function($rootScope,$c) {
        var adverts = this;

        adverts.attachId = "00000";
        $rootScope.setTab(3);
        $rootScope.base.showAllGroups();
        $rootScope.base.isFooterBottom = false;
        $c.showGroupOverBuilding($rootScope.groups);

        /*if(!$rootScope.importantIsLoadedFromTop)
            $rootScope.importantTopics = messageClient.getImportantNews($rootScope.currentGroup.id);
        $rootScope.importantIsLoadedFromTop = false;*/

        /*initAttachImage($('#attachImage-00000'), $('#attach-area-00000')); // для обсуждений
        initAttachDoc($('#attachDoc-00000'), $('#attach-doc-area-00000')); // для обсуждений*/
        $c.initFancyBox($('.adverts'));

        $rootScope.base.createTopicIsHide = true;
        adverts.isAdvertsLoaded = false;
        adverts.groups = $c.userClientGroups;

        adverts.isTalk = true;
        adverts.isAdvert = true;

        adverts.message = {};
        adverts.message.content = adverts.message.default = $c.TEXT_DEFAULT_3;
        adverts.subject = $c.TEXT_DEFAULT_4;

        $rootScope.base.bufferSelectedGroup = adverts.selectedGroup =
        $rootScope.currentGroup = $c.userClientGroups[3];

        $rootScope.currentRubric = null;

        $rootScope.base.initStartParamsForCreateTopic(adverts);

        adverts.answerFirstMessage = $c.TEXT_DEFAULT_2;

        adverts.topics = $c.messageClient.getAdverts(adverts.selectedGroup.id, 0, 1000).topics;

        initAdverts();

        if (!adverts.topics) adverts.topics = [];

        $rootScope.selectGroupInDropdown_adverts = function(groupId){
            adverts.selectedGroup = $rootScope.base.bufferSelectedGroup = $c.selectGroupInDropdown(groupId);
        };

        function initAdverts(){
            var topicLength;
            adverts.topics ? topicLength = adverts.topics.length : topicLength = 0;

            for(var i = 0; i < topicLength;i++){
                adverts.topics[i].lastUpdateEdit = $c.getTiming(adverts.topics[i].lastUpdate);
                adverts.topics[i].label = $c.getLabel(adverts.groups,adverts.topics[i].groupType);
                adverts.topics[i].tagColor = $c.getTagColor(adverts.topics[i].label);
            }
        }

        $rootScope.advertsChangeGroup = function(groupId){

            adverts.topics = $c.messageClient.getAdverts(groupId,0,1000).topics;

            if(adverts.topics) {
                initAdverts();
            }

        };

        $rootScope.selectGroup($c.getBuildingGroup($rootScope.currentGroup));

        $('.ng-cloak').removeClass('ng-cloak');

    };

module.exports = [ '$rootScope','$c', advertsCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\advertsSingle.js":[function(require,module,exports){

var advertsSingleCtrl = function($rootScope,$stateParams,$c) {
        var advert = this,
            fullTalkMessagesLength,
            advertId = $stateParams.advertId;

        $rootScope.base.isFooterBottom = false;

        $rootScope.base.lastLoadedId = 0;
        $rootScope.base.isEarliestMessages = false;
        $rootScope.base.endOfLoaded = false;

        /*if(!$rootScope.importantIsLoadedFromTop)
            $rootScope.importantTopics = messageClient.getImportantNews($rootScope.currentGroup.id);
        $rootScope.importantIsLoadedFromTop = false;*/

        advert.attachId = "00000";
        advert.selectedGroup = $rootScope.currentGroup;
        advert.topics = $c.messageClient.getAdverts(advert.selectedGroup.id, 0, 1000).topics;
        advert.fullTalkTopic = {};
        advert.fullTalkMessages = {};
        advert.fullTalkFirstMessages = [];
        advert.groups = $c.userClientGroups;

        advert.isTalk = true;

        $rootScope.base.initStartParamsForCreateMessage(advert);

        var showFullTalk = function(advert,advertOutsideId){

            $c.initFancyBox($('.adverts-single'));
            var topicLength;
            advert.topics ? topicLength = advert.topics.length : topicLength = 0;

            var advertId = advertOutsideId,
                fullTalkFirstMessagesLength;
            for(var i = 0; i < topicLength; i++){
                if(advertId == advert.topics[i].id){
                    advert.fullTalkTopic = advert.topics[i];

                    $rootScope.base.initStartParamsForCreateTopic(advert.fullTalkTopic);

                    advert.fullTalkTopic.isTalk = true;
                    advert.fullTalkTopic.isAdvert = true;
                    advert.fullTalkTopic.message.createdEdit = $c.getTiming(advert.fullTalkTopic.message.created);
                    advert.fullTalkTopic.label = $c.getLabel(advert.groups,advert.fullTalkTopic.groupType);
                    advert.fullTalkTopic.tagColor = $c.getTagColor(advert.fullTalkTopic.label);

                }
            }
            if(advert.fullTalkTopic.poll != null){
                $c.setPollEditNames(advert.fullTalkTopic.poll);
                advert.fullTalkTopic.metaType = "poll";
            }else{
                advert.fullTalkTopic.metaType = "message";
            }

            advert.fullTalkFirstMessages = $c.messageClient.getFirstLevelMessages(advertId,advert.selectedGroup.id,6,$rootScope.base.lastLoadedId,0,10).messages;

            $rootScope.base.lastLoadedId = $rootScope.base.initFirstMessages(advert.fullTalkFirstMessages);

            $rootScope.base.isAdvertTitles = false;
            $rootScope.base.mainContentTopIsHide = true;
            $rootScope.base.createTopicIsHide = true;

            $rootScope.base.advert = advert;

        };

        showFullTalk(advert,advertId);

        var initFlagsTopic = [];
        advert.showTopicAnswerInput = function(event,fullTalkTopic){
            event.preventDefault();

            advert.answerShow = true;

            if(!initFlagsTopic[fullTalkTopic.id]) {
               // initAttachImage($('#attachImage-' + fullTalkTopic.id), $('#attach-area-' + fullTalkTopic.id));
                //initAttachDoc($('#attachDoc-' + fullTalkTopic.id), $('#attach-doc-area-' + fullTalkTopic.id));
                initFlagsTopic[fullTalkTopic.id] = true;
            }

            advert.fullTalkTopic.answerInputIsShow ?
                advert.fullTalkTopic.answerInputIsShow = false :
                advert.fullTalkTopic.answerInputIsShow = true ;
        };

        var initFlagsMessage = [];
        advert.showMessageAnswerInput = function(event,fullTalkTopic,firstMessage,message){
            event.preventDefault();
            var attachId;

            if(!message){
                // если это сообщение первого уровня
                attachId = fullTalkTopic.id+'-'+firstMessage.id;

                firstMessage.isTalk = true;

                if(!advert.fulladvertFirstMessages) advert.fulladvertFirstMessages = $c.messageClient.getFirstLevelMessages(advertId,advert.selectedGroup.id,6,0,0,1000).messages;
                var fulladvertFirstMessagesLength = advert.fulladvertFirstMessages.length;

                $rootScope.base.initStartParamsForCreateMessage(firstMessage);

                firstMessage.answerInputIsShow ?
                    firstMessage.answerInputIsShow = false :
                    firstMessage.answerInputIsShow = true;


            }else{
                // если простое сообщение
                attachId = fullTalkTopic.id+'-'+message.id;

                message.isTalk = true;

                if(!advert.fullTalkMessages[firstMessage.id]) advert.fullTalkMessages[firstMessage.id] = $c.messageClient.getMessages(advertId,advert.selectedGroup.id,6,firstMessage.id,0,1000).messages;
                var  fullTalkMessagesLength = advert.fullTalkMessages[firstMessage.id].length;

                $rootScope.base.initStartParamsForCreateMessage(message);

                message.answerInputIsShow ?
                    message.answerInputIsShow = false :
                    message.answerInputIsShow = true;


            }

            if(!initFlagsMessage[attachId]) {
                //initAttachImage($('#attachImage-' + attachId), $('#attach-area-' + attachId));
                //initAttachDoc($('#attachDoc-' + attachId), $('#attach-doc-area-' + attachId));

                initFlagsMessage[attachId] = true;
            }
        };

        advert.toggleTreeFirstMessage = function(event,firstMessage){
            event.preventDefault();

            firstMessage.isTreeOpen ?
                firstMessage.isTreeOpen = false :
                firstMessage.isTreeOpen = true ;


            // --------

            advert.fullTalkMessages[firstMessage.id] = $c.messageClient.getMessages(advertId,advert.selectedGroup.id,1,firstMessage.id,0,1000).messages;
            advert.fullTalkMessages[firstMessage.id] ?
                fullTalkMessagesLength = advert.fullTalkMessages[firstMessage.id].length:
                fullTalkMessagesLength = 0;
            if(advert.fullTalkMessages[firstMessage.id] === null) advert.fullTalkMessages[firstMessage.id] = [];

            for(var i = 0; i < fullTalkMessagesLength; i++){
                advert.fullTalkMessages[firstMessage.id][i].answerInputIsShow = false;
                advert.fullTalkMessages[firstMessage.id][i].isTreeOpen = true;
                advert.fullTalkMessages[firstMessage.id][i].isOpen = true;
                advert.fullTalkMessages[firstMessage.id][i].isParentOpen = true;
                advert.fullTalkMessages[firstMessage.id][i].createdEdit = $c.getTiming(advert.fullTalkMessages[firstMessage.id][i].created);
                advert.fullTalkMessages[firstMessage.id][i].answerMessage = $c.TEXT_DEFAULT_2;

            }

        };

        advert.toggleTree = function(event,message,firstMessage){
            event.preventDefault();

            if(!advert.fullTalkMessages[firstMessage.id]) advert.fullTalkMessages[firstMessage.id] = $c.messageClient.getMessages(advertId,advert.selectedGroup.id,1,firstMessage.id,0,1000).messages;
            var fullTalkMessagesLength = advert.fullTalkMessages[firstMessage.id].length;

            message.isTreeOpen ?
                message.isTreeOpen = false :
                message.isTreeOpen = true ;

            var afterCurrentIndex = false,
                nextMessageOnCurrentLevel = false,
                loopMessageOffset,
                parentOpenStatus,
                areAllMyParentsTreeOpen = [],
                checkAreAllMyParentsTreeOpen = true,
                beginOffset = message.offset,
                parentOpenStatusArray = [];

            for(var i = 0; i < fullTalkMessagesLength; i++){
                loopMessageOffset = advert.fullTalkMessages[firstMessage.id][i].offset;

                if(afterCurrentIndex && !nextMessageOnCurrentLevel
                    && message.offset < loopMessageOffset){

                    areAllMyParentsTreeOpen[loopMessageOffset] = true;

                    if(loopMessageOffset - message.offset == 1){
                        //если это непосредственный потомок

                        advert.fullTalkMessages[firstMessage.id][i].isOpen ?
                            advert.fullTalkMessages[firstMessage.id][i].isOpen = false :
                            advert.fullTalkMessages[firstMessage.id][i].isOpen = true ;

                        parentOpenStatusArray[loopMessageOffset] = true;
                        parentOpenStatus = advert.fullTalkMessages[firstMessage.id][i].isOpen;

                        if (!advert.fullTalkMessages[firstMessage.id][i].isTreeOpen){
                            areAllMyParentsTreeOpen[loopMessageOffset] = false;
                        }
                    }else{
                        // если это птомки потомка

                        checkAreAllMyParentsTreeOpen = true;
                        for(var j = beginOffset; j < loopMessageOffset; j++){
                            // проверяем нет ли у кого в предках isTreeOpen = false
                            if(areAllMyParentsTreeOpen[j] == false){
                                checkAreAllMyParentsTreeOpen = false;
                            }
                        }
                        parentOpenStatus && checkAreAllMyParentsTreeOpen ?
                            advert.fullTalkMessages[firstMessage.id][i].isOpen = true :
                            advert.fullTalkMessages[firstMessage.id][i].isOpen = false ;

                        if (!advert.fullTalkMessages[firstMessage.id][i].isTreeOpen){
                            // если у кого-то из предков не открыто дерево
                            areAllMyParentsTreeOpen[loopMessageOffset] = false;
                        }

                        parentOpenStatusArray[loopMessageOffset] = true;
                    }
                }

                if (afterCurrentIndex && loopMessageOffset == message.offset){
                    nextMessageOnCurrentLevel = true;
                    break;
                }
                if(message.id == advert.fullTalkMessages[firstMessage.id][i].id){
                    afterCurrentIndex = true;
                }
            }
        };

        var buff,lastLoadedIdFF;
        advert.addMoreItems = function(){
            var temp = $c.messageClient.getFirstLevelMessages(advertId,advert.selectedGroup.id,1,$rootScope.base.lastLoadedId,0,10),
                buff = temp.messages;
            if(buff) {
                var buffLength = buff.length;

                if(buffLength != 0) {

                    $rootScope.base.lastLoadedId = buff[buffLength - 1].id;

                    if(lastLoadedIdFF != $rootScope.base.lastLoadedId) {
                        $rootScope.base.initFirstMessages(buff);
                        advert.fullTalkFirstMessages = advert.fullTalkFirstMessages.concat(buff);
                    }

                    lastLoadedIdFF = $rootScope.base.lastLoadedId;

                }
            }else{
                $rootScope.base.endOfLoaded = true;
            }

        };

        $('.ng-cloak').removeClass('ng-cloak');
    }

module.exports = [ '$rootScope','$stateParams', advertsSingleCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\base.js":[function(require,module,exports){
//var forumControllers = angular.module('forum.controllers', ['ui.select2','infinite-scroll','ngSanitize','yaMap','ui.bootstrap']);

var baseCtrl = function($scope,$rootScope,$state,$filter,$location,$c) {

    $rootScope.IS_BUSINESS = localStorage.getItem('VO_is_business');

        var base = this;
        base.url = $location.url();
        $scope.$on('$locationChangeSuccess', function($event,newState,oldState){
            console.log('change');
            if (newState.indexOf('blog') == -1 && newState.indexOf('about') == -1 && newState.indexOf('contacts') == -1) {
                var isLogin = $c.authClient.checkIfAuthorized();
                if(!isLogin) document.location.replace('/login');

                if(!$c.userClientGroups) $c.userClientGroups = $c.userClient.getUserGroups();
                if(!$c.shortUserInfo) $c.shortUserInfo = $c.userClient.getShortUserInfo();
                if(!hasStart) start();
                base.url = $location.url();
            }
        });

    if(base.url != '/blog' && base.url != '/about' && base.url != '/contacts') {
        if(!hasStart) start();
    }
    var hasStart = false;

    function start(){
        console.log('1',$c.shortUserInfo);
        hasStart = true;
        $rootScope.isTopSearchShow = true;
        base.neighboursLoadStatus = "";
        base.privateMessagesLoadStatus = "";
        base.profileLoadStatus = "";
        base.settingsLoadStatus = "";
        base.mapsLoadStatus = "";

        base.mainContentTopIsHide = false;
        base.createTopicIsHide = true;
        base.me = $c.shortUserInfo;

        base.isFooterBottom = false;

        base.isTalkTitles = true;

        $c.resetPages(base);
        base.lentaIsActive = true;
        base.emptyMessage = "Сообщений пока нет";

        base.textareaBlur = function (message, defaultText, ctrl, isTopic) {
            if (isTopic) {
                if (message == "") ctrl.message.content = defaultText;
            } else {
                if (message == "") ctrl.commentText = defaultText;
            }
            base.isLentaFocus = false;
        };

        base.textareaFocus = function (message, defaultText, ctrl, isTopic) {
            if (isTopic) {
                if (message == defaultText) ctrl.message.content = "";
            } else {
                if (message == defaultText) ctrl.commentText = "";
            }

        };

        base.addPollInput = function (event, obj, isFocus) {
            event.preventDefault();

            var newInput = {counter: 0, name: "" };
            obj.pollInputs.push(newInput);

            if (isFocus) {
                setTimeout(setNewFocus, 200, $(event.target));
            }

        };

        function setNewFocus(el) {
            el.prev().find('input').focus();
        }

        base.showPoll = function (event, obj) {
            event.preventDefault();

            obj.isPollShow = true;
            obj.pollSubject = "";
            obj.poll = null;

            obj.pollInputs = [
                {
                    counter: 0,
                    name: ""
                },
                {
                    counter: 1,
                    name: ""
                }
            ];
            obj.isPollAvailable = false;
        };

        base.doPoll = function (event, poll) {
            event.preventDefault();
            poll.values = [];
            var pollNamesLength = poll.editNames.length;
            var item;

            for (var i = 0; i < pollNamesLength; i++) {
                if (poll.editNames[i].value == 1) {
                    item = i;
                    break;
                }
            }

            var tempPoll = $c.messageClient.doPoll(poll.pollId, item);
            poll.alreadyPoll = true;
            poll.values = tempPoll.values;

            $c.setPollEditNames(poll);

        };

        base.oldTextLength = 0;
        base.messageChange = function (event) {

            var el = event.target,
                clientHeight = el.clientHeight,
                scrollHeight = el.scrollHeight,
                textLength = el.textLength,
                clientWidth = el.clientWidth,
                textLengthPX, newHeight, removeRowCount,
                defaultHeight, newRowCount;

            defaultHeight = $c.TEXTAREA_DEFAULT_HEIGHT;

            /*
             Исходные данные:
             На один символ приходится ~8px в ширину
             Высота строки текста ~14px

             * Здесь выполняем такие действия :
             * 1) Считаем длину текста в пикселях
             * 2) Определяем целое количестов строк, которые удалили
             * 3) Определям новую высоту с учетом высоты удаленного текста
             * */

            //console.log("0 "+scrollHeight+" "+clientHeight);
            if (scrollHeight > clientHeight) {

                el.style.height = scrollHeight + 'px';
            } else if (scrollHeight > defaultHeight) {
                textLengthPX = (parseInt(base.oldTextLength) - textLength) * 8; // 1
                //console.log("2 "+textLengthPX+" "+clientWidth+" "+textLength);
                if (textLengthPX > clientWidth) {
                    // console.log("3 "+textLengthPX+" "+clientWidth);
                    removeRowCount = Math.floor(textLengthPX / clientWidth); // 2
                    newHeight = parseInt(event.target.style.height) - removeRowCount * 14; // 3
                    newHeight > defaultHeight ? event.target.style.height = newHeight + "px" :
                        event.target.style.height = defaultHeight + 'px';

                } else {
                    el.style.height = scrollHeight - 6 + 'px';

                    //console.log("5 "+textLength+" "+textLength*8/clientWidth);
                }
            } else {
                //console.log('4');
                el.style.height = defaultHeight + 'px';
            }
            base.oldTextLength = textLength;
        };

        base.getTextareaHeight = function (textLength, clientWidth, isTopic) {
            /*if(isTopic){
             var k1 = 10,
             k2 = 19;
             }else{*/
            var k1 = 12,
                k2 = 14;
            //}

            var stringLen = textLength * k1;
            if (stringLen > clientWidth) {
                var rowCount = parseInt(stringLen / clientWidth); // сколько строк
                var areaHeight = rowCount * k2;
            } else {
                areaHeight = $c.TEXTAREA_DEFAULT_HEIGHT;
            }

            return areaHeight;
        };

        base.initFirstMessages = function (firstMessages) {
            var fullTalkFirstMessagesLength,
                lastLoadedId;

            firstMessages ?
                fullTalkFirstMessagesLength = firstMessages.length :
                fullTalkFirstMessagesLength = 0;

            if (fullTalkFirstMessagesLength != 0) lastLoadedId = firstMessages[fullTalkFirstMessagesLength - 1].id;

            if (firstMessages === null) firstMessages = [];

            for (var i = 0; i < fullTalkFirstMessagesLength; i++) {
                firstMessages[i].answerInputIsShow = false;
                firstMessages[i].isTreeOpen = false;
                firstMessages[i].isLoaded = false;
                firstMessages[i].answerMessage = $c.TEXT_DEFAULT_2;
                firstMessages[i].createdEdit = $c.getTiming(firstMessages[i].created);

            }

            return lastLoadedId;
        };

        base.deleteMessage = function (message, messagesArray, isTopic, isWall, isDialog) {

            if (isTopic && !isWall || message.isWallSingle) {
                // если talk-single или profit-single

                bootbox.confirm("Вы уверены, что хотите удалить эту тему?", function (result) {
                    if (result) {

                        try {
                            var deleteResult = $c.messageClient.deleteTopic(message.id);
                            message.message.content = deleteResult.message.content;
                        } catch (e) {
                            // вернул null, значит потомков нет
                        }

                        if (message.message.type == 1) {
                            $state.go('talks');
                        } else if (message.message.type == 6) {
                            $state.go('profit');
                        } else if (message.message.type == 5) {
                            $state.go('main');
                        }

                    }
                });
            } else if (isTopic) {
                try {
                    var deleteResult = $c.messageClient.deleteTopic(message.id);
                    message.message.content = deleteResult.message.content;
                } catch (e) {
                    // вернул null, значит удаление произошло чисто
                    var messagesArrayLength = messagesArray.length;

                    for (var i = 0; i < messagesArrayLength; i++) {

                        var currentId;
                        isWall ? currentId = messagesArray[i].topic.id :
                            currentId = messagesArray[i].id;

                        if (currentId == message.id) {
                            messagesArray.splice(i, 1);
                            break;
                        }
                    }
                }
            } else {
                if (isDialog) {
                    $c.dialogClient.deleteDialogMessage(message.id);

                    messagesArrayLength = messagesArray.length;
                    for (var i = 0; i < messagesArrayLength; i++) {
                        if (messagesArray[i].id == message.id) {
                            messagesArray.splice(i, 1);
                            break;
                        }
                    }

                } else {
                    try {
                        deleteResult = $c.messageClient.deleteMessage(message.id);
                        message.content = deleteResult.content;
                    }
                    catch (e) {
                        messagesArrayLength = messagesArray.length;
                        for (var i = 0; i < messagesArrayLength; i++) {
                            if (messagesArray[i].id == message.id) {
                                messagesArray.splice(i, 1);
                                break;
                            }
                        }
                    }
                }

            }
        };

        base.setEdit = function (event, message, isNeedAnswerShow) {
            if(!message.rubric) {
                //message.selRubricName = "Общее";
                message.rubric = {};
                message.rubric.visibleName = "Общее";
                message.rubric.id = 0;
            }

            //$rootScope.currentRubric = message.rubric;

            console.log('setEdit',$rootScope.currentRubric);
            var isTopic;
            (message.message) ? isTopic = true : isTopic = false;

            if (message.isEdit) {
                message.isEdit = false;

                if (isTopic) {
                    message.message.content = $filter('linky')(message.message.content, 'blank');
                    message.message.content = $c.withTags(message.message.content);
                } else {
                    message.content = $filter('linky')(message.commentText, 'blank');
                    message.content = $c.withTags(message.content);
                }

            } else {

                if (isTopic) {
                    message.message.content = $c.withoutTags(message.message.content);
                } else {
                    message.commentText = $c.withoutTags(message.content);
                }

                var el = event.target;

                var h0 = $(el).closest('.text-container').find('.text:eq(0)').height(),
                    h1 = $(el).closest('.text-container').find('.text:eq(1)').height(),
                    h;

                (h0 > h1) ? h = h0 + 24 : h = h1;

                message.isEdit = true;

                if (message.answerInputIsShow) message.answerInputIsShow = false;

                if (isTopic) {
                    var textLen = message.message.content.length;
                } else {
                    textLen = message.content.length;
                }

                /*if(textLen > base.contentLength){
                 h = (textLen/base.contentLength).toFixed(0)*(h-24);
                 }*/

                if (h < $c.TEXTAREA_DEFAULT_HEIGHT) h = $c.TEXTAREA_DEFAULT_HEIGHT;

                $(el).closest('.text-container').find('.edit-message textarea').height(h + 'px');
            }

            if (isNeedAnswerShow) {
                message.answerShow = true;
                message.commentText = message.content;
                message.isTalk = true;
            }

            if (message.isEdit) {
                // здесь рассматривается ситуация когда мы возвращаемся из редактирования,
                // но выше мы уже переключиди флаг, поэтому пишу message.isEdit, а не !message.isEdit
                if (isTopic) {
                    message.message.content = $c.withoutTags(message.message.content);
                } else {
                    message.commentText = $c.withoutTags(message.content);
                }
            }

        };

        base.pageTitle = "Новости";

        base.user = $c.shortUserInfo;

        base.bufferSelectedGroup = $c.userClientGroups[3];

        base.markImportant = function (event, message) {
            event.preventDefault();
            var isImportant;

            if (message.important == 3 || message.important == 2) {
                message.important = 1;
                isImportant = true;
                message.importantText = 'Снять метку "Важное"';
            } else {
                message.important = 3;
                isImportant = false;
                message.importantText = 'Пометить как "Важное"';
            }

            $c.messageClient.markMessageImportant(message.id, isImportant);
        };

        base.markLike = function (event, message) {
            event.preventDefault();
            var isLike;

            if (message.like == 1) {

                $('#like-help-' + message.id).fadeIn(200);

                setTimeout(hideLikeHelp, 2000, message.id);

            }

            message.like = 1;
            $c.messageClient.markMessageLike(message.id);
        };

        base.initStartParamsForCreateTopic = function (ctrl) {
            ctrl.selectedGroup = $rootScope.base.bufferSelectedGroup = $rootScope.currentGroup;
            
            ctrl.isEdit = false;
            ctrl.isCreateMessageError = false;
            ctrl.isPollAvailable = true;

            if (ctrl.id) {
                // если редактирование
                if (ctrl.poll && ctrl.poll.pollId) {
                    ctrl.isPollShow = true;

                    ctrl.pollSubject = ctrl.poll.subject;
                    var namesLength = ctrl.poll.names.length;
                    ctrl.pollInputs = [];
                    for (var i = 0; i < namesLength; i++) {
                        ctrl.pollInputs[i] = {};
                        ctrl.pollInputs[i].counter = i;
                        ctrl.pollInputs[i].name = ctrl.poll.names[i];
                    }
                    ctrl.isPollAvailable = false;
                }
            } else {
                // если создание


                ctrl.isPollShow = false;
                ctrl.pollSubject = "";
                ctrl.pollInputs = [
                    {
                        counter: 0,
                        name: ""
                    },
                    {
                        counter: 1,
                        name: ""
                    }
                ];
                ctrl.attachedImages = [];
            }

        }

        var hideLikeHelp = function (messageId) {
            $('#like-help-' + messageId).fadeOut(200);
        };

        base.showAllGroups = function () {
            var groupsLength = $rootScope.groups.length;
            for (var i = 0; i < groupsLength; i++) {
                $rootScope.groups[i].isShow = true;
                $rootScope.groups[i].selected = false;
            }
            $rootScope.groups[0].selected = true;
            $rootScope.base.bufferSelectedGroup = $rootScope.groups[0];
        };

        base.groups = $c.userClientGroups;
        base.rubrics = $c.userClientRubrics;

        base.goToDialog = function (userId) {
            var users = [];
            users[0] = userId;
            var dialog = $c.dialogClient.getDialog(users, 0);

            $state.go('dialog-single', { 'dialogId': dialog.id});
        };

        base.selectGroupInDropdown = function (groupId, ctrl) {
            $rootScope.base.bufferSelectedGroup = $c.selectGroupInDropdown(groupId);

            //if(!ctrl.isEdit){
            ctrl.selectedGroup = $rootScope.base.bufferSelectedGroup;
            //}
        };

        base.removeAttach = function (message, index, isImage) {
            isImage ?
                message.images.splice(index, 1) :
                message.documents.splice(index, 1);
        };

        $rootScope.initCreateTopic = function (ctrl) {

            if (ctrl.id) {
                // значит редактирование

                setTimeout(pollAttach, 200, ctrl.id, true); // ждем пока загрузится

            } else {
                // значит создание

                setTimeout(pollAttach, 200, ctrl.attachId, false);

            }

        };

        $rootScope.initCreateMessage = function (ctrlId, isEdit) {

            if (isEdit) {

                setTimeout(pollAttach, 200, ctrlId, true);

            } else {

                setTimeout(pollAttach, 200, ctrlId, false);

            }

        };

        function pollAttach(ctrlId, isEdit) {

            if (isEdit) {
                if ($('#attachImage-edit-' + ctrlId).length) {
                    $c.initAttachImage($('#attachImage-edit-' + ctrlId), $('#attach-area-edit-' + ctrlId)); // ��� ����� ��������
                    $c.initAttachDoc($('#attachDoc-edit-' + ctrlId), $('#attach-doc-area-edit-' + ctrlId), isEdit);
                } else {
                    setTimeout(pollAttach, 200, ctrlId, true);
                }
            } else {
                if ($('#attachImage-' + ctrlId).length) {
                    $c.initAttachImage($('#attachImage-' + ctrlId), $('#attach-area-' + ctrlId)); // ��� ����� ��������
                    $c.initAttachDoc($('#attachDoc-' + ctrlId), $('#attach-doc-area-' + ctrlId));
                } else {
                    setTimeout(pollAttach, 200, ctrlId, false);
                }
            }
        }

        function addSingleTalk(talk) {
            console.log('addSingleTalk-0',$rootScope.currentRubric);

            talk.selectedRubric = $rootScope.currentRubric;
            if(!talk.selectedRubric) {
                talk.selectedRubric = {};
                talk.selectedRubric.id = 0;
            }

            if (talk.isEdit) {
                talk.attachedImages = $c.getAttachedImages($('#attach-area-edit-' + talk.id));
                talk.attachedDocs = $c.getAttachedDocs($('#attach-doc-area-edit-' + talk.id), talk.isEdit);
            } else {
                talk.attachedImages = $c.getAttachedImages($('#attach-area-' + talk.attachId));
                talk.attachedDocs = $c.getAttachedDocs($('#attach-doc-area-' + talk.attachId));
            }

            if (talk.subject == $c.TEXT_DEFAULT_4 || talk.subject == "") {

                talk.isCreateTalkError = true;
                talk.createTalkErrorText = "Вы не указали заголовок";

            } else if (talk.attachedImages.length == 0 && (talk.attachedDocs === undefined || talk.attachedDocs.length == 0) && !talk.isPollShow
                && (talk.message.content == $c.TEXT_DEFAULT_3 || !talk.message.content)) {

                talk.isCreateTalkError = true;
                talk.createTalkErrorText = "Вы не ввели сообщение";

            } else if (talk.isPollShow && (!talk.pollSubject || talk.pollInputs[0].name == "" || talk.pollInputs[1].name == "")) {

                talk.isCreateTalkError = true;
                talk.createTalkErrorText = "Вы не указали данные для опроса";

            } else {

                if (talk.message.content == $c.TEXT_DEFAULT_3 && (talk.attachedImages || talk.attachedDocs || talk.isPollShow)) {
                    talk.message.content = "";
                }
                talk.isCreateTalkError = false;

                var isWall = 0, isAdvert = false;
                if (talk.isAdvert) isAdvert = true;

                console.log('addSingleTalk',$rootScope.currentRubric);
                var newTopic = $c.postTopic(talk, isWall, isAdvert, $filter);

                if (newTopic.poll && talk.poll) talk.poll.pollId = newTopic.poll.pollId;

                newTopic.label = $c.getLabel(base.groups, newTopic.groupType);
                newTopic.tagColor = $c.getTagColor(newTopic.label);

                $rootScope.base.createTopicIsHide = true;

                if (talk.isEdit) {
                    $c.cleanAttached($('#attach-area-edit-' + talk.id));
                    $c.cleanAttached($('#attach-doc-area-edit-' + talk.id));
                    talk.isEdit = false;
                } else {
                    $c.cleanAttached($('#attach-area-' + talk.attachId));
                    $c.cleanAttached($('#attach-doc-area-' + talk.attachId));
                    $rootScope.selectGroup($rootScope.base.bufferSelectedGroup);
                    talk.subject = $c.TEXT_DEFAULT_4;
                }
            }
        }

        function createWallTopic(ctrl) {

            if(ctrl.isEdit && !$rootScope.currentRubric) {
                ctrl.selectedRubric = ctrl.rubric;
            }else{
                ctrl.selectedRubric = $rootScope.currentRubric;
            }

            //console.log('WallTopic',ctrl.selectedRubric);

            if (ctrl.isEdit) {
                ctrl.attachedImages = $c.getAttachedImages($('#attach-area-edit-' + ctrl.id));
                ctrl.attachedDocs = $c.getAttachedDocs($('#attach-doc-area-edit-' + ctrl.id), ctrl.isEdit);
            } else {
                ctrl.attachedImages = $c.getAttachedImages($('#attach-area-' + ctrl.attachId));
                ctrl.attachedDocs = $c.getAttachedDocs($('#attach-doc-area-' + ctrl.attachId));
            }

            if (ctrl.attachedImages.length == 0 && ctrl.attachedDocs && ctrl.attachedDocs.length == 0 && !ctrl.isPollShow
                && (ctrl.message.content == $c.TEXT_DEFAULT_1 || !ctrl.message.content)) {

                ctrl.isCreateMessageError = true;
                ctrl.isCreateMessageGroupError = false;
                ctrl.isCreateMessageRubricError = false;

                ctrl.createMessageErrorText = "Вы не ввели сообщение";

            } else if (ctrl.isPollShow && (!ctrl.pollSubject || ctrl.pollInputs[0].name == "" || ctrl.pollInputs[1].name == "")) {

                ctrl.isCreateMessageError = true;
                ctrl.isCreateMessageGroupError = false;
                ctrl.isCreateMessageRubricError = false;

                ctrl.createMessageErrorText = "Вы не указали данные для опроса";

            } else if(!ctrl.selectedGroup){

                ctrl.isCreateMessageError = false;
                ctrl.isGroupsInMessShow = true;
                ctrl.isCreateMessageGroupError = true;
                ctrl.isCreateMessageRubricError = false;

            }else if(ctrl.selectedRubric === null || ctrl.selectedRubric.id === undefined){

                ctrl.isCreateMessageError = false;
                ctrl.isCreateMessageGroupError = false;
                ctrl.isCreateMessageRubricError = true;
                ctrl.isRubricsInMessShow = true;

            }else{

                if (ctrl.message.content == $c.TEXT_DEFAULT_1 && (ctrl.attachedImages || ctrl.attachedDocs || ctrl.isPollShow)) {
                    ctrl.message.content = "";
                }
                ctrl.isCreateMessageError = false;
                ctrl.isOpenMessageBar = false;
                ctrl.isGroupsInMessShow = false;
                ctrl.isRubricsInMessShow = false;

                //console.log('createWallTopic',ctrl.selectedRubric);

                var isWall = 1,
                    newTopic = $c.postTopic(ctrl, isWall, false, $filter);

                if (ctrl.isEdit) {
                    $c.cleanAttached($('#attach-area-edit-' + ctrl.id));
                    $c.cleanAttached($('#attach-doc-area-edit-' + ctrl.id));
                    ctrl.isEdit = false;
                    if (ctrl.poll && newTopic.poll) {
                        ctrl.poll.alreadyPoll = newTopic.poll.alreadyPoll;
                        ctrl.poll.pollId = newTopic.poll.pollId;
                    }
                } else {
                    ctrl.selectedGroup = ctrl.selGroupName = ctrl.selRubricName = null;
                    ctrl.selectedRubric = {};
                    $c.cleanAttached($('#attach-area-' + ctrl.attachId));
                    $c.cleanAttached($('#attach-doc-area-' + ctrl.attachId));
                }

                if (!ctrl.isWallSingle) $rootScope.selectGroup($rootScope.base.bufferSelectedGroup);

            }
        }

        $rootScope.createTopic = function (event, ctrl) {
            event.preventDefault();

            if (!ctrl.isEdit) {
                $(event.target).closest('.message-input').find('.topic-textarea').height($c.TEXTAREA_DEFAULT_HEIGHT);
            }

            if (ctrl.isTalk) {
                // значит это talk
                addSingleTalk(ctrl);
            } else {
                // значит это wall
                createWallTopic(ctrl);
            }
        };

        function createWallMessage(wallItem) {
            //wallItem.groupId = lenta.selectedGroupInTop.id;
            wallItem.groupId = $rootScope.base.bufferSelectedGroup.id;

            var isWall = true,
                message = $c.postMessageMy(wallItem, isWall, false, $filter);

            if (message == 0) {
                wallItem.isCreateCommentError = true;
                wallItem.createCommentErrorText = "Вы не ввели сообщение";
            } else {
                wallItem.isCreateCommentError = false;
                base.initStartParamsForCreateMessage(message);

                if (wallItem.messages) {
                    wallItem.messages.push(message);

                    var mesLen = wallItem.messages.length;

                    (mesLen >= $rootScope.COMMENTS_DEFAULT_COUNT && !wallItem.isOpen) ?
                        wallItem.bufferMessages = wallItem.messages.slice(mesLen - $rootScope.COMMENTS_DEFAULT_COUNT) :
                        wallItem.bufferMessages = wallItem.messages;

                } else {
                    wallItem.messages = [];
                    wallItem.messages[0] = message;

                    wallItem.bufferMessages = [];
                    wallItem.bufferMessages[0] = wallItem.messages[0];
                }

            }
        }

        function addSingleFirstMessage(talk) {
            if (talk.fullTalkTopic)talk.topicId = talk.fullTalkTopic.id;

            talk.messageId = talk.id;

            var isWall = false,
                isFirstLevel = true,
                newMessage = $c.postMessageMy(talk, isWall, isFirstLevel, $filter);

            if (newMessage == 0) {
                talk.isCreateFirstMessageError = true;
                talk.createFirstMessageErrorText = "Вы не ввели сообщение";
            } else {
                talk.fullTalkTopic ?
                    talk.fullTalkTopic.answerInputIsShow = false :
                    talk.answerInputIsShow = false;

                talk.isCreateFirstMessageError = false;

                /*if(talk.fullTalkTopic && !talk.fullTalkFirstMessages){
                 talk.fullTalkFirstMessages = [];
                 talk.fullTalkFirstMessages[0] = newMessage;
                 }*/

                talk.isEdit = false;

                if (talk.fullTalkTopic) {
                    if (talk.fullTalkFirstMessages) {

                        if (talk.fullTalkFirstMessages.length < 10 ||
                            $rootScope.base.isEarliestMessages ||
                            $rootScope.base.endOfLoaded) {

                            $rootScope.base.lastLoadedId = newMessage.id;
                            talk.fullTalkFirstMessages.push(newMessage);

                        }

                    } else {
                        talk.fullTalkFirstMessages = [];
                        talk.fullTalkFirstMessages[0] = newMessage;
                        $rootScope.base.lastLoadedId = newMessage.id;
                        $rootScope.base.isEarliestMessages = true;
                    }
                }

            }
        }

        function addSingleMessage(firstMessage, topicId, talk, message) {
            if (!talk.fullTalkMessages[firstMessage.id])
                talk.fullTalkMessages[firstMessage.id] =
                    $c.messageClient.getMessages(topicId, talk.selectedGroup.id, 1, firstMessage.id, 0, 1000).messages;

            var fullTalkMessagesLength;
            talk.fullTalkMessages[firstMessage.id] ?
                fullTalkMessagesLength = talk.fullTalkMessages[firstMessage.id].length :
                fullTalkMessagesLength = 0;

            var newMessage, answer, parentId;

            if (!message) {
                // если добавляем к сообщению первого уровня
                talk.messageId = firstMessage.id;
                talk.message = firstMessage;

                answer = firstMessage.commentText;
                firstMessage.isTreeOpen = true;
                firstMessage.commentText = $c.TEXT_DEFAULT_2;
                parentId = firstMessage.id;

                if (!firstMessage.childCount || firstMessage.childCount == 0) firstMessage.childCount = 1;

            } else {
                // если добавляем к простому сообщению
                talk.messageId = message.id;
                talk.message = message;

                for (var i = 0; i < fullTalkMessagesLength; i++) {
                    if (talk.fullTalkMessages[firstMessage.id][i].id == message.id) {
                        //talk.fullTalkMessages[firstMessage.id][i].answerInputIsShow = false;
                        talk.fullTalkMessages[firstMessage.id][i].isTreeOpen = true;
                        talk.fullTalkMessages[firstMessage.id][i].isOpen = true;
                        talk.fullTalkMessages[firstMessage.id][i].isParentOpen = true;
                        talk.fullTalkMessages[firstMessage.id][i].createdEdit = $c.getTiming(talk.fullTalkMessages[firstMessage.id][i].created);
                        answer = talk.fullTalkMessages[firstMessage.id][i].commentText;
                    }
                }
                parentId = message.id;

            }
            var isWall = false,
                isFirstLevel = false;
            talk.topicId = topicId;
            talk.parentId = parentId;
            talk.commentText = answer;

            newMessage = $c.postMessageMy(talk, isWall, isFirstLevel, $filter);

            if (newMessage == 0) {
                if (!message) {
                    talk.isCreateMessageToFirstError = true;
                    talk.createMessageToFirstErrorText = "Вы не ввели сообщение";
                } else {
                    talk.isCreateMessageError = true;
                    talk.createMessageErrorText = "Вы не ввели сообщение";
                }
            } else {
                if (!message) {
                    talk.isCreateMessageToFirstError = false;
                    firstMessage.answerInputIsShow = false;
                    firstMessage.isEdit = false;

                } else {
                    talk.isCreateMessageError = false;
                    for (var i = 0; i < fullTalkMessagesLength; i++) {
                        if (talk.fullTalkMessages[firstMessage.id][i].id == message.id) {
                            talk.fullTalkMessages[firstMessage.id][i].answerInputIsShow = false;
                            talk.fullTalkMessages[firstMessage.id][i].isEdit = false;
                        }
                    }
                }

                talk.fullTalkMessages[firstMessage.id] = $c.messageClient.getMessages(topicId, talk.selectedGroup.id, 1, firstMessage.id, 0, 1000).messages;

                talk.fullTalkMessages[firstMessage.id] ?
                    fullTalkMessagesLength = talk.fullTalkMessages[firstMessage.id].length :
                    fullTalkMessagesLength = 0;

                for (var i = 0; i < fullTalkMessagesLength; i++) {
                    talk.fullTalkMessages[firstMessage.id][i].answerInputIsShow = false;
                    talk.fullTalkMessages[firstMessage.id][i].isTreeOpen = true;
                    talk.fullTalkMessages[firstMessage.id][i].isOpen = true;
                    talk.fullTalkMessages[firstMessage.id][i].isParentOpen = true;
                    talk.fullTalkMessages[firstMessage.id][i].createdEdit = $c.getTiming(talk.fullTalkMessages[firstMessage.id][i].created);
                    talk.fullTalkMessages[firstMessage.id][i].commentText = $c.TEXT_DEFAULT_2;
                }
            }
        }

        function addDialogMessage(ctrl) {
            var attach = [];

            if ((ctrl.commentText != $c.TEXT_DEFAULT_1 && ctrl.commentText != "") || attach.length != 0) {

                if (ctrl.isEdit) {
                    // значит редактирование

                    var attachImg = $c.getAttachedImages($('#attach-area-edit-' + ctrl.attachId));
                    var attachDoc = $c.getAttachedDocs($('#attach-doc-area-edit-' + ctrl.attachId), true);
                    attach = attachImg.concat(attachDoc);

                    // еще attach
                    ctrl.commentText = $filter('linky')(ctrl.commentText, 'blank');
                    ctrl.commentText = $c.withTags(ctrl.commentText);
                    $c.dialogClient.updateDialogMessage(ctrl.id, ctrl.commentText, attach);

                    $c.cleanAttached($('#attach-area-edit-' + ctrl.attachId));
                    $c.cleanAttached($('#attach-doc-area-edit-' + ctrl.attachId));

                    ctrl.content = ctrl.commentText;

                    ctrl.images = attachImg;
                    ctrl.documents = attachDoc;
                    ctrl.isEdit = false;

                } else {
                    // значит создание
                    attach = $c.getAttachedImages($('#attach-area-' + ctrl.attachId)).concat($c.getAttachedDocs($('#attach-doc-area-' + ctrl.attachId)));

                    var newDialogMessage = new com.vmesteonline.be.thrift.messageservice.DialogMessage();

                    (ctrl.commentText == $c.TEXT_DEFAULT_1) ?
                        newDialogMessage.content = "" :
                        newDialogMessage.content = ctrl.commentText;

                    newDialogMessage.author = $rootScope.base.me.id;

                    newDialogMessage.created = Date.parse(new Date()) / 1000;
                    newDialogMessage.authorProfile = $c.userClient.getUserProfile(newDialogMessage.author);

                    newDialogMessage.content = $filter('linky')(newDialogMessage.content, 'blank');
                    newDialogMessage.content = $c.withTags(newDialogMessage.content);
                    var tempMessage = $c.dialogClient.postMessage(ctrl.dialogId, newDialogMessage.content, attach);

                    newDialogMessage.images = tempMessage.images;
                    newDialogMessage.documents = tempMessage.documents;
                    newDialogMessage.id = tempMessage.id;
                    newDialogMessage.isDialog = true;
                    newDialogMessage.attachId = ctrl.dialogId + "-" + newDialogMessage.id;

                    //ctrl.privateMessages.unshift(newDialogMessage);
                    $rootScope.base.privateMessages.unshift(newDialogMessage);
                    $rootScope.base.initStartParamsForCreateMessage(newDialogMessage);

                    if (ctrl.privateMessages.length == 1) {
                        // на случай если с 0 добавляется более 20 сообщений
                        // чтобы подгружал от 1го сообщения а не от 0
                        $rootScope.base.lastLoadedId = newDialogMessage.id;
                    }

                    ctrl.commentText = $c.TEXT_DEFAULT_1;

                    $c.cleanAttached($('#attach-area-' + ctrl.attachId));
                    $c.cleanAttached($('#attach-doc-area-' + ctrl.attachId));
                }

            }

        }

        $rootScope.createMessage = function (e, ctrl, topicId, talk, message) {
            e.preventDefault();

            if (!ctrl.isEdit) {
                $(e.target).closest('.answer-block').find('.message-textarea').height($c.TEXTAREA_DEFAULT_HEIGHT);
            }

            if (ctrl.isTalk) {
                //alert('111 '+ctrl.fullAdvertTopic+" "+ctrl.parentId);
                if ((ctrl.fullTalkTopic || ctrl.parentId == 0) && !topicId) {
                    //alert('1');
                    addSingleFirstMessage(ctrl);
                } else {
                    if (!message) {
                        //alert('2');
                        addSingleMessage(ctrl, topicId, talk);
                    } else {
                        //alert('3');
                        addSingleMessage(message, topicId, talk, ctrl);
                    }
                }

            } else if (ctrl.isDialog) {
                addDialogMessage(ctrl);
            } else {
                createWallMessage(ctrl);
            }

        };

        base.initStartParamsForCreateMessage = function (ctrl) {

            ctrl.isEdit = false;
            ctrl.answerShow = false;
            ctrl.isFocus = false;
            ctrl.isCreateCommentError = false;

            if (ctrl.isDialog) {
                ctrl.default = ctrl.commentText = $c.TEXT_DEFAULT_1;
            } else {
                ctrl.default = ctrl.commentText = $c.TEXT_DEFAULT_2;
            }

            if (ctrl.id || ctrl.isDialog) {
                // занчит редактирование
                if (!ctrl.isTalk) ctrl.commentText = ctrl.content;
                ctrl.answerShow = true;
            } else {
                // значит создание
            }

        };

        base.getUserColor = function (groupType) {
            return $c.getTagColor($c.getLabel(base.groups, groupType));
        };

        base.toggleFullText = function (ctrl) {
            ctrl.isFullText ? ctrl.isFullText = false : ctrl.isFullText = true;
        };

        base.setPrivateMessages = function (dialogId, loadedLength) {
            try {
                $rootScope.base.privateMessages = $c.dialogClient.getDialogMessages(dialogId, 0, loadedLength, 0);
            } catch (e) {
                $state.go('dialogs');
            }
            var privateMessagesLength = $rootScope.base.privateMessages.length;

            if (privateMessagesLength != 0) $rootScope.base.lastLoadedId = $rootScope.base.privateMessages[privateMessagesLength - 1].id;

            for (var i = 0; i < privateMessagesLength; i++) {
                $rootScope.base.privateMessages[i].authorProfile = $c.userClient.getUserProfile($rootScope.base.privateMessages[i].author);
                $rootScope.base.privateMessages[i].isDialog = true;
                $rootScope.base.privateMessages[i].attachId = dialogId + "-" + $rootScope.base.privateMessages[i].id;
                $rootScope.base.initStartParamsForCreateMessage($rootScope.base.privateMessages[i]);
            }
        };

        base.newPrivateMessagesCount = 0;
        base.biggestCountDialogId = 0;
        $rootScope.newMessages = [];
        $rootScope.newImportantCount = 0;

        var timeStamp = 0;
        base.checkUpdates = function () {
            try {
                timeStamp = $c.messageClient.checkUpdates(timeStamp);
            } catch (e) {
                document.location.replace('/login');
            }

            var updateMap,
                old = 0;

            console.log('timestemp ' + timeStamp);

            if (timeStamp == 0) {
                try {
                    updateMap = $c.messageClient.getDialogUpdates();
                } catch (e) {
                    document.location.replace('/login');
                }
                var temp = 0,
                    currentDialogId,
                    counter = 0;

                if($rootScope.base && $rootScope.base.currentDialogId)currentDialogId = $rootScope.base.currentDialogId;


                $rootScope.newMessages = [];

                for (var dialogId in updateMap) {
                    $rootScope.newMessages[counter++] = {
                        dialogId: dialogId,
                        count: updateMap[dialogId]
                    };
                    if (dialogId != currentDialogId || $rootScope.currentPage != 'dialog-single') {

                        temp += updateMap[dialogId];

                        if (updateMap[dialogId] > old) {
                            base.biggestCountDialogId = dialogId;
                        }

                        old = updateMap[dialogId];
                    } else {
                        base.setPrivateMessages(currentDialogId, 20);
                    }
                }

                base.newPrivateMessagesCount = temp;
                try {
                    $rootScope.$digest();
                } catch (e) {
                    console.log('err');
                }

            } else if (timeStamp == 1) {
                // notification
                $rootScope.newMessages = [];
                base.me.notificationIsShow = true;
                base.me.userNotification = $c.messageClient.getMulticastMessage();

            } else if (timeStamp >= 2 && timeStamp < 10000) {
                // important messages
                console.log('important ' + timeStamp);
                $rootScope.newMessages = [];
                $rootScope.newImportantCount = timeStamp;

                $rootScope.importantTopics = $c.messageClient.getImportantNews($rootScope.currentGroup.id);

            } else {
                $rootScope.newMessages = [];
                $rootScope.newImportantCount = 0;
            }

        };

        setInterval(base.checkUpdates, 5000);

        base.nextNotification = function () {
            base.me.userNotification = $c.messageClient.getNextMulticastMessage();
            if (!base.me.userNotification) {
                base.me.notificationIsShow = false;
            }
        };

        base.groupAddresesList = [];
        base.isAddresesListShow = [];
        base.showGroupAdressesList = function(messageId){
            if(!base.groupAddresesList[messageId]) {
                base.groupAddresesList[messageId] = $c.userClient.getAddressListByMessageId(messageId);
            }
            base.isAddresesListShow[messageId] = true;
        };
        base.hideGroupAdressesList = function(messageId){
            base.isAddresesListShow[messageId] = false;
        };

        base.userMenuToggle = function($event){
            $event.preventDefault();
            $event.stopPropagation();
            base.isUserMenuShow ? base.isUserMenuShow = false : base.isUserMenuShow = true;
        };

        base.isAttachDropdownShow = [];
        base.isHashtagDropdownShow = false;
        base.isRubricsDropdownShow = false;

        base.toggleAttachDropdown = function($event,ctrl,ctrlId){
            $event.stopPropagation();

            var id;
            if(ctrl) {
                (ctrl.isEdit) ? id = ctrl.id : id = ctrl.attachId;
            }else{
                id = ctrlId;
            }

            base.isAttachDropdownShow[id] ?
                base.isAttachDropdownShow[id] = false :
                    base.isAttachDropdownShow[id] = true;

            //console.log('3',id,base.isAttachDropdownShow[id]);
        };
        base.toggleHashtagDropdown = function($event){
            $event.stopPropagation();
            base.isHashtagDropdownShow ? base.isHashtagDropdownShow = false : base.isHashtagDropdownShow = true;
        };
        base.toggleRubricsDropdown = function($event){
            $event.stopPropagation();
            base.isRubricsDropdownShow ? base.isRubricsDropdownShow = false : base.isRubricsDropdownShow = true;
        };

        base.hideDropdown = function(){
            base.isUserMenuShow = false;
            base.isAttachDropdownShow = [];
            base.isHashtagDropdownShow = false;
            base.isRubricsDropdownShow = false;
        };

        base.contentLength = 500;

        /*var lsGroupId = localStorage.getItem('groupId'),
            groupsLength = base.groups.length;*/

        /*if (!lsGroupId) {*/
            $rootScope.currentGroup = $c.getDefaultGroup(base.groups);
        /*} else {
            for (var i = 0; i < groupsLength; i++) {
                if (base.groups[i].id == lsGroupId) {
                    $rootScope.currentGroup = base.groups[i];
                }
            }
            if (!$rootScope.currentGroup) {
                $rootScope.currentGroup = $c.getDefaultGroup(base.groups);
            }
        }*/

        base.isLentaFocus = false;

        base.checkUpdates();

        $rootScope.currentPage = 'lenta';

        $rootScope.leftbar = {};
    }

    $rootScope.base = base;

    };

module.exports = [ '$scope','$rootScope','$state','$filter','$location','$c', baseCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\blog.js":[function(require,module,exports){

var blogCtrl = function($rootScope,$c) {
    var blog = this;

    $rootScope.base.isFooterBottom = true;

    blog.isAuth = $c.authClient.checkIfAuthorized();

    if(blog.isAuth){
        //me = userClient.getUserProfile();
        //$('.anonName').removeClass('hidden');
    }

    blog.posts = $c.messageClient.getBlog(0,1000);

    var len = blog.posts.topics.length;
    for(var i = 0; i < len; i++){
        blog.posts.topics[i].isCommentShow = false;
        blog.posts.topics[i].isInputShow = false;
    }

    blog.toggleComm = function($event,post){
        $event.preventDefault();

        if (post.isCommentShow){
            post.isCommentShow = false;

        }else{
            post.isCommentShow = true;

            if(!post.comments) {
                post.comments = $c.messageClient.getMessagesAsList(post.id, 7, 0, false, 1000).messages;
                console.log('finish');
            }
        }

    };

    blog.toggleInput = function($event,post){
        $event.preventDefault();

        post.isInputShow ? post.isInputShow = false : post.isInputShow = true;

        console.log('input',post.isInputShow);

        //$(this).closest('.post').find('.input-group').slideToggle(200,function(){
            /*if(userName){
                $(this).find('textarea').val(userName);
                setCaretToPos($(this).find('textarea')[0],userName.length);
            }
            $(this).find('textarea').focus();*/
        //});
    };

    blog.sendComm = function($event,post){
        $event.preventDefault();
        var message = new com.vmesteonline.be.thrift.messageservice.Message();

        message.id = 0;
        message.topicId = post.id;
        message.type = com.vmesteonline.be.thrift.messageservice.MessageType.BLOG;//7;
        message.groupId = 0;
        message.content = post.commenting;
        message.parentId = 0;
        message.created = Date.parse(new Date())/1000;

        if(!blog.isAuth){
            message.anonName = post.anonName;
        }else{
            message.anonName = "";
        };

        var returnComment = $c.messageClient.postBlogMessage(message);
        if(post.comments && post.comments.length) {
            post.comments.push(returnComment);
        }else{
            post.comments = [];
            post.comments[0] = returnComment;
        }

    };

    blog.getTiming = function(messageObjDate){
        var minute = 60*1000,
            hour = minute*60,
            day = hour*24,
            threeDays = day* 3,
            now = Date.parse(new Date()),
            timing = (now - messageObjDate*1000),
            timeTemp;

        if(timing < minute){
            timing = "только что";
        }else if(timing < hour){
            timing = new Date(timing);
            timing = timing.getMinutes()+" мин назад";
        }else if(timing < day){
            timing = new Date(timing);
            timeTemp = timing.getHours();
            if(timeTemp == 1 || timeTemp == 0){
                timing = "1 час назад";
            }else if(timeTemp > 1 && timeTemp < 5){
                timing = timeTemp + " часа назад";
            }else{
                timing = timeTemp + " часов назад";
            }
        }else if(timing < threeDays){
            timing = new Date(timing);
            timeTemp = timing.getDate();
            if(timeTemp == 1){
                timing = timeTemp+" день назад";
            }else{
                timing = timeTemp+" дней назад";
            }
        }else{
            timeTemp = new Date(messageObjDate*1000).toLocaleDateString();
            var arr = timeTemp.split('.');
            if(arr[0].length == 1) arr[0] = "0"+arr[0];
            if(arr[1].length == 1) arr[1] = "0"+arr[1];
            timing = arr[0]+"."+arr[1]+"."+arr[2];
        }

        return timing;
    };

    /*$('.itemdiv').each(function(){
        var span = $(this).find('.lenta-item-bottom span');
        var created = span.attr('data-created');

        span.text(getTiming(created));
    });

    var h = $(window).height()-105;
    $('.container.coming-soon .main-container').css({'min-height': h});

    $('.post').each(function(){
        var link = $(this).attr('data-postlink');

        $(this).find('.topic').load(link+' .post', function(){
        });
    });

    var isCommentsLoaded = [];
    $('.show-comment').click(function(e){
        e.preventDefault();

        if($(this).text() == "Показать комментарии"){
            $(this).text("Скрыть комментарии");
        }else{
            $(this).text("Показать комментарии");
        }

        var topicId = $(this).closest('.post').attr('data-topicid'),
            dialogs = $(this).closest('.post').find('.dialogs');

        //if(!isCommentsLoaded[topicId]){
        var comments = c.messageClient.getMessagesAsList(topicId, 7, 0,false,1000).messages;
        //alert(comments.length);

        if(comments){
            var commentsLength = comments.length,
                commentsHTML = "";

            for(var i = 0; i < commentsLength; i++){
                var classNoLink = "",
                    messageAvatar,
                    messageName,
                    messageUserId;

                if(!comments[i].userInfo){
                    messageAvatar = "data/da.gif";
                    messageUserId = 0;
                    classNoLink = "no-link";
                }else{
                    //messageName = comments[i].userInfo.firstName+" "+comments[i].userInfo.lastName;
                    messageAvatar = comments[i].userInfo.avatar;
                    messageUserId = comments[i].userInfo.id;
                }

                messageName = comments[i].anonName;

                commentsHTML += '<div class="itemdiv dialogdiv new">'+
                    '<a href="profile-'+messageUserId+'" class="user '+classNoLink+'">'+
                    '<div class="avatar short2" style="background-image: url('+messageAvatar+')"></div>'+
                    '</a>'+
                    '<div class="body">'+
                    '<div class="name">'+
                    '<a href="profile-'+messageUserId+'" class="'+classNoLink+'">'+messageName+'</a>'+
                    '</div>'+
                    '<div class="text">'+comments[i].content+'</div>'+
                    '<div class="lenta-item-bottom">'+
                    '<span>'+ getTiming(comments[i].created) +'</span>'+
                    '<a href="#"> Ответить</a>'+
                    '</div>'+
                    '</div>'+
                    '</div>';
            }
        }

        dialogs.html("");
        dialogs.prepend(commentsHTML);

        initNoLink($(this).closest('.post'));
        initAnswerToComment($('.new .lenta-item-bottom a'));
        $('.new').removeClass('new');

        isCommentsLoaded[topicId] = true;

        //}

        dialogs.slideToggle(200);
    });

    function initAnswerToComment(selector){
        selector.click(function(e){
            e.preventDefault();

            var userName = $(this).closest('.body').find('.name a').text()+", ";
            $(this).closest('.post').find('.make-comment').trigger('click',userName);
        });
    }
    initAnswerToComment($('.lenta-item-bottom a'));

    $('.make-comment').click(function(e,userName){
        e.preventDefault();

        $(this).closest('.post').find('.input-group').slideToggle(200,function(){
            if(userName){
                $(this).find('textarea').val(userName);
                setCaretToPos($(this).find('textarea')[0],userName.length);
            }
            $(this).find('textarea').focus();
        });
    });

    function initNoLink(selector){

        selector.find('.no-link').click(function(e){
            e.preventDefault();

        });

    }
    initNoLink($('.blog'));

    $('.send-in-blog').click(function(){
        var message = new com.vmesteonline.be.thrift.messageservice.Message();

        message.id = 0;
        message.topicId = $(this).closest('.post').attr('data-topicid');
        message.type = com.vmesteonline.be.thrift.messageservice.MessageType.BLOG;//7;
        message.groupId = 0;
        message.content = $(this).closest('.input-group').find('.message-textarea').val();
        message.parentId = 0;
        message.created = Date.parse(new Date())/1000;

        if(!isAuth){
            message.anonName = $(this).closest('.input-group').find('.anonName').val();
        }else{
            message.anonName = "";
        };

        var returnComment = c.messageClient.postBlogMessage(message);
        var comments = $(this).closest('.post').find('.dialogs');

        var classNoLink = "";

        if(!isAuth){
            message.avatar = "data/da.gif";
            message.name = message.anonName;
            message.userId = 0;
            classNoLink = "no-link";
        }else{
            message.avatar = returnComment.userInfo.avatar;
            message.name = returnComment.userInfo.firstName+" "+returnComment.userInfo.lastName;
            message.userId = returnComment.userInfo.id ;
        }

        var newCommentHTML = '<div class="itemdiv dialogdiv new">'+
            '<a href="profile-'+ message.userId +'" class="user '+ classNoLink +'">'+
            '<div class="avatar short2" style="background-image: url('+ message.avatar +')"></div>'+
            '</a>'+
            '<div class="body">'+
            '<div class="name">'+
            '<a href="profile-'+ message.userId +'" class="'+ classNoLink +'" >'+ message.name +'</a>'+
            '</div>'+
            '<div class="text">'+ message.content +'</div>'+
            '<div class="lenta-item-bottom">'+
            '<span>'+ getTiming(message.created) +'</span>'+
            '<a href="#">Ответить</a>'+
            '</div>'+
            '</div>'+
            '</div>';

        if(comments.css('display') == 'none'){

            $(this).closest('.post').find('.show-comment').trigger('click');

        }else{
            comments.append(newCommentHTML);

            initNoLink($('.new'));
            initAnswerToComment($('.new .lenta-item-bottom a'));
            $('.new').removeClass('new');
        }

        //setTimeout(tempFunc,1000,comments,newCommentHTML,message,$(this));

        $(this).closest('.input-group').hide();
        $(this).closest('.input-group').find('textarea').val("");

    });

    function getTiming(messageObjDate){
        var minute = 60*1000,
            hour = minute*60,
            day = hour*24,
            threeDays = day* 3,
            now = Date.parse(new Date()),
            timing = (now - messageObjDate*1000),
            timeTemp;

        if(timing < minute){
            timing = "только что";
        }else if(timing < hour){
            timing = new Date(timing);
            timing = timing.getMinutes()+" мин назад";
        }else if(timing < day){
            timing = new Date(timing);
            timeTemp = timing.getHours();
            if(timeTemp == 1 || timeTemp == 0){
                timing = "1 час назад";
            }else if(timeTemp > 1 && timeTemp < 5){
                timing = timeTemp + " часа назад";
            }else{
                timing = timeTemp + " часов назад";
            }
        }else if(timing < threeDays){
            timing = new Date(timing);
            timeTemp = timing.getDate();
            if(timeTemp == 1){
                timing = timeTemp+" день назад";
            }else{
                timing = timeTemp+" дней назад";
            }
        }else{
            timeTemp = new Date(messageObjDate*1000).toLocaleDateString();
            var arr = timeTemp.split('.');
            if(arr[0].length == 1) arr[0] = "0"+arr[0];
            if(arr[1].length == 1) arr[1] = "0"+arr[1];
            timing = arr[0]+"."+arr[1]+"."+arr[2];
        }

        return timing;
    }

    function setSelectionRange(input, selectionStart, selectionEnd) {
        if (input.setSelectionRange) {
            input.focus();
            input.setSelectionRange(selectionStart, selectionEnd);
        }
        else if (input.createTextRange) {
            var range = input.createTextRange();
            range.collapse(true);
            range.moveEnd('character', selectionEnd);
            range.moveStart('character', selectionStart);
            range.select();
        }
    }

    function setCaretToPos (input, pos) {
        setSelectionRange(input, pos, pos);
    }
*/

    $('.ng-cloak').removeClass('ng-cloak');

};

module.exports = [ '$rootScope','$c', blogCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\business\\cabinet.js":[function(require,module,exports){

var cabinetCtrl = function($rootScope,$c) {
    var nearby = this,
        postId;

    var businessDescription = new com.vmesteonline.be.thrift.businesservice.BusinessDescription;
    businessDescription.shortName = "Мега Пицца";
    businessDescription.fulltName = "Мега Пицца круто-круто";
    businessDescription.shortInfo = "Мега Пицца круто-круто быстро-быстро";
    businessDescription.fullInfo = "Мега Пицца круто-круто быстро-быстро дешево";
    businessDescription.longitude = '30';
    businessDescription.latitude = '60';
    businessDescription.radius = 500;
    //businessClient.createBusinessDescription(businessDescription,'w','w');

    //console.log('business created');

    nearby.info = $c.businessClient.getMyBusinessInfo();
    nearby.info.fullInfo = nearby.info.fullInfo.replace('\n','<br>');

    /*if ($stateParams.nearbyId && $stateParams.nearbyId != 0){
        postId = $stateParams.nearbyId;
    }*/

    nearby.carouselInterval = 5000;
    /*nearby.addSlide = function() {
        var newWidth = 600 + slides.length + 1;
        slides.push({
            image: 'http://placekitten.com/' + newWidth + '/300',
            text: ['More','Extra','Lots of','Surplus'][slides.length % 4] + ' ' +
                ['Cats', 'Kittys', 'Felines', 'Cutes'][slides.length % 4]
        });
    };
    for (var i=0; i<4; i++) {
        nearby.addSlide();
    }*/

    $rootScope.base.isFooterBottom = true;

    nearby.toggleInput = function($event,post){
        $event.preventDefault();

        post.isInputShow ? post.isInputShow = false : post.isInputShow = true;

        console.log('input',post.isInputShow);

    };

    nearby.wallItem = $c.businessClient.getWallItem(nearby.info.id);
    console.log('1',nearby.wallItem);

    nearby.sendComm = function($event,post){
        $event.preventDefault();
        var message = new com.vmesteonline.be.thrift.messageservice.Message();

        message.id = 0;
        message.topicId = nearby.info.id; //post.id;
        message.type = com.vmesteonline.be.thrift.messageservice.MessageType.WALL;//8;
        message.groupId = 0;
        message.content = post.commenting;
        message.topicId = nearby.wallItem.topic.id;
        message.parentId = 0;
        message.created = Date.parse(new Date())/1000;
        post.commenting = "";

        if(!nearby.isAuth){
            message.anonName = post.anonName;
        }else{
            message.anonName = "";
        };

        console.log('post',message);
        //var returnComment = c.messageClient.postBusinessTopics(message);
        var returnComment = $c.messageClient.postMessage(message);
        console.log('post2',returnComment);


        if(nearby.wallItem.messages && nearby.wallItem.messages.length) {
            nearby.wallItem.messages.push(returnComment);
        }else{
            nearby.wallItem.messages = [];
            nearby.wallItem.messages[0] = returnComment;
        }

    };

    nearby.getTiming = function(messageObjDate){
        var minute = 60*1000,
            hour = minute*60,
            day = hour*24,
            threeDays = day* 3,
            now = Date.parse(new Date()),
            timing = (now - messageObjDate*1000),
            timeTemp;

        if(timing < minute){
            timing = "только что";
        }else if(timing < hour){
            timing = new Date(timing);
            timing = timing.getMinutes()+" мин назад";
        }else if(timing < day){
            timing = new Date(timing);
            timeTemp = timing.getHours();
            if(timeTemp == 1 || timeTemp == 0){
                timing = "1 час назад";
            }else if(timeTemp > 1 && timeTemp < 5){
                timing = timeTemp + " часа назад";
            }else{
                timing = timeTemp + " часов назад";
            }
        }else if(timing < threeDays){
            timing = new Date(timing);
            timeTemp = timing.getDate();
            if(timeTemp == 1){
                timing = timeTemp+" день назад";
            }else{
                timing = timeTemp+" дней назад";
            }
        }else{
            timeTemp = new Date(messageObjDate*1000).toLocaleDateString();
            var arr = timeTemp.split('.');
            if(arr[0].length == 1) arr[0] = "0"+arr[0];
            if(arr[1].length == 1) arr[1] = "0"+arr[1];
            timing = arr[0]+"."+arr[1]+"."+arr[2];
        }

        return timing;
    };


    $('.ng-cloak').removeClass('ng-cloak');

};

module.exports = [ '$rootScope','$c', cabinetCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\business\\edit.js":[function(require,module,exports){

var editCtrl = function($rootScope,$scope,$c,FileUploader) {

    var edit = this;

    var attach = new com.vmesteonline.be.thrift.messageservice.Attach(),
        isLogoUploader, isImagesUploader, imagesCounter = 0,imagesLength;

    $scope.setLoadImage = function(fileBase64){

        var svc = $c.fileClient.saveFileContent(fileBase64, true);
        console.log('setLoadImage',fileBase64);
        if(isLogoUploader){
            edit.businessDescription.logo.URL = attach.URL = edit.logoURL = svc;
            isLogoUploader = false;
        }else if(isImagesUploader){
            edit.businessDescription.images[imagesCounter].URL = svc;
            imagesCounter++;
            if(imagesCounter == imagesLength) isImagesUploader = false;

            console.log('images',imagesCounter,edit.businessDescription.images);
        }

    };

    //var uploader = $scope.uploaderLogo = new FileUploader();
    $scope.uploaderLogo = new FileUploader();
    $scope.uploaderImages = new FileUploader();

    // FILTERS

    $scope.uploaderLogo.filters.push({
        name: 'imageFilter',
        fn: function(item /*{File|FileLikeObject}*/, options) {
            var type = '|' + item.type.slice(item.type.lastIndexOf('/') + 1) + '|';
            return '|jpg|png|jpeg|bmp|gif|'.indexOf(type) !== -1;
        }
    });

    /*uploaderLogo.onWhenAddingFileFailed = function(item *//*{File|FileLikeObject}*//*, filter, options) {
        console.info('onWhenAddingFileFailed', item, filter, options);
    };*/
    $scope.uploaderLogo.onAfterAddingFile = function(fileItem) {
        console.info('onAfterAddingFile 1', fileItem);
        isLogoUploader = true;

        attach.fileName = fileItem._file.name;
        attach.contentType = fileItem._file.type;
    };
    $scope.uploaderImages.onAfterAddingFile = function(fileItem) {
        console.info('onAfterAddingFile 2', fileItem);
    };
    $scope.uploaderImages.onAfterAddingAll = function(addedFileItems) {
        console.info('onAfterAddingAll', addedFileItems);

        isImagesUploader = true;
        //imagesCounter = 0;

        imagesLength = addedFileItems.length;
        for(var i = 0; i < imagesLength; i++){
            edit.businessDescription.images[i] = new com.vmesteonline.be.thrift.messageservice.Attach();
            edit.businessDescription.images[i].fileName = addedFileItems[i]._file.name;
            edit.businessDescription.images[i].contentType = addedFileItems[i]._file.type;
        }

    };
    /*$scope.uploaderLogo.onBeforeUploadItem = function(item) {
        console.info('onBeforeUploadItem', item);
    };
    $scope.uploaderLogo.onProgressItem = function(fileItem, progress) {
        console.info('onProgressItem', fileItem, progress);
    };
    $scope.uploaderLogo.onProgressAll = function(progress) {
        console.info('onProgressAll', progress);
    };
    $scope.uploaderLogo.onSuccessItem = function(fileItem, response, status, headers) {
        console.info('onSuccessItem', fileItem, response, status, headers);
    };
    $scope.uploaderLogo.onErrorItem = function(fileItem, response, status, headers) {
        console.info('onErrorItem', fileItem, response, status, headers);
    };
    $scope.uploaderLogo.onCancelItem = function(fileItem, response, status, headers) {
        console.info('onCancelItem', fileItem, response, status, headers);
    };
    $scope.uploaderLogo.onCompleteItem = function(fileItem, response, status, headers) {
        console.info('onCompleteItem', fileItem, response, status, headers);
    };
    $scope.uploaderLogo.onCompleteAll = function() {
        console.info('onCompleteAll');
    };*/


    $rootScope.businessDescription = edit.businessDescription = $c.businessClient.getMyBusinessInfo();

    //edit.businessDescription = new com.vmesteonline.be.thrift.businesservice.BusinessDescription;

    edit.save = function(){

        //edit.businessDescription.logo.URL = $c.fileClient.saveFileContent(bg, true);
        // bg - binary data base64


        edit.businessDescription.logo = attach;
        console.log('save',edit.businessDescription);
        //edit.businessDescription.logo.fileName = '1';
        //edit.businessDescription.logo.URL = '/static/images/anna.jpg';

        try {
            $c.businessClient.updateBusinessDescription(edit.businessDescription);
            edit.statusText = "Сохранено";
            edit.status = 1;
        }catch(e){
            edit.statusText = "При сохранении произошла ошибка";
            edit.status = 0;
        }

        console.log('after save',edit.businessDescription);

    }

};

module.exports = [ '$rootScope','$scope','$c','FileUploader', editCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\business\\statistic.js":[function(require,module,exports){

var statisticCtrl = function($rootScope,$c) {

    var maps = this,
        businessDescription;

    ($rootScope.businessDescription) ?
    businessDescription = $rootScope.businessDescription :
    businessDescription = $c.businessClient.getMyBusinessInfo() ;

    var yaMap;
    maps.afterMapInit=function(nMap){
        yaMap = nMap;
    };

    //var location = userClient.getGroupView(groupId);
    maps.center = [businessDescription.longitude,businessDescription.latitude];
    maps.zoom = 16;
    maps.radius = businessDescription.radius;
    maps.color = $c.MAP_COLOR;

    maps.baloon = {
        geometry: {
            type: 'Point',
            coordinates: maps.center
        },
        // Свойства
        properties: {
            hintContent: "Я здесь"
        }
    };

};

module.exports = [ '$rootScope','$c', statisticCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\changeAvatar.js":[function(require,module,exports){

var changeAvatarCtrl = function($state,$rootScope,$c){

        var changeAvatar = this, newSrc,
            x1 = 50, y1 = 50, x2 = 200, y2 = 200,
            imageWidth = 150, imageHeight = 150;

        changeAvatar.save = function(){

            var saveSrc = newSrc+"?w="+ imageWidth +"&h="+ imageHeight +"&s="+x1+","+y1+","+x2+","+y2;
            $c.userClient.updateUserAvatar(saveSrc);
            $rootScope.base.user.avatar = $rootScope.base.avatarBuffer = saveSrc;

            $("#dialog-message").dialog('close');
            $state.go('profile');

            $('.preview-container').addClass('hidden');

            $('.ui-dialog').each(function(){
                if($(this).attr('aria-describedby') == 'dialog-message'){
                    $(this).detach();
                }
            });
        };

        changeAvatar.back = function(){
            $('.load-avatar').find('.file-label').html("").
                removeClass("hide-placeholder selected").
                attr("data-title","Загрузить аватар");

            $('.loadAvatar-area').removeClass('hidden');
            $('.crop-area').addClass('hidden');

            $('.preview-container').addClass('hidden');
            $('.loading').removeClass('hidden');

            $('#image-for-crop').detach();
            $('.jcrop-holder').detach();

            $('.btn-save-avatar').before('<img src="#" id="image-for-crop" alt="#" class="hidden" />');

        };

        initModalAndCrop();

        function initModalAndCrop() {

            $("#dialog-message").removeClass('hide').dialog({
                modal: true,
                width: 504,
                position: ['center', 100],
                title_html: false,
                closeText: "",
                create: function (event, ui) {

                    $('.load-avatar input').ace_file_input({
                        style: 'well',
                        btn_choose: 'Загрузить аватар',
                        btn_change: null,
                        no_icon: '',
                        droppable: true,
                        thumbnail: 'large',
                        icon_remove: null
                    }).on('change', function () {
                        var imageForCrop = $('#image-for-crop');

                        $('.loadAvatar-area,.load-avatar-error').addClass('hidden');
                        $('.crop-area').removeClass('hidden');

                        setTimeout(saveNewAva, 1000);

                        function saveNewAva() {
                            var avaImg = $('.load-avatar').find('.file-label img');
                            if(parseInt(avaImg.css('width')) < 200 || parseInt(avaImg.css('height')) < 200){

                                $('.loading,.btn-save-avatar').addClass('hidden');

                                $('.load-avatar-error')
                                    .text('Изображение должно быть не менее 200px в ширину и высоту. Попробуйте загрузить другое изображение.').removeClass('hidden');

                            }else {
                                $('.loading').addClass('hidden');

                                var bg = avaImg.css('background-image'),
                                    src = avaImg.attr('src');

                                newSrc = $c.fileClient.saveFileContent(bg, true);

                                $('#preview').attr('src', newSrc);

                                imageForCrop.attr('src', newSrc);
                                imageForCrop.css({'max-width': '500px', 'max-height': '500px'});

                                imageForCrop.Jcrop({
                                    aspectRatio: 1,
                                    setSelect: [ 200, 200, 50, 50 ],
                                    onChange: updateCoords,
                                    onSelect: updateCoords
                                }).removeClass('hidden');

                                $('.preview-container,.btn-save-avatar').removeClass('hidden');

                            }
                        }

                        function updateCoords(c) {
                            imageWidth = imageForCrop.width();
                            imageHeight = imageForCrop.height();

                            x1 = c.x;
                            y1 = c.y;
                            x2 = c.x2;
                            y2 = c.y2;
                            $('#x').val(c.x);
                             $('#y').val(c.y);
                             $('#w').val(c.w);
                             $('#h').val(c.h);

                             $('#x2').val(c.x2);
                             $('#y2').val(c.y2);

                            var rx = 150 / c.w; // 150 - размер окна предварительного просмотра
                            var ry = 150 / c.h;

                            $('#preview').css({
                                width: Math.round(rx * imageWidth) + 'px',
                                height: Math.round(ry * imageHeight) + 'px',
                                marginLeft: '-' + Math.round(rx * c.x) + 'px',
                                marginTop: '-' + Math.round(ry * c.y) + 'px'
                            });
                        };
                    });

                },
                close: function (event, ui) {
                    $state.go('profile');

                    $('.preview-container').addClass('hidden');

                    $('.ui-dialog').each(function(){
                        if($(this).attr('aria-describedby') == 'dialog-message'){
                            $(this).detach();
                        }
                    });
                }
            });
        }
    };

module.exports = [ '$state','$rootScope','$c', changeAvatarCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\contacts.js":[function(require,module,exports){

var contactsCtrl = function($rootScope,$c) {
    var ctrl = this;

    $rootScope.base.isFooterBottom = true;

    ctrl.isAuth = $c.authClient.checkIfAuthorized();

    if (ctrl.isAuth){
        ctrl.user = $c.userClient.getShortUserInfo();
        ctrl.user_name = ctrl.user.firstName+" "+ctrl.user.lastName;
        ctrl.contacts = $c.userClient.getUserContacts();
    }

    ctrl.send = function($event){
        $event.preventDefault();
        var email,name,
            content = ctrl.content;

        if(ctrl.isAuth){
            email = ctrl.contacts.email;
            name = ctrl.user_name;
        }else{
            email = ctrl.email;
            name = ctrl.name;
        }

        $c.messageClient.sendInfoEmail(email,name,content);
        ctrl.isSend = true;
        ctrl.content = "";
        //console.log(email,name,content);
    };

    var oldTextLength = 0;

    $('.content').keyup(function(event) {

        var el = event.target,
            clientHeight = el.clientHeight,
            scrollHeight = el.scrollHeight,
            textLength = el.textLength,
            clientWidth = el.clientWidth,
            textLengthPX, newHeight, removeRowCount,
            defaultHeight, newRowCount;

        defaultHeight = 100;

        /*
         Исходные данные:
         На один символ приходится ~8px в ширину
         Высота строки текста ~14px

         * Здесь выполняем такие действия :
         * 1) Считаем длину текста в пикселях
         * 2) Определяем целое количестов строк, которые удалили
         * 3) Определям новую высоту с учетом высоты удаленного текста
         * */

        if (scrollHeight > clientHeight) {

            el.style.height = scrollHeight + 'px';
        } else if (scrollHeight > defaultHeight) {
            textLengthPX = (parseInt(oldTextLength) - textLength) * 8; // 1
            if (textLengthPX > clientWidth) {
                removeRowCount = Math.floor(textLengthPX / clientWidth); // 2
                newHeight = parseInt(event.target.style.height) - removeRowCount * 14; // 3
                newHeight > defaultHeight ? event.target.style.height = newHeight + "px" :
                    event.target.style.height = defaultHeight + 'px';

            } else {
                el.style.height = scrollHeight - 6 + 'px';

            }
        } else {
            el.style.height = defaultHeight + 'px';
        }
        oldTextLength = textLength;


        $('.ng-cloak').removeClass('ng-cloak');
    });

    angular.element($('.coming-soon')).css({'min-height': $(window).height()-105});

    $('.ng-cloak').removeClass('ng-cloak');

};

module.exports = [ '$rootScope','$c', contactsCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\counters.js":[function(require,module,exports){

var countersCtrl = function($rootScope,$modal,$counters,$c) {
        var counters = this;
        //counters = $scope;

        $rootScope.base.mainContentTopIsHide = true;
        $rootScope.base.pageTitle = "Счетчики";
        $rootScope.base.isFooterBottom = true;

        counters.counters = $counters.getCounters;
        counters.typesArray = [];
        var typesEnumLength = 6;

        var counterService = $c.utilityClient.getCounterService();

        var currentDate = (new Date()).getDate();

        counters.endDateOfMonth = counterService.endDateOfMonth;
        counters.startDateOfMonth = counterService.startDateOfMonth;

    console.log(counterService.startDateOfMonth+" " +
        counterService.endDateOfMonth+" "+
        counterService.infoProvided);

    var isNow;
    if(counterService.endDateOfMonth > counterService.startDateOfMonth){
        isNow = (currentDate >= counterService.startDateOfMonth &&
            currentDate <= counterService.endDateOfMonth);
    }else{
        isNow = (currentDate <= counterService.endDateOfMonth ||
            currentDate >= counterService.startDateOfMonth);
    }

        if(isNow ){

            if(counterService.infoProvided){
                // с 14 по 24, отправлено
                counters.state = 2;
            }else{
                // с 14 по 24, не отправлено
                counters.state = 1;
            }
        }else{
            // время с 24 по 14 число
            counters.state = 0;
        }


    //console.log('state '+counters.state);

        for(var i = 0; i < typesEnumLength; i++){
            counters.typesArray[i] = {};
            counters.typesArray[i].type = i;
            counters.typesArray[i].typeString = $counters.getTypeString(i);
        }

        var countersLength = counters.counters.length;
        for(var i = 0; i < countersLength; i++){
            counters.counters[i].currentValue = "";
            counters.counters[i].isEdit = false;
            counters.counters[i].wasEdit = false;
            counters.counters[i].typeString = $counters.getTypeString(counters.counters[i].type);
        }

        counters.save = function(){

            var countersLen = counters.counters.length,
                currentValue,
                date, isCanSave = true;


            for(var i = 0; i < countersLen; i++){
                if(!counters.counters[i].currentValue) {
                    isCanSave= false;
                    break;
                }
            }

            if(isCanSave) {
                counters.errorText = "";
                for (i = 0; i < countersLen; i++) {
                    if (counters.counters[i].wasEdit) {
                        date = Date.parse(new Date()) / 1000;
                        currentValue = counters.counters[i].currentValue;

                        if (!currentValue) currentValue = 0;
                        $c.utilityClient.setCurrentCounterValue(counters.counters[i].id, currentValue, date);
                        counters.counters[i].lastValue = currentValue;
                        counters.counters[i].currentValue = "";
                        counters.state = 2;
                    }
                }
            }else{
                counters.errorText = "Необходимо указать значения всех счтечиков";
            }

        };

        counters.addCounter = function(){
            var counter = new com.vmesteonline.be.thrift.utilityservice.Counter();
            counter.id = $c.utilityClient.registerCounter(counter);
            counter.isEdit = true;
            counters.counters.push(counter);
        };
        counters.editCounter = function(counter){
            counter.isEdit = true;
        };
        counters.saveEditedCounter = function(counter){
            //alert(counter.id+" "+counter.number+" "+counter.type+" "+counter.location);
            /*for(var p in counter){
                alert(counter[p]+" "+p);
            }*/

            var correctCounter = new com.vmesteonline.be.thrift.utilityservice.Counter();
            correctCounter.id = counter.id;
            correctCounter.location = counter.location;
            correctCounter.type = counter.type;
            correctCounter.number = counter.number;
            correctCounter.lastValue = counter.lastValue;

            $c.utilityClient.updateCounter(correctCounter);
            counter.isEdit = false;
            counter.typeString = $counters.getTypeString(counter.type);
        };
        counters.removeCounter = function(counter){

            var modal = $modal.open({
                templateUrl: 'myModalContent.html',
                controller: 'ModalInstanceCtrl',
                windowClass: 'modal-remove-counter',
                size: 'sm'
            });

            modal.result.then(function () {

                $c.utilityClient.removeCounter(counter.id);
                var countersLength = counters.counters.length;
                for(var i = 0; i< countersLength; i++){

                    if(counter.id == counters.counters[i].id){
                        counters.counters.splice(i,1);
                    }

                }

            });

        };

        counters.countersConfirm = function(){

            var newServicesStatuses = [];
            newServicesStatuses['11'] = true;

            $c.userClient.updateUserServices(newServicesStatuses);

            $rootScope.base.me.countersConfirmed = true;
        };

        counters.cancel = function(){
            counters.state = 1;
        };

        counters.toggleNotification = function(){
           var newServicesStatuses = [];

          if ($rootScope.base.me.countersNotification ){
              $rootScope.base.me.countersNotification = newServicesStatuses['12'] = false;
          }else{
              $rootScope.base.me.countersNotification = newServicesStatuses['12'] = true;
          }

            $c.userClient.updateUserServices(newServicesStatuses);

        };

    counters.inputCounter = function(counter){
        counter.wasEdit = true;
        counter.currentValue = parseInt(counter.currentValue);
     };

        angular.element($('.counters')).css({'min-height': $(window).height()-105});

    };

module.exports = [ '$rootScope','$modal','$counters','$c', countersCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\countersHistory.js":[function(require,module,exports){

var countersHistoryCtrl = function($scope,$stateParams,$rootScope,$counters,$c) {

        $rootScope.base.mainContentTopIsHide = true;
        $rootScope.base.pageTitle = "История показаний счетчика";
        $rootScope.base.isFooterBottom = true;

        var counters = $counters.getCounters,
            countersLen = counters.length;
        for(var i = 0; i < countersLen; i++){
            if(counters[i].id == $stateParams.counterId){
                $scope.currentCounter = counters[i];
                $scope.currentCounter.typeString = $counters.getTypeString(counters[i].type);
            }
        }

        var now = Date.parse(new Date())/1000,
            history = $c.utilityClient.getCounterHistory($stateParams.counterId,0,now),
            counter = 0;

        $scope.history = [];
        $scope.counterName = $stateParams.counterName;

        for(var p in history){
            $scope.history[counter] = {};
            $scope.history[counter].date = p;
            $scope.history[counter].val = history[p];
            counter++;
        }

        angular.element($('.counters')).css({'min-height': $(window).height()-105});

    };

module.exports = [ '$state','$stateParams','$rootScope','$counters','$c', countersHistoryCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\dialog.js":[function(require,module,exports){

var dialogCtrl = function($rootScope,$stateParams,$state,$c) {

        $c.initFancyBox($('.dialog'));
        $rootScope.base.mainContentTopIsHide = true;
        $rootScope.base.isFooterBottom = false;
        $rootScope.base.lastLoadedId = 0;
        $rootScope.currentPage = 'dialog-single';
        $rootScope.base.currentDialogId = $stateParams.dialogId;
        $rootScope.currentRubric = null;

        var dialog = this,
            lastLoadedId = 0,
            loadedLength = 20;

        try {
            var currentDialog = $c.dialogClient.getDialogById($stateParams.dialogId);

            var currentDialogLength = currentDialog.length;

            dialog.isDialog = true;
            dialog.attachId = '000';
            dialog.dialogId = $stateParams.dialogId;

            dialog.users = currentDialog.users;
            var dialogUsersLength = dialog.users.length;
            for (var i = 0; i < dialogUsersLength; i++) {
                //console.log(dialog.users[i].id+" "+$rootScope.base.me.id);
                if (dialog.users[i] && (dialog.users[i].id == $rootScope.base.me.id)) {
                    dialog.users.splice(i, 1);
                }
            }

            if ($stateParams.dialogId) {
                $rootScope.base.setPrivateMessages(dialog.dialogId,loadedLength);

                dialog.privateMessages = $rootScope.base.privateMessages;
            }

            //dialog.messageText = $c.TEXT_DEFAULT_1;
            $rootScope.base.initStartParamsForCreateMessage(dialog);

        }catch(e){
            $state.go('dialogs');
        }

        var lastLoadedIdFF;
        dialog.addMoreItems = function(){
            var buff = $c.dialogClient.getDialogMessages($stateParams.dialogId,0,loadedLength,$rootScope.base.lastLoadedId);
            if(buff) {
                var buffLength = buff.length;

                if(buffLength != 0) {

                    $rootScope.base.lastLoadedId = buff[buffLength - 1].id;

                    if(lastLoadedIdFF != $rootScope.base.lastLoadedId) {
                        for (var i = 0; i < buffLength; i++) {
                            buff[i].authorProfile = $c.userClient.getUserProfile(buff[i].author);
                        }
                        dialog.privateMessages =
                            $rootScope.base.privateMessages = $rootScope.base.privateMessages.concat(buff);
                    }

                    lastLoadedIdFF = $rootScope.base.lastLoadedId;
                }
            }

        };

        $('.ng-cloak').removeClass('ng-cloak');

    };

module.exports = [ '$rootScope','$stateParams','$state','$c', dialogCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\dialogs.js":[function(require,module,exports){

var dialogsCtrl =  function($rootScope,$state,$c){
        $rootScope.isTopSearchShow = false;
        $rootScope.base.mainContentTopIsHide = true;
        $rootScope.leftbar.tab = 0;
        $rootScope.base.isFooterBottom = false;
        $rootScope.currentPage = "dialogs";
        $rootScope.currentRubric = null;

        $c.resetPages($rootScope.base);
        $rootScope.base.privateMessagesIsActive = true;
        $rootScope.base.pageTitle = "Личные сообщения";

        $c.resetAceNavBtns($rootScope.navbar);
        $rootScope.navbar.privateMessagesBtnStatus = "active";

        $rootScope.base.privateMessagesLoadStatus = "isLoaded";

        $rootScope.isNewPrivateMessageAdded = false;

        var dialogs = this;

        dialogs.dialogsList = $c.dialogClient.getDialogs(0);
        var dialogsListLength = dialogs.dialogsList.length;
        for(var i = 0; i < dialogsListLength; i++){
            (dialogs.dialogsList[i].users[0].id != $rootScope.base.me.id) ?
                dialogs.dialogsList[i].anotherUser = dialogs.dialogsList[i].users[0] :
                dialogs.dialogsList[i].anotherUser = dialogs.dialogsList[i].users[1];

            dialogs.dialogsList[i].newMessagesCount = 0;
            console.log("dialog "+$rootScope.newMessages.length);
            if($rootScope.newMessages.length > 0) {
                var newMessagesLength = $rootScope.newMessages.length;
                for(var j = 0; j < newMessagesLength; j++) {
                    if (dialogs.dialogsList[i].id == $rootScope.newMessages[j].dialogId) {
                        dialogs.dialogsList[i].newMessagesCount = $rootScope.newMessages[j].count;
                    }
                }
            }
        }

        dialogs.goToSingleDialog = function(dialogId){
            var usersInfoArray = [],
                usersInfoLength,
                usersId = [];
            for(var i = 0; i < dialogsListLength; i++){
                if(dialogs.dialogsList[i].id == dialogId){
                    usersInfoArray = dialogs.dialogsList[i].users;
                }
            }
            if(usersInfoArray){
                usersInfoLength = usersInfoArray.length;
                for(var i = 0; i < usersInfoLength; i++){
                    usersId[i] = usersInfoArray[i].id
                }
            }
            //$rootScope.currentDialog = $c.dialogClient.getDialog(usersId);
            $state.go('dialog-single',{ dialogId : dialogId});
        };

        $('.ng-cloak').removeClass('ng-cloak');

    };

module.exports = [ '$rootScope','$state','$c', dialogsCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\important.js":[function(require,module,exports){

var importantCtrl = function($rootScope,$c) {

        $rootScope.setTab(4);
        $rootScope.base.showAllGroups();
        $rootScope.base.isFooterBottom = false;
        $rootScope.base.pageTitle = "Важно";
        $rootScope.base.mainContentTopIsHide = true;
        $rootScope.currentRubric = null;

        var important = this,
            lastLoadedId = 0,
            loadedLength = 10;

        $rootScope.COMMENTS_DEFAULT_COUNT = 4;
        important.selectedGroupInTop = $rootScope.currentGroup;

        /*if(!$rootScope.importantIsLoadedFromTop)
            $rootScope.importantTopics = c.messageClient.getImportantTopics($rootScope.currentGroup.id);
        $rootScope.importantIsLoadedFromTop = false;*/

        //important.topics = c.messageClient.getImportantTopics($rootScope.currentGroup.id);
        important.wallItems = $c.messageClient.getImportantNews($rootScope.currentGroup.id,0,0,0);

        important.attachId = "0";
        //$rootScope.base.initStartParamsForCreateTopic(important);

        important.message = {};

        important.message.content = important.message.default = $c.TEXT_DEFAULT_1;

        $rootScope.importantChangeGroup = function(groupId){

            important.wallItems = $c.messageClient.getImportantNews(groupId, 0, loadedLength);

            if(important.wallItems.length) {
                initWallItem(important.wallItems);

                //lastLoadedId = lenta.wallItems[important.wallItems.length-1].topic.id;
            }

        };

        var wallItemsLength;
        important.wallItems ? wallItemsLength = important.wallItems.length :
            wallItemsLength = 0;

        if(wallItemsLength == 0) $rootScope.base.mainContentTopIsHide = true;

        if(wallItemsLength != 0) lastLoadedId = important.wallItems[wallItemsLength-1].topic.id;

        initWallItem(important.wallItems);

        $rootScope.selectGroupInDropdown_important = function(groupId){
            important.selectedGroup = $rootScope.base.bufferSelectedGroup = $c.selectGroupInDropdown(groupId);
        };

        important.goToAnswerInput = function(event){
            event.preventDefault();
        };

        var initFlagsArray = [];
        important.showAnswerInput = function(event,wallItem,wallMessage){
            event.preventDefault();

            /*wallItem.answerShow ?
             wallItem.answerShow = false :*/
            wallItem.answerShow = true ;
            wallItem.isFocus = true ;

            if(wallMessage){
                var authorName;
                wallMessage.userInfo ?
                    authorName = wallMessage.userInfo.firstName :
                    authorName = wallMessage.authorName.split(' ')[0];
                wallItem.commentText = authorName+", ";
            }else{
                wallItem.commentText = "";
            }

            if(!initFlagsArray[wallItem.topic.id]) {
                // инифицализацмю AttachImage нужно делать только один раз для каждого сообщения
                initFlagsArray[wallItem.topic.id] = true;
            }

        };

        $rootScope.wallChangeGroup = function(groupId){

            important.wallItems = $c.messageClient.getWallItems(groupId, 0, loadedLength);

            if(important.wallItems.length) {
                initWallItem(important.wallItems);

                lastLoadedId = important.wallItems[important.wallItems.length-1].topic.id;
            }

        };

        function initWallItem(wallItems){
            wallItemsLength = wallItems.length;
            for(var i = 0; i < wallItemsLength; i++){

                $rootScope.base.initStartParamsForCreateMessage(wallItems[i]);

                $rootScope.base.initStartParamsForCreateTopic(wallItems[i].topic);

                //  wallItems[i].topic.message.groupId сейчас не задана почему-то
                wallItems[i].label = $c.getLabel($rootScope.base.groups,wallItems[i].topic.groupType);

                wallItems[i].tagColor = $c.getTagColor(wallItems[i].label);

                wallItems[i].isOpen = false;

                if(wallItems[i].topic.message.important == 1){
                    wallItems[i].topic.message.importantText = 'Снять метку "Важное"';
                }else{
                    wallItems[i].topic.message.importantText = 'Пометить как "Важное"';
                }

                if(wallItems[i].topic.message.type == 1){

                    wallItems[i].topic.lastUpdateEdit = $c.getTiming(wallItems[i].topic.lastUpdate);

                }else if(wallItems[i].topic.message.type == 5){

                    wallItems[i].topic.message.createdEdit = $c.getTiming(wallItems[i].topic.message.created);
                    wallItems[i].topic.authorName = $c.getAuthorName(wallItems[i].topic.userInfo);
                    wallItems[i].topic.metaType = "message";

                    var mesLen;
                    wallItems[i].messages ?
                        mesLen = wallItems[i].messages.length:
                        mesLen = 0;

                    for(var j = 0; j < mesLen; j++){
                        wallItems[i].messages[j].createdEdit = $c.getTiming(wallItems[i].messages[j].created);
                        wallItems[i].messages[j].authorName = $c.getAuthorName(wallItems[i].messages[j].userInfo);
                        wallItems[i].messages[j].isEdit = false;

                        $rootScope.base.initStartParamsForCreateMessage(wallItems[i].messages[j]);
                    }

                    (mesLen >= $rootScope.COMMENTS_DEFAULT_COUNT) ?
                        wallItems[i].bufferMessages = wallItems[i].messages.slice(mesLen-$rootScope.COMMENTS_DEFAULT_COUNT):
                        wallItems[i].bufferMessages = wallItems[i].messages;



                    if(wallItems[i].topic.poll != null){
                        //значит это опрос
                        $c.setPollEditNames(wallItems[i].topic.poll);

                        wallItems[i].topic.metaType = "poll";
                    }
                }
            }
        }

        important.toggleComments = function(event,wallItem){
            event.preventDefault();

            var mesLen = wallItem.messages.length;

            if(wallItem.isOpen){
                wallItem.isOpen = false;

                (mesLen >= $rootScope.COMMENTS_DEFAULT_COUNT) ?
                    wallItem.bufferMessages = wallItem.messages.slice(mesLen-$rootScope.COMMENTS_DEFAULT_COUNT):
                    wallItem.bufferMessages = wallItem.messages;

                //wallItem.bufferMessages = wallItem.messages.slice(mesLen-important.COMMENTS_DEFAULT_COUNT);
            }else{
                wallItem.isOpen = true;
                wallItem.bufferMessages = wallItem.messages;
            }
        };

        $c.initFancyBox($('.forum'));

        $('.ng-cloak').removeClass('ng-cloak');

    };

module.exports = [ '$rootScope','$c', importantCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\index.js":[function(require,module,exports){
'use strict';

module.exports = angular.module('VOControllers', ['ui.select2','infinite-scroll','ngSanitize','yaMap','ui.bootstrap','angularFileUpload'])

    .controller('baseCtrl', require('./base.js'))

    .controller('aboutCtrl', require('./about.js'))
    .controller('advertsCtrl', require('./adverts.js'))
    .controller('advertsSingleCtrl', require('./advertsSingle.js'))
    .controller('blogCtrl', require('./blog.js'))
    .controller('changeAvatarCtrl', require('./changeAvatar.js'))
    .controller('contactsCtrl', require('./contacts.js'))
    .controller('countersCtrl', require('./counters.js'))
    .controller('countersHistoryCtrl', require('./countersHistory.js'))
    .controller('dialogCtrl', require('./dialog.js'))
    .controller('dialogsCtrl', require('./dialogs.js'))
    .controller('importantCtrl', require('./important.js'))
    .controller('leftBarCtrl', require('./leftBar.js'))
    .controller('wallCtrl', require('./wall.js'))
    .controller('mainContentTopCtrl', require('./mainContentTop.js'))
    .controller('mapsCtrl', require('./maps.js'))
    .controller('modalInstanceCtrl', require('./modalInstance.js'))
    .controller('navbarCtrl', require('./navbar.js'))
    .controller('nearbyCtrl', require('./nearby.js'))
    .controller('nearbySingleCtrl', require('./nearbySingle.js'))
    .controller('neighboursCtrl', require('./neighbours.js'))
    .controller('profileCtrl', require('./profile.js'))
    .controller('rubricsCtrl', require('./rubrics.js'))
    .controller('rubricsSingleCtrl', require('./rubricsSingle.js'))
    .controller('setInfoCtrl', require('./setInfo.js'))
    .controller('settingsCtrl', require('./settings.js'))
    .controller('talksCtrl', require('./talks.js'))
    .controller('talksSingleCtrl', require('./talksSingle.js'))
    .controller('unconfirmedCtrl', require('./unconfirmed.js'))
    .controller('wallSingleCtrl', require('./wallSingle.js'))

    // business
    .controller('cabinetCtrl', require('./business/cabinet.js'))
    .controller('editCtrl', require('./business/edit.js'))
    .controller('statisticCtrl', require('./business/statistic.js'))
;
},{"./about.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\about.js","./adverts.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\adverts.js","./advertsSingle.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\advertsSingle.js","./base.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\base.js","./blog.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\blog.js","./business/cabinet.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\business\\cabinet.js","./business/edit.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\business\\edit.js","./business/statistic.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\business\\statistic.js","./changeAvatar.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\changeAvatar.js","./contacts.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\contacts.js","./counters.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\counters.js","./countersHistory.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\countersHistory.js","./dialog.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\dialog.js","./dialogs.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\dialogs.js","./important.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\important.js","./leftBar.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\leftBar.js","./mainContentTop.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\mainContentTop.js","./maps.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\maps.js","./modalInstance.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\modalInstance.js","./navbar.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\navbar.js","./nearby.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\nearby.js","./nearbySingle.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\nearbySingle.js","./neighbours.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\neighbours.js","./profile.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\profile.js","./rubrics.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\rubrics.js","./rubricsSingle.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\rubricsSingle.js","./setInfo.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\setInfo.js","./settings.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\settings.js","./talks.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\talks.js","./talksSingle.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\talksSingle.js","./unconfirmed.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\unconfirmed.js","./wall.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\wall.js","./wallSingle.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\wallSingle.js"}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\leftBar.js":[function(require,module,exports){

var leftBarCtrl = function($rootScope,$state,$c) {

    $rootScope.setTab = function(newValue){

        $rootScope.leftbar.tab = newValue;
        $rootScope.isTopSearchShow = true;
        $c.resetPages($rootScope.base);
        $c.resetAceNavBtns($rootScope.navbar);

        switch(newValue){
            case 1:
                $rootScope.base.mainContentTopIsHide = false;
                $rootScope.base.lentaIsActive = true;
                $rootScope.currentPage = 'lenta';
                $rootScope.base.pageTitle = "Новости";
                break;
            case 2:
                $rootScope.base.mainContentTopIsHide = false;
                $rootScope.base.isTalkTitles = true;
                $rootScope.base.talksIsActive = true;
                $rootScope.currentPage = 'talks';
                $rootScope.base.pageTitle = "Обсуждения";
                break;
            case 3:
                $rootScope.base.mainContentTopIsHide = false;
                $rootScope.base.isAdvertsTitles = true;
                $rootScope.base.advertsIsActive = true;
                $rootScope.currentPage = 'adverts';
                $rootScope.base.pageTitle = "Объявления";
                break;
            case 4:
                $rootScope.base.mainContentTopIsHide = false;
                $rootScope.base.importantIsActive = true;
                $rootScope.currentPage = 'important';
                $rootScope.base.pageTitle = "Важные сообщения";
                break;
            case 5:
                $rootScope.base.mainContentTopIsHide = false;
                $rootScope.base.importantIsActive = true;
                $rootScope.currentPage = 'nearby';
                $rootScope.base.pageTitle = "Рядом";
                break;
            default :
                break;
        }

    };

    $rootScope.isSet = function(number){
        return $rootScope.leftbar.tab === number;
    };

    $rootScope.setRubric = function(rubric){

            $rootScope.currentRubric = rubric;
            $rootScope.selRubricName = $rootScope.currentRubric.visibleName;
        if(!rubric) {
            $rootScope.currentRubric = {};
            $rootScope.selRubricName = null;
        }

        if($state.current.name != 'main') {
            var st = $state.get('main');
            st.rubricId = rubric.id;
            $state.go('main');
        }else {
            $rootScope.wallChangeRubric($rootScope.currentRubric.id);
        }

    }
  };

module.exports = [ '$rootScope','$state','$c', leftBarCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\mainContentTop.js":[function(require,module,exports){

var mainContentTopCtrl = function($rootScope, $state,$c) {

        var topCtrl = this;

        topCtrl.groups = $c.userClientGroups;// ? userClientGroups.reverse() : userClient.getUserGroups().reverse();
        var groups = $rootScope.groups = topCtrl.groups,
            groupsLength = groups.length;

        for(var i = 0; i < groupsLength; i++){
            groups[i].isShow = true;
            if(groups[i].id == $rootScope.currentGroup.id) groups[i].selected = true;
        }

        topCtrl.isSet = function(groupId){
            //return groupId ===
        };

        $rootScope.selectGroup = function(group){
            //var groupId = group.id;

            if(group.id == 0){

                $state.go('set-info');

            }else {
                if($state.current.name == 'set-info') {
                    localStorage.setItem('VO_setInfo_groupId',group.id);
                    $state.go('main');
                }

                for (var i = 0; i < groupsLength; i++) {
                    groups[i].selected = false;
                }

                group.selected = true;

                $rootScope.currentGroup = group;
                $rootScope.base.bufferSelectedGroup = $c.selectGroupInDropdown(group.id);

                //$rootScope.importantTopics = $c.messageClient.getImportantNews(group.id);

                if ($rootScope.currentPage == 'lenta') {
                    $rootScope.wallChangeGroup(group.id);
                    $rootScope.selectGroupInDropdown_lenta(group.id);
                } else if ($rootScope.currentPage == 'talks') {
                    $rootScope.talksChangeGroup(group.id);
                    $rootScope.selectGroupInDropdown_talks(group.id);
                } else if ($rootScope.currentPage == 'adverts') {
                    $rootScope.advertsChangeGroup(group.id);
                    $rootScope.selectGroupInDropdown_adverts(group.id);
                } else if ($rootScope.currentPage == 'neighbours') {
                    $rootScope.neighboursChangeGroup(group.id);
                } else if ($rootScope.currentPage == 'maps') {
                    $rootScope.mapsChangeGroup(group.id);
                } else if ($rootScope.currentPage == 'important') {
                    $rootScope.importantChangeGroup(group.id);
                }

                localStorage.setItem('groupId', group.id);
                //$rootScope.currentGroup = $rootScope.base.selectGroupInDropdown(group.id);
            }
        };

        $rootScope.showCreateTopic = function(event){
            event.preventDefault();

            $rootScope.base.createTopicIsHide ? $rootScope.base.createTopicIsHide = false : $rootScope.base.createTopicIsHide = true;

        };

        $('.ng-cloak').removeClass('ng-cloak');
    };

module.exports = [ '$rootScope','$state','$c', mainContentTopCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\maps.js":[function(require,module,exports){

var mapsCtrl = function($rootScope,$c) {
        var maps = this;

        $rootScope.currentPage = "maps";
        $rootScope.isTopSearchShow = false;
        $rootScope.base.mainContentTopIsHide = false;
        $rootScope.leftbar.tab = 0;
        $rootScope.base.pageTitle = "Карты";

        $c.resetPages($rootScope.base);
        $rootScope.base.mapsIsActive = true;

        $c.resetAceNavBtns($rootScope.navbar);
        $rootScope.navbar.mapsBtnStatus = "active";

        $rootScope.base.mapsLoadStatus = "isLoaded";

        $c.showGroupOverBuilding($rootScope.groups);
        //$rootScope.groups[0].isShow = false;
        //$rootScope.groups[1].selected = true;

        /*if($rootScope.currentGroup.id == $rootScope.groups[0].id){
            $rootScope.currentGroup = $rootScope.groups[1];
        }*/
    $rootScope.currentGroup = $c.userClientGroups[3];

        $rootScope.base.isFooterBottom = true;

        var yaMap;
        maps.afterMapInit=function(nMap){
            yaMap = nMap;
        };

        maps.color = $c.MAP_COLOR;

        //maps.url = $c.userClient.getGroupMap($rootScope.currentGroup.id,MAP_COLOR);

        var location = $c.userClient.getGroupView($rootScope.currentGroup.id);

        var setMap = function(location){

            maps.center = [location.longitude,location.latitude];

            if (yaMap) {
                ($rootScope.currentGroup.type == 4) ? yaMap.setZoom(17) : yaMap.setZoom(16); ;
            }else{
                ($rootScope.currentGroup.type == 4) ? maps.zoom = 17 : maps.zoom = 16 ;
            }

            maps.baloon = {
                // Геометрия = тип объекта + географические координаты объекта
                geometry: {
                    // Тип геометрии - точка
                    type: 'Point',
                    // Координаты точки.
                    coordinates: maps.center
                },
                // Свойства
                properties: {
                    hintContent: "Я здесь"
                }
            };

            maps.radius = {
                geometry: {
                    type: 'Circle',
                    coordinates: maps.center,
                    radius: location.radius
                },
                properties: {
                }
            };

        };

        setMap(location);

        $rootScope.mapsChangeGroup = function(groupId){
            var location = $c.userClient.getGroupView(groupId);

            setMap(location);
        };
        //$rootScope.selectGroup($c.getBuildingGroup($rootScope.currentGroup));

        angular.element($('.maps.page')).css({'min-height': $(window).height()-175}); 

    };

module.exports = [ '$rootScope','$c', mapsCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\modalInstance.js":[function(require,module,exports){

var modalInstanceCtrl = function($scope, $modalInstance) {
        $scope.ok = function () {
            $modalInstance.close();
        };

        $scope.cancel = function () {
            $modalInstance.dismiss('cancel');
        };
    };

module.exports = [ '$scope','$$modalInstance', modalInstanceCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\navbar.js":[function(require,module,exports){

var navbarCtrl = function($rootScope,$c) {

        this.privateMessagesBtnStatus = "";
        $rootScope.navbar = this;

        this.logout = function(event){
            event.preventDefault();

            localStorage.removeItem('groupId');
            localStorage.removeItem('VO_is_business');
            $c.authClient.logout();

            document.location.replace("/login");

        };

        //$('.ng-cloak').removeClass('ng-cloak');

  };

module.exports = [ '$rootScope','$c', navbarCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\nearby.js":[function(require,module,exports){

var nearbyCtrl = function($rootScope,$c) {
    var nearby = this;

    var groupType = com.vmesteonline.be.thrift.GroupType.NEIGHBORS;
    nearby.businessList = $c.businessClient.getBusinessList(groupType,0);

    $rootScope.base.isFooterBottom = true;
    $rootScope.base.pageTitle = "Рядом";
    $rootScope.base.talksIsActive = $rootScope.base.advertsIsActive = false;
    $c.showGroupOverBuilding($rootScope.groups);
    $rootScope.currentRubric = null;

    nearby.isAuth = $c.authClient.checkIfAuthorized();

    if(nearby.isAuth){
        //me = $c.userClient.getUserProfile();
        //$('.anonName').removeClass('hidden');
    }

    nearby.posts = $c.messageClient.getBusinessTopics(0,1000);

    if(nearby.posts.topics) {
        var len = nearby.posts.topics.length;
        for (var i = 0; i < len; i++) {
            nearby.posts.topics[i].isCommentShow = false;
            nearby.posts.topics[i].isInputShow = false;
            nearby.posts.topics[i].short = nearby.posts.topics[i].message.content.split(';')[0];
        }
    }

    angular.element($('.nearby')).css({'min-height': $(window).height()-110});

    $('.ng-cloak').removeClass('ng-cloak');

};

module.exports = [ '$rootScope','$c', nearbyCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\nearbySingle.js":[function(require,module,exports){

var nearbySingleCtrl =  function($rootScope,$stateParams,$c) {
    var nearby = this,
        businessId;

    if ($stateParams.nearbyId && $stateParams.nearbyId != 0){
        businessId = $stateParams.nearbyId;
    }

    nearby.info = $c.businessClient.getBusinessDescription(businessId);
    nearby.info.fullInfo = nearby.info.fullInfo.replace('\n','<br>');
    nearby.wallItem = $c.businessClient.getWallItem(nearby.info.id);

    $rootScope.base.isFooterBottom = true;
    $rootScope.base.pageTitle = "Рядом";

    nearby.isAuth = $c.authClient.checkIfAuthorized();

    if(nearby.isAuth){
        //me = c.userClient.getUserProfile();
        //$('.anonName').removeClass('hidden');
    }

    nearby.posts = $c.messageClient.getBusinessTopics(0,1000);

    if(nearby.posts.topics) {
        var len = nearby.posts.topics.length;
        for (var i = 0; i < len; i++) {
            console.log(nearby.posts.topics[i].id,parseInt(businessId));
            if(nearby.posts.topics[i].id == parseInt(businessId)){
                nearby.posts.topics[i].isCommentShow = true;
                nearby.posts.topics[i].isInputShow = true;
                nearby.posts.topics[i].full = nearby.posts.topics[i].message.content.split(';')[1];

                nearby.post = nearby.posts.topics[i];
                nearby.post.fullLink = '/'+nearby.posts.topics[i].full;
                console.log(nearby.post);
            }
        }
    }

    nearby.toggleComm = function($event,post){
        $event.preventDefault();

        if (post.isCommentShow){
            post.isCommentShow = false;

        }else{
            post.isCommentShow = true;

            if(!post.comments) {
                post.comments = $c.messageClient.getMessagesAsList(post.id, 8, 0, false, 1000).messages;
                console.log('finish');
            }
        }

    };

    nearby.toggleInput = function($event,post){
        $event.preventDefault();

        post.isInputShow ? post.isInputShow = false : post.isInputShow = true;

        console.log('input',post.isInputShow);

    };

    nearby.sendComm = function($event,post){
        $event.preventDefault();
        var message = new com.vmesteonline.be.thrift.messageservice.Message();

        message.id = 0;
        message.topicId = nearby.info.id; //post.id;
        message.type = com.vmesteonline.be.thrift.messageservice.MessageType.WALL;//8;
        message.groupId = 0;
        message.content = post.commenting;
        message.topicId = nearby.wallItem.topic.id;
        message.parentId = 0;
        message.created = Date.parse(new Date())/1000;
        post.commenting = "";

        if(!nearby.isAuth){
            message.anonName = post.anonName;
        }else{
            message.anonName = "";
        };

        console.log('post',message);
        //var returnComment = c.messageClient.postBusinessTopics(message);
        var returnComment = $c.messageClient.postMessage(message);
        console.log('post2',returnComment);


        if(nearby.wallItem.messages && nearby.wallItem.messages.length) {
            nearby.wallItem.messages.push(returnComment);
        }else{
            nearby.wallItem.messages = [];
            nearby.wallItem.messages[0] = returnComment;
        }

    };

    nearby.getTiming = function(messageObjDate){
        var minute = 60*1000,
            hour = minute*60,
            day = hour*24,
            threeDays = day* 3,
            now = Date.parse(new Date()),
            timing = (now - messageObjDate*1000),
            timeTemp;

        if(timing < minute){
            timing = "только что";
        }else if(timing < hour){
            timing = new Date(timing);
            timing = timing.getMinutes()+" мин назад";
        }else if(timing < day){
            timing = new Date(timing);
            timeTemp = timing.getHours();
            if(timeTemp == 1 || timeTemp == 0){
                timing = "1 час назад";
            }else if(timeTemp > 1 && timeTemp < 5){
                timing = timeTemp + " часа назад";
            }else{
                timing = timeTemp + " часов назад";
            }
        }else if(timing < threeDays){
            timing = new Date(timing);
            timeTemp = timing.getDate();
            if(timeTemp == 1){
                timing = timeTemp+" день назад";
            }else{
                timing = timeTemp+" дней назад";
            }
        }else{
            timeTemp = new Date(messageObjDate*1000).toLocaleDateString();
            var arr = timeTemp.split('.');
            if(arr[0].length == 1) arr[0] = "0"+arr[0];
            if(arr[1].length == 1) arr[1] = "0"+arr[1];
            timing = arr[0]+"."+arr[1]+"."+arr[2];
        }

        return timing;
    };


    $('.ng-cloak').removeClass('ng-cloak');

};

module.exports = [ '$rootScope','$stateParams','$c', nearbySingleCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\neighbours.js":[function(require,module,exports){

var neighboursCtrl = function($rootScope,$state,$c) {
        $rootScope.currentPage = "neighbours";
        $rootScope.isTopSearchShow = false;
        $rootScope.leftbar.tab = 0;
        $rootScope.base.showAllGroups();
        $rootScope.base.isFooterBottom = false;

        $c.resetPages($rootScope.base);
        $rootScope.base.mainContentTopIsHide = false;
        $rootScope.base.neighboursIsActive = true;

        $c.resetAceNavBtns($rootScope.navbar);
        $rootScope.navbar.neighboursBtnStatus = "active";
        $rootScope.base.pageTitle = "";

        $rootScope.currentGroup = $c.userClientGroups[3];

        $rootScope.base.neighboursLoadStatus = "isLoaded";

        var neighbours = this;
        neighbours.neighboors = $c.userClient.getNeighboursByGroup($rootScope.currentGroup.id);

        $rootScope.neighboursChangeGroup = function(groupId){
            neighbours.neighboors = $c.userClient.getNeighboursByGroup(groupId);
            initAutoFill();
        };

        neighbours.neighboorsSize = neighbours.neighboors.length;

        function initAutoFill(){
            var data = [],
                neighboursLength = neighbours.neighboors.length;
            for(var i = 0; i < neighboursLength; i++){
                data[i] = {};
                data[i].label = neighbours.neighboors[i].firstName+" "+neighbours.neighboors[i].lastName;
                data[i].value = neighbours.neighboors[i].id;
                data[i].category = "";
            }
            $("#search-neighbours" ).catcomplete({
                delay: 0,
                source: data,
                select: function(event,ui){
                    $state.go('profile',{ 'userId' : ui.item.value});

                }
            });
        }
        initAutoFill();

        $('.ng-cloak').removeClass('ng-cloak');

    };

module.exports = [ '$rootScope','$state','$c', neighboursCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\profile.js":[function(require,module,exports){

var profileCtrl = function($rootScope, $stateParams,$c) {

        $rootScope.isTopSearchShow = false;
        $rootScope.leftbar.tab = 0;

        $c.resetPages($rootScope.base);
        $rootScope.base.profileIsActive = true;
        $rootScope.base.isFooterBottom = true;

        $c.resetAceNavBtns($rootScope.navbar);
        $rootScope.base.mainContentTopIsHide = true;
        $rootScope.base.profileLoadStatus = "isLoaded";

        var profile = this, userId;
        profile.isMayEdit = false;

        $("#dialog-message").addClass('hide');

        if ($stateParams.userId && $stateParams.userId != 0 && $stateParams.userId != $c.shortUserInfo.id){
            userId = $stateParams.userId;
            //profile.userContacts = $c.userClient.getUserContactsExt(userId);
        }else{
            userId = 0;
            profile.isMayEdit = true;

            try {
                var location = $c.userClient.getGroupView($rootScope.groups[0].id);

                profile.map = {};
                profile.map.zoom = 17;
                profile.map.center = [location.longitude, location.latitude];

                profile.map.baloon = {
                    // Геометрия = тип объекта + географические координаты объекта
                    geometry: {
                        // Тип геометрии - точка
                        type: 'Point',
                        // Координаты точки.
                        coordinates: profile.map.center
                    },
                    // Свойства
                    properties: {
                        hintContent: "Я здесь"
                    }
                };
            }catch(err){
            }
            //profile.userContacts = $c.userClient.getUserContacts();
        }

        profile.userProfile = $c.userClient.getUserProfile(userId);

        var isEmptyContacts = false,
            isEmptyFamily = false,
            isEmptyInterests = false,
            isEmptyNotifications = false,
            isEmptyUserInfo = false;

        if(!profile.userProfile.userInfo || !profile.userProfile.userInfo.birthday) isEmptyUserInfo = true;

        if(!profile.userProfile.contacts || (!profile.userProfile.contacts.homeAddress && !profile.userProfile.contacts.mobilePhone &&
            !profile.userProfile.contacts.email)) isEmptyContacts = true;

        if(!profile.userProfile.family || (!profile.userProfile.family.relations
            && !profile.userProfile.family.childs && !profile.userProfile.family.pets)) isEmptyFamily = true;

        if(!profile.userProfile.interests || (!profile.userProfile.interests.userInterests && !profile.userProfile.interests.job)) isEmptyInterests = true;

        if(!profile.userProfile.notifications) isEmptyNotifications = true;

        //alert(isEmptyUserInfo+" "+isEmptyContacts+" "+isEmptyFamily+" "+isEmptyInterests+" "+isEmptyNotifications);
        if(isEmptyUserInfo && isEmptyContacts && isEmptyFamily && isEmptyInterests && isEmptyNotifications)
            profile.isEmptyProfile = true;

        if(profile.userProfile.userInfo){
            if (profile.userProfile.userInfo.gender == 1){
                profile.userProfile.userInfo.genderMeta = "Женский";
            }else if(profile.userProfile.userInfo.gender == 2){
                profile.userProfile.userInfo.genderMeta = "Мужской";
            }else{
                profile.userProfile.userInfo.genderMeta = "";
            }
        }

        $rootScope.base.avatarBuffer = profile.userProfile.userInfo.avatar;

        if(profile.userProfile.family && profile.userProfile.family.relations == 0){

            if(profile.userProfile.userInfo.gender == 1){
                profile.userProfile.family.relationsMeta = "Замужем";
            }else if(profile.userProfile.userInfo.gender == 2){
                profile.userProfile.family.relationsMeta = "Женат";
            }

        }else if(profile.userProfile.family && profile.userProfile.family.relations == 1){
            if(profile.userProfile.userInfo.gender == 1){
                profile.userProfile.family.relationsMeta = "Не замужем";
            }else if(profile.userProfile.userInfo.gender == 2){
                profile.userProfile.family.relationsMeta = "Холост";
            }
        }

        if(profile.userProfile.family && profile.userProfile.family.pets && profile.userProfile.family.pets.length != 0){
           var petsLength = profile.userProfile.family.pets.length;
            var pets = profile.userProfile.family.pets;
            for(var i = 0; i < petsLength; i++){
                switch(profile.userProfile.family.pets[i].type){
                    case 0:
                        profile.userProfile.family.pets[i].typeMeta = "Кошка";
                        break;
                    case 1:
                        profile.userProfile.family.pets[i].typeMeta = "Собака";
                        break;
                    case 2:
                        profile.userProfile.family.pets[i].typeMeta = "Птичка";
                        break;
                }

            }
        }

        //$rootScope.chageIndex = 0;

        angular.element($('.profile')).css({'min-height': $(window).height()-135});

        $('.ng-cloak').removeClass('ng-cloak');

};

module.exports = [ '$rootScope','$stateParams','$c', profileCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\rubrics.js":[function(require,module,exports){

var rubricsCtrl = function($rootScope,$stateParams,$c) {
        /*
        * при работе с обсждениями нужно учесть следующее:
        * есть три типа сообщения :
        * 1) топик. На странице обсуждения может быть только один. Его дети
        * это сообщения первого уровня. Его дети всегда открыты, поэтому у него
        * нет контрола плюс-минус. Страница топика загружается в методе showFullTalk
        * через topicId который передается в функцию при вызове
        * Хранится в объекте talk.fullTalkTopic.
        *
        * 2) Сообщение первого уровня. Берутся через getFirstLevelMessages. Изначально
        * все потомки скрыты и не подгружены. При первом нажатии на контрол плюс-минус
        * подгружаются, потом просто переключается show-hide. ParentId у таких сообщений
        * равен 0. Внимание! : ParentId передается в getFirstLevelMessages через lastLoadedId.        *
        * У каждого сообщения первого уровня есть свой массив сообщений 3го типа.
        * Хранятся в массиве talk.fullTalkFirstMessages.
        *
        * 3) Просто сообщение. Береутся через getMessages(). Через параметр lastLoadedId передается
        * id последнего загруженного простого сообщения, для подгрузки. У каждого простого сообщения
        * есть offset, который задается на БЕ. offset'ы определяют вложенность сообщений и за счет них
        * создается древовидная структура форума.
        * Хранятся в двумерном массиве talk.fullTalkMessages[firstMessage.id][]
        *
        *
        * Есть следующие типы контролов, реализованные для разных типов сообщений:
        * 1) showAnswerInput : реализует клик на "Ответить", показвает поле для отправки
        * сообщения.
        * 2) addMessage: клик на "Отправить", создает и отображает новое сообщение
        * 3) toggleTree: контрол "плюс-минус", скрвает-показвает внутренние сообщения этого
        * сообщения.
        * */
            $rootScope.setTab(2);
            var talk = this;

            talk.attachId = "00";
            $c.initFancyBox($('.talks'));

            $rootScope.base.showAllGroups();
            $rootScope.base.isFooterBottom = false;

            $rootScope.base.createTopicIsHide = true;

            talk.isTalksLoaded = false;
            talk.groups = $c.userClientGroups;

            talk.message = {};
            talk.message.content = talk.message.default = $c.TEXT_DEFAULT_3;
            talk.subject = $c.TEXT_DEFAULT_4;

            $rootScope.base.bufferSelectedGroup = talk.selectedGroup =
            $rootScope.currentGroup = $c.userClientGroups[3];

            $rootScope.base.initStartParamsForCreateTopic(talk);

            talk.isTalk = true;

            talk.fullTalkTopic = {};
            talk.fullTalkTopic.answerInputIsShow = false;
            talk.fullTalkMessages = [];
            talk.fullTalkFirstMessages = [];

            talk.commentText = $c.TEXT_DEFAULT_2;
            var fullTalkFirstMessagesLength,
                talkId;

            /*if(!$rootScope.importantIsLoadedFromTop)
            $rootScope.importantTopics = $c.messageClient.getImportantNews($rootScope.currentGroup.id);
            $rootScope.importantIsLoadedFromTop = false;*/

            talk.topics = $c.messageClient.getTopics(talk.selectedGroup.id, $stateParams.rubricId, 0, 0, 1000).topics;

            initTalks();

            if (!talk.topics) talk.topics = [];

            $rootScope.selectGroupInDropdown_talks = function(groupId){
                talk.selectedGroup = $rootScope.base.bufferSelectedGroup = $c.selectGroupInDropdown(groupId);
            };

        function initTalks(){
            var topicLength;
            talk.topics ? topicLength = talk.topics.length : topicLength = 0;

            for(var i = 0; i < topicLength;i++){
                talk.topics[i].lastUpdateEdit = $c.getTiming(talk.topics[i].lastUpdate);
                talk.topics[i].label = $c.getLabel(talk.groups,talk.topics[i].groupType);
                talk.topics[i].tagColor = $c.getTagColor(talk.topics[i].label);

                if(talk.topics[i].message.important == 1){
                    talk.topics[i].message.importantText = 'Снять метку "Важное"';
                }else{
                    talk.topics[i].message.importantText = 'Пометить как "Важное"';
                }
            }
        }

        $rootScope.talksChangeGroup = function(groupId){

            talk.topics = $c.messageClient.getTopics(groupId,0,0,0,1000).topics;

            if(talk.topics) {
                initTalks();
            }

        };

        $('.ng-cloak').removeClass('ng-cloak');

    };

module.exports = [ '$rootScope','$stateParams','$c', rubricsCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\rubricsSingle.js":[function(require,module,exports){

var rubricsSingleCtrl = function($rootScope,$stateParams,$c){

        $rootScope.base.isFooterBottom = false;

        var talk = this,
            fullTalkMessagesLength,
            talkId = $stateParams.talkId;

        $rootScope.base.lastLoadedId = 0;
        $rootScope.base.isEarliestMessages = false;
        $rootScope.base.endOfLoaded = false;

        talk.attachId = "00";
        talk.selectedGroup = $rootScope.currentGroup;

        /*if(!$rootScope.importantIsLoadedFromTop)
            $rootScope.importantTopics = $c.messageClient.getImportantNews($rootScope.currentGroup.id);
        $rootScope.importantIsLoadedFromTop = false;*/

        talk.topics = $c.messageClient.getTopics(talk.selectedGroup.id, 0, 0, 0, 1000).topics;
        talk.fullTalkTopic = {};
        talk.fullTalkMessages = {};
        talk.fullTalkFirstMessages = [];
        talk.groups = $c.userClientGroups;

        talk.isTalk = true;

        $rootScope.base.initStartParamsForCreateMessage(talk);

        var showFullTalk = function(talk,talkOutsideId){

            $c.initFancyBox($('.talks-single'));
            var topicLength;
            talk.topics ? topicLength = talk.topics.length : topicLength = 0;

            var talkId = talkOutsideId;
            for(var i = 0; i < topicLength; i++){
                if(talkId == talk.topics[i].id){
                    talk.fullTalkTopic = talk.topics[i];

                    $rootScope.base.initStartParamsForCreateTopic(talk.fullTalkTopic);

                    talk.fullTalkTopic.isTalk = true;
                    talk.fullTalkTopic.message.createdEdit = $c.getTiming(talk.fullTalkTopic.message.created);
                    talk.fullTalkTopic.label = $c.getLabel(talk.groups,talk.fullTalkTopic.groupType);
                    talk.fullTalkTopic.tagColor = $c.getTagColor(talk.fullTalkTopic.label);

                    if(talk.fullTalkTopic.message.important == 1){
                        talk.fullTalkTopic.message.importantText = 'Снять метку "Важное"';
                    }else{
                        talk.fullTalkTopic.message.importantText = 'Пометить как "Важное"';
                    }
                }
            }

            if (talk.fullTalkTopic.poll != null) {
                $c.setPollEditNames(talk.fullTalkTopic.poll);
                talk.fullTalkTopic.metaType = "poll";
            } else {
                talk.fullTalkTopic.metaType = "message";
            }

            talk.fullTalkFirstMessages = $c.messageClient.getFirstLevelMessages(talkId, talk.selectedGroup.id, 1, $rootScope.base.lastLoadedId, 0, 10).messages;

            $rootScope.base.lastLoadedId = $rootScope.base.initFirstMessages(talk.fullTalkFirstMessages);

            $rootScope.base.isTalkTitles = false;
            $rootScope.base.mainContentTopIsHide = true;
            $rootScope.base.createTopicIsHide = true;

        };

        showFullTalk(talk,talkId);

        var initFlagsTopic = [];
        talk.showTopicAnswerInput = function(event,fullTalkTopic){
            event.preventDefault();

            talk.answerShow = true;

            if(!initFlagsTopic[fullTalkTopic.id]) {
                initFlagsTopic[fullTalkTopic.id] = true;
            }

            talk.fullTalkTopic.answerInputIsShow ?
                talk.fullTalkTopic.answerInputIsShow = false :
                talk.fullTalkTopic.answerInputIsShow = true ;
        };

        var initFlagsMessage = [];
        talk.showMessageAnswerInput = function(event,fullTalkTopic,firstMessage,message){
            event.preventDefault();
            var attachId;

            if(!message){
                // если это сообщение первого уровня
                firstMessage.isTalk = true;
                //firstMessage.isEdit = false;

                attachId = fullTalkTopic.id+'-'+firstMessage.id;

                if(!talk.fullTalkFirstMessages) talk.fullTalkFirstMessages = $c.messageClient.getFirstLevelMessages(talkId,talk.selectedGroup.id,1,0,0,1000).messages;
                var fullTalkFirstMessagesLength = talk.fullTalkFirstMessages.length;

                $rootScope.base.initStartParamsForCreateMessage(firstMessage);

                firstMessage.answerInputIsShow ?
                    firstMessage.answerInputIsShow = false :
                    firstMessage.answerInputIsShow = true;


            }else{
                // если простое сообщение
                message.isTalk = true;
                //message.isEdit = false;

                attachId = fullTalkTopic.id+'-'+message.id;

                if(!talk.fullTalkMessages[firstMessage.id]) talk.fullTalkMessages[firstMessage.id] = $c.messageClient.getMessages(talkId,talk.selectedGroup.id,1,firstMessage.id,0,1000).messages;
                var  fullTalkMessagesLength = talk.fullTalkMessages[firstMessage.id].length;

                $rootScope.base.initStartParamsForCreateMessage(message);
                message.answerInputIsShow ?
                    message.answerInputIsShow = false :
                    message.answerInputIsShow = true;

            }

            if(!initFlagsMessage[attachId]) {
                //initAttachImage($('#attachImage-' + attachId), $('#attach-area-' + attachId));
                //initAttachDoc($('#attachDoc-' + attachId), $('#attach-doc-area-' + attachId));

                initFlagsMessage[attachId] = true;
            }
        };

        talk.toggleTreeFirstMessage = function(event,firstMessage){
            event.preventDefault();

            firstMessage.isTreeOpen ?
                firstMessage.isTreeOpen = false :
                firstMessage.isTreeOpen = true ;


            // --------

            talk.fullTalkMessages[firstMessage.id] = $c.messageClient.getMessages(talkId,talk.selectedGroup.id,1,firstMessage.id,0,1000).messages;
            talk.fullTalkMessages[firstMessage.id] ?
                fullTalkMessagesLength = talk.fullTalkMessages[firstMessage.id].length:
                fullTalkMessagesLength = 0;
            if(talk.fullTalkMessages[firstMessage.id] === null) talk.fullTalkMessages[firstMessage.id] = [];

            for(var i = 0; i < fullTalkMessagesLength; i++){
                talk.fullTalkMessages[firstMessage.id][i].answerInputIsShow = false;
                talk.fullTalkMessages[firstMessage.id][i].isTreeOpen = true;
                talk.fullTalkMessages[firstMessage.id][i].isOpen = true;
                talk.fullTalkMessages[firstMessage.id][i].isParentOpen = true;
                talk.fullTalkMessages[firstMessage.id][i].createdEdit = $c.getTiming(talk.fullTalkMessages[firstMessage.id][i].created);
                talk.fullTalkMessages[firstMessage.id][i].commentText = $c.TEXT_DEFAULT_2;

            }

        };

        talk.toggleTree = function(event,message,firstMessage){
            event.preventDefault();

            if(!talk.fullTalkMessages[firstMessage.id]) talk.fullTalkMessages[firstMessage.id] = $c.messageClient.getMessages(talkId,talk.selectedGroup.id,1,firstMessage.id,0,1000).messages;
            var fullTalkMessagesLength = talk.fullTalkMessages[firstMessage.id].length;

            message.isTreeOpen ?
                message.isTreeOpen = false :
                message.isTreeOpen = true ;

            var afterCurrentIndex = false,
                nextMessageOnCurrentLevel = false,
                loopMessageOffset,
                parentOpenStatus,
                areAllMyParentsTreeOpen = [],
                checkAreAllMyParentsTreeOpen = true,
                beginOffset = message.offset,
                parentOpenStatusArray = [];

            for(var i = 0; i < fullTalkMessagesLength; i++){
                loopMessageOffset = talk.fullTalkMessages[firstMessage.id][i].offset;

                if(afterCurrentIndex && !nextMessageOnCurrentLevel
                    && message.offset < loopMessageOffset){

                    areAllMyParentsTreeOpen[loopMessageOffset] = true;

                    if(loopMessageOffset - message.offset == 1){
                        //если это непосредственный потомок

                        talk.fullTalkMessages[firstMessage.id][i].isOpen ?
                            talk.fullTalkMessages[firstMessage.id][i].isOpen = false :
                            talk.fullTalkMessages[firstMessage.id][i].isOpen = true ;

                        parentOpenStatusArray[loopMessageOffset] = true;
                        parentOpenStatus = talk.fullTalkMessages[firstMessage.id][i].isOpen;

                        if (!talk.fullTalkMessages[firstMessage.id][i].isTreeOpen){
                            areAllMyParentsTreeOpen[loopMessageOffset] = false;
                        }
                    }else{
                        // если это птомки потомка

                        checkAreAllMyParentsTreeOpen = true;
                        for(var j = beginOffset; j < loopMessageOffset; j++){
                            // проверяем нет ли у кого в предках isTreeOpen = false
                            if(areAllMyParentsTreeOpen[j] == false){
                                checkAreAllMyParentsTreeOpen = false;
                            }
                        }
                        parentOpenStatus && checkAreAllMyParentsTreeOpen ?
                            talk.fullTalkMessages[firstMessage.id][i].isOpen = true :
                            talk.fullTalkMessages[firstMessage.id][i].isOpen = false ;

                        if (!talk.fullTalkMessages[firstMessage.id][i].isTreeOpen){
                            // если у кого-то из предков не открыто дерево
                            areAllMyParentsTreeOpen[loopMessageOffset] = false;
                        }

                        parentOpenStatusArray[loopMessageOffset] = true;
                    }
                }

                if (afterCurrentIndex && loopMessageOffset == message.offset){
                    nextMessageOnCurrentLevel = true;
                    break;
                }
                if(message.id == talk.fullTalkMessages[firstMessage.id][i].id){
                    afterCurrentIndex = true;
                }
            }
        };

        var buff,
            lastLoadedIdFF;
        talk.addMoreItems = function(){
            var temp = $c.messageClient.getFirstLevelMessages(talkId,talk.selectedGroup.id,1,$rootScope.base.lastLoadedId,0,10),
                buff = temp.messages;
            if(buff) {
                var buffLength = buff.length;

                if(buffLength != 0) {

                    $rootScope.base.lastLoadedId = buff[buffLength - 1].id;

                    if(lastLoadedIdFF != $rootScope.base.lastLoadedId) {
                        $rootScope.base.initFirstMessages(buff);
                        talk.fullTalkFirstMessages = talk.fullTalkFirstMessages.concat(buff);
                    }

                    lastLoadedIdFF = $rootScope.base.lastLoadedId;

                }
            }else{
                $rootScope.base.endOfLoaded = true;
            }

        };

        $('.ng-cloak').removeClass('ng-cloak');

    };

module.exports = [ '$rootScope','$stateParams','$c', rubricsSingleCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\setInfo.js":[function(require,module,exports){

var setInfoCtrl = function($c) {
        var setInfo = this;

        setInfo.isSaveResult = false;
        setInfo.isError = false;

        setInfo.save = function(){
            var staircase, floor,flat;

            (!setInfo.staircase) ? staircase = 0 : staircase = setInfo.staircase;
            (!setInfo.floor) ? floor = 0 : floor = setInfo.floor;
            (!setInfo.flat) ? flat = 0 : flat = setInfo.flat;

            setInfo.isSaveResult = true;
            //try {
                $c.userClient.updateUserAddress(staircase, floor, flat);
                setInfo.info = "Сохранено";
                window.location.replace('/');
                //$rootScope.$apply();
            /*}catch(e){
                setInfo.info = "Произошла ошибка";
                setInfo.isError = true;
            }*/
        };

    };

module.exports = [ '$c', setInfoCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\settings.js":[function(require,module,exports){

var settingsCtrl= function($rootScope,$scope,$c) {
        $rootScope.isTopSearchShow = false;
        $rootScope.leftbar.tab = 0;

        $c.resetPages($rootScope.base);
        $rootScope.base.settingsIsActive = true;
        $rootScope.base.isFooterBottom = true;

        $c.resetAceNavBtns($rootScope.navbar);
        $rootScope.base.mainContentTopIsHide = true;

        $rootScope.base.settingsLoadStatus = "isLoaded";

        var settings = this,
            userProfileMeta = $c.userClient.getUserProfile(),
            userContatcsMeta = userProfileMeta.contacts,
            userInfoMeta = userProfileMeta.userInfo,
            userPrivacyMeta = userProfileMeta.privacy,
            userNotificationsMeta = userProfileMeta.notifications,
            userFamilyMeta = userProfileMeta.family,
            userInterestsMeta = userProfileMeta.interests;

        if(userFamilyMeta === null){
            userFamilyMeta = new com.vmesteonline.be.thrift.UserFamily();
        }

        settings.userContacts = $c.clone(userContatcsMeta);
        settings.userInfo = $c.clone(userInfoMeta);
        settings.userPrivacy = $c.clone(userPrivacyMeta);
        settings.userNotifications = $c.clone(userNotificationsMeta);
        if(!settings.userNotifications){
            settings.userNotifications = new com.vmesteonline.be.thrift.Notifications();
            settings.userNotifications.freq = 4;
        }

        settings.family = $c.clone(userFamilyMeta);
        settings.interests = $c.clone(userInterestsMeta);

        if (settings.userInfo.gender == 1) {
            settings.married = "Замужем";
            settings.notMarried = "Не замужем";
        }else if(settings.userInfo.gender == 2){
            settings.married = "Женат";
            settings.notMarried = "Не женат";
        }else{
            settings.married = "В браке";
            settings.notMarried = "Не состою в браке";
        }

        settings.years= [];
        var ind = 0;
        for(var i = 2014; i > 1940; i--){
            settings.years[ind++] = i;
        }

        settings.userInfo.birthday ?
        settings.userInfo.birthdayMeta = new Date(settings.userInfo.birthday*1000) :
        settings.userInfo.birthdayMeta = "";

        if(settings.userInfo.birthdayMeta){
            var month = settings.userInfo.birthdayMeta.getMonth()+1+"";
            if(month.length == 1) month = "0"+month;

            var day = ""+settings.userInfo.birthdayMeta.getDate();
            if(day.length == 1) day = "0"+day;

            var year = settings.userInfo.birthdayMeta.getFullYear();

            settings.userInfo.birthdayMeta = day+"."+month+"."+year;
        }

        if(settings.family.childs === null || settings.family.childs.length == 0){
            settings.family.childs = [];
            settings.family.childs[0] = new com.vmesteonline.be.thrift.Children();
            settings.family.childs[0].name = "";
            var nowYear = new Date();
            nowYear = nowYear.getFullYear();
            //settings.family.childs[0].birthday = Date.parse('01.15.'+nowYear);
            settings.family.childs[0].birthday = null;
            settings.family.childs[0].isNotRemove = true;
        }
        var childsLength = settings.family.childs.length;
        for(var i = 0; i < childsLength; i++){
            if(settings.family.childs[i].birthday) {

                var birthDate = new Date(settings.family.childs[i].birthday*1000);
                    settings.family.childs[i].month = ""+birthDate.getMonth();

                if(settings.family.childs[i].month.length == 1)
                    settings.family.childs[i].month = "0"+settings.family.childs[i].month;

                    settings.family.childs[i].year = birthDate.getFullYear();
            }

        }

        if(settings.family.pets === null || settings.family.pets.length == 0){
            settings.family.pets = [];
            settings.family.pets[0] = new com.vmesteonline.be.thrift.Pet();
            settings.family.pets[0].name = "";
            settings.family.pets[0].type = "0";
            settings.family.pets[0].breed = "";
            settings.family.pets[0].isNotRemove = true;
        }

        settings.oldPassw = "";
        settings.newPassw = "";

        settings.canSave = function(num){
            switch(num){
                case 1:
                    return $scope.formUserInfo.$valid;
                    break;
                case 2:
                    return $scope.formPrivate.$valid;
                    break;
                case 3:
                    return $scope.formAlerts.$valid;
                    break;
                case 4:
                    return $scope.formContacts.$valid;
                    break;
                case 5:
                    return $scope.formFamily.$valid;
                    break;
                case 6:
                    return $scope.formInterests.$valid;
                    break;
            }

        };

        settings.profileInfo = "Сохранено";

        settings.isProfileError = false;
        settings.isProfileResult = false;
        settings.updateUserInfo = function(){
            var temp = new com.vmesteonline.be.thrift.UserInfo();

            settings.userInfo.birthdayMeta ?
                temp.birthday = Date.parse($c.getCorrectDate(settings.userInfo.birthdayMeta))/1000 :
                temp.birthday = 0;

            temp.gender = settings.userInfo.gender;
            temp.firstName = $rootScope.base.me.firstName = settings.userInfo.firstName;
            temp.lastName = $rootScope.base.me.lastName = settings.userInfo.lastName;

            $c.userClient.updateUserInfo(temp);
            settings.isProfileResult = true;
            settings.isProfileError = false;
            settings.profileInfo = "Сохранено";

        };

        settings.isPasswError = false;
        settings.isPasswResult = false;
        settings.updatePassword = function(){
            if (settings.newPassw.length < 3){
                settings.isPasswResult = true;
                settings.isPasswError = true;
                settings.passwInfo = "Вы указали слишком короткий пароль";
            }else{
                settings.isPasswResult = true;
                try {
                    $c.userClient.changePassword(settings.oldPassw, settings.newPassw);
                    settings.isPasswError = false;
                    settings.passwInfo = "Сохранено";
                }catch(e){
                    settings.isPasswError = true;
                    settings.passwInfo = "Вы указали не верный старый пароль";
                }
            }
        };


        settings.isPrivacyError = false;
        settings.isPrivacyResult = false;
        settings.updatePrivacy = function(){
            $c.userClient.updatePrivacy(settings.userPrivacy);

            settings.isPrivacyResult = true;
            settings.isPrivacyError = false;
        };


        settings.isContactsError = false;
        settings.isContactsResult = false;
        settings.updateContacts = function(){
            var temp = new com.vmesteonline.be.thrift.UserContacts();
            temp.email = settings.userContacts.email;
            temp.mobilePhone = settings.userContacts.mobilePhone;
            $c.userClient.updateContacts(temp);

            settings.isContactsError = false;
            settings.isContactsResult = true;
        };

        settings.isAlertsError = false;
        settings.isAlertsResult = false;
        settings.updateNotifications = function(){
            if(settings.userNotifications && (settings.userNotifications.email || settings.userNotifications.freq) ){
                var temp = new com.vmesteonline.be.thrift.Notifications();
                temp.email = settings.userNotifications.email;
                temp.freq = settings.userNotifications.freq;

                $c.userClient.updateNotifications(temp);

                settings.isAlertsError = false;
                settings.isAlertsResult = true;
            }
        };

        settings.isFamilyError = false;
        settings.isFamilyResult = false;
        settings.updateFamily = function(){
            var temp = new com.vmesteonline.be.thrift.UserFamily();
            temp.relations = settings.family.relations;
            temp.childs = settings.family.childs;
            //temp.childs = [];
            //temp.childs[0] = settings.firstChild;

            temp.pets = settings.family.pets;

            var childsLength = settings.family.childs.length;
            for(var i = 0; i < childsLength; i++){
                if(settings.family.childs[i].name && settings.family.childs[i].name != ""){ <!--  && settings.family.childs[i].month && settings.family.childs[i].year -->

                    var tempMonth = parseInt(settings.family.childs[i].month)+1+"";

                    if(tempMonth.length < 2) tempMonth = "0" + tempMonth;

                    if(settings.family.childs[i].year && settings.family.childs[i].year != '1911' && settings.family.childs[i].month) {
                        temp.childs[i].birthday = Date.parse($c.getCorrectDate("15."+tempMonth +"." + settings.family.childs[i].year)) / 1000;
                        //alert(tempMonth+" "+$c.getCorrectDate("15."+tempMonth +"." + settings.family.childs[i].year));
                    }else{
                        temp.childs[i].birthday = null;
                    }
                }
            }
            var petsLength = settings.family.pets.length;
            for(var i = 0; i < petsLength; i++){
                if(temp.pets[i] && !temp.pets[i].name){
                    //temp.pets.splice(i,1);
                }
            }

            $c.userClient.updateFamily(temp);

            settings.isFamilyError = false;
            settings.isFamilyResult = true;
        };

        settings.isInterestsError = false;
        settings.isInterestsResult = false;
        settings.updateInterests = function(){
            var temp = new com.vmesteonline.be.thrift.UserInterests();
            temp.job = settings.interests.job;
            temp.userInterests = settings.interests.userInterests;
            $c.userClient.updateInterests(temp);

            settings.isInterestsError = false;
            settings.isInterestsResult = true;
        };

        settings.childAdd = function(event){
            event.preventDefault();

            var newChild = new com.vmesteonline.be.thrift.Children();
            newChild.name = " ";
            var nowYear = new Date();
            nowYear = nowYear.getFullYear();
            newChild.birthday = Date.parse($c.getCorrectDate('15.01.'+nowYear));

            var birthDate = new Date(newChild.birthday);
            //newChild.month = ""+birthDate.getMonth();
            newChild.month = "";

            if(newChild.length == 1)
                newChild.month = "0"+newChild.month;

            //newChild.year = birthDate.getFullYear();
            newChild.year = "";


            if(settings.family == null){
                settings.family = new com.vmesteonline.be.thrift.UserFamily();
            }
            if(settings.family.childs == null){
                settings.family.childs= [];
            }

            settings.family.childs.length == 0 ?
            settings.family.childs[0] = newChild :
            settings.family.childs.push(newChild);

        };
        settings.removeChild = function(childName){
            var childsLength = settings.family.childs.length;
            for(var i = 0; i < childsLength; i++){
                if(settings.family.childs[i].name == childName) {
                    settings.family.childs.splice(i,1);
                }

            }
        };
        settings.petAdd = function(event){
            event.preventDefault();

            var newPet = new com.vmesteonline.be.thrift.Pet();
            newPet.name = " ";
            newPet.type = "0";

            if(settings.family == null){
                settings.family = new com.vmesteonline.be.thrift.UserFamily();
            }
            if(settings.family.pets == null){
                settings.family.pets= [];
            }

            settings.family.pets.length == 0 ?
                settings.family.pets[0] = newPet :
                settings.family.pets.push(newPet);
        };
        settings.removePet = function(petName){
            var petsLength = settings.family.pets.length;
            for(var i = 0; i < petsLength; i++){
                if(settings.family.pets[i].name == petName) {
                    settings.family.pets.splice(i,1);
                }

            }
        };

        settings.passwChange = false;
        settings.changePassw = function(){
            settings.passwChange = true;
        };

        /*(settings.userInfo.birthday != 0) ?
        settings.birthday = settings.userInfo.birthday :
        settings.birthday = "";*/

        $('#settings-input-3').datepicker({changeMonth:true, changeYear:true,dateFormat: "dd.mm.yy",yearRange:'c-100:+c'});
        $.datepicker.setDefaults($.datepicker.regional['ru']);

        angular.element($('.settings')).css({'min-height': $(window).height()-125});

        $('.ng-cloak').removeClass('ng-cloak');

        var href = document.location.href;
        var hrefInd = href.indexOf("/",9);
        $('input[name="redirect_uri"]').val(href.substring(0,hrefInd)+"/oauth");

    };

module.exports = [ '$rootScope','$scope','$c', settingsCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\talks.js":[function(require,module,exports){

var talksCtrl = function($rootScope,$c) {
        /*
        * при работе с обсждениями нужно учесть следующее:
        * есть три типа сообщения :
        * 1) топик. На странице обсуждения может быть только один. Его дети
        * это сообщения первого уровня. Его дети всегда открыты, поэтому у него
        * нет контрола плюс-минус. Страница топика загружается в методе showFullTalk
        * через topicId который передается в функцию при вызове
        * Хранится в объекте talk.fullTalkTopic.
        *
        * 2) Сообщение первого уровня. Берутся через getFirstLevelMessages. Изначально
        * все потомки скрыты и не подгружены. При первом нажатии на контрол плюс-минус
        * подгружаются, потом просто переключается show-hide. ParentId у таких сообщений
        * равен 0. Внимание! : ParentId передается в getFirstLevelMessages через lastLoadedId.        *
        * У каждого сообщения первого уровня есть свой массив сообщений 3го типа.
        * Хранятся в массиве talk.fullTalkFirstMessages.
        *
        * 3) Просто сообщение. Береутся через getMessages(). Через параметр lastLoadedId передается
        * id последнего загруженного простого сообщения, для подгрузки. У каждого простого сообщения
        * есть offset, который задается на БЕ. offset'ы определяют вложенность сообщений и за счет них
        * создается древовидная структура форума.
        * Хранятся в двумерном массиве talk.fullTalkMessages[firstMessage.id][]
        *
        *
        * Есть следующие типы контролов, реализованные для разных типов сообщений:
        * 1) showAnswerInput : реализует клик на "Ответить", показвает поле для отправки
        * сообщения.
        * 2) addMessage: клик на "Отправить", создает и отображает новое сообщение
        * 3) toggleTree: контрол "плюс-минус", скрвает-показвает внутренние сообщения этого
        * сообщения.
        * */
            $rootScope.setTab(2);
            var talk = this;

            talk.attachId = "00";
            $c.initFancyBox($('.talks'));

            $rootScope.base.showAllGroups();
            $rootScope.base.isFooterBottom = false;

            $rootScope.base.createTopicIsHide = true;

            talk.isTalksLoaded = false;
            talk.groups = $c.userClientGroups;

            talk.message = {};
            talk.message.content = talk.message.default = $c.TEXT_DEFAULT_3;
            talk.subject = $c.TEXT_DEFAULT_4;

            $rootScope.base.bufferSelectedGroup = talk.selectedGroup =
            $rootScope.currentGroup = $c.userClientGroups[3];

            $rootScope.currentRubric = null;

            $rootScope.base.initStartParamsForCreateTopic(talk);

            talk.isTalk = true;

            talk.fullTalkTopic = {};
            talk.fullTalkTopic.answerInputIsShow = false;
            talk.fullTalkMessages = [];
            talk.fullTalkFirstMessages = [];

            talk.commentText = $c.TEXT_DEFAULT_2;
            var fullTalkFirstMessagesLength,
                talkId;

            /*if(!$rootScope.importantIsLoadedFromTop)
            $rootScope.importantTopics = $c.messageClient.getImportantNews($rootScope.currentGroup.id);
            $rootScope.importantIsLoadedFromTop = false;*/

            talk.topics = $c.messageClient.getTopics(talk.selectedGroup.id, 0, 0, 0, 1000).topics;

            initTalks();

            if (!talk.topics) talk.topics = [];

            $rootScope.selectGroupInDropdown_talks = function(groupId){
                talk.selectedGroup = $rootScope.base.bufferSelectedGroup = $c.selectGroupInDropdown(groupId);
            };

        function initTalks(){
            var topicLength;
            talk.topics ? topicLength = talk.topics.length : topicLength = 0;

            for(var i = 0; i < topicLength;i++){
                talk.topics[i].lastUpdateEdit = $c.getTiming(talk.topics[i].lastUpdate);
                talk.topics[i].label = $c.getLabel(talk.groups,talk.topics[i].groupType);
                talk.topics[i].tagColor = $c.getTagColor(talk.topics[i].label);

                if(talk.topics[i].message.important == 1){
                    talk.topics[i].message.importantText = 'Снять метку "Важное"';
                }else{
                    talk.topics[i].message.importantText = 'Пометить как "Важное"';
                }
            }
        }

        $rootScope.talksChangeGroup = function(groupId){

            talk.topics = $c.messageClient.getTopics(groupId,0,0,0,1000).topics;

            if(talk.topics) {
                initTalks();
            }

        };

    talk.selRubricName = "Общее";
    talk.selectRubricNew = function(rubric){
        if(rubric) {
            talk.selRubricName = rubric.visibleName;
        }else{
            talk.selRubricName = "Общее";
            $rootScope.currentRubric = {};
            $rootScope.currentRubric.id = 0;
        }

        var rubricsLength = $c.userClientRubrics.length;

        for(var i = 0; i < rubricsLength; i++){
            if(rubric.id == $c.userClientRubrics[i].id){
                $rootScope.currentRubric = $c.userClientRubrics[i];
            }
        }

    };

        $('.ng-cloak').removeClass('ng-cloak');

    };

module.exports = [ '$rootScope','$c', talksCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\talksSingle.js":[function(require,module,exports){

var talksSingleCtrl = function($rootScope,$stateParams,$c){

        $rootScope.base.isFooterBottom = false;

        var talk = this,
            fullTalkMessagesLength,
            talkId = $stateParams.talkId;

        $rootScope.base.lastLoadedId = 0;
        $rootScope.base.isEarliestMessages = false;
        $rootScope.base.endOfLoaded = false;

        talk.attachId = "00";
        talk.selectedGroup = $c.getDefaultGroup($rootScope.base.groups);//$rootScope.currentGroup;

        /*if(!$rootScope.importantIsLoadedFromTop)
            $rootScope.importantTopics = $c.messageClient.getImportantNews($rootScope.currentGroup.id);
        $rootScope.importantIsLoadedFromTop = false;*/

    //console.log('0',talk.selectedGroup,$c.getDefaultGroup($rootScope.base.groups));
        talk.topics = $c.messageClient.getTopics(talk.selectedGroup.id, 0, 0, 0, 1000).topics;
        talk.fullTalkTopic = {};
        talk.fullTalkMessages = {};
        talk.fullTalkFirstMessages = [];
        talk.groups = $c.userClientGroups;

        talk.isTalk = true;

        $rootScope.base.initStartParamsForCreateMessage(talk);

        var showFullTalk = function(talk,talkOutsideId){

            $c.initFancyBox($('.talks-single'));
            var topicLength;
            talk.topics ? topicLength = talk.topics.length : topicLength = 0;

            var talkId = talkOutsideId;
            for(var i = 0; i < topicLength; i++){
                if(talkId == talk.topics[i].id){
                    talk.fullTalkTopic = talk.topics[i];
                    talk.fullTalkTopic.rubric = $c.getTopicRubric(talk.fullTalkTopic);
                    if(!talk.fullTalkTopic.rubric) talk.fullTalkTopic.selRubricName = "Общее";

                    talk.fullTalkTopic.selectRubricNew = function(rubric){
                        if(rubric) {
                            talk.fullTalkTopic.selRubricName = rubric.visibleName;
                        }else{
                            talk.fullTalkTopic.selRubricName = "Общее";
                            $rootScope.currentRubric = {};
                            $rootScope.currentRubric.id = 0;
                        }
                        var rubricsLength = $c.userClientRubrics.length;

                        for(var i = 0; i < rubricsLength; i++){
                            if(rubric.id == $c.userClientRubrics[i].id){
                                $rootScope.currentRubric = $c.userClientRubrics[i];
                            }
                        }

                        console.log('talk-single',$rootScope.currentRubric);

                    };

                    $rootScope.base.initStartParamsForCreateTopic(talk.fullTalkTopic);

                    talk.fullTalkTopic.isTalk = true;
                    talk.fullTalkTopic.message.createdEdit = $c.getTiming(talk.fullTalkTopic.message.created);
                    talk.fullTalkTopic.label = $c.getLabel(talk.groups,talk.fullTalkTopic.groupType);
                    talk.fullTalkTopic.tagColor = $c.getTagColor(talk.fullTalkTopic.label);

                    if(talk.fullTalkTopic.message.important == 1){
                        talk.fullTalkTopic.message.importantText = 'Снять метку "Важное"';
                    }else{
                        talk.fullTalkTopic.message.importantText = 'Пометить как "Важное"';
                    }
                }
            }

            if (talk.fullTalkTopic.poll != null) {
                $c.setPollEditNames(talk.fullTalkTopic.poll);
                talk.fullTalkTopic.metaType = "poll";
            } else {
                talk.fullTalkTopic.metaType = "message";
            }

            talk.fullTalkFirstMessages = $c.messageClient.getFirstLevelMessages(talkId, talk.selectedGroup.id, 1, $rootScope.base.lastLoadedId, 0, 10).messages;

            $rootScope.base.lastLoadedId = $rootScope.base.initFirstMessages(talk.fullTalkFirstMessages);

            $rootScope.base.isTalkTitles = false;
            $rootScope.base.mainContentTopIsHide = true;
            $rootScope.base.createTopicIsHide = true;

        };

        showFullTalk(talk,talkId);

        var initFlagsTopic = [];
        talk.showTopicAnswerInput = function(event,fullTalkTopic){
            event.preventDefault();

            talk.answerShow = true;

            if(!initFlagsTopic[fullTalkTopic.id]) {
                initFlagsTopic[fullTalkTopic.id] = true;
            }

            talk.fullTalkTopic.answerInputIsShow ?
                talk.fullTalkTopic.answerInputIsShow = false :
                talk.fullTalkTopic.answerInputIsShow = true ;
        };

        var initFlagsMessage = [];
        talk.showMessageAnswerInput = function(event,fullTalkTopic,firstMessage,message){
            event.preventDefault();
            var attachId;

            if(!message){
                // если это сообщение первого уровня
                firstMessage.isTalk = true;
                //firstMessage.isEdit = false;

                attachId = fullTalkTopic.id+'-'+firstMessage.id;

                if(!talk.fullTalkFirstMessages) talk.fullTalkFirstMessages = $c.messageClient.getFirstLevelMessages(talkId,talk.selectedGroup.id,1,0,0,1000).messages;
                var fullTalkFirstMessagesLength = talk.fullTalkFirstMessages.length;

                $rootScope.base.initStartParamsForCreateMessage(firstMessage);

                firstMessage.answerInputIsShow ?
                    firstMessage.answerInputIsShow = false :
                    firstMessage.answerInputIsShow = true;


            }else{
                // если простое сообщение
                message.isTalk = true;
                //message.isEdit = false;

                attachId = fullTalkTopic.id+'-'+message.id;

                if(!talk.fullTalkMessages[firstMessage.id]) talk.fullTalkMessages[firstMessage.id] = $c.messageClient.getMessages(talkId,talk.selectedGroup.id,1,firstMessage.id,0,1000).messages;
                var  fullTalkMessagesLength = talk.fullTalkMessages[firstMessage.id].length;

                $rootScope.base.initStartParamsForCreateMessage(message);
                message.answerInputIsShow ?
                    message.answerInputIsShow = false :
                    message.answerInputIsShow = true;

            }

            if(!initFlagsMessage[attachId]) {
                //initAttachImage($('#attachImage-' + attachId), $('#attach-area-' + attachId));
                //initAttachDoc($('#attachDoc-' + attachId), $('#attach-doc-area-' + attachId));

                initFlagsMessage[attachId] = true;
            }
        };

        talk.toggleTreeFirstMessage = function(event,firstMessage){
            event.preventDefault();

            firstMessage.isTreeOpen ?
                firstMessage.isTreeOpen = false :
                firstMessage.isTreeOpen = true ;


            // --------

            talk.fullTalkMessages[firstMessage.id] = $c.messageClient.getMessages(talkId,talk.selectedGroup.id,1,firstMessage.id,0,1000).messages;
            talk.fullTalkMessages[firstMessage.id] ?
                fullTalkMessagesLength = talk.fullTalkMessages[firstMessage.id].length:
                fullTalkMessagesLength = 0;
            if(talk.fullTalkMessages[firstMessage.id] === null) talk.fullTalkMessages[firstMessage.id] = [];

            for(var i = 0; i < fullTalkMessagesLength; i++){
                talk.fullTalkMessages[firstMessage.id][i].answerInputIsShow = false;
                talk.fullTalkMessages[firstMessage.id][i].isTreeOpen = true;
                talk.fullTalkMessages[firstMessage.id][i].isOpen = true;
                talk.fullTalkMessages[firstMessage.id][i].isParentOpen = true;
                talk.fullTalkMessages[firstMessage.id][i].createdEdit = $c.getTiming(talk.fullTalkMessages[firstMessage.id][i].created);
                talk.fullTalkMessages[firstMessage.id][i].commentText = $c.TEXT_DEFAULT_2;

            }

        };

        talk.toggleTree = function(event,message,firstMessage){
            event.preventDefault();

            if(!talk.fullTalkMessages[firstMessage.id]) talk.fullTalkMessages[firstMessage.id] = $c.messageClient.getMessages(talkId,talk.selectedGroup.id,1,firstMessage.id,0,1000).messages;
            var fullTalkMessagesLength = talk.fullTalkMessages[firstMessage.id].length;

            message.isTreeOpen ?
                message.isTreeOpen = false :
                message.isTreeOpen = true ;

            var afterCurrentIndex = false,
                nextMessageOnCurrentLevel = false,
                loopMessageOffset,
                parentOpenStatus,
                areAllMyParentsTreeOpen = [],
                checkAreAllMyParentsTreeOpen = true,
                beginOffset = message.offset,
                parentOpenStatusArray = [];

            for(var i = 0; i < fullTalkMessagesLength; i++){
                loopMessageOffset = talk.fullTalkMessages[firstMessage.id][i].offset;

                if(afterCurrentIndex && !nextMessageOnCurrentLevel
                    && message.offset < loopMessageOffset){

                    areAllMyParentsTreeOpen[loopMessageOffset] = true;

                    if(loopMessageOffset - message.offset == 1){
                        //если это непосредственный потомок

                        talk.fullTalkMessages[firstMessage.id][i].isOpen ?
                            talk.fullTalkMessages[firstMessage.id][i].isOpen = false :
                            talk.fullTalkMessages[firstMessage.id][i].isOpen = true ;

                        parentOpenStatusArray[loopMessageOffset] = true;
                        parentOpenStatus = talk.fullTalkMessages[firstMessage.id][i].isOpen;

                        if (!talk.fullTalkMessages[firstMessage.id][i].isTreeOpen){
                            areAllMyParentsTreeOpen[loopMessageOffset] = false;
                        }
                    }else{
                        // если это птомки потомка

                        checkAreAllMyParentsTreeOpen = true;
                        for(var j = beginOffset; j < loopMessageOffset; j++){
                            // проверяем нет ли у кого в предках isTreeOpen = false
                            if(areAllMyParentsTreeOpen[j] == false){
                                checkAreAllMyParentsTreeOpen = false;
                            }
                        }
                        parentOpenStatus && checkAreAllMyParentsTreeOpen ?
                            talk.fullTalkMessages[firstMessage.id][i].isOpen = true :
                            talk.fullTalkMessages[firstMessage.id][i].isOpen = false ;

                        if (!talk.fullTalkMessages[firstMessage.id][i].isTreeOpen){
                            // если у кого-то из предков не открыто дерево
                            areAllMyParentsTreeOpen[loopMessageOffset] = false;
                        }

                        parentOpenStatusArray[loopMessageOffset] = true;
                    }
                }

                if (afterCurrentIndex && loopMessageOffset == message.offset){
                    nextMessageOnCurrentLevel = true;
                    break;
                }
                if(message.id == talk.fullTalkMessages[firstMessage.id][i].id){
                    afterCurrentIndex = true;
                }
            }
        };

        var buff,
            lastLoadedIdFF;
        talk.addMoreItems = function(){
            var temp = $c.messageClient.getFirstLevelMessages(talkId,talk.selectedGroup.id,1,$rootScope.base.lastLoadedId,0,10),
                buff = temp.messages;
            if(buff) {
                var buffLength = buff.length;

                if(buffLength != 0) {

                    $rootScope.base.lastLoadedId = buff[buffLength - 1].id;

                    if(lastLoadedIdFF != $rootScope.base.lastLoadedId) {
                        $rootScope.base.initFirstMessages(buff);
                        talk.fullTalkFirstMessages = talk.fullTalkFirstMessages.concat(buff);
                    }

                    lastLoadedIdFF = $rootScope.base.lastLoadedId;

                }
            }else{
                $rootScope.base.endOfLoaded = true;
            }

        };


        $('.ng-cloak').removeClass('ng-cloak');

    };

module.exports = [ '$rootScope','$stateParams','$c', talksSingleCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\unconfirmed.js":[function(require,module,exports){

var unconfirmedCtrl =  function($rootScope,$c) {
    $rootScope.base.isFooterBottom = true;
    $rootScope.base.mainContentTopIsHide = true;
    $rootScope.base.hideSidebar = true;

    var ctrl = this;
    ctrl.user = $c.userClient.getShortUserInfo();
    ctrl.isErrorConfirm = false;

    ctrl.unconfLogin = function(){

        var isConfirm = $c.userClient.confirmUserAddress(ctrl.code);
        console.log(isConfirm);
        if(isConfirm){
            $rootScope.base.me.addressConfirmed = true;
        }else{
            ctrl.isErrorConfirm = true;
        }

    };

    angular.element($('.unconfirm')).css({'min-height': $(window).height()-105});

    $('.ng-cloak').removeClass('ng-cloak');

};

module.exports = [ '$rootScope','$c', unconfirmedCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\wall.js":[function(require,module,exports){

var wallCtrl = function($rootScope,$state,$c) {

    var lenta = this;

    /**/

    lenta.isGroupsInMessShow = false;
    lenta.isRubricsInMessShow = false;
    lenta.isOpenMessageBar = false;

    lenta.showGroups = function(){
        lenta.isGroupsInMessShow ? lenta.isGroupsInMessShow = false : lenta.isGroupsInMessShow = true
    };

    lenta.selectGroupNew = function(group){
        lenta.isGroupsInMessShow = false;
        lenta.isCreateMessageGroupError = false;

        //lenta.selGroupName = group.visibleName;
        $rootScope.base.selectGroupInDropdown(group.id,lenta);
    };

    lenta.showRubrics = function(){
        lenta.isRubricsInMessShow ? lenta.isRubricsInMessShow = false : lenta.isRubricsInMessShow = true
    };

    lenta.selectRubricNew = function(rubric,ctrl){
        lenta.isRubricsInMessShow = false;
        lenta.isCreateMessageRubricError = false;

        if(rubric) {
            $rootScope.selRubricName = rubric.visibleName;
        }else{
            $rootScope.selRubricName = "Общее";
            $rootScope.currentRubric = {};
            $rootScope.currentRubric.id = 0;
        }
        //$rootScope.base.selectRubricInDropdown(rubric.id,lenta);
        var rubricsLength = $c.userClientRubrics.length,
            selectedRubric;

        //if(!ctrl.isEdit) {
            for (var i = 0; i < rubricsLength; i++) {
                if (rubric.id == $c.userClientRubrics[i].id) {
                    $rootScope.currentRubric = $c.userClientRubrics[i];
                }
            }
        //}

        if(ctrl){
            rubric ? ctrl.selRubricName = rubric.visibleName : ctrl.selRubricName = "Общее";
        }

        //$rootScope.base.bufferSelectedGroup = selectGroupInDropdown(groupId);

        //ctrl.selectedGroup = $rootScope.base.bufferSelectedGroup;
    };

    //$rootScope.currentRubric.id = 0;

    lenta.closeInput = function(){
        lenta.isCreateMessageError = false;
        lenta.isCreateMessageGroupError = false;
        lenta.isCreateMessageRubricError = false;

        lenta.isOpenMessageBar = false;
        lenta.isGroupsInMessShow = false;
        lenta.isRubricsInMessShow = false;
        lenta.selectedGroup = lenta.selGroupName = $rootScope.selRubricName = $rootScope.currentRubric = null;
        lenta.message.content = $c.TEXT_DEFAULT_1;
    };

    lenta.isCreateMessageError = true;
    lenta.createMessageErrorText = "Вы не указали группу";

    /**/

    $('.ng-cloak').removeClass('ng-cloak');
        $rootScope.setTab(1);
        $rootScope.base.showAllGroups();
        $rootScope.base.isFooterBottom = false;

        var lastLoadedId = 0,
            loadedLength = 10;

        var len = $c.userClientGroups.length;
        lenta.isCreateNewsShow = [];
        for(var i = 0; i < len; i++){
            lenta.isCreateNewsShow[$c.userClientGroups[i].id] = false;
        }
        //lenta.isCreateNewsShow[] = false;
        $rootScope.COMMENTS_DEFAULT_COUNT = 3;

        var ls_setInfo_groupId = localStorage.getItem('VO_setInfo_groupId'),
            currentGroup = $c.userClientGroups[3];

        if(ls_setInfo_groupId){
            var groupsLength = $c.userClientGroups.length;
            for (var i = 0; i < groupsLength; i++) {
                if ($c.userClientGroups[i].id == ls_setInfo_groupId) {
                    currentGroup = $c.userClientGroups[i];
                }
            }
            localStorage.removeItem('VO_setInfo_groupId');
        }

    lenta.selectedGroupInTop = $rootScope.currentGroup =
        $rootScope.base.bufferSelectedGroup = currentGroup;
    //console.log('lenta',$rootScope.currentGroup.id);

        /*if(!$rootScope.importantIsLoadedFromTop)
        $rootScope.importantTopics = c.messageClient.getImportantNews($rootScope.currentGroup.id);
        $rootScope.importantIsLoadedFromTop = false;*/

        lenta.attachId = "0";
        $rootScope.base.initStartParamsForCreateTopic(lenta);
        lenta.selectedGroup = null;

        lenta.message = {};

        lenta.message.content = lenta.message.default = $c.TEXT_DEFAULT_1;

        $rootScope.wallChangeRubric = function(rubricId){

            lenta.wallItems = $c.messageClient.getWallItems(currentGroup.id, rubricId,0, loadedLength);

            if(lenta.wallItems.length) {
                initWallItem(lenta.wallItems);

                lastLoadedId = lenta.wallItems[lenta.wallItems.length-1].topic.id;
                lastLoadedIdFF = null;
            }

        };

        if($state.current.rubricId) {
            $rootScope.wallChangeRubric($state.current.rubricId);
            $state.current.rubricId = null;
        }else{
            $rootScope.currentRubric = {};
        }

        lenta.wallItems = $c.messageClient.getWallItems($rootScope.base.bufferSelectedGroup.id,$rootScope.currentRubric.id,0,loadedLength);

        var wallItemsLength;
        lenta.wallItems ? wallItemsLength = lenta.wallItems.length :
            wallItemsLength = 0;

        if(wallItemsLength != 0) lastLoadedId = lenta.wallItems[wallItemsLength-1].topic.id;

        initWallItem(lenta.wallItems);

        $rootScope.selectGroupInDropdown_lenta = function(groupId){
            //lenta.selectedGroup = $rootScope.base.bufferSelectedGroup = selectGroupInDropdown(groupId);
            $rootScope.base.bufferSelectedGroup = $c.selectGroupInDropdown(groupId);
        };

        lenta.goToAnswerInput = function(event){
            event.preventDefault();
        };

        var initFlagsArray = [];
        lenta.showAnswerInput = function(event,wallItem,wallMessage){
            event.preventDefault();

            /*wallItem.answerShow ?
                wallItem.answerShow = false :*/
                wallItem.answerShow = true ;
                wallItem.isFocus = true ;

            if(wallMessage){
                var authorName;
                wallMessage.userInfo ?
                    authorName = wallMessage.userInfo.firstName :
                    authorName = wallMessage.authorName.split(' ')[0];
                wallItem.commentText = authorName+", ";
            }else{
                wallItem.commentText = "";
            }

            if(!initFlagsArray[wallItem.topic.id]) {
                // инифицализацмю AttachImage нужно делать только один раз для каждого сообщения
                initFlagsArray[wallItem.topic.id] = true;
            }

        };

        $rootScope.wallChangeGroup = function(groupId){

            lenta.wallItems = $c.messageClient.getWallItems(groupId, $rootScope.currentRubric.id,0, loadedLength);

            if(lenta.wallItems.length) {
                initWallItem(lenta.wallItems);

                lastLoadedId = lenta.wallItems[lenta.wallItems.length-1].topic.id;
                lastLoadedIdFF = null;
            }

        };

        function initWallItem(wallItems){
            wallItemsLength = wallItems.length;
            for(var i = 0; i < wallItemsLength; i++){

                $rootScope.base.initStartParamsForCreateMessage(wallItems[i]);

                $rootScope.base.initStartParamsForCreateTopic(wallItems[i].topic);

                //  wallItems[i].topic.message.groupId сейчас не задана почему-то
                wallItems[i].label = $c.getLabel($rootScope.base.groups,wallItems[i].topic.groupType);

                wallItems[i].tagColor = $c.getTagColor(wallItems[i].label);

                wallItems[i].isOpen = false;

                if(wallItems[i].topic.message.important == 1){
                    wallItems[i].topic.message.importantText = 'Снять метку "Важное"';
                }else{
                    wallItems[i].topic.message.importantText = 'Пометить как "Важное"';
                }

                if(wallItems[i].topic.message.type == 1){

                    wallItems[i].topic.lastUpdateEdit = $c.getTiming(wallItems[i].topic.lastUpdate);

                }else if(wallItems[i].topic.message.type == 5){

                    wallItems[i].topic.message.createdEdit = $c.getTiming(wallItems[i].topic.message.created);
                    wallItems[i].topic.authorName = $c.getAuthorName(wallItems[i].topic.userInfo);
                    wallItems[i].topic.metaType = "message";
                    wallItems[i].topic.rubric = $c.getTopicRubric(wallItems[i].topic);

                    var mesLen;
                    wallItems[i].messages ?
                        mesLen = wallItems[i].messages.length:
                        mesLen = 0;

                    for(var j = 0; j < mesLen; j++){
                        wallItems[i].messages[j].createdEdit = $c.getTiming(wallItems[i].messages[j].created);
                        wallItems[i].messages[j].authorName = $c.getAuthorName(wallItems[i].messages[j].userInfo);
                        wallItems[i].messages[j].isEdit = false;

                        $rootScope.base.initStartParamsForCreateMessage(wallItems[i].messages[j]);
                    }

                    (mesLen >= $rootScope.COMMENTS_DEFAULT_COUNT) ?
                    wallItems[i].bufferMessages = wallItems[i].messages.slice(mesLen-$rootScope.COMMENTS_DEFAULT_COUNT):
                        wallItems[i].bufferMessages = wallItems[i].messages;

                    if(wallItems[i].topic.poll != null){
                        //значит это опрос
                        $c.setPollEditNames(wallItems[i].topic.poll);

                        wallItems[i].topic.metaType = "poll";
                    }
                }
            }
        }

        lenta.toggleComments = function(event,wallItem){
            event.preventDefault();

            var mesLen = wallItem.messages.length;

            if(wallItem.isOpen){
                wallItem.isOpen = false;

                (mesLen >= $rootScope.COMMENTS_DEFAULT_COUNT) ?
                    wallItem.bufferMessages = wallItem.messages.slice(mesLen-$rootScope.COMMENTS_DEFAULT_COUNT):
                    wallItem.bufferMessages = wallItem.messages;

                //wallItem.bufferMessages = wallItem.messages.slice(mesLen-lenta.COMMENTS_DEFAULT_COUNT);
            }else{
                wallItem.isOpen = true;
                wallItem.bufferMessages = wallItem.messages;
            }
        };

        var lastLoadedIdFF;
        lenta.addMoreItems = function(){
            //lastLoadedIdFF = lastLoadedId;
            console.log('addMoreItems',lastLoadedId,loadedLength,$rootScope.base.bufferSelectedGroup.id,$rootScope.currentRubric);
            if(wallItemsLength == 10) {
                var buff = $c.messageClient.getWallItems($rootScope.base.bufferSelectedGroup.id,$rootScope.currentRubric.id, lastLoadedId, loadedLength);
                if (buff) {

                    var buffLength = buff.length;

                    if (buffLength != 0) {

                        lastLoadedId = buff[buffLength - 1].topic.id;

                        if(lastLoadedIdFF != lastLoadedId) {
                            initWallItem(buff);
                            lenta.wallItems = lenta.wallItems.concat(buff);
                        }

                        lastLoadedIdFF = lastLoadedId;

                    }
                }
            }
        };


    $rootScope.initCreateTopic(lenta);

        $c.initFancyBox($('.forum'));

    };

module.exports = [ '$rootScope','$state','$c', wallCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\controllers\\wallSingle.js":[function(require,module,exports){

var wallSingleCtrl = function($rootScope, $stateParams,$c){
        var wallSingle = this;

        $rootScope.base.mainContentTopIsHide = true;
        $rootScope.base.isFooterBottom = false;
        $c.initFancyBox($('.lenta-item'));

        // временно, нужна функция getWallItem(topicId)
        $rootScope.currentGroup.id = $c.getDefaultGroup($rootScope.base.groups).id;
        var wallItems = $c.messageClient.getWallItems($rootScope.currentGroup.id,0,0,1000),
        wallItemsLength = wallItems.length;

    //console.log('0',wallItems,$stateParams.topicId);
        for(var i = 0; i < wallItemsLength; i++){
            if(wallItems[i].topic.id == $stateParams.topicId){
                wallSingle.wallItem = wallItems[i];
                wallSingle.wallItem.topic.isWallSingle = true;
            }
        }

    //console.log('11',wallSingle.wallItem,$rootScope.currentGroup.id);
        $rootScope.base.initStartParamsForCreateMessage(wallSingle.wallItem);
        $rootScope.base.initStartParamsForCreateTopic(wallSingle.wallItem.topic);

/*
        wallSingle.wallItem.commentText = TEXT_DEFAULT_2;
        wallSingle.wallItem.answerShow = false;
        wallSingle.wallItem.isFocus = false;
        wallSingle.wallItem.isCreateCommentError = false;
*/

        if(wallSingle.wallItem.topic.message.important == 1){
            wallSingle.wallItem.topic.message.importantText = 'Снять метку "Важное"';
        }else{
            wallSingle.wallItem.topic.message.importantText = 'Пометить как "Важное"';
        }

        //  lenta.wallItems[i].topic.message.groupId сейчас не задана почему-то
        wallSingle.wallItem.label = $c.getLabel($c.userClientGroups,wallSingle.wallItem.topic.groupType);

        wallSingle.wallItem.tagColor = $c.getTagColor(wallSingle.wallItem.label);

        if(wallSingle.wallItem.topic.message.type == 1){

            wallSingle.wallItem.topic.lastUpdateEdit = $c.getTiming(wallSingle.wallItem.topic.lastUpdate);

        }else if(wallSingle.wallItem.topic.message.type == 5){

            wallSingle.wallItem.topic.message.createdEdit = getTiming(wallSingle.wallItem.topic.message.created);
            wallSingle.wallItem.topic.authorName = $c.getAuthorName(wallSingle.wallItem.topic.userInfo);
            wallSingle.wallItem.topic.metaType = "message";

            var mesLen;
            wallSingle.wallItem.messages ?
                mesLen = wallSingle.wallItem.messages.length:
                mesLen = 0;

            for(var j = 0; j < mesLen; j++){
                wallSingle.wallItem.messages[j].createdEdit = getTiming(wallSingle.wallItem.messages[j].created);
                wallSingle.wallItem.messages[j].authorName = $c.getAuthorName(wallSingle.wallItem.messages[j].userInfo);
                wallSingle.wallItem.messages[j].isEdit = false;

                $rootScope.base.initStartParamsForCreateMessage(wallSingle.wallItem.messages[j]);
            }


            if(wallSingle.wallItem.topic.poll != null){
                //значит это опрос
                $c.setPollEditNames(wallSingle.wallItem.topic.poll);

                wallSingle.wallItem.topic.metaType = "poll";
            }
        }

        var initFlagsArray = [];
        wallSingle.showAnswerInput = function(event,wallItem,wallMessage){
            event.preventDefault();

            /*wallItem.answerShow ?
             wallItem.answerShow = false :*/
            wallItem.answerShow = true ;
            wallItem.isFocus = true ;

            if(wallMessage){
                var authorName;
                wallMessage.userInfo ?
                    authorName = wallMessage.userInfo.firstName :
                    authorName = wallMessage.authorName.split(' ')[0];
                wallItem.commentText = authorName+", ";
            }else{
                wallItem.commentText = "";
            }

            if(!initFlagsArray[wallItem.topic.id]) {
                // инифицализацмю AttachImage нужно делать только один раз для каждого сообщения
                //initAttachImage($('#attachImage-' + wallItem.topic.id), $('#attach-area-' + wallItem.topic.id));
                //initAttachDoc($('#attachDoc-' + wallItem.topic.id), $('#attach-doc-area-' + wallItem.topic.id));
                initFlagsArray[wallItem.topic.id] = true;
            }

        };

        $('.ng-cloak').removeClass('ng-cloak');
    };

module.exports = [ '$rootScope','$stateParams','$c', wallSingleCtrl ];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\directives.js":[function(require,module,exports){
'use strict';

/* Directives */

angular.module('forum.directives', []).
  directive('ngHasfocus', function() {
        return function(scope, element, attrs) {

            scope.$watch(attrs.ngHasfocus, function (nVal, oVal) {
                if (nVal) {
                    element[0].focus();
                    if(scope.wallItem) {
                        setCaretToPos(element[0], scope.wallItem.commentText.length);
                    }else if(scope.ctrl){
                        scope.base.textareaFocus(scope.ctrl.message.content,scope.ctrl.message.default,scope.ctrl,true);
                    }
                }
            });

            element.bind('blur', function() {
                if(scope.wallItem){
                    scope.wallItem.isFocus = false;
                    scope.$apply(attrs.ngHasfocus + " = false");
                }
                //scope.$apply(attrs.ngShow + " = false");
            });

            element.bind('keydown', function (e) {
                if (e.which == 13)
                    scope.$apply(attrs.ngHasfocus + " = false");
            });
        }
    })
    .directive('button',function(){
        return {
            restrict : 'E',
            compile: function(element,attributes){
                element.addClass('btn');
                if(attributes.type == "submit"){
                    element.addClass('btn-primary');
                }
                if(attributes.size){
                    element.addClass('btn-'+attributes.size);
                }

            }
        }

    })
    .directive('pagination',function(){
        /*
        * <pagination num-pages="task.count" current-page="task.current" on-select-page="selectPage()"></pagination>
        * */
        return{
            template : '<div class="pagination">'+
                '<ul>'+
                '<li ng-class="{disabled: noPrevious()}"><a href="#" ng-click="selectPrevious()">Previous</a></li>'+
                '<li ng-repeat="page in pages" ng-class="{active : isActive(page)}"><a href="#" ng-click="selectPage(page)">{{page}}</a></li>'+
                '<li ng-class="{disabled: noNext()}"><a href="#" ng-click="selectNext()">Next</a></li>'+
                '</ul>'+
                '</div>',
            restrict:"E",
            scope : {
                numPages: "=",
                currentPage: "=",
                onSelectPage: "&"
            },
            replace: true,
            link: function(scope){
                scope.$watch('numPages',function(value){
                    scope.pages = [];
                    for(var i = 0; i <= value; i++){
                        scope.pages.push(i);
                    }
                    if(scope.currentPage > value){
                        scope.selectPage(value);
                    }
                });

                scope.isActive = function(page){
                    return scope.currentPage === page;
                };

                scope.selectPage = function(page){
                    if(!scope.isActive(page)){
                        scope.currentPage = page;
                        scope.onSelectPage({page : page});
                    }
                };

                scope.selectNext = function(){
                    if (!scope.noNext()){
                        scope.selectPage(scope.currentPage + 1);
                    }
                };
            }
        }
    })
	.directive('ngThumb', ['$window', function($window) {
        var helper = {
            support: !!($window.FileReader && $window.CanvasRenderingContext2D),
            isFile: function(item) {
                return angular.isObject(item) && item instanceof $window.File;
            },
            isImage: function(file) {
                var type =  '|' + file.type.slice(file.type.lastIndexOf('/') + 1) + '|';
                return '|jpg|png|jpeg|bmp|gif|'.indexOf(type) !== -1;
            }
        };

        return {
            restrict: 'A',
            template: '<canvas/>',
            link: function(scope, element, attributes) {
                if (!helper.support) return;

                var params = scope.$eval(attributes.ngThumb);

                if (!helper.isFile(params.file)) return;
                if (!helper.isImage(params.file)) return;

                var canvas = element.find('canvas');
                var reader = new FileReader();

                reader.onload = onLoadFile;
                reader.readAsDataURL(params.file);

                function onLoadFile(event) {
                    var img = new Image();
                    img.onload = onLoadImage;
                    img.src = event.target.result;
                }

                function onLoadImage() {
                    var width = params.width || this.width / this.height * params.height;
                    var height = params.height || this.height / this.width * params.width;
                    canvas.attr({ width: width, height: height });
                    canvas[0].getContext('2d').drawImage(this, 0, 0, width, height);

                    //scope.$parent.fileBase64 = canvas[0].toDataURL();
                    console.log('dir',width,height);

                    scope.$parent.setLoadImage('url('+canvas[0].toDataURL()+')');

                }
            }
        };
    }]);
;



// functions

function setSelectionRange(input, selectionStart, selectionEnd) {
    if (input.setSelectionRange) {
        input.focus();
        input.setSelectionRange(selectionStart, selectionEnd);
    }
    else if (input.createTextRange) {
        var range = input.createTextRange();
        range.collapse(true);
        range.moveEnd('character', selectionEnd);
        range.moveStart('character', selectionStart);
        range.select();
    }
}

function setCaretToPos (input, pos) {
    setSelectionRange(input, pos, pos);
}
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\services\\common.js":[function(require,module,exports){

module.exports = function() {
    var c = {};

    /* const */
    c.TEXT_DEFAULT_1 = "Написать сообщение";
    c.TEXT_DEFAULT_2 = "Ваш ответ";
    c.TEXT_DEFAULT_3 = "Сообщение";
    c.TEXT_DEFAULT_4 = "Заголовок";

    c.MAP_COLOR = "6FB3E040";

    c.TEXTAREA_DEFAULT_HEIGHT = 54;

    /* functions */

    var transport = new Thrift.Transport("/thrift/MessageService");
    var protocol = new Thrift.Protocol(transport);
    c.messageClient = new com.vmesteonline.be.thrift.messageservice.MessageServiceClient(protocol);

    transport = new Thrift.Transport("/thrift/AuthService");
    protocol = new Thrift.Protocol(transport);
    c.authClient = new com.vmesteonline.be.thrift.authservice.AuthServiceClient(protocol);

    var isLogin = c.authClient.checkIfAuthorized();
    var path = document.location.pathname;
    if (!isLogin && path != '/blog' && path != '/about' && path != '/contacts') document.location.replace('/login');

    transport = new Thrift.Transport("/thrift/DialogService");
    protocol = new Thrift.Protocol(transport);
    c.dialogClient = new com.vmesteonline.be.thrift.messageservice.DialogServiceClient(protocol);

    transport = new Thrift.Transport("/thrift/UserService");
    protocol = new Thrift.Protocol(transport);
    c.userClient = new com.vmesteonline.be.thrift.userservice.UserServiceClient(protocol);

    transport = new Thrift.Transport("/thrift/BusinessService");
    protocol = new Thrift.Protocol(transport);
    c.businessClient = new com.vmesteonline.be.thrift.businesservice.BusinessServiceClient(protocol);
    //BusinessServiceClient(protocol);

    if (isLogin) { //path != '/blog' && path != '/about' && path != '/contacts'
        c.userClientGroups = c.userClient.getUserGroups();
        c.userClientRubrics = c.userClient.getUserRubrics();

        //console.log('111',c.userClientRubrics,c.userClientGroups);
        if (c.userClientGroups.length == 0) document.location.replace('/login');

        c.shortUserInfo = c.userClient.getShortUserInfo();
        console.log('0', c.shortUserInfo);

        var servicesStr = c.shortUserInfo.services.join(';');

        console.log(c.shortUserInfo);
        if (servicesStr.indexOf('10') != -1) c.shortUserInfo.countersEnabled = true;
        if (servicesStr.indexOf('11') != -1) c.shortUserInfo.countersConfirmed = true;
        if (servicesStr.indexOf('12') != -1) c.shortUserInfo.countersNotification = true;
    }
//console.log('333',c.userClientGroups);

    transport = new Thrift.Transport("/thrift/UtilityService");
    protocol = new Thrift.Protocol(transport);
    c.utilityClient = new com.vmesteonline.be.thrift.utilityservice.UtilityServiceClient(protocol);

    transport = new Thrift.Transport("/thrift/fs");
    protocol = new Thrift.Protocol(transport);
    c.fileClient = new com.vmesteonline.be.thrift.fileservice.FileServiceClient(protocol);

    c.withTags = function(str){
        var result = str.replace(/&#10;/g, '<br>'); // пробел после <br> специально, чтобы не слипался с ссылками
        result = result.replace(/\n/g, '<br>');
        /*var strArr = result.split(" "),

         len = strArr.length,
         tempStr;

         result = "";
         for(var i = 0; i < len; i++){
         if(strArr[i].indexOf("http://") != -1 || strArr[i].indexOf("https://") != -1){
         //tempStr = "<a href='"+ strArr[i] +"' target='_blank'>"+strArr[i]+"</a>";
         tempStr = strArr[i].link(strArr[i]);

         strArr[i] = tempStr;
         }

         result += strArr[i]+" ";
         }*/


        return result;

    }

    c.withoutTags = function(str){
        var result = str.replace(/<br>/g, '\n');
        result = result.replace(/<[^>]+>/g, '');
        return result;
    }

/*    c.getStrFromHTMLCode = function(str){
        //alert(str);
        var strArr = str.split(';'),
            len = strArr.length,
            symb = [], counter = 0, result = "";


        for (var i = 0; i < len; i++) {
            var strArr2 = strArr[i].split(" "),
                len2 = strArr2.length;

            if (len2 == 1) {
                if (strArr2[0].indexOf('&') != -1) {
                    //alert(strArr2[0].substr(-4) == '&#10');
                    if (strArr2[0].substr(-4) != '&#10') {
                        symb[counter] = String.fromCharCode(strArr2[0].substring(2));
                        //alert("0 "+strArr2[0].substring(2)+" "+String.fromCharCode(strArr2[0].substring(2))+" "+symb[counter]);
                    } else {
                        symb[counter] = strArr2[0].substring(0, strArr2[0].length - 4) + '\n';
                        //alert("1 "+strArr2[0].substring(2)+" "+String.fromCharCode(strArr2[0].substring(2))+" "+symb[counter]);
                    }
                } else {
                    symb[counter] = strArr[i];
                }
                result += symb[counter++];
            } else {
                for (var j = 0; j < len2; j++) {
                    if (strArr2[j].indexOf('&') != -1) {
                        if (strArr2[0].substr(-4) != '&#10') {
                            symb[counter] = String.fromCharCode(strArr2[j].substring(2));
                        } else {
                            symb[counter] = strArr2[j].substring(0, strArr2[j].length - 4) + '\n';
                        }
                    } else {
                        symb[counter] = strArr2[j];
                    }
                    (j == len2 - 1) ? result += symb[counter++] : result += symb[counter++] + " ";
                }
            }
        }

        //return symb.join('');
        return result;
    }*/

    c.getDefaultGroup = function(groups){
        var len = groups.length;
        for (var i = 0; i < len; i++) {
            if (groups[i].type == 5) return groups[i];
        }

        return groups[0];
    }

    c.showGroupOverBuilding = function(groups, currentGroup){
        var len = groups.length;
        for (var i = 0; i < len; i++) {
            if (groups[i].type < 4) {
                groups[i].isShow = false;
            } //4 = BUILDING
        }
    }

    c.getBuildingGroup = function(currentGroup){
        var len = c.userClientGroups.length,
            group;
        if (currentGroup.type < 4) {
            for (var j = 0; j < len; j++) {
                if (c.userClientGroups[j].type == 4) {
                    group = c.userClientGroups[j];
                }
            }
            return group;
        } else {
            return currentGroup;
        }

    }

    c.getCorrectDate = function(str){
        var arrDate = str.split(/[./]/),
            month = arrDate[1],
            monthStr;

        switch (month) {
            case "01":
                monthStr = "Jan";
                break;
            case "02":
                monthStr = "Feb";
                break;
            case "03":
                monthStr = "Mar";
                break;
            case "04":
                monthStr = "Apr";
                break;
            case "05":
                monthStr = "May";
                break;
            case "06":
                monthStr = "June";
                break;
            case "07":
                monthStr = "July";
                break;
            case "08":
                monthStr = "Aug";
                break;
            case "09":
                monthStr = "Sep";
                break;
            case "10":
                monthStr = "Oct";
                break;
            case "11":
                monthStr = "Nov";
                break;
            case "12":
                monthStr = "Dec";
                break;
        }

        return arrDate[0] + " " + monthStr + " " + arrDate[2];

    }

    c.resetPages = function(base){
        base.neighboursIsActive = false;
        base.privateMessagesIsActive = false;
        base.mapsIsActive = false;
        base.profileIsActive = false;
        base.settingsIsActive = false;
        base.talksIsActive = false;
        base.lentaIsActive = false;
        base.advertsIsActive = false;
    }

    c.resetAceNavBtns = function(navbar){
        navbar.neighboursBtnStatus = "";
        navbar.privateMessagesBtnStatus = "";
        navbar.mapsBtnStatus = "";
    }

    var base64encode = function(str){
        // Символы для base64-преобразования
        var b64chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefg' +
            'hijklmnopqrstuvwxyz0123456789+/=';
        var b64encoded = '';
        var chr1, chr2, chr3;
        var enc1, enc2, enc3, enc4;

        for (var i = 0; i < str.length;) {
            chr1 = str.charCodeAt(i++);
            chr2 = str.charCodeAt(i++);
            chr3 = str.charCodeAt(i++);

            enc1 = chr1 >> 2;
            enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);

            enc3 = isNaN(chr2) ? 64 : (((chr2 & 15) << 2) | (chr3 >> 6));
            enc4 = isNaN(chr3) ? 64 : (chr3 & 63);

            b64encoded += b64chars.charAt(enc1) + b64chars.charAt(enc2) +
                b64chars.charAt(enc3) + b64chars.charAt(enc4);
        }
        return b64encoded;
    }

    var insertDoc = function(selector, attachAreaSelector, fileLabel){
        var docName = fileLabel.find('.file-name').attr('data-title');

        var reader = new FileReader();
        reader.readAsBinaryString(selector[0].files[0]);
        var dataType = selector[0].files[0].type;

        reader.onload = function (e) {
            docsBase64[attachAreaSelector][docsInd[attachAreaSelector]] = new com.vmesteonline.be.thrift.messageservice.Attach();
            docsBase64[attachAreaSelector][docsInd[attachAreaSelector]].fileName = docName;
            docsBase64[attachAreaSelector][docsInd[attachAreaSelector]].contentType = dataType;
            var url = docsBase64[attachAreaSelector][docsInd[attachAreaSelector]].URL = c.fileClient.saveFileContent(base64encode(reader.result));
            docsInd[attachAreaSelector]++;

            attachAreaSelector.append("<span class='attach-item new-attached' data-href='" + url + "' data-type='" + dataType + "'>" +
                "<a href='#' title='Не прикреплять' class='remove-attach-img'>&times;</a>" +
                '<span>' + docName + '</span>' +
                "</span>");

            $('.new-attached .remove-attach-img').click(function (e) {
                e.preventDefault();
                var attachItem = $(this).closest('.attach-item');
                var ind = attachItem.index();
                attachItem.hide().detach();
                docsBase64[attachAreaSelector].splice(ind, 1);
                c.fileClient.deleteFile(url);
            });

            $('.new-attached').removeClass('new-attached');
        };

    }

    var copyImage = function(attachAreaSelector, fileLabel, type){
        var copyImgSrc = fileLabel.find('.file-name img').css('background-image');

        if (copyImgSrc == 'none' || !copyImgSrc) {
            setTimeout(copyImage, 200, attachAreaSelector, fileLabel, type);
        } else {

            var url = c.fileClient.saveFileContent(copyImgSrc, true),
                fileName = fileLabel.find('.file-name').attr('data-title');

            attachAreaSelector.find('.loading').addClass('hidden');

            attachAreaSelector.find('.loading').before("<span class='attach-item new-attached'>" +
                "<a href='#' title='Не прикреплять' class='remove-attach-img'>&times;</a>" +
                "<img data-title='" + fileName + "' data-type='" + type + "' class='attached-img' style='background-image:url(" + url + ")'></span>");

            $('.new-attached .remove-attach-img').click(function (e) {
                e.preventDefault();
                $(this).closest('.attach-item').hide().detach();
                c.fileClient.deleteFile(url);
            });

            $('.new-attached').removeClass('new-attached');
        }
    }

    c.initAttachImage = function(selector, attachAreaSelector){
        var title;
        // на случай если будет прикрепляться не файл
        docsBase64[attachAreaSelector] = [];
        docsInd[attachAreaSelector] = 0;

        selector.ace_file_input({
            style: 'well',
            btn_choose: 'Изображение',
            btn_change: null,
            no_icon: '',
            droppable: true,
            thumbnail: 'large',
            icon_remove: null,
            before_change: function (files, dropped) {
                title = $(this).find('+.file-label').data('title');
                return true;
            }
        }).on('change', function () {
            var fileLabel = $(this).find('+.file-label');
            fileLabel.attr('data-title', title).removeClass('hide-placeholder');
            fileLabel.find('.file-name').hide();

            var type = selector[0].files[0].type;

            if (type.indexOf('image') != -1) {
                //если картинка
                attachAreaSelector.find('.loading').removeClass('hidden');


                var myArea = attachAreaSelector;
                if (attachAreaSelector.selector.indexOf('doc-area') != -1)
                    myArea = $(attachAreaSelector.selector.replace('doc-area', 'area'));

                setTimeout(copyImage, 200, myArea, fileLabel, type);
            } else {
                // если другой файл

                var myArea = attachAreaSelector;
                if (attachAreaSelector.selector.indexOf('doc-area') == -1)
                    myArea = $(attachAreaSelector.selector.replace('area', 'doc-area'));

                setTimeout(insertDoc, 200, selector, myArea, fileLabel);

            }

        });
    }

    var docsBase64 = [],
        docsInd = [];

    c.initAttachDoc = function(selector, attachAreaSelector){
        var title;
        docsBase64[attachAreaSelector] = [];
        docsInd[attachAreaSelector] = 0;

        selector.ace_file_input({
            style: 'well',
            btn_choose: 'Документ',
            btn_change: null,
            no_icon: '',
            droppable: true,
            thumbnail: 'large',
            icon_remove: null,
            before_change: function (files, dropped) {
                title = $(this).find('+.file-label').data('title');
                return true;
            }
        }).on('change', function () {
            var fileLabel = $(this).find('+.file-label');
            fileLabel.attr('data-title', title).removeClass('hide-placeholder');
            fileLabel.find('.file-name').hide();

            //setTimeout(insertDoc,200,selector,attachAreaSelector,fileLabel);

            var type = selector[0].files[0].type;

            if (type.indexOf('image') != -1) {
                //если картинка
                attachAreaSelector.find('.loading').removeClass('hidden');

                var myArea = attachAreaSelector;
                if (attachAreaSelector.selector.indexOf('doc-area') != -1)
                    myArea = $(attachAreaSelector.selector.replace('doc-area', 'area'));

                setTimeout(copyImage, 200, myArea, fileLabel, type);
            } else {
                // если другой файл

                var myArea = attachAreaSelector;
                if (attachAreaSelector.selector.indexOf('doc-area') == -1)
                    myArea = $(attachAreaSelector.selector.replace('area', 'doc-area'));

                setTimeout(insertDoc, 200, selector, myArea, fileLabel);
            }

        });
    }

    c.selectGroupInDropdown = function(groupId){
        var groupsLength = c.userClientGroups.length,
            selectedGroup;
        for (var i = 0; i < groupsLength; i++) {
            if (groupId == c.userClientGroups[i].id) {
                selectedGroup = c.userClientGroups[i];
            }
        }
        return selectedGroup;
    }

    c.getTiming = function(messageObjDate){
        var minute = 60 * 1000,
            hour = minute * 60,
            day = hour * 24,
            threeDays = day * 3,
            now = Date.parse(new Date()),
            timing = (now - messageObjDate * 1000),
            timeTemp;

        if (timing < minute) {
            timing = "только что";
        } else if (timing < hour) {
            timing = new Date(timing);
            //timing = timing.getMinutes()+" мин назад";
            timing = (timing / minute).toFixed(0) + " мин назад";
        } else if (timing < day) {
            timing = new Date(timing);
            //timeTemp = timing.getHours();
            timeTemp = (timing / hour).toFixed(0);

            if (timeTemp == 1 || timeTemp == 0) {
                timing = "1 час назад";
            } else if (timeTemp > 1 && timeTemp < 5) {
                timing = timeTemp + " часа назад";
            } else {
                timing = timeTemp + " часов назад";
            }
        } else if (timing < threeDays) {
            timing = new Date(timing);
            //timeTemp = timing.getDate();
            timeTemp = (timing / day).toFixed(0);
            if (timeTemp == 1) {
                timing = timeTemp + " день назад";
            } else {
                timing = timeTemp + " дня назад";
            }
        } else {
            timeTemp = new Date(messageObjDate * 1000).toLocaleDateString();

            var arr = timeTemp.split(/[./]/);
            if (arr[0].length == 1) arr[0] = "0" + arr[0];
            if (arr[1].length == 1) arr[1] = "0" + arr[1];
            timing = arr[0] + "." + arr[1] + "." + arr[2];
        }

        return timing;
    }

    c.getLabel = function(groupsArray, groupType){
        var groupsArrayLen = groupsArray.length;
        var label = "";
        for (var i = 0; i < groupsArrayLen; i++) {

            if (groupsArray[i].type == groupType) {
                label = groupsArray[i].visibleName;
            }
        }

        return label;
    }

    c.getAuthorName = function(userInfo){
        var userInf = userInfo;
        if (!userInfo) {
            userInf = c.shortUserInfo;
        }

        return userInf.firstName + " " + userInf.lastName;
    }

    c.getTagColor = function(labelName){
        var color,
            len = c.userClientGroups.length;

        for (var i = 0; i < len; i++) {
            if (labelName == c.userClientGroups[i].visibleName) {
                if (i == 0) {
                    color = 'label-pink';
                } else if (i == 1) {
                    color = 'label-success'; // green
                } else if (i == 2) {
                    color = 'label-yellow';
                } else if (i == 3) {
                    color = 'label-purple';
                }
            }
        }
        return color;
    }

    c.getTopicRubric = function(topic){
        var len = c.userClientRubrics.length,
            rubric;

        for (var i = 0; i < len; i++) {
            if (c.userClientRubrics[i].id == topic.rubricId) {
                rubric = c.userClientRubrics[i];
            }
        }

        return rubric
    };

    c.setPoll = function(poll, pollInputs){
        var counterForPoll = 0,
            pollInputsLength = pollInputs.length;

        for (var i = 0; i < pollInputsLength; i++) {
            if (pollInputs[i].name != "") {
                poll.names[counterForPoll] = pollInputs[i].name;
                poll.editNames[counterForPoll] = {
                    id: counterForPoll++,
                    name: pollInputs[i].name
                };
            }
        }

    }

    c.postTopic = function(obj, isWall, isAdverts, $filter){
        if (obj.id) {
            // значит редактирование
            if (obj.isPollShow) {
                // с опросом
                if (obj.poll && obj.poll.pollId) {
                    // редактирование опроса
                    obj.poll.subject = obj.pollSubject;
                    obj.poll.names = [];

                    c.setPoll(obj.poll, obj.pollInputs);

                } else {
                    // создание опроса
                    poll = new com.vmesteonline.be.thrift.messageservice.Poll();
                    poll.pollId = 0;
                    poll.editNames = [];
                    poll.names = [];
                    poll.subject = obj.pollSubject;
                    poll.alreadyPoll = false;

                    c.setPoll(poll, obj.pollInputs);

                    obj.poll = poll;
                    obj.metaType = "poll";
                }
            } else {
                obj.poll = null;
            }

            obj.message.images = obj.attachedImages;
            obj.message.documents = obj.attachedDocs;
            obj.message.groupId = obj.selectedGroup.id;
            //obj.message.content = c.withTags(obj.message.content);

            obj.message.content = $filter('linky')(obj.message.content, 'blank');
            obj.message.content = c.withTags(obj.message.content);

            obj.label = c.getLabel(c.userClientGroups, obj.selectedGroup.type);
            obj.tagColor = c.getTagColor(obj.label);
            obj.selectedRubric.id ? obj.rubricId = obj.selectedRubric.id : obj.rubricId = 0;

            console.log('postTopic-2', obj.rubricId);

            var newTopic = c.messageClient.postTopic(obj);
        } else {
            // значит создание

            var messageType,
                messageContent,
                subject;
            if (isWall) {
                messageType = 5; // wall
                messageContent = obj.message.content;
                obj.message.content = c.TEXT_DEFAULT_1;
                subject = "";
            } else {
                if (!isAdverts) {
                    messageType = 1; // talks
                } else {
                    messageType = 6; // adverts
                }
                messageContent = obj.message.content;
                obj.message.content = c.TEXT_DEFAULT_3;
                subject = obj.subject;

            }
            //console.log(messageContent + " " + messageType + " " + subject);

            newTopic = new com.vmesteonline.be.thrift.messageservice.Topic();
            newTopic.message = new com.vmesteonline.be.thrift.messageservice.Message();
            newTopic.message.groupId = obj.selectedGroup.id;
            newTopic.message.type = messageType;

            messageContent = $filter('linky')(messageContent, 'blank');
            newTopic.message.content = c.withTags(messageContent);

            newTopic.message.images = obj.attachedImages;
            newTopic.message.documents = obj.attachedDocs;
            newTopic.message.id = 0;
            newTopic.message.created = Date.parse(new Date()) / 1000;

            newTopic.subject = subject;
            newTopic.id = 0;
            newTopic.metaType = "message";
            newTopic.messageNum = 0;

            if (obj.id) {
                // значит редактирование
                newTopic.id = obj.id;
                newTopic.message.id = obj.message.id;
            }

            var poll;
            if (obj.isPollShow) {
                poll = new com.vmesteonline.be.thrift.messageservice.Poll();
                poll.pollId = 0;
                poll.editNames = [];
                poll.names = [];
                poll.subject = obj.pollSubject;
                poll.alreadyPoll = false;

                c.setPoll(poll, obj.pollInputs);

                newTopic.poll = poll;
                newTopic.metaType = "poll";
            }
            //newTopic.rubricId = obj.selectedRubric.id;
            obj.selectedRubric.id ? newTopic.rubricId = obj.selectedRubric.id : newTopic.rubricId = 0;

            //alert(newTopic.message.content);
            var tempTopic = c.messageClient.postTopic(newTopic);
            newTopic.id = tempTopic.id;
            newTopic.message.images = tempTopic.message.images;
            newTopic.message.documents = tempTopic.message.documents;
            newTopic.userInfo = tempTopic.userInfo;

            if (obj.isPollShow) {
                newTopic.poll.pollId = tempTopic.poll.pollId;
                obj.isPollShow = false;
                obj.pollSubject = "";
                obj.isPollAvailable = true;
            }
            if (isWall) {
                newTopic.message.createdEdit = c.getTiming(newTopic.message.created);
            } else {
                newTopic.lastUpdateEdit = c.getTiming(newTopic.message.created);
            }

        }

        return newTopic;

    }

    c.getAttachedImages = function(selector){
        var imgList = [], ind = 0;

        selector.find('.attach-item').each(function () {
            //значит картинка
            var bgImg = $(this).find('img').css('background-image'),
                name = $(this).find('img').attr('data-title'),
                type = $(this).find('img').attr('data-type'),
                result, content;

            var i = bgImg.indexOf('base64,');
            content = bgImg.slice(4, bgImg.length - 1);

            result = new com.vmesteonline.be.thrift.messageservice.Attach();
            result.fileName = name;
            result.contentType = type;

            var indexFile = content.indexOf('/file');
            content = content.substring(indexFile);

            result.URL = content;
            //console.log(content);
            //result = 'obj(name:'+ base64encode(name) +';data:'+ type +';content:'+content+")";

            imgList[ind++] = result;

        });

        return imgList;
    }

    c.getAttachedDocs = function(selector, isEdit){
        if (isEdit) {
            var docList = [], ind = 0;
            docsBase64[selector] = [];

            selector.find('.attach-item').each(function () {
                docsBase64[selector][ind] = new com.vmesteonline.be.thrift.messageservice.Attach();
                docsBase64[selector][ind].fileName = $(this).find('span').text();
                docsBase64[selector][ind].contentType = $(this).attr('data-type');
                docsBase64[selector][ind].URL = $(this).attr('data-href');

                ind++;
            });
        }

        return docsBase64[selector];


    }

    c.cleanAttached = function(selector){
        //selector.html('').append('<div class="loading hidden"><img src="i/loading2.gif"></div>');
        selector.find('.attach-item').detach();
        //docsBase64 = [];
        docsInd[selector] = 0;
        docsBase64[selector] = [];
    }

    c.postMessageMy = function(obj, isWall, isFirstLevel, $filter){

        if ((obj.id && obj.isEdit) || (obj.message && obj.message.isEdit)) {
            // значит редактирование
            var message;
            if (obj.message && obj.message.isEdit) {
                message = obj.message;
                message.content = obj.commentText;
            } else {
                obj.content = obj.commentText;
                message = obj;
            }

            var attachId;
            if (!obj.id || isFirstLevel) {
                attachId = obj.topicId + "-" + obj.messageId;
            } else {
                attachId = obj.id;
            }

            message.images = c.getAttachedImages($('#attach-area-edit-' + attachId));
            message.documents = c.getAttachedDocs($('#attach-doc-area-edit-' + attachId), true);

            if (message.content == "" && message.images.length == 0 && (message.documents === undefined || message.documents.length == 0)) {

                return 0;

            } else {
                try {
                    // try на случай если топик был удален создателем, а юзер пытается
                    // его комментировать

                    message.content = $filter('linky')(message.content, 'blank');
                    message.content = c.withTags(message.content);

                    var newMessage = c.messageClient.postMessage(message);
                } catch (e) {
                    document.location.replace('/');
                }

                c.cleanAttached($('#attach-area-edit-' + attachId));
                c.cleanAttached($('#attach-doc-area-edit-' + attachId));

                obj.isEdit = false;

                return newMessage;
            }

        } else {
            // значит создание
            var message = new com.vmesteonline.be.thrift.messageservice.Message(),
                attachId, isEmptyText = false;

            if (isWall) {
                message.type = com.vmesteonline.be.thrift.messageservice.MessageType.WALL;//5;
                attachId = message.topicId = obj.topic.id;
                message.groupId = obj.groupId;
                message.content = obj.commentText;
                message.parentId = 0;
                isEmptyText = (obj.commentText == c.TEXT_DEFAULT_2 || obj.commentText == "");
            } else {
                message.type = com.vmesteonline.be.thrift.messageservice.MessageType.BASE;//1;
                attachId = message.topicId = obj.topicId;
                message.groupId = obj.selectedGroup.id;

                if (isFirstLevel) {
                    //message.content = obj.answerFirstMessage;
                    message.content = obj.commentText;
                    message.parentId = 0;
                } else {
                    message.content = obj.commentText;
                    message.parentId = obj.parentId;
                    attachId = attachId + "-" + obj.messageId;
                }

                isEmptyText = (message.content == c.TEXT_DEFAULT_2 || message.content == "" || message.content === undefined);
            }

            message.id = 0;
            message.images = c.getAttachedImages($('#attach-area-' + attachId));

            message.documents = c.getAttachedDocs($('#attach-doc-area-' + attachId));
            for (var p in message.documents[0]) {
                alert(p + " " + message.documents[0][p]);
            }
            c.cleanAttached($('#attach-area-' + attachId));
            c.cleanAttached($('#attach-doc-area-' + attachId));
            //message.images = obj.attachedImages;
            message.created = Date.parse(new Date) / 1000;

            if (isEmptyText && message.images.length == 0 && (message.documents === undefined || message.documents.length == 0)) {

                return 0;

            } else {
                if (message.content == c.TEXT_DEFAULT_2 && (message.images.length != 0 || message.documents.length != 0)) {
                    message.content = "";
                }

                message.content = $filter('linky')(message.content, 'blank');
                message.content = c.withTags(message.content);

                try {
                    newMessage = c.messageClient.postMessage(message);
                } catch (e) {
                    document.location.replace('/');
                }

                obj.commentText = c.TEXT_DEFAULT_2;
                message.createdEdit = c.getTiming(newMessage.created);
                console.log(newMessage.created);
                message.authorName = c.getAuthorName();
                message.userInfo = newMessage.userInfo;
                message.images = newMessage.images;
                message.documents = newMessage.documents;
                message.id = newMessage.id;

                return message;
            }
        }
    }

    c.setPollEditNames = function(poll){
        // obj.wallItems[i].topic
        poll.editNames = [];
        var namesLength,
            amount = 0,
            votersNum = 0,
            votersPercent = 0;
        poll.names ?
            namesLength = poll.names.length :
            namesLength = 0;
        //console.log(poll.alreadyPoll);

        // нужно знать полный amount для вычисления процентной длины
        for (var j = 0; j < namesLength; j++) {
            if (poll && poll.values && poll.values[j]) {
                amount += poll.values[j];
            }
        }

        for (var j = 0; j < namesLength; j++) {
            if (poll && poll.values && poll.values[j]) {
                votersNum = poll.values[j];
                votersPercent = votersNum * 100 / amount;
            } else {
                votersNum = votersPercent = 0;
            }

            poll.editNames[j] = {
                id: j,
                value: 0,
                name: poll.names[j],
                votersNum: votersNum,
                votersPercent: votersPercent.toFixed(1) + "%"
            };

        }
        poll.amount = amount;
    }

    c.initFancyBox = function(selector){
        selector.find(".fancybox").fancybox({
            'transitionIn': 'elastic',
            'transitionOut': 'elastic',
            'speedIn': 600,
            'speedOut': 200,
            'overlayShow': false
        });
    }

    c.clone = function(obj){
        if (obj == null || typeof(obj) != 'object')
            return obj;
        var temp = new obj.constructor();
        for (var key in obj)
            temp[key] = c.clone(obj[key]);
        return temp;
    }

    $.widget("custom.catcomplete", $.ui.autocomplete, {
        _renderMenu: function (ul, items) {
            var that = this,
                currentCategory = "";
            $.each(items, function (index, item) {
                if (item.category != currentCategory) {
                    ul.append("<li class='ui-autocomplete-category'>" + item.category + "</li>");
                    currentCategory = item.category;
                }
                that._renderItemData(ul, item);
            });
        }
    });

    bootbox.setDefaults({locale: "ru"});

    return c;

};
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\services\\counters.js":[function(require,module,exports){
'use strict';

var counters = function($c){
        return {
            getCounters : $c.utilityClient.getCounters(),
            getTypeString : function (type){
                var typeString;

                switch (parseInt(type)){
                    case 0:
                        typeString = "Горячая вода";
                        break;
                    case 1:
                        typeString = "Холодная вода";
                        break;
                    case 2:
                        typeString = "Электричество(общий)";
                        break;
                    case 3:
                        typeString = "Электричество(ночь)";
                        break;
                    case 4:
                        typeString = "Электричество(день)";
                        break;
                    case 5:
                        typeString = "Газ";
                        break;
                    case 6:
                        typeString = "Другое";
                        break;
                }

                return typeString;
            }
        }
};

module.exports = ['$c',counters];
},{}],"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\services\\index.js":[function(require,module,exports){
'use strict';

module.exports = angular.module('forum.services', [])
    .factory( '$c', require('./common.js'))
    .factory( '$counters', require('./counters.js'))
;

/*angular.module('forum.services', []).
    factory( '$counters', function() {
        return {
            getCounters : c.utilityClient.getCounters(),
            getTypeString : function (type){
                var typeString;

                switch (parseInt(type)){
                    case 0:
                        typeString = "Горячая вода";
                        break;
                    case 1:
                        typeString = "Холодная вода";
                        break;
                    case 2:
                        typeString = "Электричество(общий)";
                        break;
                    case 3:
                        typeString = "Электричество(ночь)";
                        break;
                    case 4:
                        typeString = "Электричество(день)";
                        break;
                    case 5:
                        typeString = "Газ";
                        break;
                    case 6:
                        typeString = "Другое";
                        break;
                }

                return typeString;
            }
        }
    })
    .factory('$c', require('./common.js'));*/

},{"./common.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\services\\common.js","./counters.js":"C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\services\\counters.js"}]},{},["C:\\workspace\\projects\\vonline-cs\\vonline-cs\\src\\main\\webapp\\static\\js\\app.js"])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvYW5ndWxhci1maWxlLXVwbG9hZC9kaXN0L2FuZ3VsYXItZmlsZS11cGxvYWQubWluLmpzIiwibm9kZV9tb2R1bGVzL2FuZ3VsYXItdWktcm91dGVyL3JlbGVhc2UvYW5ndWxhci11aS1yb3V0ZXIuanMiLCJzdGF0aWMvanMvYXBwLmpzIiwic3RhdGljL2pzL2NvbmZpZy5qcyIsInN0YXRpYy9qcy9jb250cm9sbGVycy9hYm91dC5qcyIsInN0YXRpYy9qcy9jb250cm9sbGVycy9hZHZlcnRzLmpzIiwic3RhdGljL2pzL2NvbnRyb2xsZXJzL2FkdmVydHNTaW5nbGUuanMiLCJzdGF0aWMvanMvY29udHJvbGxlcnMvYmFzZS5qcyIsInN0YXRpYy9qcy9jb250cm9sbGVycy9ibG9nLmpzIiwic3RhdGljL2pzL2NvbnRyb2xsZXJzL2J1c2luZXNzL2NhYmluZXQuanMiLCJzdGF0aWMvanMvY29udHJvbGxlcnMvYnVzaW5lc3MvZWRpdC5qcyIsInN0YXRpYy9qcy9jb250cm9sbGVycy9idXNpbmVzcy9zdGF0aXN0aWMuanMiLCJzdGF0aWMvanMvY29udHJvbGxlcnMvY2hhbmdlQXZhdGFyLmpzIiwic3RhdGljL2pzL2NvbnRyb2xsZXJzL2NvbnRhY3RzLmpzIiwic3RhdGljL2pzL2NvbnRyb2xsZXJzL2NvdW50ZXJzLmpzIiwic3RhdGljL2pzL2NvbnRyb2xsZXJzL2NvdW50ZXJzSGlzdG9yeS5qcyIsInN0YXRpYy9qcy9jb250cm9sbGVycy9kaWFsb2cuanMiLCJzdGF0aWMvanMvY29udHJvbGxlcnMvZGlhbG9ncy5qcyIsInN0YXRpYy9qcy9jb250cm9sbGVycy9pbXBvcnRhbnQuanMiLCJzdGF0aWMvanMvY29udHJvbGxlcnMvaW5kZXguanMiLCJzdGF0aWMvanMvY29udHJvbGxlcnMvbGVmdEJhci5qcyIsInN0YXRpYy9qcy9jb250cm9sbGVycy9tYWluQ29udGVudFRvcC5qcyIsInN0YXRpYy9qcy9jb250cm9sbGVycy9tYXBzLmpzIiwic3RhdGljL2pzL2NvbnRyb2xsZXJzL21vZGFsSW5zdGFuY2UuanMiLCJzdGF0aWMvanMvY29udHJvbGxlcnMvbmF2YmFyLmpzIiwic3RhdGljL2pzL2NvbnRyb2xsZXJzL25lYXJieS5qcyIsInN0YXRpYy9qcy9jb250cm9sbGVycy9uZWFyYnlTaW5nbGUuanMiLCJzdGF0aWMvanMvY29udHJvbGxlcnMvbmVpZ2hib3Vycy5qcyIsInN0YXRpYy9qcy9jb250cm9sbGVycy9wcm9maWxlLmpzIiwic3RhdGljL2pzL2NvbnRyb2xsZXJzL3J1YnJpY3MuanMiLCJzdGF0aWMvanMvY29udHJvbGxlcnMvcnVicmljc1NpbmdsZS5qcyIsInN0YXRpYy9qcy9jb250cm9sbGVycy9zZXRJbmZvLmpzIiwic3RhdGljL2pzL2NvbnRyb2xsZXJzL3NldHRpbmdzLmpzIiwic3RhdGljL2pzL2NvbnRyb2xsZXJzL3RhbGtzLmpzIiwic3RhdGljL2pzL2NvbnRyb2xsZXJzL3RhbGtzU2luZ2xlLmpzIiwic3RhdGljL2pzL2NvbnRyb2xsZXJzL3VuY29uZmlybWVkLmpzIiwic3RhdGljL2pzL2NvbnRyb2xsZXJzL3dhbGwuanMiLCJzdGF0aWMvanMvY29udHJvbGxlcnMvd2FsbFNpbmdsZS5qcyIsInN0YXRpYy9qcy9kaXJlY3RpdmVzLmpzIiwic3RhdGljL2pzL3NlcnZpY2VzL2NvbW1vbi5qcyIsInN0YXRpYy9qcy9zZXJ2aWNlcy9jb3VudGVycy5qcyIsInN0YXRpYy9qcy9zZXJ2aWNlcy9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2b0lBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcnJDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3REQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1UUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4VEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3I3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvKiEgMS42LjQgKi9cclxuIWZ1bmN0aW9uKCl7dmFyIGE9YW5ndWxhci5tb2R1bGUoXCJhbmd1bGFyRmlsZVVwbG9hZFwiLFtdKTthLnNlcnZpY2UoXCIkdXBsb2FkXCIsW1wiJGh0dHBcIixcIiRxXCIsXCIkdGltZW91dFwiLGZ1bmN0aW9uKGEsYixjKXtmdW5jdGlvbiBkKGQpe2QubWV0aG9kPWQubWV0aG9kfHxcIlBPU1RcIixkLmhlYWRlcnM9ZC5oZWFkZXJzfHx7fSxkLnRyYW5zZm9ybVJlcXVlc3Q9ZC50cmFuc2Zvcm1SZXF1ZXN0fHxmdW5jdGlvbihiLGMpe3JldHVybiB3aW5kb3cuQXJyYXlCdWZmZXImJmIgaW5zdGFuY2VvZiB3aW5kb3cuQXJyYXlCdWZmZXI/YjphLmRlZmF1bHRzLnRyYW5zZm9ybVJlcXVlc3RbMF0oYixjKX07dmFyIGU9Yi5kZWZlcigpO3dpbmRvdy5YTUxIdHRwUmVxdWVzdC5fX2lzU2hpbSYmKGQuaGVhZGVycy5fX3NldFhIUl89ZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24oYSl7YSYmKGQuX19YSFI9YSxkLnhockZuJiZkLnhockZuKGEpLGEudXBsb2FkLmFkZEV2ZW50TGlzdGVuZXIoXCJwcm9ncmVzc1wiLGZ1bmN0aW9uKGEpe2Uubm90aWZ5KGEpfSwhMSksYS51cGxvYWQuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIixmdW5jdGlvbihhKXthLmxlbmd0aENvbXB1dGFibGUmJmUubm90aWZ5KGEpfSwhMSkpfX0pLGEoZCkudGhlbihmdW5jdGlvbihhKXtlLnJlc29sdmUoYSl9LGZ1bmN0aW9uKGEpe2UucmVqZWN0KGEpfSxmdW5jdGlvbihhKXtlLm5vdGlmeShhKX0pO3ZhciBmPWUucHJvbWlzZTtyZXR1cm4gZi5zdWNjZXNzPWZ1bmN0aW9uKGEpe3JldHVybiBmLnRoZW4oZnVuY3Rpb24oYil7YShiLmRhdGEsYi5zdGF0dXMsYi5oZWFkZXJzLGQpfSksZn0sZi5lcnJvcj1mdW5jdGlvbihhKXtyZXR1cm4gZi50aGVuKG51bGwsZnVuY3Rpb24oYil7YShiLmRhdGEsYi5zdGF0dXMsYi5oZWFkZXJzLGQpfSksZn0sZi5wcm9ncmVzcz1mdW5jdGlvbihhKXtyZXR1cm4gZi50aGVuKG51bGwsbnVsbCxmdW5jdGlvbihiKXthKGIpfSksZn0sZi5hYm9ydD1mdW5jdGlvbigpe3JldHVybiBkLl9fWEhSJiZjKGZ1bmN0aW9uKCl7ZC5fX1hIUi5hYm9ydCgpfSksZn0sZi54aHI9ZnVuY3Rpb24oYSl7cmV0dXJuIGQueGhyRm49ZnVuY3Rpb24oYil7cmV0dXJuIGZ1bmN0aW9uKCl7YiYmYi5hcHBseShmLGFyZ3VtZW50cyksYS5hcHBseShmLGFyZ3VtZW50cyl9fShkLnhockZuKSxmfSxmfXRoaXMudXBsb2FkPWZ1bmN0aW9uKGIpe2IuaGVhZGVycz1iLmhlYWRlcnN8fHt9LGIuaGVhZGVyc1tcIkNvbnRlbnQtVHlwZVwiXT12b2lkIDAsYi50cmFuc2Zvcm1SZXF1ZXN0PWIudHJhbnNmb3JtUmVxdWVzdHx8YS5kZWZhdWx0cy50cmFuc2Zvcm1SZXF1ZXN0O3ZhciBjPW5ldyBGb3JtRGF0YSxlPWIudHJhbnNmb3JtUmVxdWVzdCxmPWIuZGF0YTtyZXR1cm4gYi50cmFuc2Zvcm1SZXF1ZXN0PWZ1bmN0aW9uKGEsYyl7aWYoZilpZihiLmZvcm1EYXRhQXBwZW5kZXIpZm9yKHZhciBkIGluIGYpe3ZhciBnPWZbZF07Yi5mb3JtRGF0YUFwcGVuZGVyKGEsZCxnKX1lbHNlIGZvcih2YXIgZCBpbiBmKXt2YXIgZz1mW2RdO2lmKFwiZnVuY3Rpb25cIj09dHlwZW9mIGUpZz1lKGcsYyk7ZWxzZSBmb3IodmFyIGg9MDtoPGUubGVuZ3RoO2grKyl7dmFyIGk9ZVtoXTtcImZ1bmN0aW9uXCI9PXR5cGVvZiBpJiYoZz1pKGcsYykpfWEuYXBwZW5kKGQsZyl9aWYobnVsbCE9Yi5maWxlKXt2YXIgaj1iLmZpbGVGb3JtRGF0YU5hbWV8fFwiZmlsZVwiO2lmKFwiW29iamVjdCBBcnJheV1cIj09PU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChiLmZpbGUpKWZvcih2YXIgaz1cIltvYmplY3QgU3RyaW5nXVwiPT09T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGopLGg9MDtoPGIuZmlsZS5sZW5ndGg7aCsrKWEuYXBwZW5kKGs/ajpqW2hdLGIuZmlsZVtoXSxiLmZpbGVOYW1lJiZiLmZpbGVOYW1lW2hdfHxiLmZpbGVbaF0ubmFtZSk7ZWxzZSBhLmFwcGVuZChqLGIuZmlsZSxiLmZpbGVOYW1lfHxiLmZpbGUubmFtZSl9cmV0dXJuIGF9LGIuZGF0YT1jLGQoYil9LHRoaXMuaHR0cD1mdW5jdGlvbihhKXtyZXR1cm4gZChhKX19XSksYS5kaXJlY3RpdmUoXCJuZ0ZpbGVTZWxlY3RcIixbXCIkcGFyc2VcIixcIiR0aW1lb3V0XCIsZnVuY3Rpb24oYSxiKXtyZXR1cm4gZnVuY3Rpb24oYyxkLGUpe3ZhciBmPWEoZS5uZ0ZpbGVTZWxlY3QpO2lmKFwiaW5wdXRcIiE9PWRbMF0udGFnTmFtZS50b0xvd2VyQ2FzZSgpfHxcImZpbGVcIiE9PShkLmF0dHIoXCJ0eXBlXCIpJiZkLmF0dHIoXCJ0eXBlXCIpLnRvTG93ZXJDYXNlKCkpKXtmb3IodmFyIGc9YW5ndWxhci5lbGVtZW50KCc8aW5wdXQgdHlwZT1cImZpbGVcIj4nKSxoPTA7aDxkWzBdLmF0dHJpYnV0ZXMubGVuZ3RoO2grKylnLmF0dHIoZFswXS5hdHRyaWJ1dGVzW2hdLm5hbWUsZFswXS5hdHRyaWJ1dGVzW2hdLnZhbHVlKTtkLmF0dHIoXCJkYXRhLW11bHRpcGxlXCIpJiZnLmF0dHIoXCJtdWx0aXBsZVwiLFwidHJ1ZVwiKSxnLmNzcyhcInRvcFwiLDApLmNzcyhcImJvdHRvbVwiLDApLmNzcyhcImxlZnRcIiwwKS5jc3MoXCJyaWdodFwiLDApLmNzcyhcIndpZHRoXCIsXCIxMDAlXCIpLmNzcyhcIm9wYWNpdHlcIiwwKS5jc3MoXCJwb3NpdGlvblwiLFwiYWJzb2x1dGVcIikuY3NzKFwiZmlsdGVyXCIsXCJhbHBoYShvcGFjaXR5PTApXCIpLGQuYXBwZW5kKGcpLChcIlwiPT09ZC5jc3MoXCJwb3NpdGlvblwiKXx8XCJzdGF0aWNcIj09PWQuY3NzKFwicG9zaXRpb25cIikpJiZkLmNzcyhcInBvc2l0aW9uXCIsXCJyZWxhdGl2ZVwiKSxkPWd9ZC5iaW5kKFwiY2hhbmdlXCIsZnVuY3Rpb24oYSl7dmFyIGQsZSxnPVtdO2lmKGQ9YS5fX2ZpbGVzX3x8YS50YXJnZXQuZmlsZXMsbnVsbCE9ZClmb3IoZT0wO2U8ZC5sZW5ndGg7ZSsrKWcucHVzaChkLml0ZW0oZSkpO2IoZnVuY3Rpb24oKXtmKGMseyRmaWxlczpnLCRldmVudDphfSl9KX0pfX1dKSxhLmRpcmVjdGl2ZShcIm5nRmlsZURyb3BBdmFpbGFibGVcIixbXCIkcGFyc2VcIixcIiR0aW1lb3V0XCIsZnVuY3Rpb24oYSxiKXtyZXR1cm4gZnVuY3Rpb24oYyxkLGUpe2lmKFwiZHJhZ2dhYmxlXCJpbiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKSl7dmFyIGY9YShlLm5nRmlsZURyb3BBdmFpbGFibGUpO2IoZnVuY3Rpb24oKXtmKGMpfSl9fX1dKSxhLmRpcmVjdGl2ZShcIm5nRmlsZURyb3BcIixbXCIkcGFyc2VcIixcIiR0aW1lb3V0XCIsXCIkbG9jYXRpb25cIixmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGZ1bmN0aW9uKGQsZSxmKXtmdW5jdGlvbiBnKGEpe3JldHVybi9eW1xcMDAwLVxcMTc3XSokLy50ZXN0KGEpfWZ1bmN0aW9uIGgoYSxkKXt2YXIgZT1bXSxmPWEuZGF0YVRyYW5zZmVyLml0ZW1zO2lmKGYmJmYubGVuZ3RoPjAmJmZbMF0ud2Via2l0R2V0QXNFbnRyeSYmXCJmaWxlXCIhPWMucHJvdG9jb2woKSYmZlswXS53ZWJraXRHZXRBc0VudHJ5KCkuaXNEaXJlY3RvcnkpZm9yKHZhciBoPTA7aDxmLmxlbmd0aDtoKyspe3ZhciBqPWZbaF0ud2Via2l0R2V0QXNFbnRyeSgpO251bGwhPWomJihnKGoubmFtZSk/aShlLGopOmUucHVzaChmW2hdLmdldEFzRmlsZSgpKSl9ZWxzZXt2YXIgaz1hLmRhdGFUcmFuc2Zlci5maWxlcztpZihudWxsIT1rKWZvcih2YXIgaD0wO2g8ay5sZW5ndGg7aCsrKWUucHVzaChrLml0ZW0oaCkpfSFmdW5jdGlvbiBtKGEpe2IoZnVuY3Rpb24oKXtsP20oMTApOmQoZSl9LGF8fDApfSgpfWZ1bmN0aW9uIGkoYSxiKXtpZihudWxsIT1iKWlmKGIuaXNEaXJlY3Rvcnkpe3ZhciBjPWIuY3JlYXRlUmVhZGVyKCk7bCsrLGMucmVhZEVudHJpZXMoZnVuY3Rpb24oYil7Zm9yKHZhciBjPTA7YzxiLmxlbmd0aDtjKyspaShhLGJbY10pO2wtLX0pfWVsc2UgbCsrLGIuZmlsZShmdW5jdGlvbihiKXtsLS0sYS5wdXNoKGIpfSl9aWYoXCJkcmFnZ2FibGVcImluIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpKXt2YXIgaj1udWxsO2VbMF0uYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdvdmVyXCIsZnVuY3Rpb24oYyl7aWYoYy5zdG9wUHJvcGFnYXRpb24oKSxjLnByZXZlbnREZWZhdWx0KCksYi5jYW5jZWwoaiksIWVbMF0uX19kcmFnX292ZXJfY2xhc3NfKWlmKGYubmdGaWxlRHJhZ092ZXJDbGFzcy5zZWFyY2goL1xcKSAqJC8pPi0xKXtkcmFnT3ZlckNsYXNzRm49YShmLm5nRmlsZURyYWdPdmVyQ2xhc3MpO3ZhciBnPWRyYWdPdmVyQ2xhc3NGbihkLHskZXZlbnQ6Y30pO2VbMF0uX19kcmFnX292ZXJfY2xhc3NfPWd9ZWxzZSBlWzBdLl9fZHJhZ19vdmVyX2NsYXNzXz1mLm5nRmlsZURyYWdPdmVyQ2xhc3N8fFwiZHJhZ292ZXJcIjtlLmFkZENsYXNzKGVbMF0uX19kcmFnX292ZXJfY2xhc3NfKX0sITEpLGVbMF0uYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdlbnRlclwiLGZ1bmN0aW9uKGEpe2Euc3RvcFByb3BhZ2F0aW9uKCksYS5wcmV2ZW50RGVmYXVsdCgpfSwhMSksZVswXS5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ2xlYXZlXCIsZnVuY3Rpb24oKXtqPWIoZnVuY3Rpb24oKXtlLnJlbW92ZUNsYXNzKGVbMF0uX19kcmFnX292ZXJfY2xhc3NfKSxlWzBdLl9fZHJhZ19vdmVyX2NsYXNzXz1udWxsfSxmLm5nRmlsZURyYWdPdmVyRGVsYXl8fDEpfSwhMSk7dmFyIGs9YShmLm5nRmlsZURyb3ApO2VbMF0uYWRkRXZlbnRMaXN0ZW5lcihcImRyb3BcIixmdW5jdGlvbihhKXthLnN0b3BQcm9wYWdhdGlvbigpLGEucHJldmVudERlZmF1bHQoKSxlLnJlbW92ZUNsYXNzKGVbMF0uX19kcmFnX292ZXJfY2xhc3NfKSxlWzBdLl9fZHJhZ19vdmVyX2NsYXNzXz1udWxsLGgoYSxmdW5jdGlvbihiKXtrKGQseyRmaWxlczpiLCRldmVudDphfSl9KX0sITEpO3ZhciBsPTB9fX1dKX0oKTsiLCIvKipcclxuICogU3RhdGUtYmFzZWQgcm91dGluZyBmb3IgQW5ndWxhckpTXHJcbiAqIEB2ZXJzaW9uIHYwLjIuMTNcclxuICogQGxpbmsgaHR0cDovL2FuZ3VsYXItdWkuZ2l0aHViLmNvbS9cclxuICogQGxpY2Vuc2UgTUlUIExpY2Vuc2UsIGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUXHJcbiAqL1xyXG5cclxuLyogY29tbW9uanMgcGFja2FnZSBtYW5hZ2VyIHN1cHBvcnQgKGVnIGNvbXBvbmVudGpzKSAqL1xyXG5pZiAodHlwZW9mIG1vZHVsZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YgZXhwb3J0cyAhPT0gXCJ1bmRlZmluZWRcIiAmJiBtb2R1bGUuZXhwb3J0cyA9PT0gZXhwb3J0cyl7XHJcbiAgbW9kdWxlLmV4cG9ydHMgPSAndWkucm91dGVyJztcclxufVxyXG5cclxuKGZ1bmN0aW9uICh3aW5kb3csIGFuZ3VsYXIsIHVuZGVmaW5lZCkge1xyXG4vKmpzaGludCBnbG9iYWxzdHJpY3Q6dHJ1ZSovXHJcbi8qZ2xvYmFsIGFuZ3VsYXI6ZmFsc2UqL1xyXG4ndXNlIHN0cmljdCc7XHJcblxyXG52YXIgaXNEZWZpbmVkID0gYW5ndWxhci5pc0RlZmluZWQsXHJcbiAgICBpc0Z1bmN0aW9uID0gYW5ndWxhci5pc0Z1bmN0aW9uLFxyXG4gICAgaXNTdHJpbmcgPSBhbmd1bGFyLmlzU3RyaW5nLFxyXG4gICAgaXNPYmplY3QgPSBhbmd1bGFyLmlzT2JqZWN0LFxyXG4gICAgaXNBcnJheSA9IGFuZ3VsYXIuaXNBcnJheSxcclxuICAgIGZvckVhY2ggPSBhbmd1bGFyLmZvckVhY2gsXHJcbiAgICBleHRlbmQgPSBhbmd1bGFyLmV4dGVuZCxcclxuICAgIGNvcHkgPSBhbmd1bGFyLmNvcHk7XHJcblxyXG5mdW5jdGlvbiBpbmhlcml0KHBhcmVudCwgZXh0cmEpIHtcclxuICByZXR1cm4gZXh0ZW5kKG5ldyAoZXh0ZW5kKGZ1bmN0aW9uKCkge30sIHsgcHJvdG90eXBlOiBwYXJlbnQgfSkpKCksIGV4dHJhKTtcclxufVxyXG5cclxuZnVuY3Rpb24gbWVyZ2UoZHN0KSB7XHJcbiAgZm9yRWFjaChhcmd1bWVudHMsIGZ1bmN0aW9uKG9iaikge1xyXG4gICAgaWYgKG9iaiAhPT0gZHN0KSB7XHJcbiAgICAgIGZvckVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XHJcbiAgICAgICAgaWYgKCFkc3QuaGFzT3duUHJvcGVydHkoa2V5KSkgZHN0W2tleV0gPSB2YWx1ZTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgcmV0dXJuIGRzdDtcclxufVxyXG5cclxuLyoqXHJcbiAqIEZpbmRzIHRoZSBjb21tb24gYW5jZXN0b3IgcGF0aCBiZXR3ZWVuIHR3byBzdGF0ZXMuXHJcbiAqXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBmaXJzdCBUaGUgZmlyc3Qgc3RhdGUuXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBzZWNvbmQgVGhlIHNlY29uZCBzdGF0ZS5cclxuICogQHJldHVybiB7QXJyYXl9IFJldHVybnMgYW4gYXJyYXkgb2Ygc3RhdGUgbmFtZXMgaW4gZGVzY2VuZGluZyBvcmRlciwgbm90IGluY2x1ZGluZyB0aGUgcm9vdC5cclxuICovXHJcbmZ1bmN0aW9uIGFuY2VzdG9ycyhmaXJzdCwgc2Vjb25kKSB7XHJcbiAgdmFyIHBhdGggPSBbXTtcclxuXHJcbiAgZm9yICh2YXIgbiBpbiBmaXJzdC5wYXRoKSB7XHJcbiAgICBpZiAoZmlyc3QucGF0aFtuXSAhPT0gc2Vjb25kLnBhdGhbbl0pIGJyZWFrO1xyXG4gICAgcGF0aC5wdXNoKGZpcnN0LnBhdGhbbl0pO1xyXG4gIH1cclxuICByZXR1cm4gcGF0aDtcclxufVxyXG5cclxuLyoqXHJcbiAqIElFOC1zYWZlIHdyYXBwZXIgZm9yIGBPYmplY3Qua2V5cygpYC5cclxuICpcclxuICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBBIEphdmFTY3JpcHQgb2JqZWN0LlxyXG4gKiBAcmV0dXJuIHtBcnJheX0gUmV0dXJucyB0aGUga2V5cyBvZiB0aGUgb2JqZWN0IGFzIGFuIGFycmF5LlxyXG4gKi9cclxuZnVuY3Rpb24gb2JqZWN0S2V5cyhvYmplY3QpIHtcclxuICBpZiAoT2JqZWN0LmtleXMpIHtcclxuICAgIHJldHVybiBPYmplY3Qua2V5cyhvYmplY3QpO1xyXG4gIH1cclxuICB2YXIgcmVzdWx0ID0gW107XHJcblxyXG4gIGFuZ3VsYXIuZm9yRWFjaChvYmplY3QsIGZ1bmN0aW9uKHZhbCwga2V5KSB7XHJcbiAgICByZXN1bHQucHVzaChrZXkpO1xyXG4gIH0pO1xyXG4gIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJRTgtc2FmZSB3cmFwcGVyIGZvciBgQXJyYXkucHJvdG90eXBlLmluZGV4T2YoKWAuXHJcbiAqXHJcbiAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IEEgSmF2YVNjcmlwdCBhcnJheS5cclxuICogQHBhcmFtIHsqfSB2YWx1ZSBBIHZhbHVlIHRvIHNlYXJjaCB0aGUgYXJyYXkgZm9yLlxyXG4gKiBAcmV0dXJuIHtOdW1iZXJ9IFJldHVybnMgdGhlIGFycmF5IGluZGV4IHZhbHVlIG9mIGB2YWx1ZWAsIG9yIGAtMWAgaWYgbm90IHByZXNlbnQuXHJcbiAqL1xyXG5mdW5jdGlvbiBpbmRleE9mKGFycmF5LCB2YWx1ZSkge1xyXG4gIGlmIChBcnJheS5wcm90b3R5cGUuaW5kZXhPZikge1xyXG4gICAgcmV0dXJuIGFycmF5LmluZGV4T2YodmFsdWUsIE51bWJlcihhcmd1bWVudHNbMl0pIHx8IDApO1xyXG4gIH1cclxuICB2YXIgbGVuID0gYXJyYXkubGVuZ3RoID4+PiAwLCBmcm9tID0gTnVtYmVyKGFyZ3VtZW50c1syXSkgfHwgMDtcclxuICBmcm9tID0gKGZyb20gPCAwKSA/IE1hdGguY2VpbChmcm9tKSA6IE1hdGguZmxvb3IoZnJvbSk7XHJcblxyXG4gIGlmIChmcm9tIDwgMCkgZnJvbSArPSBsZW47XHJcblxyXG4gIGZvciAoOyBmcm9tIDwgbGVuOyBmcm9tKyspIHtcclxuICAgIGlmIChmcm9tIGluIGFycmF5ICYmIGFycmF5W2Zyb21dID09PSB2YWx1ZSkgcmV0dXJuIGZyb207XHJcbiAgfVxyXG4gIHJldHVybiAtMTtcclxufVxyXG5cclxuLyoqXHJcbiAqIE1lcmdlcyBhIHNldCBvZiBwYXJhbWV0ZXJzIHdpdGggYWxsIHBhcmFtZXRlcnMgaW5oZXJpdGVkIGJldHdlZW4gdGhlIGNvbW1vbiBwYXJlbnRzIG9mIHRoZVxyXG4gKiBjdXJyZW50IHN0YXRlIGFuZCBhIGdpdmVuIGRlc3RpbmF0aW9uIHN0YXRlLlxyXG4gKlxyXG4gKiBAcGFyYW0ge09iamVjdH0gY3VycmVudFBhcmFtcyBUaGUgdmFsdWUgb2YgdGhlIGN1cnJlbnQgc3RhdGUgcGFyYW1ldGVycyAoJHN0YXRlUGFyYW1zKS5cclxuICogQHBhcmFtIHtPYmplY3R9IG5ld1BhcmFtcyBUaGUgc2V0IG9mIHBhcmFtZXRlcnMgd2hpY2ggd2lsbCBiZSBjb21wb3NpdGVkIHdpdGggaW5oZXJpdGVkIHBhcmFtcy5cclxuICogQHBhcmFtIHtPYmplY3R9ICRjdXJyZW50IEludGVybmFsIGRlZmluaXRpb24gb2Ygb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgY3VycmVudCBzdGF0ZS5cclxuICogQHBhcmFtIHtPYmplY3R9ICR0byBJbnRlcm5hbCBkZWZpbml0aW9uIG9mIG9iamVjdCByZXByZXNlbnRpbmcgc3RhdGUgdG8gdHJhbnNpdGlvbiB0by5cclxuICovXHJcbmZ1bmN0aW9uIGluaGVyaXRQYXJhbXMoY3VycmVudFBhcmFtcywgbmV3UGFyYW1zLCAkY3VycmVudCwgJHRvKSB7XHJcbiAgdmFyIHBhcmVudHMgPSBhbmNlc3RvcnMoJGN1cnJlbnQsICR0byksIHBhcmVudFBhcmFtcywgaW5oZXJpdGVkID0ge30sIGluaGVyaXRMaXN0ID0gW107XHJcblxyXG4gIGZvciAodmFyIGkgaW4gcGFyZW50cykge1xyXG4gICAgaWYgKCFwYXJlbnRzW2ldLnBhcmFtcykgY29udGludWU7XHJcbiAgICBwYXJlbnRQYXJhbXMgPSBvYmplY3RLZXlzKHBhcmVudHNbaV0ucGFyYW1zKTtcclxuICAgIGlmICghcGFyZW50UGFyYW1zLmxlbmd0aCkgY29udGludWU7XHJcblxyXG4gICAgZm9yICh2YXIgaiBpbiBwYXJlbnRQYXJhbXMpIHtcclxuICAgICAgaWYgKGluZGV4T2YoaW5oZXJpdExpc3QsIHBhcmVudFBhcmFtc1tqXSkgPj0gMCkgY29udGludWU7XHJcbiAgICAgIGluaGVyaXRMaXN0LnB1c2gocGFyZW50UGFyYW1zW2pdKTtcclxuICAgICAgaW5oZXJpdGVkW3BhcmVudFBhcmFtc1tqXV0gPSBjdXJyZW50UGFyYW1zW3BhcmVudFBhcmFtc1tqXV07XHJcbiAgICB9XHJcbiAgfVxyXG4gIHJldHVybiBleHRlbmQoe30sIGluaGVyaXRlZCwgbmV3UGFyYW1zKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFBlcmZvcm1zIGEgbm9uLXN0cmljdCBjb21wYXJpc29uIG9mIHRoZSBzdWJzZXQgb2YgdHdvIG9iamVjdHMsIGRlZmluZWQgYnkgYSBsaXN0IG9mIGtleXMuXHJcbiAqXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBhIFRoZSBmaXJzdCBvYmplY3QuXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBiIFRoZSBzZWNvbmQgb2JqZWN0LlxyXG4gKiBAcGFyYW0ge0FycmF5fSBrZXlzIFRoZSBsaXN0IG9mIGtleXMgd2l0aGluIGVhY2ggb2JqZWN0IHRvIGNvbXBhcmUuIElmIHRoZSBsaXN0IGlzIGVtcHR5IG9yIG5vdCBzcGVjaWZpZWQsXHJcbiAqICAgICAgICAgICAgICAgICAgICAgaXQgZGVmYXVsdHMgdG8gdGhlIGxpc3Qgb2Yga2V5cyBpbiBgYWAuXHJcbiAqIEByZXR1cm4ge0Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBrZXlzIG1hdGNoLCBvdGhlcndpc2UgYGZhbHNlYC5cclxuICovXHJcbmZ1bmN0aW9uIGVxdWFsRm9yS2V5cyhhLCBiLCBrZXlzKSB7XHJcbiAgaWYgKCFrZXlzKSB7XHJcbiAgICBrZXlzID0gW107XHJcbiAgICBmb3IgKHZhciBuIGluIGEpIGtleXMucHVzaChuKTsgLy8gVXNlZCBpbnN0ZWFkIG9mIE9iamVjdC5rZXlzKCkgZm9yIElFOCBjb21wYXRpYmlsaXR5XHJcbiAgfVxyXG5cclxuICBmb3IgKHZhciBpPTA7IGk8a2V5cy5sZW5ndGg7IGkrKykge1xyXG4gICAgdmFyIGsgPSBrZXlzW2ldO1xyXG4gICAgaWYgKGFba10gIT0gYltrXSkgcmV0dXJuIGZhbHNlOyAvLyBOb3QgJz09PScsIHZhbHVlcyBhcmVuJ3QgbmVjZXNzYXJpbHkgbm9ybWFsaXplZFxyXG4gIH1cclxuICByZXR1cm4gdHJ1ZTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFJldHVybnMgdGhlIHN1YnNldCBvZiBhbiBvYmplY3QsIGJhc2VkIG9uIGEgbGlzdCBvZiBrZXlzLlxyXG4gKlxyXG4gKiBAcGFyYW0ge0FycmF5fSBrZXlzXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSB2YWx1ZXNcclxuICogQHJldHVybiB7Qm9vbGVhbn0gUmV0dXJucyBhIHN1YnNldCBvZiBgdmFsdWVzYC5cclxuICovXHJcbmZ1bmN0aW9uIGZpbHRlckJ5S2V5cyhrZXlzLCB2YWx1ZXMpIHtcclxuICB2YXIgZmlsdGVyZWQgPSB7fTtcclxuXHJcbiAgZm9yRWFjaChrZXlzLCBmdW5jdGlvbiAobmFtZSkge1xyXG4gICAgZmlsdGVyZWRbbmFtZV0gPSB2YWx1ZXNbbmFtZV07XHJcbiAgfSk7XHJcbiAgcmV0dXJuIGZpbHRlcmVkO1xyXG59XHJcblxyXG4vLyBsaWtlIF8uaW5kZXhCeVxyXG4vLyB3aGVuIHlvdSBrbm93IHRoYXQgeW91ciBpbmRleCB2YWx1ZXMgd2lsbCBiZSB1bmlxdWUsIG9yIHlvdSB3YW50IGxhc3Qtb25lLWluIHRvIHdpblxyXG5mdW5jdGlvbiBpbmRleEJ5KGFycmF5LCBwcm9wTmFtZSkge1xyXG4gIHZhciByZXN1bHQgPSB7fTtcclxuICBmb3JFYWNoKGFycmF5LCBmdW5jdGlvbihpdGVtKSB7XHJcbiAgICByZXN1bHRbaXRlbVtwcm9wTmFtZV1dID0gaXRlbTtcclxuICB9KTtcclxuICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG4vLyBleHRyYWN0ZWQgZnJvbSB1bmRlcnNjb3JlLmpzXHJcbi8vIFJldHVybiBhIGNvcHkgb2YgdGhlIG9iamVjdCBvbmx5IGNvbnRhaW5pbmcgdGhlIHdoaXRlbGlzdGVkIHByb3BlcnRpZXMuXHJcbmZ1bmN0aW9uIHBpY2sob2JqKSB7XHJcbiAgdmFyIGNvcHkgPSB7fTtcclxuICB2YXIga2V5cyA9IEFycmF5LnByb3RvdHlwZS5jb25jYXQuYXBwbHkoQXJyYXkucHJvdG90eXBlLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTtcclxuICBmb3JFYWNoKGtleXMsIGZ1bmN0aW9uKGtleSkge1xyXG4gICAgaWYgKGtleSBpbiBvYmopIGNvcHlba2V5XSA9IG9ialtrZXldO1xyXG4gIH0pO1xyXG4gIHJldHVybiBjb3B5O1xyXG59XHJcblxyXG4vLyBleHRyYWN0ZWQgZnJvbSB1bmRlcnNjb3JlLmpzXHJcbi8vIFJldHVybiBhIGNvcHkgb2YgdGhlIG9iamVjdCBvbWl0dGluZyB0aGUgYmxhY2tsaXN0ZWQgcHJvcGVydGllcy5cclxuZnVuY3Rpb24gb21pdChvYmopIHtcclxuICB2YXIgY29weSA9IHt9O1xyXG4gIHZhciBrZXlzID0gQXJyYXkucHJvdG90eXBlLmNvbmNhdC5hcHBseShBcnJheS5wcm90b3R5cGUsIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpO1xyXG4gIGZvciAodmFyIGtleSBpbiBvYmopIHtcclxuICAgIGlmIChpbmRleE9mKGtleXMsIGtleSkgPT0gLTEpIGNvcHlba2V5XSA9IG9ialtrZXldO1xyXG4gIH1cclxuICByZXR1cm4gY29weTtcclxufVxyXG5cclxuZnVuY3Rpb24gcGx1Y2soY29sbGVjdGlvbiwga2V5KSB7XHJcbiAgdmFyIHJlc3VsdCA9IGlzQXJyYXkoY29sbGVjdGlvbikgPyBbXSA6IHt9O1xyXG5cclxuICBmb3JFYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbCwgaSkge1xyXG4gICAgcmVzdWx0W2ldID0gaXNGdW5jdGlvbihrZXkpID8ga2V5KHZhbCkgOiB2YWxba2V5XTtcclxuICB9KTtcclxuICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5mdW5jdGlvbiBmaWx0ZXIoY29sbGVjdGlvbiwgY2FsbGJhY2spIHtcclxuICB2YXIgYXJyYXkgPSBpc0FycmF5KGNvbGxlY3Rpb24pO1xyXG4gIHZhciByZXN1bHQgPSBhcnJheSA/IFtdIDoge307XHJcbiAgZm9yRWFjaChjb2xsZWN0aW9uLCBmdW5jdGlvbih2YWwsIGkpIHtcclxuICAgIGlmIChjYWxsYmFjayh2YWwsIGkpKSB7XHJcbiAgICAgIHJlc3VsdFthcnJheSA/IHJlc3VsdC5sZW5ndGggOiBpXSA9IHZhbDtcclxuICAgIH1cclxuICB9KTtcclxuICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5mdW5jdGlvbiBtYXAoY29sbGVjdGlvbiwgY2FsbGJhY2spIHtcclxuICB2YXIgcmVzdWx0ID0gaXNBcnJheShjb2xsZWN0aW9uKSA/IFtdIDoge307XHJcblxyXG4gIGZvckVhY2goY29sbGVjdGlvbiwgZnVuY3Rpb24odmFsLCBpKSB7XHJcbiAgICByZXN1bHRbaV0gPSBjYWxsYmFjayh2YWwsIGkpO1xyXG4gIH0pO1xyXG4gIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAbmdkb2Mgb3ZlcnZpZXdcclxuICogQG5hbWUgdWkucm91dGVyLnV0aWxcclxuICpcclxuICogQGRlc2NyaXB0aW9uXHJcbiAqICMgdWkucm91dGVyLnV0aWwgc3ViLW1vZHVsZVxyXG4gKlxyXG4gKiBUaGlzIG1vZHVsZSBpcyBhIGRlcGVuZGVuY3kgb2Ygb3RoZXIgc3ViLW1vZHVsZXMuIERvIG5vdCBpbmNsdWRlIHRoaXMgbW9kdWxlIGFzIGEgZGVwZW5kZW5jeVxyXG4gKiBpbiB5b3VyIGFuZ3VsYXIgYXBwICh1c2Uge0BsaW5rIHVpLnJvdXRlcn0gbW9kdWxlIGluc3RlYWQpLlxyXG4gKlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ3VpLnJvdXRlci51dGlsJywgWyduZyddKTtcclxuXHJcbi8qKlxyXG4gKiBAbmdkb2Mgb3ZlcnZpZXdcclxuICogQG5hbWUgdWkucm91dGVyLnJvdXRlclxyXG4gKiBcclxuICogQHJlcXVpcmVzIHVpLnJvdXRlci51dGlsXHJcbiAqXHJcbiAqIEBkZXNjcmlwdGlvblxyXG4gKiAjIHVpLnJvdXRlci5yb3V0ZXIgc3ViLW1vZHVsZVxyXG4gKlxyXG4gKiBUaGlzIG1vZHVsZSBpcyBhIGRlcGVuZGVuY3kgb2Ygb3RoZXIgc3ViLW1vZHVsZXMuIERvIG5vdCBpbmNsdWRlIHRoaXMgbW9kdWxlIGFzIGEgZGVwZW5kZW5jeVxyXG4gKiBpbiB5b3VyIGFuZ3VsYXIgYXBwICh1c2Uge0BsaW5rIHVpLnJvdXRlcn0gbW9kdWxlIGluc3RlYWQpLlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ3VpLnJvdXRlci5yb3V0ZXInLCBbJ3VpLnJvdXRlci51dGlsJ10pO1xyXG5cclxuLyoqXHJcbiAqIEBuZ2RvYyBvdmVydmlld1xyXG4gKiBAbmFtZSB1aS5yb3V0ZXIuc3RhdGVcclxuICogXHJcbiAqIEByZXF1aXJlcyB1aS5yb3V0ZXIucm91dGVyXHJcbiAqIEByZXF1aXJlcyB1aS5yb3V0ZXIudXRpbFxyXG4gKlxyXG4gKiBAZGVzY3JpcHRpb25cclxuICogIyB1aS5yb3V0ZXIuc3RhdGUgc3ViLW1vZHVsZVxyXG4gKlxyXG4gKiBUaGlzIG1vZHVsZSBpcyBhIGRlcGVuZGVuY3kgb2YgdGhlIG1haW4gdWkucm91dGVyIG1vZHVsZS4gRG8gbm90IGluY2x1ZGUgdGhpcyBtb2R1bGUgYXMgYSBkZXBlbmRlbmN5XHJcbiAqIGluIHlvdXIgYW5ndWxhciBhcHAgKHVzZSB7QGxpbmsgdWkucm91dGVyfSBtb2R1bGUgaW5zdGVhZCkuXHJcbiAqIFxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ3VpLnJvdXRlci5zdGF0ZScsIFsndWkucm91dGVyLnJvdXRlcicsICd1aS5yb3V0ZXIudXRpbCddKTtcclxuXHJcbi8qKlxyXG4gKiBAbmdkb2Mgb3ZlcnZpZXdcclxuICogQG5hbWUgdWkucm91dGVyXHJcbiAqXHJcbiAqIEByZXF1aXJlcyB1aS5yb3V0ZXIuc3RhdGVcclxuICpcclxuICogQGRlc2NyaXB0aW9uXHJcbiAqICMgdWkucm91dGVyXHJcbiAqIFxyXG4gKiAjIyBUaGUgbWFpbiBtb2R1bGUgZm9yIHVpLnJvdXRlciBcclxuICogVGhlcmUgYXJlIHNldmVyYWwgc3ViLW1vZHVsZXMgaW5jbHVkZWQgd2l0aCB0aGUgdWkucm91dGVyIG1vZHVsZSwgaG93ZXZlciBvbmx5IHRoaXMgbW9kdWxlIGlzIG5lZWRlZFxyXG4gKiBhcyBhIGRlcGVuZGVuY3kgd2l0aGluIHlvdXIgYW5ndWxhciBhcHAuIFRoZSBvdGhlciBtb2R1bGVzIGFyZSBmb3Igb3JnYW5pemF0aW9uIHB1cnBvc2VzLiBcclxuICpcclxuICogVGhlIG1vZHVsZXMgYXJlOlxyXG4gKiAqIHVpLnJvdXRlciAtIHRoZSBtYWluIFwidW1icmVsbGFcIiBtb2R1bGVcclxuICogKiB1aS5yb3V0ZXIucm91dGVyIC0gXHJcbiAqIFxyXG4gKiAqWW91J2xsIG5lZWQgdG8gaW5jbHVkZSAqKm9ubHkqKiB0aGlzIG1vZHVsZSBhcyB0aGUgZGVwZW5kZW5jeSB3aXRoaW4geW91ciBhbmd1bGFyIGFwcC4qXHJcbiAqIFxyXG4gKiA8cHJlPlxyXG4gKiA8IWRvY3R5cGUgaHRtbD5cclxuICogPGh0bWwgbmctYXBwPVwibXlBcHBcIj5cclxuICogPGhlYWQ+XHJcbiAqICAgPHNjcmlwdCBzcmM9XCJqcy9hbmd1bGFyLmpzXCI+PC9zY3JpcHQ+XHJcbiAqICAgPCEtLSBJbmNsdWRlIHRoZSB1aS1yb3V0ZXIgc2NyaXB0IC0tPlxyXG4gKiAgIDxzY3JpcHQgc3JjPVwianMvYW5ndWxhci11aS1yb3V0ZXIubWluLmpzXCI+PC9zY3JpcHQ+XHJcbiAqICAgPHNjcmlwdD5cclxuICogICAgIC8vIC4uLmFuZCBhZGQgJ3VpLnJvdXRlcicgYXMgYSBkZXBlbmRlbmN5XHJcbiAqICAgICB2YXIgbXlBcHAgPSBhbmd1bGFyLm1vZHVsZSgnbXlBcHAnLCBbJ3VpLnJvdXRlciddKTtcclxuICogICA8L3NjcmlwdD5cclxuICogPC9oZWFkPlxyXG4gKiA8Ym9keT5cclxuICogPC9ib2R5PlxyXG4gKiA8L2h0bWw+XHJcbiAqIDwvcHJlPlxyXG4gKi9cclxuYW5ndWxhci5tb2R1bGUoJ3VpLnJvdXRlcicsIFsndWkucm91dGVyLnN0YXRlJ10pO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3VpLnJvdXRlci5jb21wYXQnLCBbJ3VpLnJvdXRlciddKTtcclxuXHJcbi8qKlxyXG4gKiBAbmdkb2Mgb2JqZWN0XHJcbiAqIEBuYW1lIHVpLnJvdXRlci51dGlsLiRyZXNvbHZlXHJcbiAqXHJcbiAqIEByZXF1aXJlcyAkcVxyXG4gKiBAcmVxdWlyZXMgJGluamVjdG9yXHJcbiAqXHJcbiAqIEBkZXNjcmlwdGlvblxyXG4gKiBNYW5hZ2VzIHJlc29sdXRpb24gb2YgKGFjeWNsaWMpIGdyYXBocyBvZiBwcm9taXNlcy5cclxuICovXHJcbiRSZXNvbHZlLiRpbmplY3QgPSBbJyRxJywgJyRpbmplY3RvciddO1xyXG5mdW5jdGlvbiAkUmVzb2x2ZSggICRxLCAgICAkaW5qZWN0b3IpIHtcclxuICBcclxuICB2YXIgVklTSVRfSU5fUFJPR1JFU1MgPSAxLFxyXG4gICAgICBWSVNJVF9ET05FID0gMixcclxuICAgICAgTk9USElORyA9IHt9LFxyXG4gICAgICBOT19ERVBFTkRFTkNJRVMgPSBbXSxcclxuICAgICAgTk9fTE9DQUxTID0gTk9USElORyxcclxuICAgICAgTk9fUEFSRU5UID0gZXh0ZW5kKCRxLndoZW4oTk9USElORyksIHsgJCRwcm9taXNlczogTk9USElORywgJCR2YWx1ZXM6IE5PVEhJTkcgfSk7XHJcbiAgXHJcblxyXG4gIC8qKlxyXG4gICAqIEBuZ2RvYyBmdW5jdGlvblxyXG4gICAqIEBuYW1lIHVpLnJvdXRlci51dGlsLiRyZXNvbHZlI3N0dWR5XHJcbiAgICogQG1ldGhvZE9mIHVpLnJvdXRlci51dGlsLiRyZXNvbHZlXHJcbiAgICpcclxuICAgKiBAZGVzY3JpcHRpb25cclxuICAgKiBTdHVkaWVzIGEgc2V0IG9mIGludm9jYWJsZXMgdGhhdCBhcmUgbGlrZWx5IHRvIGJlIHVzZWQgbXVsdGlwbGUgdGltZXMuXHJcbiAgICogPHByZT5cclxuICAgKiAkcmVzb2x2ZS5zdHVkeShpbnZvY2FibGVzKShsb2NhbHMsIHBhcmVudCwgc2VsZilcclxuICAgKiA8L3ByZT5cclxuICAgKiBpcyBlcXVpdmFsZW50IHRvXHJcbiAgICogPHByZT5cclxuICAgKiAkcmVzb2x2ZS5yZXNvbHZlKGludm9jYWJsZXMsIGxvY2FscywgcGFyZW50LCBzZWxmKVxyXG4gICAqIDwvcHJlPlxyXG4gICAqIGJ1dCB0aGUgZm9ybWVyIGlzIG1vcmUgZWZmaWNpZW50IChpbiBmYWN0IGByZXNvbHZlYCBqdXN0IGNhbGxzIGBzdHVkeWAgXHJcbiAgICogaW50ZXJuYWxseSkuXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge29iamVjdH0gaW52b2NhYmxlcyBJbnZvY2FibGUgb2JqZWN0c1xyXG4gICAqIEByZXR1cm4ge2Z1bmN0aW9ufSBhIGZ1bmN0aW9uIHRvIHBhc3MgaW4gbG9jYWxzLCBwYXJlbnQgYW5kIHNlbGZcclxuICAgKi9cclxuICB0aGlzLnN0dWR5ID0gZnVuY3Rpb24gKGludm9jYWJsZXMpIHtcclxuICAgIGlmICghaXNPYmplY3QoaW52b2NhYmxlcykpIHRocm93IG5ldyBFcnJvcihcIidpbnZvY2FibGVzJyBtdXN0IGJlIGFuIG9iamVjdFwiKTtcclxuICAgIHZhciBpbnZvY2FibGVLZXlzID0gb2JqZWN0S2V5cyhpbnZvY2FibGVzIHx8IHt9KTtcclxuICAgIFxyXG4gICAgLy8gUGVyZm9ybSBhIHRvcG9sb2dpY2FsIHNvcnQgb2YgaW52b2NhYmxlcyB0byBidWlsZCBhbiBvcmRlcmVkIHBsYW5cclxuICAgIHZhciBwbGFuID0gW10sIGN5Y2xlID0gW10sIHZpc2l0ZWQgPSB7fTtcclxuICAgIGZ1bmN0aW9uIHZpc2l0KHZhbHVlLCBrZXkpIHtcclxuICAgICAgaWYgKHZpc2l0ZWRba2V5XSA9PT0gVklTSVRfRE9ORSkgcmV0dXJuO1xyXG4gICAgICBcclxuICAgICAgY3ljbGUucHVzaChrZXkpO1xyXG4gICAgICBpZiAodmlzaXRlZFtrZXldID09PSBWSVNJVF9JTl9QUk9HUkVTUykge1xyXG4gICAgICAgIGN5Y2xlLnNwbGljZSgwLCBpbmRleE9mKGN5Y2xlLCBrZXkpKTtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDeWNsaWMgZGVwZW5kZW5jeTogXCIgKyBjeWNsZS5qb2luKFwiIC0+IFwiKSk7XHJcbiAgICAgIH1cclxuICAgICAgdmlzaXRlZFtrZXldID0gVklTSVRfSU5fUFJPR1JFU1M7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoaXNTdHJpbmcodmFsdWUpKSB7XHJcbiAgICAgICAgcGxhbi5wdXNoKGtleSwgWyBmdW5jdGlvbigpIHsgcmV0dXJuICRpbmplY3Rvci5nZXQodmFsdWUpOyB9XSwgTk9fREVQRU5ERU5DSUVTKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB2YXIgcGFyYW1zID0gJGluamVjdG9yLmFubm90YXRlKHZhbHVlKTtcclxuICAgICAgICBmb3JFYWNoKHBhcmFtcywgZnVuY3Rpb24gKHBhcmFtKSB7XHJcbiAgICAgICAgICBpZiAocGFyYW0gIT09IGtleSAmJiBpbnZvY2FibGVzLmhhc093blByb3BlcnR5KHBhcmFtKSkgdmlzaXQoaW52b2NhYmxlc1twYXJhbV0sIHBhcmFtKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBwbGFuLnB1c2goa2V5LCB2YWx1ZSwgcGFyYW1zKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgY3ljbGUucG9wKCk7XHJcbiAgICAgIHZpc2l0ZWRba2V5XSA9IFZJU0lUX0RPTkU7XHJcbiAgICB9XHJcbiAgICBmb3JFYWNoKGludm9jYWJsZXMsIHZpc2l0KTtcclxuICAgIGludm9jYWJsZXMgPSBjeWNsZSA9IHZpc2l0ZWQgPSBudWxsOyAvLyBwbGFuIGlzIGFsbCB0aGF0J3MgcmVxdWlyZWRcclxuICAgIFxyXG4gICAgZnVuY3Rpb24gaXNSZXNvbHZlKHZhbHVlKSB7XHJcbiAgICAgIHJldHVybiBpc09iamVjdCh2YWx1ZSkgJiYgdmFsdWUudGhlbiAmJiB2YWx1ZS4kJHByb21pc2VzO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGxvY2FscywgcGFyZW50LCBzZWxmKSB7XHJcbiAgICAgIGlmIChpc1Jlc29sdmUobG9jYWxzKSAmJiBzZWxmID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBzZWxmID0gcGFyZW50OyBwYXJlbnQgPSBsb2NhbHM7IGxvY2FscyA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKCFsb2NhbHMpIGxvY2FscyA9IE5PX0xPQ0FMUztcclxuICAgICAgZWxzZSBpZiAoIWlzT2JqZWN0KGxvY2FscykpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCInbG9jYWxzJyBtdXN0IGJlIGFuIG9iamVjdFwiKTtcclxuICAgICAgfSAgICAgICBcclxuICAgICAgaWYgKCFwYXJlbnQpIHBhcmVudCA9IE5PX1BBUkVOVDtcclxuICAgICAgZWxzZSBpZiAoIWlzUmVzb2x2ZShwYXJlbnQpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiJ3BhcmVudCcgbXVzdCBiZSBhIHByb21pc2UgcmV0dXJuZWQgYnkgJHJlc29sdmUucmVzb2x2ZSgpXCIpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBUbyBjb21wbGV0ZSB0aGUgb3ZlcmFsbCByZXNvbHV0aW9uLCB3ZSBoYXZlIHRvIHdhaXQgZm9yIHRoZSBwYXJlbnRcclxuICAgICAgLy8gcHJvbWlzZSBhbmQgZm9yIHRoZSBwcm9taXNlIGZvciBlYWNoIGludm9rYWJsZSBpbiBvdXIgcGxhbi5cclxuICAgICAgdmFyIHJlc29sdXRpb24gPSAkcS5kZWZlcigpLFxyXG4gICAgICAgICAgcmVzdWx0ID0gcmVzb2x1dGlvbi5wcm9taXNlLFxyXG4gICAgICAgICAgcHJvbWlzZXMgPSByZXN1bHQuJCRwcm9taXNlcyA9IHt9LFxyXG4gICAgICAgICAgdmFsdWVzID0gZXh0ZW5kKHt9LCBsb2NhbHMpLFxyXG4gICAgICAgICAgd2FpdCA9IDEgKyBwbGFuLmxlbmd0aC8zLFxyXG4gICAgICAgICAgbWVyZ2VkID0gZmFsc2U7XHJcbiAgICAgICAgICBcclxuICAgICAgZnVuY3Rpb24gZG9uZSgpIHtcclxuICAgICAgICAvLyBNZXJnZSBwYXJlbnQgdmFsdWVzIHdlIGhhdmVuJ3QgZ290IHlldCBhbmQgcHVibGlzaCBvdXIgb3duICQkdmFsdWVzXHJcbiAgICAgICAgaWYgKCEtLXdhaXQpIHtcclxuICAgICAgICAgIGlmICghbWVyZ2VkKSBtZXJnZSh2YWx1ZXMsIHBhcmVudC4kJHZhbHVlcyk7IFxyXG4gICAgICAgICAgcmVzdWx0LiQkdmFsdWVzID0gdmFsdWVzO1xyXG4gICAgICAgICAgcmVzdWx0LiQkcHJvbWlzZXMgPSByZXN1bHQuJCRwcm9taXNlcyB8fCB0cnVlOyAvLyBrZWVwIGZvciBpc1Jlc29sdmUoKVxyXG4gICAgICAgICAgZGVsZXRlIHJlc3VsdC4kJGluaGVyaXRlZFZhbHVlcztcclxuICAgICAgICAgIHJlc29sdXRpb24ucmVzb2x2ZSh2YWx1ZXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgZnVuY3Rpb24gZmFpbChyZWFzb24pIHtcclxuICAgICAgICByZXN1bHQuJCRmYWlsdXJlID0gcmVhc29uO1xyXG4gICAgICAgIHJlc29sdXRpb24ucmVqZWN0KHJlYXNvbik7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFNob3J0LWNpcmN1aXQgaWYgcGFyZW50IGhhcyBhbHJlYWR5IGZhaWxlZFxyXG4gICAgICBpZiAoaXNEZWZpbmVkKHBhcmVudC4kJGZhaWx1cmUpKSB7XHJcbiAgICAgICAgZmFpbChwYXJlbnQuJCRmYWlsdXJlKTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBpZiAocGFyZW50LiQkaW5oZXJpdGVkVmFsdWVzKSB7XHJcbiAgICAgICAgbWVyZ2UodmFsdWVzLCBvbWl0KHBhcmVudC4kJGluaGVyaXRlZFZhbHVlcywgaW52b2NhYmxlS2V5cykpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBNZXJnZSBwYXJlbnQgdmFsdWVzIGlmIHRoZSBwYXJlbnQgaGFzIGFscmVhZHkgcmVzb2x2ZWQsIG9yIG1lcmdlXHJcbiAgICAgIC8vIHBhcmVudCBwcm9taXNlcyBhbmQgd2FpdCBpZiB0aGUgcGFyZW50IHJlc29sdmUgaXMgc3RpbGwgaW4gcHJvZ3Jlc3MuXHJcbiAgICAgIGV4dGVuZChwcm9taXNlcywgcGFyZW50LiQkcHJvbWlzZXMpO1xyXG4gICAgICBpZiAocGFyZW50LiQkdmFsdWVzKSB7XHJcbiAgICAgICAgbWVyZ2VkID0gbWVyZ2UodmFsdWVzLCBvbWl0KHBhcmVudC4kJHZhbHVlcywgaW52b2NhYmxlS2V5cykpO1xyXG4gICAgICAgIHJlc3VsdC4kJGluaGVyaXRlZFZhbHVlcyA9IG9taXQocGFyZW50LiQkdmFsdWVzLCBpbnZvY2FibGVLZXlzKTtcclxuICAgICAgICBkb25lKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKHBhcmVudC4kJGluaGVyaXRlZFZhbHVlcykge1xyXG4gICAgICAgICAgcmVzdWx0LiQkaW5oZXJpdGVkVmFsdWVzID0gb21pdChwYXJlbnQuJCRpbmhlcml0ZWRWYWx1ZXMsIGludm9jYWJsZUtleXMpO1xyXG4gICAgICAgIH0gICAgICAgIFxyXG4gICAgICAgIHBhcmVudC50aGVuKGRvbmUsIGZhaWwpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBQcm9jZXNzIGVhY2ggaW52b2NhYmxlIGluIHRoZSBwbGFuLCBidXQgaWdub3JlIGFueSB3aGVyZSBhIGxvY2FsIG9mIHRoZSBzYW1lIG5hbWUgZXhpc3RzLlxyXG4gICAgICBmb3IgKHZhciBpPTAsIGlpPXBsYW4ubGVuZ3RoOyBpPGlpOyBpKz0zKSB7XHJcbiAgICAgICAgaWYgKGxvY2Fscy5oYXNPd25Qcm9wZXJ0eShwbGFuW2ldKSkgZG9uZSgpO1xyXG4gICAgICAgIGVsc2UgaW52b2tlKHBsYW5baV0sIHBsYW5baSsxXSwgcGxhbltpKzJdKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgZnVuY3Rpb24gaW52b2tlKGtleSwgaW52b2NhYmxlLCBwYXJhbXMpIHtcclxuICAgICAgICAvLyBDcmVhdGUgYSBkZWZlcnJlZCBmb3IgdGhpcyBpbnZvY2F0aW9uLiBGYWlsdXJlcyB3aWxsIHByb3BhZ2F0ZSB0byB0aGUgcmVzb2x1dGlvbiBhcyB3ZWxsLlxyXG4gICAgICAgIHZhciBpbnZvY2F0aW9uID0gJHEuZGVmZXIoKSwgd2FpdFBhcmFtcyA9IDA7XHJcbiAgICAgICAgZnVuY3Rpb24gb25mYWlsdXJlKHJlYXNvbikge1xyXG4gICAgICAgICAgaW52b2NhdGlvbi5yZWplY3QocmVhc29uKTtcclxuICAgICAgICAgIGZhaWwocmVhc29uKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gV2FpdCBmb3IgYW55IHBhcmFtZXRlciB0aGF0IHdlIGhhdmUgYSBwcm9taXNlIGZvciAoZWl0aGVyIGZyb20gcGFyZW50IG9yIGZyb20gdGhpc1xyXG4gICAgICAgIC8vIHJlc29sdmU7IGluIHRoYXQgY2FzZSBzdHVkeSgpIHdpbGwgaGF2ZSBtYWRlIHN1cmUgaXQncyBvcmRlcmVkIGJlZm9yZSB1cyBpbiB0aGUgcGxhbikuXHJcbiAgICAgICAgZm9yRWFjaChwYXJhbXMsIGZ1bmN0aW9uIChkZXApIHtcclxuICAgICAgICAgIGlmIChwcm9taXNlcy5oYXNPd25Qcm9wZXJ0eShkZXApICYmICFsb2NhbHMuaGFzT3duUHJvcGVydHkoZGVwKSkge1xyXG4gICAgICAgICAgICB3YWl0UGFyYW1zKys7XHJcbiAgICAgICAgICAgIHByb21pc2VzW2RlcF0udGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgdmFsdWVzW2RlcF0gPSByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgaWYgKCEoLS13YWl0UGFyYW1zKSkgcHJvY2VlZCgpO1xyXG4gICAgICAgICAgICB9LCBvbmZhaWx1cmUpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmICghd2FpdFBhcmFtcykgcHJvY2VlZCgpO1xyXG4gICAgICAgIGZ1bmN0aW9uIHByb2NlZWQoKSB7XHJcbiAgICAgICAgICBpZiAoaXNEZWZpbmVkKHJlc3VsdC4kJGZhaWx1cmUpKSByZXR1cm47XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpbnZvY2F0aW9uLnJlc29sdmUoJGluamVjdG9yLmludm9rZShpbnZvY2FibGUsIHNlbGYsIHZhbHVlcykpO1xyXG4gICAgICAgICAgICBpbnZvY2F0aW9uLnByb21pc2UudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgdmFsdWVzW2tleV0gPSByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgZG9uZSgpO1xyXG4gICAgICAgICAgICB9LCBvbmZhaWx1cmUpO1xyXG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBvbmZhaWx1cmUoZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFB1Ymxpc2ggcHJvbWlzZSBzeW5jaHJvbm91c2x5OyBpbnZvY2F0aW9ucyBmdXJ0aGVyIGRvd24gaW4gdGhlIHBsYW4gbWF5IGRlcGVuZCBvbiBpdC5cclxuICAgICAgICBwcm9taXNlc1trZXldID0gaW52b2NhdGlvbi5wcm9taXNlO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICB9O1xyXG4gIFxyXG4gIC8qKlxyXG4gICAqIEBuZ2RvYyBmdW5jdGlvblxyXG4gICAqIEBuYW1lIHVpLnJvdXRlci51dGlsLiRyZXNvbHZlI3Jlc29sdmVcclxuICAgKiBAbWV0aG9kT2YgdWkucm91dGVyLnV0aWwuJHJlc29sdmVcclxuICAgKlxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqIFJlc29sdmVzIGEgc2V0IG9mIGludm9jYWJsZXMuIEFuIGludm9jYWJsZSBpcyBhIGZ1bmN0aW9uIHRvIGJlIGludm9rZWQgdmlhIFxyXG4gICAqIGAkaW5qZWN0b3IuaW52b2tlKClgLCBhbmQgY2FuIGhhdmUgYW4gYXJiaXRyYXJ5IG51bWJlciBvZiBkZXBlbmRlbmNpZXMuIFxyXG4gICAqIEFuIGludm9jYWJsZSBjYW4gZWl0aGVyIHJldHVybiBhIHZhbHVlIGRpcmVjdGx5LFxyXG4gICAqIG9yIGEgYCRxYCBwcm9taXNlLiBJZiBhIHByb21pc2UgaXMgcmV0dXJuZWQgaXQgd2lsbCBiZSByZXNvbHZlZCBhbmQgdGhlIFxyXG4gICAqIHJlc3VsdGluZyB2YWx1ZSB3aWxsIGJlIHVzZWQgaW5zdGVhZC4gRGVwZW5kZW5jaWVzIG9mIGludm9jYWJsZXMgYXJlIHJlc29sdmVkIFxyXG4gICAqIChpbiB0aGlzIG9yZGVyIG9mIHByZWNlZGVuY2UpXHJcbiAgICpcclxuICAgKiAtIGZyb20gdGhlIHNwZWNpZmllZCBgbG9jYWxzYFxyXG4gICAqIC0gZnJvbSBhbm90aGVyIGludm9jYWJsZSB0aGF0IGlzIHBhcnQgb2YgdGhpcyBgJHJlc29sdmVgIGNhbGxcclxuICAgKiAtIGZyb20gYW4gaW52b2NhYmxlIHRoYXQgaXMgaW5oZXJpdGVkIGZyb20gYSBgcGFyZW50YCBjYWxsIHRvIGAkcmVzb2x2ZWAgXHJcbiAgICogICAob3IgcmVjdXJzaXZlbHlcclxuICAgKiAtIGZyb20gYW55IGFuY2VzdG9yIGAkcmVzb2x2ZWAgb2YgdGhhdCBwYXJlbnQpLlxyXG4gICAqXHJcbiAgICogVGhlIHJldHVybiB2YWx1ZSBvZiBgJHJlc29sdmVgIGlzIGEgcHJvbWlzZSBmb3IgYW4gb2JqZWN0IHRoYXQgY29udGFpbnMgXHJcbiAgICogKGluIHRoaXMgb3JkZXIgb2YgcHJlY2VkZW5jZSlcclxuICAgKlxyXG4gICAqIC0gYW55IGBsb2NhbHNgIChpZiBzcGVjaWZpZWQpXHJcbiAgICogLSB0aGUgcmVzb2x2ZWQgcmV0dXJuIHZhbHVlcyBvZiBhbGwgaW5qZWN0YWJsZXNcclxuICAgKiAtIGFueSB2YWx1ZXMgaW5oZXJpdGVkIGZyb20gYSBgcGFyZW50YCBjYWxsIHRvIGAkcmVzb2x2ZWAgKGlmIHNwZWNpZmllZClcclxuICAgKlxyXG4gICAqIFRoZSBwcm9taXNlIHdpbGwgcmVzb2x2ZSBhZnRlciB0aGUgYHBhcmVudGAgcHJvbWlzZSAoaWYgYW55KSBhbmQgYWxsIHByb21pc2VzIFxyXG4gICAqIHJldHVybmVkIGJ5IGluamVjdGFibGVzIGhhdmUgYmVlbiByZXNvbHZlZC4gSWYgYW55IGludm9jYWJsZSBcclxuICAgKiAob3IgYCRpbmplY3Rvci5pbnZva2VgKSB0aHJvd3MgYW4gZXhjZXB0aW9uLCBvciBpZiBhIHByb21pc2UgcmV0dXJuZWQgYnkgYW4gXHJcbiAgICogaW52b2NhYmxlIGlzIHJlamVjdGVkLCB0aGUgYCRyZXNvbHZlYCBwcm9taXNlIGlzIGltbWVkaWF0ZWx5IHJlamVjdGVkIHdpdGggdGhlIFxyXG4gICAqIHNhbWUgZXJyb3IuIEEgcmVqZWN0aW9uIG9mIGEgYHBhcmVudGAgcHJvbWlzZSAoaWYgc3BlY2lmaWVkKSB3aWxsIGxpa2V3aXNlIGJlIFxyXG4gICAqIHByb3BhZ2F0ZWQgaW1tZWRpYXRlbHkuIE9uY2UgdGhlIGAkcmVzb2x2ZWAgcHJvbWlzZSBoYXMgYmVlbiByZWplY3RlZCwgbm8gXHJcbiAgICogZnVydGhlciBpbnZvY2FibGVzIHdpbGwgYmUgY2FsbGVkLlxyXG4gICAqIFxyXG4gICAqIEN5Y2xpYyBkZXBlbmRlbmNpZXMgYmV0d2VlbiBpbnZvY2FibGVzIGFyZSBub3QgcGVybWl0dGVkIGFuZCB3aWxsIGNhdWVzIGAkcmVzb2x2ZWBcclxuICAgKiB0byB0aHJvdyBhbiBlcnJvci4gQXMgYSBzcGVjaWFsIGNhc2UsIGFuIGluamVjdGFibGUgY2FuIGRlcGVuZCBvbiBhIHBhcmFtZXRlciBcclxuICAgKiB3aXRoIHRoZSBzYW1lIG5hbWUgYXMgdGhlIGluamVjdGFibGUsIHdoaWNoIHdpbGwgYmUgZnVsZmlsbGVkIGZyb20gdGhlIGBwYXJlbnRgIFxyXG4gICAqIGluamVjdGFibGUgb2YgdGhlIHNhbWUgbmFtZS4gVGhpcyBhbGxvd3MgaW5oZXJpdGVkIHZhbHVlcyB0byBiZSBkZWNvcmF0ZWQuIFxyXG4gICAqIE5vdGUgdGhhdCBpbiB0aGlzIGNhc2UgYW55IG90aGVyIGluamVjdGFibGUgaW4gdGhlIHNhbWUgYCRyZXNvbHZlYCB3aXRoIHRoZSBzYW1lXHJcbiAgICogZGVwZW5kZW5jeSB3b3VsZCBzZWUgdGhlIGRlY29yYXRlZCB2YWx1ZSwgbm90IHRoZSBpbmhlcml0ZWQgdmFsdWUuXHJcbiAgICpcclxuICAgKiBOb3RlIHRoYXQgbWlzc2luZyBkZXBlbmRlbmNpZXMgLS0gdW5saWtlIGN5Y2xpYyBkZXBlbmRlbmNpZXMgLS0gd2lsbCBjYXVzZSBhbiBcclxuICAgKiAoYXN5bmNocm9ub3VzKSByZWplY3Rpb24gb2YgdGhlIGAkcmVzb2x2ZWAgcHJvbWlzZSByYXRoZXIgdGhhbiBhIChzeW5jaHJvbm91cykgXHJcbiAgICogZXhjZXB0aW9uLlxyXG4gICAqXHJcbiAgICogSW52b2NhYmxlcyBhcmUgaW52b2tlZCBlYWdlcmx5IGFzIHNvb24gYXMgYWxsIGRlcGVuZGVuY2llcyBhcmUgYXZhaWxhYmxlLiBcclxuICAgKiBUaGlzIGlzIHRydWUgZXZlbiBmb3IgZGVwZW5kZW5jaWVzIGluaGVyaXRlZCBmcm9tIGEgYHBhcmVudGAgY2FsbCB0byBgJHJlc29sdmVgLlxyXG4gICAqXHJcbiAgICogQXMgYSBzcGVjaWFsIGNhc2UsIGFuIGludm9jYWJsZSBjYW4gYmUgYSBzdHJpbmcsIGluIHdoaWNoIGNhc2UgaXQgaXMgdGFrZW4gdG8gXHJcbiAgICogYmUgYSBzZXJ2aWNlIG5hbWUgdG8gYmUgcGFzc2VkIHRvIGAkaW5qZWN0b3IuZ2V0KClgLiBUaGlzIGlzIHN1cHBvcnRlZCBwcmltYXJpbHkgXHJcbiAgICogZm9yIGJhY2t3YXJkcy1jb21wYXRpYmlsaXR5IHdpdGggdGhlIGByZXNvbHZlYCBwcm9wZXJ0eSBvZiBgJHJvdXRlUHJvdmlkZXJgIFxyXG4gICAqIHJvdXRlcy5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBpbnZvY2FibGVzIGZ1bmN0aW9ucyB0byBpbnZva2Ugb3IgXHJcbiAgICogYCRpbmplY3RvcmAgc2VydmljZXMgdG8gZmV0Y2guXHJcbiAgICogQHBhcmFtIHtvYmplY3R9IGxvY2FscyAgdmFsdWVzIHRvIG1ha2UgYXZhaWxhYmxlIHRvIHRoZSBpbmplY3RhYmxlc1xyXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBwYXJlbnQgIGEgcHJvbWlzZSByZXR1cm5lZCBieSBhbm90aGVyIGNhbGwgdG8gYCRyZXNvbHZlYC5cclxuICAgKiBAcGFyYW0ge29iamVjdH0gc2VsZiAgdGhlIGB0aGlzYCBmb3IgdGhlIGludm9rZWQgbWV0aG9kc1xyXG4gICAqIEByZXR1cm4ge29iamVjdH0gUHJvbWlzZSBmb3IgYW4gb2JqZWN0IHRoYXQgY29udGFpbnMgdGhlIHJlc29sdmVkIHJldHVybiB2YWx1ZVxyXG4gICAqIG9mIGFsbCBpbnZvY2FibGVzLCBhcyB3ZWxsIGFzIGFueSBpbmhlcml0ZWQgYW5kIGxvY2FsIHZhbHVlcy5cclxuICAgKi9cclxuICB0aGlzLnJlc29sdmUgPSBmdW5jdGlvbiAoaW52b2NhYmxlcywgbG9jYWxzLCBwYXJlbnQsIHNlbGYpIHtcclxuICAgIHJldHVybiB0aGlzLnN0dWR5KGludm9jYWJsZXMpKGxvY2FscywgcGFyZW50LCBzZWxmKTtcclxuICB9O1xyXG59XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgndWkucm91dGVyLnV0aWwnKS5zZXJ2aWNlKCckcmVzb2x2ZScsICRSZXNvbHZlKTtcclxuXHJcblxyXG4vKipcclxuICogQG5nZG9jIG9iamVjdFxyXG4gKiBAbmFtZSB1aS5yb3V0ZXIudXRpbC4kdGVtcGxhdGVGYWN0b3J5XHJcbiAqXHJcbiAqIEByZXF1aXJlcyAkaHR0cFxyXG4gKiBAcmVxdWlyZXMgJHRlbXBsYXRlQ2FjaGVcclxuICogQHJlcXVpcmVzICRpbmplY3RvclxyXG4gKlxyXG4gKiBAZGVzY3JpcHRpb25cclxuICogU2VydmljZS4gTWFuYWdlcyBsb2FkaW5nIG9mIHRlbXBsYXRlcy5cclxuICovXHJcbiRUZW1wbGF0ZUZhY3RvcnkuJGluamVjdCA9IFsnJGh0dHAnLCAnJHRlbXBsYXRlQ2FjaGUnLCAnJGluamVjdG9yJ107XHJcbmZ1bmN0aW9uICRUZW1wbGF0ZUZhY3RvcnkoICAkaHR0cCwgICAkdGVtcGxhdGVDYWNoZSwgICAkaW5qZWN0b3IpIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQG5nZG9jIGZ1bmN0aW9uXHJcbiAgICogQG5hbWUgdWkucm91dGVyLnV0aWwuJHRlbXBsYXRlRmFjdG9yeSNmcm9tQ29uZmlnXHJcbiAgICogQG1ldGhvZE9mIHVpLnJvdXRlci51dGlsLiR0ZW1wbGF0ZUZhY3RvcnlcclxuICAgKlxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqIENyZWF0ZXMgYSB0ZW1wbGF0ZSBmcm9tIGEgY29uZmlndXJhdGlvbiBvYmplY3QuIFxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtvYmplY3R9IGNvbmZpZyBDb25maWd1cmF0aW9uIG9iamVjdCBmb3Igd2hpY2ggdG8gbG9hZCBhIHRlbXBsYXRlLiBcclxuICAgKiBUaGUgZm9sbG93aW5nIHByb3BlcnRpZXMgYXJlIHNlYXJjaCBpbiB0aGUgc3BlY2lmaWVkIG9yZGVyLCBhbmQgdGhlIGZpcnN0IG9uZSBcclxuICAgKiB0aGF0IGlzIGRlZmluZWQgaXMgdXNlZCB0byBjcmVhdGUgdGhlIHRlbXBsYXRlOlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtzdHJpbmd8b2JqZWN0fSBjb25maWcudGVtcGxhdGUgaHRtbCBzdHJpbmcgdGVtcGxhdGUgb3IgZnVuY3Rpb24gdG8gXHJcbiAgICogbG9hZCB2aWEge0BsaW5rIHVpLnJvdXRlci51dGlsLiR0ZW1wbGF0ZUZhY3RvcnkjZnJvbVN0cmluZyBmcm9tU3RyaW5nfS5cclxuICAgKiBAcGFyYW0ge3N0cmluZ3xvYmplY3R9IGNvbmZpZy50ZW1wbGF0ZVVybCB1cmwgdG8gbG9hZCBvciBhIGZ1bmN0aW9uIHJldHVybmluZyBcclxuICAgKiB0aGUgdXJsIHRvIGxvYWQgdmlhIHtAbGluayB1aS5yb3V0ZXIudXRpbC4kdGVtcGxhdGVGYWN0b3J5I2Zyb21VcmwgZnJvbVVybH0uXHJcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY29uZmlnLnRlbXBsYXRlUHJvdmlkZXIgZnVuY3Rpb24gdG8gaW52b2tlIHZpYSBcclxuICAgKiB7QGxpbmsgdWkucm91dGVyLnV0aWwuJHRlbXBsYXRlRmFjdG9yeSNmcm9tUHJvdmlkZXIgZnJvbVByb3ZpZGVyfS5cclxuICAgKiBAcGFyYW0ge29iamVjdH0gcGFyYW1zICBQYXJhbWV0ZXJzIHRvIHBhc3MgdG8gdGhlIHRlbXBsYXRlIGZ1bmN0aW9uLlxyXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBsb2NhbHMgTG9jYWxzIHRvIHBhc3MgdG8gYGludm9rZWAgaWYgdGhlIHRlbXBsYXRlIGlzIGxvYWRlZCBcclxuICAgKiB2aWEgYSBgdGVtcGxhdGVQcm92aWRlcmAuIERlZmF1bHRzIHRvIGB7IHBhcmFtczogcGFyYW1zIH1gLlxyXG4gICAqXHJcbiAgICogQHJldHVybiB7c3RyaW5nfG9iamVjdH0gIFRoZSB0ZW1wbGF0ZSBodG1sIGFzIGEgc3RyaW5nLCBvciBhIHByb21pc2UgZm9yIFxyXG4gICAqIHRoYXQgc3RyaW5nLG9yIGBudWxsYCBpZiBubyB0ZW1wbGF0ZSBpcyBjb25maWd1cmVkLlxyXG4gICAqL1xyXG4gIHRoaXMuZnJvbUNvbmZpZyA9IGZ1bmN0aW9uIChjb25maWcsIHBhcmFtcywgbG9jYWxzKSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICBpc0RlZmluZWQoY29uZmlnLnRlbXBsYXRlKSA/IHRoaXMuZnJvbVN0cmluZyhjb25maWcudGVtcGxhdGUsIHBhcmFtcykgOlxyXG4gICAgICBpc0RlZmluZWQoY29uZmlnLnRlbXBsYXRlVXJsKSA/IHRoaXMuZnJvbVVybChjb25maWcudGVtcGxhdGVVcmwsIHBhcmFtcykgOlxyXG4gICAgICBpc0RlZmluZWQoY29uZmlnLnRlbXBsYXRlUHJvdmlkZXIpID8gdGhpcy5mcm9tUHJvdmlkZXIoY29uZmlnLnRlbXBsYXRlUHJvdmlkZXIsIHBhcmFtcywgbG9jYWxzKSA6XHJcbiAgICAgIG51bGxcclxuICAgICk7XHJcbiAgfTtcclxuXHJcbiAgLyoqXHJcbiAgICogQG5nZG9jIGZ1bmN0aW9uXHJcbiAgICogQG5hbWUgdWkucm91dGVyLnV0aWwuJHRlbXBsYXRlRmFjdG9yeSNmcm9tU3RyaW5nXHJcbiAgICogQG1ldGhvZE9mIHVpLnJvdXRlci51dGlsLiR0ZW1wbGF0ZUZhY3RvcnlcclxuICAgKlxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqIENyZWF0ZXMgYSB0ZW1wbGF0ZSBmcm9tIGEgc3RyaW5nIG9yIGEgZnVuY3Rpb24gcmV0dXJuaW5nIGEgc3RyaW5nLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtzdHJpbmd8b2JqZWN0fSB0ZW1wbGF0ZSBodG1sIHRlbXBsYXRlIGFzIGEgc3RyaW5nIG9yIGZ1bmN0aW9uIHRoYXQgXHJcbiAgICogcmV0dXJucyBhbiBodG1sIHRlbXBsYXRlIGFzIGEgc3RyaW5nLlxyXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBwYXJhbXMgUGFyYW1ldGVycyB0byBwYXNzIHRvIHRoZSB0ZW1wbGF0ZSBmdW5jdGlvbi5cclxuICAgKlxyXG4gICAqIEByZXR1cm4ge3N0cmluZ3xvYmplY3R9IFRoZSB0ZW1wbGF0ZSBodG1sIGFzIGEgc3RyaW5nLCBvciBhIHByb21pc2UgZm9yIHRoYXQgXHJcbiAgICogc3RyaW5nLlxyXG4gICAqL1xyXG4gIHRoaXMuZnJvbVN0cmluZyA9IGZ1bmN0aW9uICh0ZW1wbGF0ZSwgcGFyYW1zKSB7XHJcbiAgICByZXR1cm4gaXNGdW5jdGlvbih0ZW1wbGF0ZSkgPyB0ZW1wbGF0ZShwYXJhbXMpIDogdGVtcGxhdGU7XHJcbiAgfTtcclxuXHJcbiAgLyoqXHJcbiAgICogQG5nZG9jIGZ1bmN0aW9uXHJcbiAgICogQG5hbWUgdWkucm91dGVyLnV0aWwuJHRlbXBsYXRlRmFjdG9yeSNmcm9tVXJsXHJcbiAgICogQG1ldGhvZE9mIHVpLnJvdXRlci51dGlsLiR0ZW1wbGF0ZUZhY3RvcnlcclxuICAgKiBcclxuICAgKiBAZGVzY3JpcHRpb25cclxuICAgKiBMb2FkcyBhIHRlbXBsYXRlIGZyb20gdGhlIGEgVVJMIHZpYSBgJGh0dHBgIGFuZCBgJHRlbXBsYXRlQ2FjaGVgLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtzdHJpbmd8RnVuY3Rpb259IHVybCB1cmwgb2YgdGhlIHRlbXBsYXRlIHRvIGxvYWQsIG9yIGEgZnVuY3Rpb24gXHJcbiAgICogdGhhdCByZXR1cm5zIGEgdXJsLlxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBwYXJhbXMgUGFyYW1ldGVycyB0byBwYXNzIHRvIHRoZSB1cmwgZnVuY3Rpb24uXHJcbiAgICogQHJldHVybiB7c3RyaW5nfFByb21pc2UuPHN0cmluZz59IFRoZSB0ZW1wbGF0ZSBodG1sIGFzIGEgc3RyaW5nLCBvciBhIHByb21pc2UgXHJcbiAgICogZm9yIHRoYXQgc3RyaW5nLlxyXG4gICAqL1xyXG4gIHRoaXMuZnJvbVVybCA9IGZ1bmN0aW9uICh1cmwsIHBhcmFtcykge1xyXG4gICAgaWYgKGlzRnVuY3Rpb24odXJsKSkgdXJsID0gdXJsKHBhcmFtcyk7XHJcbiAgICBpZiAodXJsID09IG51bGwpIHJldHVybiBudWxsO1xyXG4gICAgZWxzZSByZXR1cm4gJGh0dHBcclxuICAgICAgICAuZ2V0KHVybCwgeyBjYWNoZTogJHRlbXBsYXRlQ2FjaGUsIGhlYWRlcnM6IHsgQWNjZXB0OiAndGV4dC9odG1sJyB9fSlcclxuICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkgeyByZXR1cm4gcmVzcG9uc2UuZGF0YTsgfSk7XHJcbiAgfTtcclxuXHJcbiAgLyoqXHJcbiAgICogQG5nZG9jIGZ1bmN0aW9uXHJcbiAgICogQG5hbWUgdWkucm91dGVyLnV0aWwuJHRlbXBsYXRlRmFjdG9yeSNmcm9tUHJvdmlkZXJcclxuICAgKiBAbWV0aG9kT2YgdWkucm91dGVyLnV0aWwuJHRlbXBsYXRlRmFjdG9yeVxyXG4gICAqXHJcbiAgICogQGRlc2NyaXB0aW9uXHJcbiAgICogQ3JlYXRlcyBhIHRlbXBsYXRlIGJ5IGludm9raW5nIGFuIGluamVjdGFibGUgcHJvdmlkZXIgZnVuY3Rpb24uXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBwcm92aWRlciBGdW5jdGlvbiB0byBpbnZva2UgdmlhIGAkaW5qZWN0b3IuaW52b2tlYFxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBwYXJhbXMgUGFyYW1ldGVycyBmb3IgdGhlIHRlbXBsYXRlLlxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBsb2NhbHMgTG9jYWxzIHRvIHBhc3MgdG8gYGludm9rZWAuIERlZmF1bHRzIHRvIFxyXG4gICAqIGB7IHBhcmFtczogcGFyYW1zIH1gLlxyXG4gICAqIEByZXR1cm4ge3N0cmluZ3xQcm9taXNlLjxzdHJpbmc+fSBUaGUgdGVtcGxhdGUgaHRtbCBhcyBhIHN0cmluZywgb3IgYSBwcm9taXNlIFxyXG4gICAqIGZvciB0aGF0IHN0cmluZy5cclxuICAgKi9cclxuICB0aGlzLmZyb21Qcm92aWRlciA9IGZ1bmN0aW9uIChwcm92aWRlciwgcGFyYW1zLCBsb2NhbHMpIHtcclxuICAgIHJldHVybiAkaW5qZWN0b3IuaW52b2tlKHByb3ZpZGVyLCBudWxsLCBsb2NhbHMgfHwgeyBwYXJhbXM6IHBhcmFtcyB9KTtcclxuICB9O1xyXG59XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgndWkucm91dGVyLnV0aWwnKS5zZXJ2aWNlKCckdGVtcGxhdGVGYWN0b3J5JywgJFRlbXBsYXRlRmFjdG9yeSk7XHJcblxyXG52YXIgJCRVTUZQOyAvLyByZWZlcmVuY2UgdG8gJFVybE1hdGNoZXJGYWN0b3J5UHJvdmlkZXJcclxuXHJcbi8qKlxyXG4gKiBAbmdkb2Mgb2JqZWN0XHJcbiAqIEBuYW1lIHVpLnJvdXRlci51dGlsLnR5cGU6VXJsTWF0Y2hlclxyXG4gKlxyXG4gKiBAZGVzY3JpcHRpb25cclxuICogTWF0Y2hlcyBVUkxzIGFnYWluc3QgcGF0dGVybnMgYW5kIGV4dHJhY3RzIG5hbWVkIHBhcmFtZXRlcnMgZnJvbSB0aGUgcGF0aCBvciB0aGUgc2VhcmNoXHJcbiAqIHBhcnQgb2YgdGhlIFVSTC4gQSBVUkwgcGF0dGVybiBjb25zaXN0cyBvZiBhIHBhdGggcGF0dGVybiwgb3B0aW9uYWxseSBmb2xsb3dlZCBieSAnPycgYW5kIGEgbGlzdFxyXG4gKiBvZiBzZWFyY2ggcGFyYW1ldGVycy4gTXVsdGlwbGUgc2VhcmNoIHBhcmFtZXRlciBuYW1lcyBhcmUgc2VwYXJhdGVkIGJ5ICcmJy4gU2VhcmNoIHBhcmFtZXRlcnNcclxuICogZG8gbm90IGluZmx1ZW5jZSB3aGV0aGVyIG9yIG5vdCBhIFVSTCBpcyBtYXRjaGVkLCBidXQgdGhlaXIgdmFsdWVzIGFyZSBwYXNzZWQgdGhyb3VnaCBpbnRvXHJcbiAqIHRoZSBtYXRjaGVkIHBhcmFtZXRlcnMgcmV0dXJuZWQgYnkge0BsaW5rIHVpLnJvdXRlci51dGlsLnR5cGU6VXJsTWF0Y2hlciNtZXRob2RzX2V4ZWMgZXhlY30uXHJcbiAqIFxyXG4gKiBQYXRoIHBhcmFtZXRlciBwbGFjZWhvbGRlcnMgY2FuIGJlIHNwZWNpZmllZCB1c2luZyBzaW1wbGUgY29sb24vY2F0Y2gtYWxsIHN5bnRheCBvciBjdXJseSBicmFjZVxyXG4gKiBzeW50YXgsIHdoaWNoIG9wdGlvbmFsbHkgYWxsb3dzIGEgcmVndWxhciBleHByZXNzaW9uIGZvciB0aGUgcGFyYW1ldGVyIHRvIGJlIHNwZWNpZmllZDpcclxuICpcclxuICogKiBgJzonYCBuYW1lIC0gY29sb24gcGxhY2Vob2xkZXJcclxuICogKiBgJyonYCBuYW1lIC0gY2F0Y2gtYWxsIHBsYWNlaG9sZGVyXHJcbiAqICogYCd7JyBuYW1lICd9J2AgLSBjdXJseSBwbGFjZWhvbGRlclxyXG4gKiAqIGAneycgbmFtZSAnOicgcmVnZXhwfHR5cGUgJ30nYCAtIGN1cmx5IHBsYWNlaG9sZGVyIHdpdGggcmVnZXhwIG9yIHR5cGUgbmFtZS4gU2hvdWxkIHRoZVxyXG4gKiAgIHJlZ2V4cCBpdHNlbGYgY29udGFpbiBjdXJseSBicmFjZXMsIHRoZXkgbXVzdCBiZSBpbiBtYXRjaGVkIHBhaXJzIG9yIGVzY2FwZWQgd2l0aCBhIGJhY2tzbGFzaC5cclxuICpcclxuICogUGFyYW1ldGVyIG5hbWVzIG1heSBjb250YWluIG9ubHkgd29yZCBjaGFyYWN0ZXJzIChsYXRpbiBsZXR0ZXJzLCBkaWdpdHMsIGFuZCB1bmRlcnNjb3JlKSBhbmRcclxuICogbXVzdCBiZSB1bmlxdWUgd2l0aGluIHRoZSBwYXR0ZXJuIChhY3Jvc3MgYm90aCBwYXRoIGFuZCBzZWFyY2ggcGFyYW1ldGVycykuIEZvciBjb2xvbiBcclxuICogcGxhY2Vob2xkZXJzIG9yIGN1cmx5IHBsYWNlaG9sZGVycyB3aXRob3V0IGFuIGV4cGxpY2l0IHJlZ2V4cCwgYSBwYXRoIHBhcmFtZXRlciBtYXRjaGVzIGFueVxyXG4gKiBudW1iZXIgb2YgY2hhcmFjdGVycyBvdGhlciB0aGFuICcvJy4gRm9yIGNhdGNoLWFsbCBwbGFjZWhvbGRlcnMgdGhlIHBhdGggcGFyYW1ldGVyIG1hdGNoZXNcclxuICogYW55IG51bWJlciBvZiBjaGFyYWN0ZXJzLlxyXG4gKiBcclxuICogRXhhbXBsZXM6XHJcbiAqIFxyXG4gKiAqIGAnL2hlbGxvLydgIC0gTWF0Y2hlcyBvbmx5IGlmIHRoZSBwYXRoIGlzIGV4YWN0bHkgJy9oZWxsby8nLiBUaGVyZSBpcyBubyBzcGVjaWFsIHRyZWF0bWVudCBmb3JcclxuICogICB0cmFpbGluZyBzbGFzaGVzLCBhbmQgcGF0dGVybnMgaGF2ZSB0byBtYXRjaCB0aGUgZW50aXJlIHBhdGgsIG5vdCBqdXN0IGEgcHJlZml4LlxyXG4gKiAqIGAnL3VzZXIvOmlkJ2AgLSBNYXRjaGVzICcvdXNlci9ib2InIG9yICcvdXNlci8xMjM0ISEhJyBvciBldmVuICcvdXNlci8nIGJ1dCBub3QgJy91c2VyJyBvclxyXG4gKiAgICcvdXNlci9ib2IvZGV0YWlscycuIFRoZSBzZWNvbmQgcGF0aCBzZWdtZW50IHdpbGwgYmUgY2FwdHVyZWQgYXMgdGhlIHBhcmFtZXRlciAnaWQnLlxyXG4gKiAqIGAnL3VzZXIve2lkfSdgIC0gU2FtZSBhcyB0aGUgcHJldmlvdXMgZXhhbXBsZSwgYnV0IHVzaW5nIGN1cmx5IGJyYWNlIHN5bnRheC5cclxuICogKiBgJy91c2VyL3tpZDpbXi9dKn0nYCAtIFNhbWUgYXMgdGhlIHByZXZpb3VzIGV4YW1wbGUuXHJcbiAqICogYCcvdXNlci97aWQ6WzAtOWEtZkEtRl17MSw4fX0nYCAtIFNpbWlsYXIgdG8gdGhlIHByZXZpb3VzIGV4YW1wbGUsIGJ1dCBvbmx5IG1hdGNoZXMgaWYgdGhlIGlkXHJcbiAqICAgcGFyYW1ldGVyIGNvbnNpc3RzIG9mIDEgdG8gOCBoZXggZGlnaXRzLlxyXG4gKiAqIGAnL2ZpbGVzL3twYXRoOi4qfSdgIC0gTWF0Y2hlcyBhbnkgVVJMIHN0YXJ0aW5nIHdpdGggJy9maWxlcy8nIGFuZCBjYXB0dXJlcyB0aGUgcmVzdCBvZiB0aGVcclxuICogICBwYXRoIGludG8gdGhlIHBhcmFtZXRlciAncGF0aCcuXHJcbiAqICogYCcvZmlsZXMvKnBhdGgnYCAtIGRpdHRvLlxyXG4gKiAqIGAnL2NhbGVuZGFyL3tzdGFydDpkYXRlfSdgIC0gTWF0Y2hlcyBcIi9jYWxlbmRhci8yMDE0LTExLTEyXCIgKGJlY2F1c2UgdGhlIHBhdHRlcm4gZGVmaW5lZFxyXG4gKiAgIGluIHRoZSBidWlsdC1pbiAgYGRhdGVgIFR5cGUgbWF0Y2hlcyBgMjAxNC0xMS0xMmApIGFuZCBwcm92aWRlcyBhIERhdGUgb2JqZWN0IGluICRzdGF0ZVBhcmFtcy5zdGFydFxyXG4gKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0dGVybiAgVGhlIHBhdHRlcm4gdG8gY29tcGlsZSBpbnRvIGEgbWF0Y2hlci5cclxuICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyAgQSBjb25maWd1cmF0aW9uIG9iamVjdCBoYXNoOlxyXG4gKiBAcGFyYW0ge09iamVjdD19IHBhcmVudE1hdGNoZXIgVXNlZCB0byBjb25jYXRlbmF0ZSB0aGUgcGF0dGVybi9jb25maWcgb250b1xyXG4gKiAgIGFuIGV4aXN0aW5nIFVybE1hdGNoZXJcclxuICpcclxuICogKiBgY2FzZUluc2Vuc2l0aXZlYCAtIGB0cnVlYCBpZiBVUkwgbWF0Y2hpbmcgc2hvdWxkIGJlIGNhc2UgaW5zZW5zaXRpdmUsIG90aGVyd2lzZSBgZmFsc2VgLCB0aGUgZGVmYXVsdCB2YWx1ZSAoZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkpIGlzIGBmYWxzZWAuXHJcbiAqICogYHN0cmljdGAgLSBgZmFsc2VgIGlmIG1hdGNoaW5nIGFnYWluc3QgYSBVUkwgd2l0aCBhIHRyYWlsaW5nIHNsYXNoIHNob3VsZCBiZSB0cmVhdGVkIGFzIGVxdWl2YWxlbnQgdG8gYSBVUkwgd2l0aG91dCBhIHRyYWlsaW5nIHNsYXNoLCB0aGUgZGVmYXVsdCB2YWx1ZSBpcyBgdHJ1ZWAuXHJcbiAqXHJcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBwcmVmaXggIEEgc3RhdGljIHByZWZpeCBvZiB0aGlzIHBhdHRlcm4uIFRoZSBtYXRjaGVyIGd1YXJhbnRlZXMgdGhhdCBhbnlcclxuICogICBVUkwgbWF0Y2hpbmcgdGhpcyBtYXRjaGVyIChpLmUuIGFueSBzdHJpbmcgZm9yIHdoaWNoIHtAbGluayB1aS5yb3V0ZXIudXRpbC50eXBlOlVybE1hdGNoZXIjbWV0aG9kc19leGVjIGV4ZWMoKX0gcmV0dXJuc1xyXG4gKiAgIG5vbi1udWxsKSB3aWxsIHN0YXJ0IHdpdGggdGhpcyBwcmVmaXguXHJcbiAqXHJcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBzb3VyY2UgIFRoZSBwYXR0ZXJuIHRoYXQgd2FzIHBhc3NlZCBpbnRvIHRoZSBjb25zdHJ1Y3RvclxyXG4gKlxyXG4gKiBAcHJvcGVydHkge3N0cmluZ30gc291cmNlUGF0aCAgVGhlIHBhdGggcG9ydGlvbiBvZiB0aGUgc291cmNlIHByb3BlcnR5XHJcbiAqXHJcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBzb3VyY2VTZWFyY2ggIFRoZSBzZWFyY2ggcG9ydGlvbiBvZiB0aGUgc291cmNlIHByb3BlcnR5XHJcbiAqXHJcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSByZWdleCAgVGhlIGNvbnN0cnVjdGVkIHJlZ2V4IHRoYXQgd2lsbCBiZSB1c2VkIHRvIG1hdGNoIGFnYWluc3QgdGhlIHVybCB3aGVuIFxyXG4gKiAgIGl0IGlzIHRpbWUgdG8gZGV0ZXJtaW5lIHdoaWNoIHVybCB3aWxsIG1hdGNoLlxyXG4gKlxyXG4gKiBAcmV0dXJucyB7T2JqZWN0fSAgTmV3IGBVcmxNYXRjaGVyYCBvYmplY3RcclxuICovXHJcbmZ1bmN0aW9uIFVybE1hdGNoZXIocGF0dGVybiwgY29uZmlnLCBwYXJlbnRNYXRjaGVyKSB7XHJcbiAgY29uZmlnID0gZXh0ZW5kKHsgcGFyYW1zOiB7fSB9LCBpc09iamVjdChjb25maWcpID8gY29uZmlnIDoge30pO1xyXG5cclxuICAvLyBGaW5kIGFsbCBwbGFjZWhvbGRlcnMgYW5kIGNyZWF0ZSBhIGNvbXBpbGVkIHBhdHRlcm4sIHVzaW5nIGVpdGhlciBjbGFzc2ljIG9yIGN1cmx5IHN5bnRheDpcclxuICAvLyAgICcqJyBuYW1lXHJcbiAgLy8gICAnOicgbmFtZVxyXG4gIC8vICAgJ3snIG5hbWUgJ30nXHJcbiAgLy8gICAneycgbmFtZSAnOicgcmVnZXhwICd9J1xyXG4gIC8vIFRoZSByZWd1bGFyIGV4cHJlc3Npb24gaXMgc29tZXdoYXQgY29tcGxpY2F0ZWQgZHVlIHRvIHRoZSBuZWVkIHRvIGFsbG93IGN1cmx5IGJyYWNlc1xyXG4gIC8vIGluc2lkZSB0aGUgcmVndWxhciBleHByZXNzaW9uLiBUaGUgcGxhY2Vob2xkZXIgcmVnZXhwIGJyZWFrcyBkb3duIGFzIGZvbGxvd3M6XHJcbiAgLy8gICAgKFs6Kl0pKFtcXHdcXFtcXF1dKykgICAgICAgICAgICAgIC0gY2xhc3NpYyBwbGFjZWhvbGRlciAoJDEgLyAkMikgKHNlYXJjaCB2ZXJzaW9uIGhhcyAtIGZvciBzbmFrZS1jYXNlKVxyXG4gIC8vICAgIFxceyhbXFx3XFxbXFxdXSspKD86XFw6KCAuLi4gKSk/XFx9ICAtIGN1cmx5IGJyYWNlIHBsYWNlaG9sZGVyICgkMykgd2l0aCBvcHRpb25hbCByZWdleHAvdHlwZSAuLi4gKCQ0KSAoc2VhcmNoIHZlcnNpb24gaGFzIC0gZm9yIHNuYWtlLWNhc2VcclxuICAvLyAgICAoPzogLi4uIHwgLi4uIHwgLi4uICkrICAgICAgICAgLSB0aGUgcmVnZXhwIGNvbnNpc3RzIG9mIGFueSBudW1iZXIgb2YgYXRvbXMsIGFuIGF0b20gYmVpbmcgZWl0aGVyXHJcbiAgLy8gICAgW157fVxcXFxdKyAgICAgICAgICAgICAgICAgICAgICAgLSBhbnl0aGluZyBvdGhlciB0aGFuIGN1cmx5IGJyYWNlcyBvciBiYWNrc2xhc2hcclxuICAvLyAgICBcXFxcLiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIGEgYmFja3NsYXNoIGVzY2FwZVxyXG4gIC8vICAgIFxceyg/Oltee31cXFxcXSt8XFxcXC4pKlxcfSAgICAgICAgICAtIGEgbWF0Y2hlZCBzZXQgb2YgY3VybHkgYnJhY2VzIGNvbnRhaW5pbmcgb3RoZXIgYXRvbXNcclxuICB2YXIgcGxhY2Vob2xkZXIgICAgICAgPSAvKFs6Kl0pKFtcXHdcXFtcXF1dKyl8XFx7KFtcXHdcXFtcXF1dKykoPzpcXDooKD86W157fVxcXFxdK3xcXFxcLnxcXHsoPzpbXnt9XFxcXF0rfFxcXFwuKSpcXH0pKykpP1xcfS9nLFxyXG4gICAgICBzZWFyY2hQbGFjZWhvbGRlciA9IC8oWzpdPykoW1xcd1xcW1xcXS1dKyl8XFx7KFtcXHdcXFtcXF0tXSspKD86XFw6KCg/Oltee31cXFxcXSt8XFxcXC58XFx7KD86W157fVxcXFxdK3xcXFxcLikqXFx9KSspKT9cXH0vZyxcclxuICAgICAgY29tcGlsZWQgPSAnXicsIGxhc3QgPSAwLCBtLFxyXG4gICAgICBzZWdtZW50cyA9IHRoaXMuc2VnbWVudHMgPSBbXSxcclxuICAgICAgcGFyZW50UGFyYW1zID0gcGFyZW50TWF0Y2hlciA/IHBhcmVudE1hdGNoZXIucGFyYW1zIDoge30sXHJcbiAgICAgIHBhcmFtcyA9IHRoaXMucGFyYW1zID0gcGFyZW50TWF0Y2hlciA/IHBhcmVudE1hdGNoZXIucGFyYW1zLiQkbmV3KCkgOiBuZXcgJCRVTUZQLlBhcmFtU2V0KCksXHJcbiAgICAgIHBhcmFtTmFtZXMgPSBbXTtcclxuXHJcbiAgZnVuY3Rpb24gYWRkUGFyYW1ldGVyKGlkLCB0eXBlLCBjb25maWcsIGxvY2F0aW9uKSB7XHJcbiAgICBwYXJhbU5hbWVzLnB1c2goaWQpO1xyXG4gICAgaWYgKHBhcmVudFBhcmFtc1tpZF0pIHJldHVybiBwYXJlbnRQYXJhbXNbaWRdO1xyXG4gICAgaWYgKCEvXlxcdysoLStcXHcrKSooPzpcXFtcXF0pPyQvLnRlc3QoaWQpKSB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHBhcmFtZXRlciBuYW1lICdcIiArIGlkICsgXCInIGluIHBhdHRlcm4gJ1wiICsgcGF0dGVybiArIFwiJ1wiKTtcclxuICAgIGlmIChwYXJhbXNbaWRdKSB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgcGFyYW1ldGVyIG5hbWUgJ1wiICsgaWQgKyBcIicgaW4gcGF0dGVybiAnXCIgKyBwYXR0ZXJuICsgXCInXCIpO1xyXG4gICAgcGFyYW1zW2lkXSA9IG5ldyAkJFVNRlAuUGFyYW0oaWQsIHR5cGUsIGNvbmZpZywgbG9jYXRpb24pO1xyXG4gICAgcmV0dXJuIHBhcmFtc1tpZF07XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBxdW90ZVJlZ0V4cChzdHJpbmcsIHBhdHRlcm4sIHNxdWFzaCkge1xyXG4gICAgdmFyIHN1cnJvdW5kUGF0dGVybiA9IFsnJywnJ10sIHJlc3VsdCA9IHN0cmluZy5yZXBsYWNlKC9bXFxcXFxcW1xcXVxcXiQqKz8uKCl8e31dL2csIFwiXFxcXCQmXCIpO1xyXG4gICAgaWYgKCFwYXR0ZXJuKSByZXR1cm4gcmVzdWx0O1xyXG4gICAgc3dpdGNoKHNxdWFzaCkge1xyXG4gICAgICBjYXNlIGZhbHNlOiBzdXJyb3VuZFBhdHRlcm4gPSBbJygnLCAnKSddOyAgIGJyZWFrO1xyXG4gICAgICBjYXNlIHRydWU6ICBzdXJyb3VuZFBhdHRlcm4gPSBbJz8oJywgJyk/J107IGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OiAgICBzdXJyb3VuZFBhdHRlcm4gPSBbJygnICsgc3F1YXNoICsgXCJ8XCIsICcpPyddOyAgYnJlYWs7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0ICsgc3Vycm91bmRQYXR0ZXJuWzBdICsgcGF0dGVybiArIHN1cnJvdW5kUGF0dGVyblsxXTtcclxuICB9XHJcblxyXG4gIHRoaXMuc291cmNlID0gcGF0dGVybjtcclxuXHJcbiAgLy8gU3BsaXQgaW50byBzdGF0aWMgc2VnbWVudHMgc2VwYXJhdGVkIGJ5IHBhdGggcGFyYW1ldGVyIHBsYWNlaG9sZGVycy5cclxuICAvLyBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIGlzIGFsd2F5cyAxIG1vcmUgdGhhbiB0aGUgbnVtYmVyIG9mIHBhcmFtZXRlcnMuXHJcbiAgZnVuY3Rpb24gbWF0Y2hEZXRhaWxzKG0sIGlzU2VhcmNoKSB7XHJcbiAgICB2YXIgaWQsIHJlZ2V4cCwgc2VnbWVudCwgdHlwZSwgY2ZnLCBhcnJheU1vZGU7XHJcbiAgICBpZCAgICAgICAgICA9IG1bMl0gfHwgbVszXTsgLy8gSUVbNzhdIHJldHVybnMgJycgZm9yIHVubWF0Y2hlZCBncm91cHMgaW5zdGVhZCBvZiBudWxsXHJcbiAgICBjZmcgICAgICAgICA9IGNvbmZpZy5wYXJhbXNbaWRdO1xyXG4gICAgc2VnbWVudCAgICAgPSBwYXR0ZXJuLnN1YnN0cmluZyhsYXN0LCBtLmluZGV4KTtcclxuICAgIHJlZ2V4cCAgICAgID0gaXNTZWFyY2ggPyBtWzRdIDogbVs0XSB8fCAobVsxXSA9PSAnKicgPyAnLionIDogbnVsbCk7XHJcbiAgICB0eXBlICAgICAgICA9ICQkVU1GUC50eXBlKHJlZ2V4cCB8fCBcInN0cmluZ1wiKSB8fCBpbmhlcml0KCQkVU1GUC50eXBlKFwic3RyaW5nXCIpLCB7IHBhdHRlcm46IG5ldyBSZWdFeHAocmVnZXhwKSB9KTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGlkOiBpZCwgcmVnZXhwOiByZWdleHAsIHNlZ21lbnQ6IHNlZ21lbnQsIHR5cGU6IHR5cGUsIGNmZzogY2ZnXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgdmFyIHAsIHBhcmFtLCBzZWdtZW50O1xyXG4gIHdoaWxlICgobSA9IHBsYWNlaG9sZGVyLmV4ZWMocGF0dGVybikpKSB7XHJcbiAgICBwID0gbWF0Y2hEZXRhaWxzKG0sIGZhbHNlKTtcclxuICAgIGlmIChwLnNlZ21lbnQuaW5kZXhPZignPycpID49IDApIGJyZWFrOyAvLyB3ZSdyZSBpbnRvIHRoZSBzZWFyY2ggcGFydFxyXG5cclxuICAgIHBhcmFtID0gYWRkUGFyYW1ldGVyKHAuaWQsIHAudHlwZSwgcC5jZmcsIFwicGF0aFwiKTtcclxuICAgIGNvbXBpbGVkICs9IHF1b3RlUmVnRXhwKHAuc2VnbWVudCwgcGFyYW0udHlwZS5wYXR0ZXJuLnNvdXJjZSwgcGFyYW0uc3F1YXNoKTtcclxuICAgIHNlZ21lbnRzLnB1c2gocC5zZWdtZW50KTtcclxuICAgIGxhc3QgPSBwbGFjZWhvbGRlci5sYXN0SW5kZXg7XHJcbiAgfVxyXG4gIHNlZ21lbnQgPSBwYXR0ZXJuLnN1YnN0cmluZyhsYXN0KTtcclxuXHJcbiAgLy8gRmluZCBhbnkgc2VhcmNoIHBhcmFtZXRlciBuYW1lcyBhbmQgcmVtb3ZlIHRoZW0gZnJvbSB0aGUgbGFzdCBzZWdtZW50XHJcbiAgdmFyIGkgPSBzZWdtZW50LmluZGV4T2YoJz8nKTtcclxuXHJcbiAgaWYgKGkgPj0gMCkge1xyXG4gICAgdmFyIHNlYXJjaCA9IHRoaXMuc291cmNlU2VhcmNoID0gc2VnbWVudC5zdWJzdHJpbmcoaSk7XHJcbiAgICBzZWdtZW50ID0gc2VnbWVudC5zdWJzdHJpbmcoMCwgaSk7XHJcbiAgICB0aGlzLnNvdXJjZVBhdGggPSBwYXR0ZXJuLnN1YnN0cmluZygwLCBsYXN0ICsgaSk7XHJcblxyXG4gICAgaWYgKHNlYXJjaC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGxhc3QgPSAwO1xyXG4gICAgICB3aGlsZSAoKG0gPSBzZWFyY2hQbGFjZWhvbGRlci5leGVjKHNlYXJjaCkpKSB7XHJcbiAgICAgICAgcCA9IG1hdGNoRGV0YWlscyhtLCB0cnVlKTtcclxuICAgICAgICBwYXJhbSA9IGFkZFBhcmFtZXRlcihwLmlkLCBwLnR5cGUsIHAuY2ZnLCBcInNlYXJjaFwiKTtcclxuICAgICAgICBsYXN0ID0gcGxhY2Vob2xkZXIubGFzdEluZGV4O1xyXG4gICAgICAgIC8vIGNoZWNrIGlmID8mXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9IGVsc2Uge1xyXG4gICAgdGhpcy5zb3VyY2VQYXRoID0gcGF0dGVybjtcclxuICAgIHRoaXMuc291cmNlU2VhcmNoID0gJyc7XHJcbiAgfVxyXG5cclxuICBjb21waWxlZCArPSBxdW90ZVJlZ0V4cChzZWdtZW50KSArIChjb25maWcuc3RyaWN0ID09PSBmYWxzZSA/ICdcXC8/JyA6ICcnKSArICckJztcclxuICBzZWdtZW50cy5wdXNoKHNlZ21lbnQpO1xyXG5cclxuICB0aGlzLnJlZ2V4cCA9IG5ldyBSZWdFeHAoY29tcGlsZWQsIGNvbmZpZy5jYXNlSW5zZW5zaXRpdmUgPyAnaScgOiB1bmRlZmluZWQpO1xyXG4gIHRoaXMucHJlZml4ID0gc2VnbWVudHNbMF07XHJcbiAgdGhpcy4kJHBhcmFtTmFtZXMgPSBwYXJhbU5hbWVzO1xyXG59XHJcblxyXG4vKipcclxuICogQG5nZG9jIGZ1bmN0aW9uXHJcbiAqIEBuYW1lIHVpLnJvdXRlci51dGlsLnR5cGU6VXJsTWF0Y2hlciNjb25jYXRcclxuICogQG1ldGhvZE9mIHVpLnJvdXRlci51dGlsLnR5cGU6VXJsTWF0Y2hlclxyXG4gKlxyXG4gKiBAZGVzY3JpcHRpb25cclxuICogUmV0dXJucyBhIG5ldyBtYXRjaGVyIGZvciBhIHBhdHRlcm4gY29uc3RydWN0ZWQgYnkgYXBwZW5kaW5nIHRoZSBwYXRoIHBhcnQgYW5kIGFkZGluZyB0aGVcclxuICogc2VhcmNoIHBhcmFtZXRlcnMgb2YgdGhlIHNwZWNpZmllZCBwYXR0ZXJuIHRvIHRoaXMgcGF0dGVybi4gVGhlIGN1cnJlbnQgcGF0dGVybiBpcyBub3RcclxuICogbW9kaWZpZWQuIFRoaXMgY2FuIGJlIHVuZGVyc3Rvb2QgYXMgY3JlYXRpbmcgYSBwYXR0ZXJuIGZvciBVUkxzIHRoYXQgYXJlIHJlbGF0aXZlIHRvIChvclxyXG4gKiBzdWZmaXhlcyBvZikgdGhlIGN1cnJlbnQgcGF0dGVybi5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogVGhlIGZvbGxvd2luZyB0d28gbWF0Y2hlcnMgYXJlIGVxdWl2YWxlbnQ6XHJcbiAqIDxwcmU+XHJcbiAqIG5ldyBVcmxNYXRjaGVyKCcvdXNlci97aWR9P3EnKS5jb25jYXQoJy9kZXRhaWxzP2RhdGUnKTtcclxuICogbmV3IFVybE1hdGNoZXIoJy91c2VyL3tpZH0vZGV0YWlscz9xJmRhdGUnKTtcclxuICogPC9wcmU+XHJcbiAqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXR0ZXJuICBUaGUgcGF0dGVybiB0byBhcHBlbmQuXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgIEFuIG9iamVjdCBoYXNoIG9mIHRoZSBjb25maWd1cmF0aW9uIGZvciB0aGUgbWF0Y2hlci5cclxuICogQHJldHVybnMge1VybE1hdGNoZXJ9ICBBIG1hdGNoZXIgZm9yIHRoZSBjb25jYXRlbmF0ZWQgcGF0dGVybi5cclxuICovXHJcblVybE1hdGNoZXIucHJvdG90eXBlLmNvbmNhdCA9IGZ1bmN0aW9uIChwYXR0ZXJuLCBjb25maWcpIHtcclxuICAvLyBCZWNhdXNlIG9yZGVyIG9mIHNlYXJjaCBwYXJhbWV0ZXJzIGlzIGlycmVsZXZhbnQsIHdlIGNhbiBhZGQgb3VyIG93biBzZWFyY2hcclxuICAvLyBwYXJhbWV0ZXJzIHRvIHRoZSBlbmQgb2YgdGhlIG5ldyBwYXR0ZXJuLiBQYXJzZSB0aGUgbmV3IHBhdHRlcm4gYnkgaXRzZWxmXHJcbiAgLy8gYW5kIHRoZW4gam9pbiB0aGUgYml0cyB0b2dldGhlciwgYnV0IGl0J3MgbXVjaCBlYXNpZXIgdG8gZG8gdGhpcyBvbiBhIHN0cmluZyBsZXZlbC5cclxuICB2YXIgZGVmYXVsdENvbmZpZyA9IHtcclxuICAgIGNhc2VJbnNlbnNpdGl2ZTogJCRVTUZQLmNhc2VJbnNlbnNpdGl2ZSgpLFxyXG4gICAgc3RyaWN0OiAkJFVNRlAuc3RyaWN0TW9kZSgpLFxyXG4gICAgc3F1YXNoOiAkJFVNRlAuZGVmYXVsdFNxdWFzaFBvbGljeSgpXHJcbiAgfTtcclxuICByZXR1cm4gbmV3IFVybE1hdGNoZXIodGhpcy5zb3VyY2VQYXRoICsgcGF0dGVybiArIHRoaXMuc291cmNlU2VhcmNoLCBleHRlbmQoZGVmYXVsdENvbmZpZywgY29uZmlnKSwgdGhpcyk7XHJcbn07XHJcblxyXG5VcmxNYXRjaGVyLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcclxuICByZXR1cm4gdGhpcy5zb3VyY2U7XHJcbn07XHJcblxyXG4vKipcclxuICogQG5nZG9jIGZ1bmN0aW9uXHJcbiAqIEBuYW1lIHVpLnJvdXRlci51dGlsLnR5cGU6VXJsTWF0Y2hlciNleGVjXHJcbiAqIEBtZXRob2RPZiB1aS5yb3V0ZXIudXRpbC50eXBlOlVybE1hdGNoZXJcclxuICpcclxuICogQGRlc2NyaXB0aW9uXHJcbiAqIFRlc3RzIHRoZSBzcGVjaWZpZWQgcGF0aCBhZ2FpbnN0IHRoaXMgbWF0Y2hlciwgYW5kIHJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGNhcHR1cmVkXHJcbiAqIHBhcmFtZXRlciB2YWx1ZXMsIG9yIG51bGwgaWYgdGhlIHBhdGggZG9lcyBub3QgbWF0Y2guIFRoZSByZXR1cm5lZCBvYmplY3QgY29udGFpbnMgdGhlIHZhbHVlc1xyXG4gKiBvZiBhbnkgc2VhcmNoIHBhcmFtZXRlcnMgdGhhdCBhcmUgbWVudGlvbmVkIGluIHRoZSBwYXR0ZXJuLCBidXQgdGhlaXIgdmFsdWUgbWF5IGJlIG51bGwgaWZcclxuICogdGhleSBhcmUgbm90IHByZXNlbnQgaW4gYHNlYXJjaFBhcmFtc2AuIFRoaXMgbWVhbnMgdGhhdCBzZWFyY2ggcGFyYW1ldGVycyBhcmUgYWx3YXlzIHRyZWF0ZWRcclxuICogYXMgb3B0aW9uYWwuXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIDxwcmU+XHJcbiAqIG5ldyBVcmxNYXRjaGVyKCcvdXNlci97aWR9P3EmcicpLmV4ZWMoJy91c2VyL2JvYicsIHtcclxuICogICB4OiAnMScsIHE6ICdoZWxsbydcclxuICogfSk7XHJcbiAqIC8vIHJldHVybnMgeyBpZDogJ2JvYicsIHE6ICdoZWxsbycsIHI6IG51bGwgfVxyXG4gKiA8L3ByZT5cclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHBhdGggIFRoZSBVUkwgcGF0aCB0byBtYXRjaCwgZS5nLiBgJGxvY2F0aW9uLnBhdGgoKWAuXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBzZWFyY2hQYXJhbXMgIFVSTCBzZWFyY2ggcGFyYW1ldGVycywgZS5nLiBgJGxvY2F0aW9uLnNlYXJjaCgpYC5cclxuICogQHJldHVybnMge09iamVjdH0gIFRoZSBjYXB0dXJlZCBwYXJhbWV0ZXIgdmFsdWVzLlxyXG4gKi9cclxuVXJsTWF0Y2hlci5wcm90b3R5cGUuZXhlYyA9IGZ1bmN0aW9uIChwYXRoLCBzZWFyY2hQYXJhbXMpIHtcclxuICB2YXIgbSA9IHRoaXMucmVnZXhwLmV4ZWMocGF0aCk7XHJcbiAgaWYgKCFtKSByZXR1cm4gbnVsbDtcclxuICBzZWFyY2hQYXJhbXMgPSBzZWFyY2hQYXJhbXMgfHwge307XHJcblxyXG4gIHZhciBwYXJhbU5hbWVzID0gdGhpcy5wYXJhbWV0ZXJzKCksIG5Ub3RhbCA9IHBhcmFtTmFtZXMubGVuZ3RoLFxyXG4gICAgblBhdGggPSB0aGlzLnNlZ21lbnRzLmxlbmd0aCAtIDEsXHJcbiAgICB2YWx1ZXMgPSB7fSwgaSwgaiwgY2ZnLCBwYXJhbU5hbWU7XHJcblxyXG4gIGlmIChuUGF0aCAhPT0gbS5sZW5ndGggLSAxKSB0aHJvdyBuZXcgRXJyb3IoXCJVbmJhbGFuY2VkIGNhcHR1cmUgZ3JvdXAgaW4gcm91dGUgJ1wiICsgdGhpcy5zb3VyY2UgKyBcIidcIik7XHJcblxyXG4gIGZ1bmN0aW9uIGRlY29kZVBhdGhBcnJheShzdHJpbmcpIHtcclxuICAgIGZ1bmN0aW9uIHJldmVyc2VTdHJpbmcoc3RyKSB7IHJldHVybiBzdHIuc3BsaXQoXCJcIikucmV2ZXJzZSgpLmpvaW4oXCJcIik7IH1cclxuICAgIGZ1bmN0aW9uIHVucXVvdGVEYXNoZXMoc3RyKSB7IHJldHVybiBzdHIucmVwbGFjZSgvXFxcXC0vLCBcIi1cIik7IH1cclxuXHJcbiAgICB2YXIgc3BsaXQgPSByZXZlcnNlU3RyaW5nKHN0cmluZykuc3BsaXQoLy0oPyFcXFxcKS8pO1xyXG4gICAgdmFyIGFsbFJldmVyc2VkID0gbWFwKHNwbGl0LCByZXZlcnNlU3RyaW5nKTtcclxuICAgIHJldHVybiBtYXAoYWxsUmV2ZXJzZWQsIHVucXVvdGVEYXNoZXMpLnJldmVyc2UoKTtcclxuICB9XHJcblxyXG4gIGZvciAoaSA9IDA7IGkgPCBuUGF0aDsgaSsrKSB7XHJcbiAgICBwYXJhbU5hbWUgPSBwYXJhbU5hbWVzW2ldO1xyXG4gICAgdmFyIHBhcmFtID0gdGhpcy5wYXJhbXNbcGFyYW1OYW1lXTtcclxuICAgIHZhciBwYXJhbVZhbCA9IG1baSsxXTtcclxuICAgIC8vIGlmIHRoZSBwYXJhbSB2YWx1ZSBtYXRjaGVzIGEgcHJlLXJlcGxhY2UgcGFpciwgcmVwbGFjZSB0aGUgdmFsdWUgYmVmb3JlIGRlY29kaW5nLlxyXG4gICAgZm9yIChqID0gMDsgaiA8IHBhcmFtLnJlcGxhY2U7IGorKykge1xyXG4gICAgICBpZiAocGFyYW0ucmVwbGFjZVtqXS5mcm9tID09PSBwYXJhbVZhbCkgcGFyYW1WYWwgPSBwYXJhbS5yZXBsYWNlW2pdLnRvO1xyXG4gICAgfVxyXG4gICAgaWYgKHBhcmFtVmFsICYmIHBhcmFtLmFycmF5ID09PSB0cnVlKSBwYXJhbVZhbCA9IGRlY29kZVBhdGhBcnJheShwYXJhbVZhbCk7XHJcbiAgICB2YWx1ZXNbcGFyYW1OYW1lXSA9IHBhcmFtLnZhbHVlKHBhcmFtVmFsKTtcclxuICB9XHJcbiAgZm9yICgvKiovOyBpIDwgblRvdGFsOyBpKyspIHtcclxuICAgIHBhcmFtTmFtZSA9IHBhcmFtTmFtZXNbaV07XHJcbiAgICB2YWx1ZXNbcGFyYW1OYW1lXSA9IHRoaXMucGFyYW1zW3BhcmFtTmFtZV0udmFsdWUoc2VhcmNoUGFyYW1zW3BhcmFtTmFtZV0pO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHZhbHVlcztcclxufTtcclxuXHJcbi8qKlxyXG4gKiBAbmdkb2MgZnVuY3Rpb25cclxuICogQG5hbWUgdWkucm91dGVyLnV0aWwudHlwZTpVcmxNYXRjaGVyI3BhcmFtZXRlcnNcclxuICogQG1ldGhvZE9mIHVpLnJvdXRlci51dGlsLnR5cGU6VXJsTWF0Y2hlclxyXG4gKlxyXG4gKiBAZGVzY3JpcHRpb25cclxuICogUmV0dXJucyB0aGUgbmFtZXMgb2YgYWxsIHBhdGggYW5kIHNlYXJjaCBwYXJhbWV0ZXJzIG9mIHRoaXMgcGF0dGVybiBpbiBhbiB1bnNwZWNpZmllZCBvcmRlci5cclxuICogXHJcbiAqIEByZXR1cm5zIHtBcnJheS48c3RyaW5nPn0gIEFuIGFycmF5IG9mIHBhcmFtZXRlciBuYW1lcy4gTXVzdCBiZSB0cmVhdGVkIGFzIHJlYWQtb25seS4gSWYgdGhlXHJcbiAqICAgIHBhdHRlcm4gaGFzIG5vIHBhcmFtZXRlcnMsIGFuIGVtcHR5IGFycmF5IGlzIHJldHVybmVkLlxyXG4gKi9cclxuVXJsTWF0Y2hlci5wcm90b3R5cGUucGFyYW1ldGVycyA9IGZ1bmN0aW9uIChwYXJhbSkge1xyXG4gIGlmICghaXNEZWZpbmVkKHBhcmFtKSkgcmV0dXJuIHRoaXMuJCRwYXJhbU5hbWVzO1xyXG4gIHJldHVybiB0aGlzLnBhcmFtc1twYXJhbV0gfHwgbnVsbDtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBAbmdkb2MgZnVuY3Rpb25cclxuICogQG5hbWUgdWkucm91dGVyLnV0aWwudHlwZTpVcmxNYXRjaGVyI3ZhbGlkYXRlXHJcbiAqIEBtZXRob2RPZiB1aS5yb3V0ZXIudXRpbC50eXBlOlVybE1hdGNoZXJcclxuICpcclxuICogQGRlc2NyaXB0aW9uXHJcbiAqIENoZWNrcyBhbiBvYmplY3QgaGFzaCBvZiBwYXJhbWV0ZXJzIHRvIHZhbGlkYXRlIHRoZWlyIGNvcnJlY3RuZXNzIGFjY29yZGluZyB0byB0aGUgcGFyYW1ldGVyXHJcbiAqIHR5cGVzIG9mIHRoaXMgYFVybE1hdGNoZXJgLlxyXG4gKlxyXG4gKiBAcGFyYW0ge09iamVjdH0gcGFyYW1zIFRoZSBvYmplY3QgaGFzaCBvZiBwYXJhbWV0ZXJzIHRvIHZhbGlkYXRlLlxyXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHBhcmFtc2AgdmFsaWRhdGVzLCBvdGhlcndpc2UgYGZhbHNlYC5cclxuICovXHJcblVybE1hdGNoZXIucHJvdG90eXBlLnZhbGlkYXRlcyA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcclxuICByZXR1cm4gdGhpcy5wYXJhbXMuJCR2YWxpZGF0ZXMocGFyYW1zKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBAbmdkb2MgZnVuY3Rpb25cclxuICogQG5hbWUgdWkucm91dGVyLnV0aWwudHlwZTpVcmxNYXRjaGVyI2Zvcm1hdFxyXG4gKiBAbWV0aG9kT2YgdWkucm91dGVyLnV0aWwudHlwZTpVcmxNYXRjaGVyXHJcbiAqXHJcbiAqIEBkZXNjcmlwdGlvblxyXG4gKiBDcmVhdGVzIGEgVVJMIHRoYXQgbWF0Y2hlcyB0aGlzIHBhdHRlcm4gYnkgc3Vic3RpdHV0aW5nIHRoZSBzcGVjaWZpZWQgdmFsdWVzXHJcbiAqIGZvciB0aGUgcGF0aCBhbmQgc2VhcmNoIHBhcmFtZXRlcnMuIE51bGwgdmFsdWVzIGZvciBwYXRoIHBhcmFtZXRlcnMgYXJlXHJcbiAqIHRyZWF0ZWQgYXMgZW1wdHkgc3RyaW5ncy5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogPHByZT5cclxuICogbmV3IFVybE1hdGNoZXIoJy91c2VyL3tpZH0/cScpLmZvcm1hdCh7IGlkOidib2InLCBxOid5ZXMnIH0pO1xyXG4gKiAvLyByZXR1cm5zICcvdXNlci9ib2I/cT15ZXMnXHJcbiAqIDwvcHJlPlxyXG4gKlxyXG4gKiBAcGFyYW0ge09iamVjdH0gdmFsdWVzICB0aGUgdmFsdWVzIHRvIHN1YnN0aXR1dGUgZm9yIHRoZSBwYXJhbWV0ZXJzIGluIHRoaXMgcGF0dGVybi5cclxuICogQHJldHVybnMge3N0cmluZ30gIHRoZSBmb3JtYXR0ZWQgVVJMIChwYXRoIGFuZCBvcHRpb25hbGx5IHNlYXJjaCBwYXJ0KS5cclxuICovXHJcblVybE1hdGNoZXIucHJvdG90eXBlLmZvcm1hdCA9IGZ1bmN0aW9uICh2YWx1ZXMpIHtcclxuICB2YWx1ZXMgPSB2YWx1ZXMgfHwge307XHJcbiAgdmFyIHNlZ21lbnRzID0gdGhpcy5zZWdtZW50cywgcGFyYW1zID0gdGhpcy5wYXJhbWV0ZXJzKCksIHBhcmFtc2V0ID0gdGhpcy5wYXJhbXM7XHJcbiAgaWYgKCF0aGlzLnZhbGlkYXRlcyh2YWx1ZXMpKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgdmFyIGksIHNlYXJjaCA9IGZhbHNlLCBuUGF0aCA9IHNlZ21lbnRzLmxlbmd0aCAtIDEsIG5Ub3RhbCA9IHBhcmFtcy5sZW5ndGgsIHJlc3VsdCA9IHNlZ21lbnRzWzBdO1xyXG5cclxuICBmdW5jdGlvbiBlbmNvZGVEYXNoZXMoc3RyKSB7IC8vIFJlcGxhY2UgZGFzaGVzIHdpdGggZW5jb2RlZCBcIlxcLVwiXHJcbiAgICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KHN0cikucmVwbGFjZSgvLS9nLCBmdW5jdGlvbihjKSB7IHJldHVybiAnJTVDJScgKyBjLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCk7IH0pO1xyXG4gIH1cclxuXHJcbiAgZm9yIChpID0gMDsgaSA8IG5Ub3RhbDsgaSsrKSB7XHJcbiAgICB2YXIgaXNQYXRoUGFyYW0gPSBpIDwgblBhdGg7XHJcbiAgICB2YXIgbmFtZSA9IHBhcmFtc1tpXSwgcGFyYW0gPSBwYXJhbXNldFtuYW1lXSwgdmFsdWUgPSBwYXJhbS52YWx1ZSh2YWx1ZXNbbmFtZV0pO1xyXG4gICAgdmFyIGlzRGVmYXVsdFZhbHVlID0gcGFyYW0uaXNPcHRpb25hbCAmJiBwYXJhbS50eXBlLmVxdWFscyhwYXJhbS52YWx1ZSgpLCB2YWx1ZSk7XHJcbiAgICB2YXIgc3F1YXNoID0gaXNEZWZhdWx0VmFsdWUgPyBwYXJhbS5zcXVhc2ggOiBmYWxzZTtcclxuICAgIHZhciBlbmNvZGVkID0gcGFyYW0udHlwZS5lbmNvZGUodmFsdWUpO1xyXG5cclxuICAgIGlmIChpc1BhdGhQYXJhbSkge1xyXG4gICAgICB2YXIgbmV4dFNlZ21lbnQgPSBzZWdtZW50c1tpICsgMV07XHJcbiAgICAgIGlmIChzcXVhc2ggPT09IGZhbHNlKSB7XHJcbiAgICAgICAgaWYgKGVuY29kZWQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgaWYgKGlzQXJyYXkoZW5jb2RlZCkpIHtcclxuICAgICAgICAgICAgcmVzdWx0ICs9IG1hcChlbmNvZGVkLCBlbmNvZGVEYXNoZXMpLmpvaW4oXCItXCIpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVzdWx0ICs9IGVuY29kZVVSSUNvbXBvbmVudChlbmNvZGVkKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmVzdWx0ICs9IG5leHRTZWdtZW50O1xyXG4gICAgICB9IGVsc2UgaWYgKHNxdWFzaCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgIHZhciBjYXB0dXJlID0gcmVzdWx0Lm1hdGNoKC9cXC8kLykgPyAvXFwvPyguKikvIDogLyguKikvO1xyXG4gICAgICAgIHJlc3VsdCArPSBuZXh0U2VnbWVudC5tYXRjaChjYXB0dXJlKVsxXTtcclxuICAgICAgfSBlbHNlIGlmIChpc1N0cmluZyhzcXVhc2gpKSB7XHJcbiAgICAgICAgcmVzdWx0ICs9IHNxdWFzaCArIG5leHRTZWdtZW50O1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZiAoZW5jb2RlZCA9PSBudWxsIHx8IChpc0RlZmF1bHRWYWx1ZSAmJiBzcXVhc2ggIT09IGZhbHNlKSkgY29udGludWU7XHJcbiAgICAgIGlmICghaXNBcnJheShlbmNvZGVkKSkgZW5jb2RlZCA9IFsgZW5jb2RlZCBdO1xyXG4gICAgICBlbmNvZGVkID0gbWFwKGVuY29kZWQsIGVuY29kZVVSSUNvbXBvbmVudCkuam9pbignJicgKyBuYW1lICsgJz0nKTtcclxuICAgICAgcmVzdWx0ICs9IChzZWFyY2ggPyAnJicgOiAnPycpICsgKG5hbWUgKyAnPScgKyBlbmNvZGVkKTtcclxuICAgICAgc2VhcmNoID0gdHJ1ZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiByZXN1bHQ7XHJcbn07XHJcblxyXG4vKipcclxuICogQG5nZG9jIG9iamVjdFxyXG4gKiBAbmFtZSB1aS5yb3V0ZXIudXRpbC50eXBlOlR5cGVcclxuICpcclxuICogQGRlc2NyaXB0aW9uXHJcbiAqIEltcGxlbWVudHMgYW4gaW50ZXJmYWNlIHRvIGRlZmluZSBjdXN0b20gcGFyYW1ldGVyIHR5cGVzIHRoYXQgY2FuIGJlIGRlY29kZWQgZnJvbSBhbmQgZW5jb2RlZCB0b1xyXG4gKiBzdHJpbmcgcGFyYW1ldGVycyBtYXRjaGVkIGluIGEgVVJMLiBVc2VkIGJ5IHtAbGluayB1aS5yb3V0ZXIudXRpbC50eXBlOlVybE1hdGNoZXIgYFVybE1hdGNoZXJgfVxyXG4gKiBvYmplY3RzIHdoZW4gbWF0Y2hpbmcgb3IgZm9ybWF0dGluZyBVUkxzLCBvciBjb21wYXJpbmcgb3IgdmFsaWRhdGluZyBwYXJhbWV0ZXIgdmFsdWVzLlxyXG4gKlxyXG4gKiBTZWUge0BsaW5rIHVpLnJvdXRlci51dGlsLiR1cmxNYXRjaGVyRmFjdG9yeSNtZXRob2RzX3R5cGUgYCR1cmxNYXRjaGVyRmFjdG9yeSN0eXBlKClgfSBmb3IgbW9yZVxyXG4gKiBpbmZvcm1hdGlvbiBvbiByZWdpc3RlcmluZyBjdXN0b20gdHlwZXMuXHJcbiAqXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgIEEgY29uZmlndXJhdGlvbiBvYmplY3Qgd2hpY2ggY29udGFpbnMgdGhlIGN1c3RvbSB0eXBlIGRlZmluaXRpb24uICBUaGUgb2JqZWN0J3NcclxuICogICAgICAgIHByb3BlcnRpZXMgd2lsbCBvdmVycmlkZSB0aGUgZGVmYXVsdCBtZXRob2RzIGFuZC9vciBwYXR0ZXJuIGluIGBUeXBlYCdzIHB1YmxpYyBpbnRlcmZhY2UuXHJcbiAqIEBleGFtcGxlXHJcbiAqIDxwcmU+XHJcbiAqIHtcclxuICogICBkZWNvZGU6IGZ1bmN0aW9uKHZhbCkgeyByZXR1cm4gcGFyc2VJbnQodmFsLCAxMCk7IH0sXHJcbiAqICAgZW5jb2RlOiBmdW5jdGlvbih2YWwpIHsgcmV0dXJuIHZhbCAmJiB2YWwudG9TdHJpbmcoKTsgfSxcclxuICogICBlcXVhbHM6IGZ1bmN0aW9uKGEsIGIpIHsgcmV0dXJuIHRoaXMuaXMoYSkgJiYgYSA9PT0gYjsgfSxcclxuICogICBpczogZnVuY3Rpb24odmFsKSB7IHJldHVybiBhbmd1bGFyLmlzTnVtYmVyKHZhbCkgaXNGaW5pdGUodmFsKSAmJiB2YWwgJSAxID09PSAwOyB9LFxyXG4gKiAgIHBhdHRlcm46IC9cXGQrL1xyXG4gKiB9XHJcbiAqIDwvcHJlPlxyXG4gKlxyXG4gKiBAcHJvcGVydHkge1JlZ0V4cH0gcGF0dGVybiBUaGUgcmVndWxhciBleHByZXNzaW9uIHBhdHRlcm4gdXNlZCB0byBtYXRjaCB2YWx1ZXMgb2YgdGhpcyB0eXBlIHdoZW5cclxuICogICAgICAgICAgIGNvbWluZyBmcm9tIGEgc3Vic3RyaW5nIG9mIGEgVVJMLlxyXG4gKlxyXG4gKiBAcmV0dXJucyB7T2JqZWN0fSAgUmV0dXJucyBhIG5ldyBgVHlwZWAgb2JqZWN0LlxyXG4gKi9cclxuZnVuY3Rpb24gVHlwZShjb25maWcpIHtcclxuICBleHRlbmQodGhpcywgY29uZmlnKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEBuZ2RvYyBmdW5jdGlvblxyXG4gKiBAbmFtZSB1aS5yb3V0ZXIudXRpbC50eXBlOlR5cGUjaXNcclxuICogQG1ldGhvZE9mIHVpLnJvdXRlci51dGlsLnR5cGU6VHlwZVxyXG4gKlxyXG4gKiBAZGVzY3JpcHRpb25cclxuICogRGV0ZWN0cyB3aGV0aGVyIGEgdmFsdWUgaXMgb2YgYSBwYXJ0aWN1bGFyIHR5cGUuIEFjY2VwdHMgYSBuYXRpdmUgKGRlY29kZWQpIHZhbHVlXHJcbiAqIGFuZCBkZXRlcm1pbmVzIHdoZXRoZXIgaXQgbWF0Y2hlcyB0aGUgY3VycmVudCBgVHlwZWAgb2JqZWN0LlxyXG4gKlxyXG4gKiBAcGFyYW0geyp9IHZhbCAgVGhlIHZhbHVlIHRvIGNoZWNrLlxyXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5ICBPcHRpb25hbC4gSWYgdGhlIHR5cGUgY2hlY2sgaXMgaGFwcGVuaW5nIGluIHRoZSBjb250ZXh0IG9mIGEgc3BlY2lmaWNcclxuICogICAgICAgIHtAbGluayB1aS5yb3V0ZXIudXRpbC50eXBlOlVybE1hdGNoZXIgYFVybE1hdGNoZXJgfSBvYmplY3QsIHRoaXMgaXMgdGhlIG5hbWUgb2YgdGhlXHJcbiAqICAgICAgICBwYXJhbWV0ZXIgaW4gd2hpY2ggYHZhbGAgaXMgc3RvcmVkLiBDYW4gYmUgdXNlZCBmb3IgbWV0YS1wcm9ncmFtbWluZyBvZiBgVHlwZWAgb2JqZWN0cy5cclxuICogQHJldHVybnMge0Jvb2xlYW59ICBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgdmFsdWUgbWF0Y2hlcyB0aGUgdHlwZSwgb3RoZXJ3aXNlIGBmYWxzZWAuXHJcbiAqL1xyXG5UeXBlLnByb3RvdHlwZS5pcyA9IGZ1bmN0aW9uKHZhbCwga2V5KSB7XHJcbiAgcmV0dXJuIHRydWU7XHJcbn07XHJcblxyXG4vKipcclxuICogQG5nZG9jIGZ1bmN0aW9uXHJcbiAqIEBuYW1lIHVpLnJvdXRlci51dGlsLnR5cGU6VHlwZSNlbmNvZGVcclxuICogQG1ldGhvZE9mIHVpLnJvdXRlci51dGlsLnR5cGU6VHlwZVxyXG4gKlxyXG4gKiBAZGVzY3JpcHRpb25cclxuICogRW5jb2RlcyBhIGN1c3RvbS9uYXRpdmUgdHlwZSB2YWx1ZSB0byBhIHN0cmluZyB0aGF0IGNhbiBiZSBlbWJlZGRlZCBpbiBhIFVSTC4gTm90ZSB0aGF0IHRoZVxyXG4gKiByZXR1cm4gdmFsdWUgZG9lcyAqbm90KiBuZWVkIHRvIGJlIFVSTC1zYWZlIChpLmUuIHBhc3NlZCB0aHJvdWdoIGBlbmNvZGVVUklDb21wb25lbnQoKWApLCBpdFxyXG4gKiBvbmx5IG5lZWRzIHRvIGJlIGEgcmVwcmVzZW50YXRpb24gb2YgYHZhbGAgdGhhdCBoYXMgYmVlbiBjb2VyY2VkIHRvIGEgc3RyaW5nLlxyXG4gKlxyXG4gKiBAcGFyYW0geyp9IHZhbCAgVGhlIHZhbHVlIHRvIGVuY29kZS5cclxuICogQHBhcmFtIHtzdHJpbmd9IGtleSAgVGhlIG5hbWUgb2YgdGhlIHBhcmFtZXRlciBpbiB3aGljaCBgdmFsYCBpcyBzdG9yZWQuIENhbiBiZSB1c2VkIGZvclxyXG4gKiAgICAgICAgbWV0YS1wcm9ncmFtbWluZyBvZiBgVHlwZWAgb2JqZWN0cy5cclxuICogQHJldHVybnMge3N0cmluZ30gIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYHZhbGAgdGhhdCBjYW4gYmUgZW5jb2RlZCBpbiBhIFVSTC5cclxuICovXHJcblR5cGUucHJvdG90eXBlLmVuY29kZSA9IGZ1bmN0aW9uKHZhbCwga2V5KSB7XHJcbiAgcmV0dXJuIHZhbDtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBAbmdkb2MgZnVuY3Rpb25cclxuICogQG5hbWUgdWkucm91dGVyLnV0aWwudHlwZTpUeXBlI2RlY29kZVxyXG4gKiBAbWV0aG9kT2YgdWkucm91dGVyLnV0aWwudHlwZTpUeXBlXHJcbiAqXHJcbiAqIEBkZXNjcmlwdGlvblxyXG4gKiBDb252ZXJ0cyBhIHBhcmFtZXRlciB2YWx1ZSAoZnJvbSBVUkwgc3RyaW5nIG9yIHRyYW5zaXRpb24gcGFyYW0pIHRvIGEgY3VzdG9tL25hdGl2ZSB2YWx1ZS5cclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHZhbCAgVGhlIFVSTCBwYXJhbWV0ZXIgdmFsdWUgdG8gZGVjb2RlLlxyXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5ICBUaGUgbmFtZSBvZiB0aGUgcGFyYW1ldGVyIGluIHdoaWNoIGB2YWxgIGlzIHN0b3JlZC4gQ2FuIGJlIHVzZWQgZm9yXHJcbiAqICAgICAgICBtZXRhLXByb2dyYW1taW5nIG9mIGBUeXBlYCBvYmplY3RzLlxyXG4gKiBAcmV0dXJucyB7Kn0gIFJldHVybnMgYSBjdXN0b20gcmVwcmVzZW50YXRpb24gb2YgdGhlIFVSTCBwYXJhbWV0ZXIgdmFsdWUuXHJcbiAqL1xyXG5UeXBlLnByb3RvdHlwZS5kZWNvZGUgPSBmdW5jdGlvbih2YWwsIGtleSkge1xyXG4gIHJldHVybiB2YWw7XHJcbn07XHJcblxyXG4vKipcclxuICogQG5nZG9jIGZ1bmN0aW9uXHJcbiAqIEBuYW1lIHVpLnJvdXRlci51dGlsLnR5cGU6VHlwZSNlcXVhbHNcclxuICogQG1ldGhvZE9mIHVpLnJvdXRlci51dGlsLnR5cGU6VHlwZVxyXG4gKlxyXG4gKiBAZGVzY3JpcHRpb25cclxuICogRGV0ZXJtaW5lcyB3aGV0aGVyIHR3byBkZWNvZGVkIHZhbHVlcyBhcmUgZXF1aXZhbGVudC5cclxuICpcclxuICogQHBhcmFtIHsqfSBhICBBIHZhbHVlIHRvIGNvbXBhcmUgYWdhaW5zdC5cclxuICogQHBhcmFtIHsqfSBiICBBIHZhbHVlIHRvIGNvbXBhcmUgYWdhaW5zdC5cclxuICogQHJldHVybnMge0Jvb2xlYW59ICBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgdmFsdWVzIGFyZSBlcXVpdmFsZW50L2VxdWFsLCBvdGhlcndpc2UgYGZhbHNlYC5cclxuICovXHJcblR5cGUucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uKGEsIGIpIHtcclxuICByZXR1cm4gYSA9PSBiO1xyXG59O1xyXG5cclxuVHlwZS5wcm90b3R5cGUuJHN1YlBhdHRlcm4gPSBmdW5jdGlvbigpIHtcclxuICB2YXIgc3ViID0gdGhpcy5wYXR0ZXJuLnRvU3RyaW5nKCk7XHJcbiAgcmV0dXJuIHN1Yi5zdWJzdHIoMSwgc3ViLmxlbmd0aCAtIDIpO1xyXG59O1xyXG5cclxuVHlwZS5wcm90b3R5cGUucGF0dGVybiA9IC8uKi87XHJcblxyXG5UeXBlLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gXCJ7VHlwZTpcIiArIHRoaXMubmFtZSArIFwifVwiOyB9O1xyXG5cclxuLypcclxuICogV3JhcHMgYW4gZXhpc3RpbmcgY3VzdG9tIFR5cGUgYXMgYW4gYXJyYXkgb2YgVHlwZSwgZGVwZW5kaW5nIG9uICdtb2RlJy5cclxuICogZS5nLjpcclxuICogLSB1cmxtYXRjaGVyIHBhdHRlcm4gXCIvcGF0aD97cXVlcnlQYXJhbVtdOmludH1cIlxyXG4gKiAtIHVybDogXCIvcGF0aD9xdWVyeVBhcmFtPTEmcXVlcnlQYXJhbT0yXHJcbiAqIC0gJHN0YXRlUGFyYW1zLnF1ZXJ5UGFyYW0gd2lsbCBiZSBbMSwgMl1cclxuICogaWYgYG1vZGVgIGlzIFwiYXV0b1wiLCB0aGVuXHJcbiAqIC0gdXJsOiBcIi9wYXRoP3F1ZXJ5UGFyYW09MSB3aWxsIGNyZWF0ZSAkc3RhdGVQYXJhbXMucXVlcnlQYXJhbTogMVxyXG4gKiAtIHVybDogXCIvcGF0aD9xdWVyeVBhcmFtPTEmcXVlcnlQYXJhbT0yIHdpbGwgY3JlYXRlICRzdGF0ZVBhcmFtcy5xdWVyeVBhcmFtOiBbMSwgMl1cclxuICovXHJcblR5cGUucHJvdG90eXBlLiRhc0FycmF5ID0gZnVuY3Rpb24obW9kZSwgaXNTZWFyY2gpIHtcclxuICBpZiAoIW1vZGUpIHJldHVybiB0aGlzO1xyXG4gIGlmIChtb2RlID09PSBcImF1dG9cIiAmJiAhaXNTZWFyY2gpIHRocm93IG5ldyBFcnJvcihcIidhdXRvJyBhcnJheSBtb2RlIGlzIGZvciBxdWVyeSBwYXJhbWV0ZXJzIG9ubHlcIik7XHJcbiAgcmV0dXJuIG5ldyBBcnJheVR5cGUodGhpcywgbW9kZSk7XHJcblxyXG4gIGZ1bmN0aW9uIEFycmF5VHlwZSh0eXBlLCBtb2RlKSB7XHJcbiAgICBmdW5jdGlvbiBiaW5kVG8odHlwZSwgY2FsbGJhY2tOYW1lKSB7XHJcbiAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdHlwZVtjYWxsYmFja05hbWVdLmFwcGx5KHR5cGUsIGFyZ3VtZW50cyk7XHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gV3JhcCBub24tYXJyYXkgdmFsdWUgYXMgYXJyYXlcclxuICAgIGZ1bmN0aW9uIGFycmF5V3JhcCh2YWwpIHsgcmV0dXJuIGlzQXJyYXkodmFsKSA/IHZhbCA6IChpc0RlZmluZWQodmFsKSA/IFsgdmFsIF0gOiBbXSk7IH1cclxuICAgIC8vIFVud3JhcCBhcnJheSB2YWx1ZSBmb3IgXCJhdXRvXCIgbW9kZS4gUmV0dXJuIHVuZGVmaW5lZCBmb3IgZW1wdHkgYXJyYXkuXHJcbiAgICBmdW5jdGlvbiBhcnJheVVud3JhcCh2YWwpIHtcclxuICAgICAgc3dpdGNoKHZhbC5sZW5ndGgpIHtcclxuICAgICAgICBjYXNlIDA6IHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgY2FzZSAxOiByZXR1cm4gbW9kZSA9PT0gXCJhdXRvXCIgPyB2YWxbMF0gOiB2YWw7XHJcbiAgICAgICAgZGVmYXVsdDogcmV0dXJuIHZhbDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gZmFsc2V5KHZhbCkgeyByZXR1cm4gIXZhbDsgfVxyXG5cclxuICAgIC8vIFdyYXBzIHR5cGUgKC5pcy8uZW5jb2RlLy5kZWNvZGUpIGZ1bmN0aW9ucyB0byBvcGVyYXRlIG9uIGVhY2ggdmFsdWUgb2YgYW4gYXJyYXlcclxuICAgIGZ1bmN0aW9uIGFycmF5SGFuZGxlcihjYWxsYmFjaywgYWxsVHJ1dGh5TW9kZSkge1xyXG4gICAgICByZXR1cm4gZnVuY3Rpb24gaGFuZGxlQXJyYXkodmFsKSB7XHJcbiAgICAgICAgdmFsID0gYXJyYXlXcmFwKHZhbCk7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IG1hcCh2YWwsIGNhbGxiYWNrKTtcclxuICAgICAgICBpZiAoYWxsVHJ1dGh5TW9kZSA9PT0gdHJ1ZSlcclxuICAgICAgICAgIHJldHVybiBmaWx0ZXIocmVzdWx0LCBmYWxzZXkpLmxlbmd0aCA9PT0gMDtcclxuICAgICAgICByZXR1cm4gYXJyYXlVbndyYXAocmVzdWx0KTtcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBXcmFwcyB0eXBlICguZXF1YWxzKSBmdW5jdGlvbnMgdG8gb3BlcmF0ZSBvbiBlYWNoIHZhbHVlIG9mIGFuIGFycmF5XHJcbiAgICBmdW5jdGlvbiBhcnJheUVxdWFsc0hhbmRsZXIoY2FsbGJhY2spIHtcclxuICAgICAgcmV0dXJuIGZ1bmN0aW9uIGhhbmRsZUFycmF5KHZhbDEsIHZhbDIpIHtcclxuICAgICAgICB2YXIgbGVmdCA9IGFycmF5V3JhcCh2YWwxKSwgcmlnaHQgPSBhcnJheVdyYXAodmFsMik7XHJcbiAgICAgICAgaWYgKGxlZnQubGVuZ3RoICE9PSByaWdodC5sZW5ndGgpIHJldHVybiBmYWxzZTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlZnQubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgIGlmICghY2FsbGJhY2sobGVmdFtpXSwgcmlnaHRbaV0pKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZW5jb2RlID0gYXJyYXlIYW5kbGVyKGJpbmRUbyh0eXBlLCAnZW5jb2RlJykpO1xyXG4gICAgdGhpcy5kZWNvZGUgPSBhcnJheUhhbmRsZXIoYmluZFRvKHR5cGUsICdkZWNvZGUnKSk7XHJcbiAgICB0aGlzLmlzICAgICA9IGFycmF5SGFuZGxlcihiaW5kVG8odHlwZSwgJ2lzJyksIHRydWUpO1xyXG4gICAgdGhpcy5lcXVhbHMgPSBhcnJheUVxdWFsc0hhbmRsZXIoYmluZFRvKHR5cGUsICdlcXVhbHMnKSk7XHJcbiAgICB0aGlzLnBhdHRlcm4gPSB0eXBlLnBhdHRlcm47XHJcbiAgICB0aGlzLiRhcnJheU1vZGUgPSBtb2RlO1xyXG4gIH1cclxufTtcclxuXHJcblxyXG5cclxuLyoqXHJcbiAqIEBuZ2RvYyBvYmplY3RcclxuICogQG5hbWUgdWkucm91dGVyLnV0aWwuJHVybE1hdGNoZXJGYWN0b3J5XHJcbiAqXHJcbiAqIEBkZXNjcmlwdGlvblxyXG4gKiBGYWN0b3J5IGZvciB7QGxpbmsgdWkucm91dGVyLnV0aWwudHlwZTpVcmxNYXRjaGVyIGBVcmxNYXRjaGVyYH0gaW5zdGFuY2VzLiBUaGUgZmFjdG9yeVxyXG4gKiBpcyBhbHNvIGF2YWlsYWJsZSB0byBwcm92aWRlcnMgdW5kZXIgdGhlIG5hbWUgYCR1cmxNYXRjaGVyRmFjdG9yeVByb3ZpZGVyYC5cclxuICovXHJcbmZ1bmN0aW9uICRVcmxNYXRjaGVyRmFjdG9yeSgpIHtcclxuICAkJFVNRlAgPSB0aGlzO1xyXG5cclxuICB2YXIgaXNDYXNlSW5zZW5zaXRpdmUgPSBmYWxzZSwgaXNTdHJpY3RNb2RlID0gdHJ1ZSwgZGVmYXVsdFNxdWFzaFBvbGljeSA9IGZhbHNlO1xyXG5cclxuICBmdW5jdGlvbiB2YWxUb1N0cmluZyh2YWwpIHsgcmV0dXJuIHZhbCAhPSBudWxsID8gdmFsLnRvU3RyaW5nKCkucmVwbGFjZSgvXFwvL2csIFwiJTJGXCIpIDogdmFsOyB9XHJcbiAgZnVuY3Rpb24gdmFsRnJvbVN0cmluZyh2YWwpIHsgcmV0dXJuIHZhbCAhPSBudWxsID8gdmFsLnRvU3RyaW5nKCkucmVwbGFjZSgvJTJGL2csIFwiL1wiKSA6IHZhbDsgfVxyXG4vLyAgVE9ETzogaW4gMS4wLCBtYWtlIHN0cmluZyAuaXMoKSByZXR1cm4gZmFsc2UgaWYgdmFsdWUgaXMgdW5kZWZpbmVkIGJ5IGRlZmF1bHQuXHJcbi8vICBmdW5jdGlvbiByZWdleHBNYXRjaGVzKHZhbCkgeyAvKmpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqLyByZXR1cm4gaXNEZWZpbmVkKHZhbCkgJiYgdGhpcy5wYXR0ZXJuLnRlc3QodmFsKTsgfVxyXG4gIGZ1bmN0aW9uIHJlZ2V4cE1hdGNoZXModmFsKSB7IC8qanNoaW50IHZhbGlkdGhpczp0cnVlICovIHJldHVybiB0aGlzLnBhdHRlcm4udGVzdCh2YWwpOyB9XHJcblxyXG4gIHZhciAkdHlwZXMgPSB7fSwgZW5xdWV1ZSA9IHRydWUsIHR5cGVRdWV1ZSA9IFtdLCBpbmplY3RvciwgZGVmYXVsdFR5cGVzID0ge1xyXG4gICAgc3RyaW5nOiB7XHJcbiAgICAgIGVuY29kZTogdmFsVG9TdHJpbmcsXHJcbiAgICAgIGRlY29kZTogdmFsRnJvbVN0cmluZyxcclxuICAgICAgaXM6IHJlZ2V4cE1hdGNoZXMsXHJcbiAgICAgIHBhdHRlcm46IC9bXi9dKi9cclxuICAgIH0sXHJcbiAgICBpbnQ6IHtcclxuICAgICAgZW5jb2RlOiB2YWxUb1N0cmluZyxcclxuICAgICAgZGVjb2RlOiBmdW5jdGlvbih2YWwpIHsgcmV0dXJuIHBhcnNlSW50KHZhbCwgMTApOyB9LFxyXG4gICAgICBpczogZnVuY3Rpb24odmFsKSB7IHJldHVybiBpc0RlZmluZWQodmFsKSAmJiB0aGlzLmRlY29kZSh2YWwudG9TdHJpbmcoKSkgPT09IHZhbDsgfSxcclxuICAgICAgcGF0dGVybjogL1xcZCsvXHJcbiAgICB9LFxyXG4gICAgYm9vbDoge1xyXG4gICAgICBlbmNvZGU6IGZ1bmN0aW9uKHZhbCkgeyByZXR1cm4gdmFsID8gMSA6IDA7IH0sXHJcbiAgICAgIGRlY29kZTogZnVuY3Rpb24odmFsKSB7IHJldHVybiBwYXJzZUludCh2YWwsIDEwKSAhPT0gMDsgfSxcclxuICAgICAgaXM6IGZ1bmN0aW9uKHZhbCkgeyByZXR1cm4gdmFsID09PSB0cnVlIHx8IHZhbCA9PT0gZmFsc2U7IH0sXHJcbiAgICAgIHBhdHRlcm46IC8wfDEvXHJcbiAgICB9LFxyXG4gICAgZGF0ZToge1xyXG4gICAgICBlbmNvZGU6IGZ1bmN0aW9uICh2YWwpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXModmFsKSlcclxuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgcmV0dXJuIFsgdmFsLmdldEZ1bGxZZWFyKCksXHJcbiAgICAgICAgICAoJzAnICsgKHZhbC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSxcclxuICAgICAgICAgICgnMCcgKyB2YWwuZ2V0RGF0ZSgpKS5zbGljZSgtMilcclxuICAgICAgICBdLmpvaW4oXCItXCIpO1xyXG4gICAgICB9LFxyXG4gICAgICBkZWNvZGU6IGZ1bmN0aW9uICh2YWwpIHtcclxuICAgICAgICBpZiAodGhpcy5pcyh2YWwpKSByZXR1cm4gdmFsO1xyXG4gICAgICAgIHZhciBtYXRjaCA9IHRoaXMuY2FwdHVyZS5leGVjKHZhbCk7XHJcbiAgICAgICAgcmV0dXJuIG1hdGNoID8gbmV3IERhdGUobWF0Y2hbMV0sIG1hdGNoWzJdIC0gMSwgbWF0Y2hbM10pIDogdW5kZWZpbmVkO1xyXG4gICAgICB9LFxyXG4gICAgICBpczogZnVuY3Rpb24odmFsKSB7IHJldHVybiB2YWwgaW5zdGFuY2VvZiBEYXRlICYmICFpc05hTih2YWwudmFsdWVPZigpKTsgfSxcclxuICAgICAgZXF1YWxzOiBmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gdGhpcy5pcyhhKSAmJiB0aGlzLmlzKGIpICYmIGEudG9JU09TdHJpbmcoKSA9PT0gYi50b0lTT1N0cmluZygpOyB9LFxyXG4gICAgICBwYXR0ZXJuOiAvWzAtOV17NH0tKD86MFsxLTldfDFbMC0yXSktKD86MFsxLTldfFsxLTJdWzAtOV18M1swLTFdKS8sXHJcbiAgICAgIGNhcHR1cmU6IC8oWzAtOV17NH0pLSgwWzEtOV18MVswLTJdKS0oMFsxLTldfFsxLTJdWzAtOV18M1swLTFdKS9cclxuICAgIH0sXHJcbiAgICBqc29uOiB7XHJcbiAgICAgIGVuY29kZTogYW5ndWxhci50b0pzb24sXHJcbiAgICAgIGRlY29kZTogYW5ndWxhci5mcm9tSnNvbixcclxuICAgICAgaXM6IGFuZ3VsYXIuaXNPYmplY3QsXHJcbiAgICAgIGVxdWFsczogYW5ndWxhci5lcXVhbHMsXHJcbiAgICAgIHBhdHRlcm46IC9bXi9dKi9cclxuICAgIH0sXHJcbiAgICBhbnk6IHsgLy8gZG9lcyBub3QgZW5jb2RlL2RlY29kZVxyXG4gICAgICBlbmNvZGU6IGFuZ3VsYXIuaWRlbnRpdHksXHJcbiAgICAgIGRlY29kZTogYW5ndWxhci5pZGVudGl0eSxcclxuICAgICAgaXM6IGFuZ3VsYXIuaWRlbnRpdHksXHJcbiAgICAgIGVxdWFsczogYW5ndWxhci5lcXVhbHMsXHJcbiAgICAgIHBhdHRlcm46IC8uKi9cclxuICAgIH1cclxuICB9O1xyXG5cclxuICBmdW5jdGlvbiBnZXREZWZhdWx0Q29uZmlnKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3RyaWN0OiBpc1N0cmljdE1vZGUsXHJcbiAgICAgIGNhc2VJbnNlbnNpdGl2ZTogaXNDYXNlSW5zZW5zaXRpdmVcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBpc0luamVjdGFibGUodmFsdWUpIHtcclxuICAgIHJldHVybiAoaXNGdW5jdGlvbih2YWx1ZSkgfHwgKGlzQXJyYXkodmFsdWUpICYmIGlzRnVuY3Rpb24odmFsdWVbdmFsdWUubGVuZ3RoIC0gMV0pKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBbSW50ZXJuYWxdIEdldCB0aGUgZGVmYXVsdCB2YWx1ZSBvZiBhIHBhcmFtZXRlciwgd2hpY2ggbWF5IGJlIGFuIGluamVjdGFibGUgZnVuY3Rpb24uXHJcbiAgICovXHJcbiAgJFVybE1hdGNoZXJGYWN0b3J5LiQkZ2V0RGVmYXVsdFZhbHVlID0gZnVuY3Rpb24oY29uZmlnKSB7XHJcbiAgICBpZiAoIWlzSW5qZWN0YWJsZShjb25maWcudmFsdWUpKSByZXR1cm4gY29uZmlnLnZhbHVlO1xyXG4gICAgaWYgKCFpbmplY3RvcikgdGhyb3cgbmV3IEVycm9yKFwiSW5qZWN0YWJsZSBmdW5jdGlvbnMgY2Fubm90IGJlIGNhbGxlZCBhdCBjb25maWd1cmF0aW9uIHRpbWVcIik7XHJcbiAgICByZXR1cm4gaW5qZWN0b3IuaW52b2tlKGNvbmZpZy52YWx1ZSk7XHJcbiAgfTtcclxuXHJcbiAgLyoqXHJcbiAgICogQG5nZG9jIGZ1bmN0aW9uXHJcbiAgICogQG5hbWUgdWkucm91dGVyLnV0aWwuJHVybE1hdGNoZXJGYWN0b3J5I2Nhc2VJbnNlbnNpdGl2ZVxyXG4gICAqIEBtZXRob2RPZiB1aS5yb3V0ZXIudXRpbC4kdXJsTWF0Y2hlckZhY3RvcnlcclxuICAgKlxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqIERlZmluZXMgd2hldGhlciBVUkwgbWF0Y2hpbmcgc2hvdWxkIGJlIGNhc2Ugc2Vuc2l0aXZlICh0aGUgZGVmYXVsdCBiZWhhdmlvciksIG9yIG5vdC5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWUgYGZhbHNlYCB0byBtYXRjaCBVUkwgaW4gYSBjYXNlIHNlbnNpdGl2ZSBtYW5uZXI7IG90aGVyd2lzZSBgdHJ1ZWA7XHJcbiAgICogQHJldHVybnMge2Jvb2xlYW59IHRoZSBjdXJyZW50IHZhbHVlIG9mIGNhc2VJbnNlbnNpdGl2ZVxyXG4gICAqL1xyXG4gIHRoaXMuY2FzZUluc2Vuc2l0aXZlID0gZnVuY3Rpb24odmFsdWUpIHtcclxuICAgIGlmIChpc0RlZmluZWQodmFsdWUpKVxyXG4gICAgICBpc0Nhc2VJbnNlbnNpdGl2ZSA9IHZhbHVlO1xyXG4gICAgcmV0dXJuIGlzQ2FzZUluc2Vuc2l0aXZlO1xyXG4gIH07XHJcblxyXG4gIC8qKlxyXG4gICAqIEBuZ2RvYyBmdW5jdGlvblxyXG4gICAqIEBuYW1lIHVpLnJvdXRlci51dGlsLiR1cmxNYXRjaGVyRmFjdG9yeSNzdHJpY3RNb2RlXHJcbiAgICogQG1ldGhvZE9mIHVpLnJvdXRlci51dGlsLiR1cmxNYXRjaGVyRmFjdG9yeVxyXG4gICAqXHJcbiAgICogQGRlc2NyaXB0aW9uXHJcbiAgICogRGVmaW5lcyB3aGV0aGVyIFVSTHMgc2hvdWxkIG1hdGNoIHRyYWlsaW5nIHNsYXNoZXMsIG9yIG5vdCAodGhlIGRlZmF1bHQgYmVoYXZpb3IpLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtib29sZWFuPX0gdmFsdWUgYGZhbHNlYCB0byBtYXRjaCB0cmFpbGluZyBzbGFzaGVzIGluIFVSTHMsIG90aGVyd2lzZSBgdHJ1ZWAuXHJcbiAgICogQHJldHVybnMge2Jvb2xlYW59IHRoZSBjdXJyZW50IHZhbHVlIG9mIHN0cmljdE1vZGVcclxuICAgKi9cclxuICB0aGlzLnN0cmljdE1vZGUgPSBmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgaWYgKGlzRGVmaW5lZCh2YWx1ZSkpXHJcbiAgICAgIGlzU3RyaWN0TW9kZSA9IHZhbHVlO1xyXG4gICAgcmV0dXJuIGlzU3RyaWN0TW9kZTtcclxuICB9O1xyXG5cclxuICAvKipcclxuICAgKiBAbmdkb2MgZnVuY3Rpb25cclxuICAgKiBAbmFtZSB1aS5yb3V0ZXIudXRpbC4kdXJsTWF0Y2hlckZhY3RvcnkjZGVmYXVsdFNxdWFzaFBvbGljeVxyXG4gICAqIEBtZXRob2RPZiB1aS5yb3V0ZXIudXRpbC4kdXJsTWF0Y2hlckZhY3RvcnlcclxuICAgKlxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqIFNldHMgdGhlIGRlZmF1bHQgYmVoYXZpb3Igd2hlbiBnZW5lcmF0aW5nIG9yIG1hdGNoaW5nIFVSTHMgd2l0aCBkZWZhdWx0IHBhcmFtZXRlciB2YWx1ZXMuXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUgQSBzdHJpbmcgdGhhdCBkZWZpbmVzIHRoZSBkZWZhdWx0IHBhcmFtZXRlciBVUkwgc3F1YXNoaW5nIGJlaGF2aW9yLlxyXG4gICAqICAgIGBub3NxdWFzaGA6IFdoZW4gZ2VuZXJhdGluZyBhbiBocmVmIHdpdGggYSBkZWZhdWx0IHBhcmFtZXRlciB2YWx1ZSwgZG8gbm90IHNxdWFzaCB0aGUgcGFyYW1ldGVyIHZhbHVlIGZyb20gdGhlIFVSTFxyXG4gICAqICAgIGBzbGFzaGA6IFdoZW4gZ2VuZXJhdGluZyBhbiBocmVmIHdpdGggYSBkZWZhdWx0IHBhcmFtZXRlciB2YWx1ZSwgc3F1YXNoIChyZW1vdmUpIHRoZSBwYXJhbWV0ZXIgdmFsdWUsIGFuZCwgaWYgdGhlXHJcbiAgICogICAgICAgICAgICAgcGFyYW1ldGVyIGlzIHN1cnJvdW5kZWQgYnkgc2xhc2hlcywgc3F1YXNoIChyZW1vdmUpIG9uZSBzbGFzaCBmcm9tIHRoZSBVUkxcclxuICAgKiAgICBhbnkgb3RoZXIgc3RyaW5nLCBlLmcuIFwiflwiOiBXaGVuIGdlbmVyYXRpbmcgYW4gaHJlZiB3aXRoIGEgZGVmYXVsdCBwYXJhbWV0ZXIgdmFsdWUsIHNxdWFzaCAocmVtb3ZlKVxyXG4gICAqICAgICAgICAgICAgIHRoZSBwYXJhbWV0ZXIgdmFsdWUgZnJvbSB0aGUgVVJMIGFuZCByZXBsYWNlIGl0IHdpdGggdGhpcyBzdHJpbmcuXHJcbiAgICovXHJcbiAgdGhpcy5kZWZhdWx0U3F1YXNoUG9saWN5ID0gZnVuY3Rpb24odmFsdWUpIHtcclxuICAgIGlmICghaXNEZWZpbmVkKHZhbHVlKSkgcmV0dXJuIGRlZmF1bHRTcXVhc2hQb2xpY3k7XHJcbiAgICBpZiAodmFsdWUgIT09IHRydWUgJiYgdmFsdWUgIT09IGZhbHNlICYmICFpc1N0cmluZyh2YWx1ZSkpXHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgc3F1YXNoIHBvbGljeTogXCIgKyB2YWx1ZSArIFwiLiBWYWxpZCBwb2xpY2llczogZmFsc2UsIHRydWUsIGFyYml0cmFyeS1zdHJpbmdcIik7XHJcbiAgICBkZWZhdWx0U3F1YXNoUG9saWN5ID0gdmFsdWU7XHJcbiAgICByZXR1cm4gdmFsdWU7XHJcbiAgfTtcclxuXHJcbiAgLyoqXHJcbiAgICogQG5nZG9jIGZ1bmN0aW9uXHJcbiAgICogQG5hbWUgdWkucm91dGVyLnV0aWwuJHVybE1hdGNoZXJGYWN0b3J5I2NvbXBpbGVcclxuICAgKiBAbWV0aG9kT2YgdWkucm91dGVyLnV0aWwuJHVybE1hdGNoZXJGYWN0b3J5XHJcbiAgICpcclxuICAgKiBAZGVzY3JpcHRpb25cclxuICAgKiBDcmVhdGVzIGEge0BsaW5rIHVpLnJvdXRlci51dGlsLnR5cGU6VXJsTWF0Y2hlciBgVXJsTWF0Y2hlcmB9IGZvciB0aGUgc3BlY2lmaWVkIHBhdHRlcm4uXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGF0dGVybiAgVGhlIFVSTCBwYXR0ZXJuLlxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgIFRoZSBjb25maWcgb2JqZWN0IGhhc2guXHJcbiAgICogQHJldHVybnMge1VybE1hdGNoZXJ9ICBUaGUgVXJsTWF0Y2hlci5cclxuICAgKi9cclxuICB0aGlzLmNvbXBpbGUgPSBmdW5jdGlvbiAocGF0dGVybiwgY29uZmlnKSB7XHJcbiAgICByZXR1cm4gbmV3IFVybE1hdGNoZXIocGF0dGVybiwgZXh0ZW5kKGdldERlZmF1bHRDb25maWcoKSwgY29uZmlnKSk7XHJcbiAgfTtcclxuXHJcbiAgLyoqXHJcbiAgICogQG5nZG9jIGZ1bmN0aW9uXHJcbiAgICogQG5hbWUgdWkucm91dGVyLnV0aWwuJHVybE1hdGNoZXJGYWN0b3J5I2lzTWF0Y2hlclxyXG4gICAqIEBtZXRob2RPZiB1aS5yb3V0ZXIudXRpbC4kdXJsTWF0Y2hlckZhY3RvcnlcclxuICAgKlxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgc3BlY2lmaWVkIG9iamVjdCBpcyBhIGBVcmxNYXRjaGVyYCwgb3IgZmFsc2Ugb3RoZXJ3aXNlLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCAgVGhlIG9iamVjdCB0byBwZXJmb3JtIHRoZSB0eXBlIGNoZWNrIGFnYWluc3QuXHJcbiAgICogQHJldHVybnMge0Jvb2xlYW59ICBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgb2JqZWN0IG1hdGNoZXMgdGhlIGBVcmxNYXRjaGVyYCBpbnRlcmZhY2UsIGJ5XHJcbiAgICogICAgICAgICAgaW1wbGVtZW50aW5nIGFsbCB0aGUgc2FtZSBtZXRob2RzLlxyXG4gICAqL1xyXG4gIHRoaXMuaXNNYXRjaGVyID0gZnVuY3Rpb24gKG8pIHtcclxuICAgIGlmICghaXNPYmplY3QobykpIHJldHVybiBmYWxzZTtcclxuICAgIHZhciByZXN1bHQgPSB0cnVlO1xyXG5cclxuICAgIGZvckVhY2goVXJsTWF0Y2hlci5wcm90b3R5cGUsIGZ1bmN0aW9uKHZhbCwgbmFtZSkge1xyXG4gICAgICBpZiAoaXNGdW5jdGlvbih2YWwpKSB7XHJcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIChpc0RlZmluZWQob1tuYW1lXSkgJiYgaXNGdW5jdGlvbihvW25hbWVdKSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9O1xyXG5cclxuICAvKipcclxuICAgKiBAbmdkb2MgZnVuY3Rpb25cclxuICAgKiBAbmFtZSB1aS5yb3V0ZXIudXRpbC4kdXJsTWF0Y2hlckZhY3RvcnkjdHlwZVxyXG4gICAqIEBtZXRob2RPZiB1aS5yb3V0ZXIudXRpbC4kdXJsTWF0Y2hlckZhY3RvcnlcclxuICAgKlxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqIFJlZ2lzdGVycyBhIGN1c3RvbSB7QGxpbmsgdWkucm91dGVyLnV0aWwudHlwZTpUeXBlIGBUeXBlYH0gb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgdG9cclxuICAgKiBnZW5lcmF0ZSBVUkxzIHdpdGggdHlwZWQgcGFyYW1ldGVycy5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lICBUaGUgdHlwZSBuYW1lLlxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fEZ1bmN0aW9ufSBkZWZpbml0aW9uICAgVGhlIHR5cGUgZGVmaW5pdGlvbi4gU2VlXHJcbiAgICogICAgICAgIHtAbGluayB1aS5yb3V0ZXIudXRpbC50eXBlOlR5cGUgYFR5cGVgfSBmb3IgaW5mb3JtYXRpb24gb24gdGhlIHZhbHVlcyBhY2NlcHRlZC5cclxuICAgKiBAcGFyYW0ge09iamVjdHxGdW5jdGlvbn0gZGVmaW5pdGlvbkZuIChvcHRpb25hbCkgQSBmdW5jdGlvbiB0aGF0IGlzIGluamVjdGVkIGJlZm9yZSB0aGUgYXBwXHJcbiAgICogICAgICAgIHJ1bnRpbWUgc3RhcnRzLiAgVGhlIHJlc3VsdCBvZiB0aGlzIGZ1bmN0aW9uIGlzIG1lcmdlZCBpbnRvIHRoZSBleGlzdGluZyBgZGVmaW5pdGlvbmAuXHJcbiAgICogICAgICAgIFNlZSB7QGxpbmsgdWkucm91dGVyLnV0aWwudHlwZTpUeXBlIGBUeXBlYH0gZm9yIGluZm9ybWF0aW9uIG9uIHRoZSB2YWx1ZXMgYWNjZXB0ZWQuXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB7T2JqZWN0fSAgUmV0dXJucyBgJHVybE1hdGNoZXJGYWN0b3J5UHJvdmlkZXJgLlxyXG4gICAqXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBUaGlzIGlzIGEgc2ltcGxlIGV4YW1wbGUgb2YgYSBjdXN0b20gdHlwZSB0aGF0IGVuY29kZXMgYW5kIGRlY29kZXMgaXRlbXMgZnJvbSBhblxyXG4gICAqIGFycmF5LCB1c2luZyB0aGUgYXJyYXkgaW5kZXggYXMgdGhlIFVSTC1lbmNvZGVkIHZhbHVlOlxyXG4gICAqXHJcbiAgICogPHByZT5cclxuICAgKiB2YXIgbGlzdCA9IFsnSm9obicsICdQYXVsJywgJ0dlb3JnZScsICdSaW5nbyddO1xyXG4gICAqXHJcbiAgICogJHVybE1hdGNoZXJGYWN0b3J5UHJvdmlkZXIudHlwZSgnbGlzdEl0ZW0nLCB7XHJcbiAgICogICBlbmNvZGU6IGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgKiAgICAgLy8gUmVwcmVzZW50IHRoZSBsaXN0IGl0ZW0gaW4gdGhlIFVSTCB1c2luZyBpdHMgY29ycmVzcG9uZGluZyBpbmRleFxyXG4gICAqICAgICByZXR1cm4gbGlzdC5pbmRleE9mKGl0ZW0pO1xyXG4gICAqICAgfSxcclxuICAgKiAgIGRlY29kZTogZnVuY3Rpb24oaXRlbSkge1xyXG4gICAqICAgICAvLyBMb29rIHVwIHRoZSBsaXN0IGl0ZW0gYnkgaW5kZXhcclxuICAgKiAgICAgcmV0dXJuIGxpc3RbcGFyc2VJbnQoaXRlbSwgMTApXTtcclxuICAgKiAgIH0sXHJcbiAgICogICBpczogZnVuY3Rpb24oaXRlbSkge1xyXG4gICAqICAgICAvLyBFbnN1cmUgdGhlIGl0ZW0gaXMgdmFsaWQgYnkgY2hlY2tpbmcgdG8gc2VlIHRoYXQgaXQgYXBwZWFyc1xyXG4gICAqICAgICAvLyBpbiB0aGUgbGlzdFxyXG4gICAqICAgICByZXR1cm4gbGlzdC5pbmRleE9mKGl0ZW0pID4gLTE7XHJcbiAgICogICB9XHJcbiAgICogfSk7XHJcbiAgICpcclxuICAgKiAkc3RhdGVQcm92aWRlci5zdGF0ZSgnbGlzdCcsIHtcclxuICAgKiAgIHVybDogXCIvbGlzdC97aXRlbTpsaXN0SXRlbX1cIixcclxuICAgKiAgIGNvbnRyb2xsZXI6IGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlUGFyYW1zKSB7XHJcbiAgICogICAgIGNvbnNvbGUubG9nKCRzdGF0ZVBhcmFtcy5pdGVtKTtcclxuICAgKiAgIH1cclxuICAgKiB9KTtcclxuICAgKlxyXG4gICAqIC8vIC4uLlxyXG4gICAqXHJcbiAgICogLy8gQ2hhbmdlcyBVUkwgdG8gJy9saXN0LzMnLCBsb2dzIFwiUmluZ29cIiB0byB0aGUgY29uc29sZVxyXG4gICAqICRzdGF0ZS5nbygnbGlzdCcsIHsgaXRlbTogXCJSaW5nb1wiIH0pO1xyXG4gICAqIDwvcHJlPlxyXG4gICAqXHJcbiAgICogVGhpcyBpcyBhIG1vcmUgY29tcGxleCBleGFtcGxlIG9mIGEgdHlwZSB0aGF0IHJlbGllcyBvbiBkZXBlbmRlbmN5IGluamVjdGlvbiB0b1xyXG4gICAqIGludGVyYWN0IHdpdGggc2VydmljZXMsIGFuZCB1c2VzIHRoZSBwYXJhbWV0ZXIgbmFtZSBmcm9tIHRoZSBVUkwgdG8gaW5mZXIgaG93IHRvXHJcbiAgICogaGFuZGxlIGVuY29kaW5nIGFuZCBkZWNvZGluZyBwYXJhbWV0ZXIgdmFsdWVzOlxyXG4gICAqXHJcbiAgICogPHByZT5cclxuICAgKiAvLyBEZWZpbmVzIGEgY3VzdG9tIHR5cGUgdGhhdCBnZXRzIGEgdmFsdWUgZnJvbSBhIHNlcnZpY2UsXHJcbiAgICogLy8gd2hlcmUgZWFjaCBzZXJ2aWNlIGdldHMgZGlmZmVyZW50IHR5cGVzIG9mIHZhbHVlcyBmcm9tXHJcbiAgICogLy8gYSBiYWNrZW5kIEFQSTpcclxuICAgKiAkdXJsTWF0Y2hlckZhY3RvcnlQcm92aWRlci50eXBlKCdkYk9iamVjdCcsIHt9LCBmdW5jdGlvbihVc2VycywgUG9zdHMpIHtcclxuICAgKlxyXG4gICAqICAgLy8gTWF0Y2hlcyB1cCBzZXJ2aWNlcyB0byBVUkwgcGFyYW1ldGVyIG5hbWVzXHJcbiAgICogICB2YXIgc2VydmljZXMgPSB7XHJcbiAgICogICAgIHVzZXI6IFVzZXJzLFxyXG4gICAqICAgICBwb3N0OiBQb3N0c1xyXG4gICAqICAgfTtcclxuICAgKlxyXG4gICAqICAgcmV0dXJuIHtcclxuICAgKiAgICAgZW5jb2RlOiBmdW5jdGlvbihvYmplY3QpIHtcclxuICAgKiAgICAgICAvLyBSZXByZXNlbnQgdGhlIG9iamVjdCBpbiB0aGUgVVJMIHVzaW5nIGl0cyB1bmlxdWUgSURcclxuICAgKiAgICAgICByZXR1cm4gb2JqZWN0LmlkO1xyXG4gICAqICAgICB9LFxyXG4gICAqICAgICBkZWNvZGU6IGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcclxuICAgKiAgICAgICAvLyBMb29rIHVwIHRoZSBvYmplY3QgYnkgSUQsIHVzaW5nIHRoZSBwYXJhbWV0ZXJcclxuICAgKiAgICAgICAvLyBuYW1lIChrZXkpIHRvIGNhbGwgdGhlIGNvcnJlY3Qgc2VydmljZVxyXG4gICAqICAgICAgIHJldHVybiBzZXJ2aWNlc1trZXldLmZpbmRCeUlkKHZhbHVlKTtcclxuICAgKiAgICAgfSxcclxuICAgKiAgICAgaXM6IGZ1bmN0aW9uKG9iamVjdCwga2V5KSB7XHJcbiAgICogICAgICAgLy8gQ2hlY2sgdGhhdCBvYmplY3QgaXMgYSB2YWxpZCBkYk9iamVjdFxyXG4gICAqICAgICAgIHJldHVybiBhbmd1bGFyLmlzT2JqZWN0KG9iamVjdCkgJiYgb2JqZWN0LmlkICYmIHNlcnZpY2VzW2tleV07XHJcbiAgICogICAgIH1cclxuICAgKiAgICAgZXF1YWxzOiBmdW5jdGlvbihhLCBiKSB7XHJcbiAgICogICAgICAgLy8gQ2hlY2sgdGhlIGVxdWFsaXR5IG9mIGRlY29kZWQgb2JqZWN0cyBieSBjb21wYXJpbmdcclxuICAgKiAgICAgICAvLyB0aGVpciB1bmlxdWUgSURzXHJcbiAgICogICAgICAgcmV0dXJuIGEuaWQgPT09IGIuaWQ7XHJcbiAgICogICAgIH1cclxuICAgKiAgIH07XHJcbiAgICogfSk7XHJcbiAgICpcclxuICAgKiAvLyBJbiBhIGNvbmZpZygpIGJsb2NrLCB5b3UgY2FuIHRoZW4gYXR0YWNoIFVSTHMgd2l0aFxyXG4gICAqIC8vIHR5cGUtYW5ub3RhdGVkIHBhcmFtZXRlcnM6XHJcbiAgICogJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ3VzZXJzJywge1xyXG4gICAqICAgdXJsOiBcIi91c2Vyc1wiLFxyXG4gICAqICAgLy8gLi4uXHJcbiAgICogfSkuc3RhdGUoJ3VzZXJzLml0ZW0nLCB7XHJcbiAgICogICB1cmw6IFwiL3t1c2VyOmRiT2JqZWN0fVwiLFxyXG4gICAqICAgY29udHJvbGxlcjogZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGVQYXJhbXMpIHtcclxuICAgKiAgICAgLy8gJHN0YXRlUGFyYW1zLnVzZXIgd2lsbCBub3cgYmUgYW4gb2JqZWN0IHJldHVybmVkIGZyb21cclxuICAgKiAgICAgLy8gdGhlIFVzZXJzIHNlcnZpY2VcclxuICAgKiAgIH0sXHJcbiAgICogICAvLyAuLi5cclxuICAgKiB9KTtcclxuICAgKiA8L3ByZT5cclxuICAgKi9cclxuICB0aGlzLnR5cGUgPSBmdW5jdGlvbiAobmFtZSwgZGVmaW5pdGlvbiwgZGVmaW5pdGlvbkZuKSB7XHJcbiAgICBpZiAoIWlzRGVmaW5lZChkZWZpbml0aW9uKSkgcmV0dXJuICR0eXBlc1tuYW1lXTtcclxuICAgIGlmICgkdHlwZXMuaGFzT3duUHJvcGVydHkobmFtZSkpIHRocm93IG5ldyBFcnJvcihcIkEgdHlwZSBuYW1lZCAnXCIgKyBuYW1lICsgXCInIGhhcyBhbHJlYWR5IGJlZW4gZGVmaW5lZC5cIik7XHJcblxyXG4gICAgJHR5cGVzW25hbWVdID0gbmV3IFR5cGUoZXh0ZW5kKHsgbmFtZTogbmFtZSB9LCBkZWZpbml0aW9uKSk7XHJcbiAgICBpZiAoZGVmaW5pdGlvbkZuKSB7XHJcbiAgICAgIHR5cGVRdWV1ZS5wdXNoKHsgbmFtZTogbmFtZSwgZGVmOiBkZWZpbml0aW9uRm4gfSk7XHJcbiAgICAgIGlmICghZW5xdWV1ZSkgZmx1c2hUeXBlUXVldWUoKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH07XHJcblxyXG4gIC8vIGBmbHVzaFR5cGVRdWV1ZSgpYCB3YWl0cyB1bnRpbCBgJHVybE1hdGNoZXJGYWN0b3J5YCBpcyBpbmplY3RlZCBiZWZvcmUgaW52b2tpbmcgdGhlIHF1ZXVlZCBgZGVmaW5pdGlvbkZuYHNcclxuICBmdW5jdGlvbiBmbHVzaFR5cGVRdWV1ZSgpIHtcclxuICAgIHdoaWxlKHR5cGVRdWV1ZS5sZW5ndGgpIHtcclxuICAgICAgdmFyIHR5cGUgPSB0eXBlUXVldWUuc2hpZnQoKTtcclxuICAgICAgaWYgKHR5cGUucGF0dGVybikgdGhyb3cgbmV3IEVycm9yKFwiWW91IGNhbm5vdCBvdmVycmlkZSBhIHR5cGUncyAucGF0dGVybiBhdCBydW50aW1lLlwiKTtcclxuICAgICAgYW5ndWxhci5leHRlbmQoJHR5cGVzW3R5cGUubmFtZV0sIGluamVjdG9yLmludm9rZSh0eXBlLmRlZikpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gUmVnaXN0ZXIgZGVmYXVsdCB0eXBlcy4gU3RvcmUgdGhlbSBpbiB0aGUgcHJvdG90eXBlIG9mICR0eXBlcy5cclxuICBmb3JFYWNoKGRlZmF1bHRUeXBlcywgZnVuY3Rpb24odHlwZSwgbmFtZSkgeyAkdHlwZXNbbmFtZV0gPSBuZXcgVHlwZShleHRlbmQoe25hbWU6IG5hbWV9LCB0eXBlKSk7IH0pO1xyXG4gICR0eXBlcyA9IGluaGVyaXQoJHR5cGVzLCB7fSk7XHJcblxyXG4gIC8qIE5vIG5lZWQgdG8gZG9jdW1lbnQgJGdldCwgc2luY2UgaXQgcmV0dXJucyB0aGlzICovXHJcbiAgdGhpcy4kZ2V0ID0gWyckaW5qZWN0b3InLCBmdW5jdGlvbiAoJGluamVjdG9yKSB7XHJcbiAgICBpbmplY3RvciA9ICRpbmplY3RvcjtcclxuICAgIGVucXVldWUgPSBmYWxzZTtcclxuICAgIGZsdXNoVHlwZVF1ZXVlKCk7XHJcblxyXG4gICAgZm9yRWFjaChkZWZhdWx0VHlwZXMsIGZ1bmN0aW9uKHR5cGUsIG5hbWUpIHtcclxuICAgICAgaWYgKCEkdHlwZXNbbmFtZV0pICR0eXBlc1tuYW1lXSA9IG5ldyBUeXBlKHR5cGUpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XTtcclxuXHJcbiAgdGhpcy5QYXJhbSA9IGZ1bmN0aW9uIFBhcmFtKGlkLCB0eXBlLCBjb25maWcsIGxvY2F0aW9uKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICBjb25maWcgPSB1bndyYXBTaG9ydGhhbmQoY29uZmlnKTtcclxuICAgIHR5cGUgPSBnZXRUeXBlKGNvbmZpZywgdHlwZSwgbG9jYXRpb24pO1xyXG4gICAgdmFyIGFycmF5TW9kZSA9IGdldEFycmF5TW9kZSgpO1xyXG4gICAgdHlwZSA9IGFycmF5TW9kZSA/IHR5cGUuJGFzQXJyYXkoYXJyYXlNb2RlLCBsb2NhdGlvbiA9PT0gXCJzZWFyY2hcIikgOiB0eXBlO1xyXG4gICAgaWYgKHR5cGUubmFtZSA9PT0gXCJzdHJpbmdcIiAmJiAhYXJyYXlNb2RlICYmIGxvY2F0aW9uID09PSBcInBhdGhcIiAmJiBjb25maWcudmFsdWUgPT09IHVuZGVmaW5lZClcclxuICAgICAgY29uZmlnLnZhbHVlID0gXCJcIjsgLy8gZm9yIDAuMi54OyBpbiAwLjMuMCsgZG8gbm90IGF1dG9tYXRpY2FsbHkgZGVmYXVsdCB0byBcIlwiXHJcbiAgICB2YXIgaXNPcHRpb25hbCA9IGNvbmZpZy52YWx1ZSAhPT0gdW5kZWZpbmVkO1xyXG4gICAgdmFyIHNxdWFzaCA9IGdldFNxdWFzaFBvbGljeShjb25maWcsIGlzT3B0aW9uYWwpO1xyXG4gICAgdmFyIHJlcGxhY2UgPSBnZXRSZXBsYWNlKGNvbmZpZywgYXJyYXlNb2RlLCBpc09wdGlvbmFsLCBzcXVhc2gpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHVud3JhcFNob3J0aGFuZChjb25maWcpIHtcclxuICAgICAgdmFyIGtleXMgPSBpc09iamVjdChjb25maWcpID8gb2JqZWN0S2V5cyhjb25maWcpIDogW107XHJcbiAgICAgIHZhciBpc1Nob3J0aGFuZCA9IGluZGV4T2Yoa2V5cywgXCJ2YWx1ZVwiKSA9PT0gLTEgJiYgaW5kZXhPZihrZXlzLCBcInR5cGVcIikgPT09IC0xICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4T2Yoa2V5cywgXCJzcXVhc2hcIikgPT09IC0xICYmIGluZGV4T2Yoa2V5cywgXCJhcnJheVwiKSA9PT0gLTE7XHJcbiAgICAgIGlmIChpc1Nob3J0aGFuZCkgY29uZmlnID0geyB2YWx1ZTogY29uZmlnIH07XHJcbiAgICAgIGNvbmZpZy4kJGZuID0gaXNJbmplY3RhYmxlKGNvbmZpZy52YWx1ZSkgPyBjb25maWcudmFsdWUgOiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb25maWcudmFsdWU7IH07XHJcbiAgICAgIHJldHVybiBjb25maWc7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0VHlwZShjb25maWcsIHVybFR5cGUsIGxvY2F0aW9uKSB7XHJcbiAgICAgIGlmIChjb25maWcudHlwZSAmJiB1cmxUeXBlKSB0aHJvdyBuZXcgRXJyb3IoXCJQYXJhbSAnXCIraWQrXCInIGhhcyB0d28gdHlwZSBjb25maWd1cmF0aW9ucy5cIik7XHJcbiAgICAgIGlmICh1cmxUeXBlKSByZXR1cm4gdXJsVHlwZTtcclxuICAgICAgaWYgKCFjb25maWcudHlwZSkgcmV0dXJuIChsb2NhdGlvbiA9PT0gXCJjb25maWdcIiA/ICR0eXBlcy5hbnkgOiAkdHlwZXMuc3RyaW5nKTtcclxuICAgICAgcmV0dXJuIGNvbmZpZy50eXBlIGluc3RhbmNlb2YgVHlwZSA/IGNvbmZpZy50eXBlIDogbmV3IFR5cGUoY29uZmlnLnR5cGUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGFycmF5IGNvbmZpZzogcGFyYW0gbmFtZSAocGFyYW1bXSkgb3ZlcnJpZGVzIGRlZmF1bHQgc2V0dGluZ3MuICBleHBsaWNpdCBjb25maWcgb3ZlcnJpZGVzIHBhcmFtIG5hbWUuXHJcbiAgICBmdW5jdGlvbiBnZXRBcnJheU1vZGUoKSB7XHJcbiAgICAgIHZhciBhcnJheURlZmF1bHRzID0geyBhcnJheTogKGxvY2F0aW9uID09PSBcInNlYXJjaFwiID8gXCJhdXRvXCIgOiBmYWxzZSkgfTtcclxuICAgICAgdmFyIGFycmF5UGFyYW1Ob21lbmNsYXR1cmUgPSBpZC5tYXRjaCgvXFxbXFxdJC8pID8geyBhcnJheTogdHJ1ZSB9IDoge307XHJcbiAgICAgIHJldHVybiBleHRlbmQoYXJyYXlEZWZhdWx0cywgYXJyYXlQYXJhbU5vbWVuY2xhdHVyZSwgY29uZmlnKS5hcnJheTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHJldHVybnMgZmFsc2UsIHRydWUsIG9yIHRoZSBzcXVhc2ggdmFsdWUgdG8gaW5kaWNhdGUgdGhlIFwiZGVmYXVsdCBwYXJhbWV0ZXIgdXJsIHNxdWFzaCBwb2xpY3lcIi5cclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gZ2V0U3F1YXNoUG9saWN5KGNvbmZpZywgaXNPcHRpb25hbCkge1xyXG4gICAgICB2YXIgc3F1YXNoID0gY29uZmlnLnNxdWFzaDtcclxuICAgICAgaWYgKCFpc09wdGlvbmFsIHx8IHNxdWFzaCA9PT0gZmFsc2UpIHJldHVybiBmYWxzZTtcclxuICAgICAgaWYgKCFpc0RlZmluZWQoc3F1YXNoKSB8fCBzcXVhc2ggPT0gbnVsbCkgcmV0dXJuIGRlZmF1bHRTcXVhc2hQb2xpY3k7XHJcbiAgICAgIGlmIChzcXVhc2ggPT09IHRydWUgfHwgaXNTdHJpbmcoc3F1YXNoKSkgcmV0dXJuIHNxdWFzaDtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBzcXVhc2ggcG9saWN5OiAnXCIgKyBzcXVhc2ggKyBcIicuIFZhbGlkIHBvbGljaWVzOiBmYWxzZSwgdHJ1ZSwgb3IgYXJiaXRyYXJ5IHN0cmluZ1wiKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRSZXBsYWNlKGNvbmZpZywgYXJyYXlNb2RlLCBpc09wdGlvbmFsLCBzcXVhc2gpIHtcclxuICAgICAgdmFyIHJlcGxhY2UsIGNvbmZpZ3VyZWRLZXlzLCBkZWZhdWx0UG9saWN5ID0gW1xyXG4gICAgICAgIHsgZnJvbTogXCJcIiwgICB0bzogKGlzT3B0aW9uYWwgfHwgYXJyYXlNb2RlID8gdW5kZWZpbmVkIDogXCJcIikgfSxcclxuICAgICAgICB7IGZyb206IG51bGwsIHRvOiAoaXNPcHRpb25hbCB8fCBhcnJheU1vZGUgPyB1bmRlZmluZWQgOiBcIlwiKSB9XHJcbiAgICAgIF07XHJcbiAgICAgIHJlcGxhY2UgPSBpc0FycmF5KGNvbmZpZy5yZXBsYWNlKSA/IGNvbmZpZy5yZXBsYWNlIDogW107XHJcbiAgICAgIGlmIChpc1N0cmluZyhzcXVhc2gpKVxyXG4gICAgICAgIHJlcGxhY2UucHVzaCh7IGZyb206IHNxdWFzaCwgdG86IHVuZGVmaW5lZCB9KTtcclxuICAgICAgY29uZmlndXJlZEtleXMgPSBtYXAocmVwbGFjZSwgZnVuY3Rpb24oaXRlbSkgeyByZXR1cm4gaXRlbS5mcm9tOyB9ICk7XHJcbiAgICAgIHJldHVybiBmaWx0ZXIoZGVmYXVsdFBvbGljeSwgZnVuY3Rpb24oaXRlbSkgeyByZXR1cm4gaW5kZXhPZihjb25maWd1cmVkS2V5cywgaXRlbS5mcm9tKSA9PT0gLTE7IH0pLmNvbmNhdChyZXBsYWNlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFtJbnRlcm5hbF0gR2V0IHRoZSBkZWZhdWx0IHZhbHVlIG9mIGEgcGFyYW1ldGVyLCB3aGljaCBtYXkgYmUgYW4gaW5qZWN0YWJsZSBmdW5jdGlvbi5cclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gJCRnZXREZWZhdWx0VmFsdWUoKSB7XHJcbiAgICAgIGlmICghaW5qZWN0b3IpIHRocm93IG5ldyBFcnJvcihcIkluamVjdGFibGUgZnVuY3Rpb25zIGNhbm5vdCBiZSBjYWxsZWQgYXQgY29uZmlndXJhdGlvbiB0aW1lXCIpO1xyXG4gICAgICByZXR1cm4gaW5qZWN0b3IuaW52b2tlKGNvbmZpZy4kJGZuKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFtJbnRlcm5hbF0gR2V0cyB0aGUgZGVjb2RlZCByZXByZXNlbnRhdGlvbiBvZiBhIHZhbHVlIGlmIHRoZSB2YWx1ZSBpcyBkZWZpbmVkLCBvdGhlcndpc2UsIHJldHVybnMgdGhlXHJcbiAgICAgKiBkZWZhdWx0IHZhbHVlLCB3aGljaCBtYXkgYmUgdGhlIHJlc3VsdCBvZiBhbiBpbmplY3RhYmxlIGZ1bmN0aW9uLlxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiAkdmFsdWUodmFsdWUpIHtcclxuICAgICAgZnVuY3Rpb24gaGFzUmVwbGFjZVZhbCh2YWwpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iaikgeyByZXR1cm4gb2JqLmZyb20gPT09IHZhbDsgfTsgfVxyXG4gICAgICBmdW5jdGlvbiAkcmVwbGFjZSh2YWx1ZSkge1xyXG4gICAgICAgIHZhciByZXBsYWNlbWVudCA9IG1hcChmaWx0ZXIoc2VsZi5yZXBsYWNlLCBoYXNSZXBsYWNlVmFsKHZhbHVlKSksIGZ1bmN0aW9uKG9iaikgeyByZXR1cm4gb2JqLnRvOyB9KTtcclxuICAgICAgICByZXR1cm4gcmVwbGFjZW1lbnQubGVuZ3RoID8gcmVwbGFjZW1lbnRbMF0gOiB2YWx1ZTtcclxuICAgICAgfVxyXG4gICAgICB2YWx1ZSA9ICRyZXBsYWNlKHZhbHVlKTtcclxuICAgICAgcmV0dXJuIGlzRGVmaW5lZCh2YWx1ZSkgPyBzZWxmLnR5cGUuZGVjb2RlKHZhbHVlKSA6ICQkZ2V0RGVmYXVsdFZhbHVlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gdG9TdHJpbmcoKSB7IHJldHVybiBcIntQYXJhbTpcIiArIGlkICsgXCIgXCIgKyB0eXBlICsgXCIgc3F1YXNoOiAnXCIgKyBzcXVhc2ggKyBcIicgb3B0aW9uYWw6IFwiICsgaXNPcHRpb25hbCArIFwifVwiOyB9XHJcblxyXG4gICAgZXh0ZW5kKHRoaXMsIHtcclxuICAgICAgaWQ6IGlkLFxyXG4gICAgICB0eXBlOiB0eXBlLFxyXG4gICAgICBsb2NhdGlvbjogbG9jYXRpb24sXHJcbiAgICAgIGFycmF5OiBhcnJheU1vZGUsXHJcbiAgICAgIHNxdWFzaDogc3F1YXNoLFxyXG4gICAgICByZXBsYWNlOiByZXBsYWNlLFxyXG4gICAgICBpc09wdGlvbmFsOiBpc09wdGlvbmFsLFxyXG4gICAgICB2YWx1ZTogJHZhbHVlLFxyXG4gICAgICBkeW5hbWljOiB1bmRlZmluZWQsXHJcbiAgICAgIGNvbmZpZzogY29uZmlnLFxyXG4gICAgICB0b1N0cmluZzogdG9TdHJpbmdcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIGZ1bmN0aW9uIFBhcmFtU2V0KHBhcmFtcykge1xyXG4gICAgZXh0ZW5kKHRoaXMsIHBhcmFtcyB8fCB7fSk7XHJcbiAgfVxyXG5cclxuICBQYXJhbVNldC5wcm90b3R5cGUgPSB7XHJcbiAgICAkJG5ldzogZnVuY3Rpb24oKSB7XHJcbiAgICAgIHJldHVybiBpbmhlcml0KHRoaXMsIGV4dGVuZChuZXcgUGFyYW1TZXQoKSwgeyAkJHBhcmVudDogdGhpc30pKTtcclxuICAgIH0sXHJcbiAgICAkJGtleXM6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgdmFyIGtleXMgPSBbXSwgY2hhaW4gPSBbXSwgcGFyZW50ID0gdGhpcyxcclxuICAgICAgICBpZ25vcmUgPSBvYmplY3RLZXlzKFBhcmFtU2V0LnByb3RvdHlwZSk7XHJcbiAgICAgIHdoaWxlIChwYXJlbnQpIHsgY2hhaW4ucHVzaChwYXJlbnQpOyBwYXJlbnQgPSBwYXJlbnQuJCRwYXJlbnQ7IH1cclxuICAgICAgY2hhaW4ucmV2ZXJzZSgpO1xyXG4gICAgICBmb3JFYWNoKGNoYWluLCBmdW5jdGlvbihwYXJhbXNldCkge1xyXG4gICAgICAgIGZvckVhY2gob2JqZWN0S2V5cyhwYXJhbXNldCksIGZ1bmN0aW9uKGtleSkge1xyXG4gICAgICAgICAgICBpZiAoaW5kZXhPZihrZXlzLCBrZXkpID09PSAtMSAmJiBpbmRleE9mKGlnbm9yZSwga2V5KSA9PT0gLTEpIGtleXMucHVzaChrZXkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGtleXM7XHJcbiAgICB9LFxyXG4gICAgJCR2YWx1ZXM6IGZ1bmN0aW9uKHBhcmFtVmFsdWVzKSB7XHJcbiAgICAgIHZhciB2YWx1ZXMgPSB7fSwgc2VsZiA9IHRoaXM7XHJcbiAgICAgIGZvckVhY2goc2VsZi4kJGtleXMoKSwgZnVuY3Rpb24oa2V5KSB7XHJcbiAgICAgICAgdmFsdWVzW2tleV0gPSBzZWxmW2tleV0udmFsdWUocGFyYW1WYWx1ZXMgJiYgcGFyYW1WYWx1ZXNba2V5XSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gdmFsdWVzO1xyXG4gICAgfSxcclxuICAgICQkZXF1YWxzOiBmdW5jdGlvbihwYXJhbVZhbHVlczEsIHBhcmFtVmFsdWVzMikge1xyXG4gICAgICB2YXIgZXF1YWwgPSB0cnVlLCBzZWxmID0gdGhpcztcclxuICAgICAgZm9yRWFjaChzZWxmLiQka2V5cygpLCBmdW5jdGlvbihrZXkpIHtcclxuICAgICAgICB2YXIgbGVmdCA9IHBhcmFtVmFsdWVzMSAmJiBwYXJhbVZhbHVlczFba2V5XSwgcmlnaHQgPSBwYXJhbVZhbHVlczIgJiYgcGFyYW1WYWx1ZXMyW2tleV07XHJcbiAgICAgICAgaWYgKCFzZWxmW2tleV0udHlwZS5lcXVhbHMobGVmdCwgcmlnaHQpKSBlcXVhbCA9IGZhbHNlO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGVxdWFsO1xyXG4gICAgfSxcclxuICAgICQkdmFsaWRhdGVzOiBmdW5jdGlvbiAkJHZhbGlkYXRlKHBhcmFtVmFsdWVzKSB7XHJcbiAgICAgIHZhciByZXN1bHQgPSB0cnVlLCBpc09wdGlvbmFsLCB2YWwsIHBhcmFtLCBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgIGZvckVhY2godGhpcy4kJGtleXMoKSwgZnVuY3Rpb24oa2V5KSB7XHJcbiAgICAgICAgcGFyYW0gPSBzZWxmW2tleV07XHJcbiAgICAgICAgdmFsID0gcGFyYW1WYWx1ZXNba2V5XTtcclxuICAgICAgICBpc09wdGlvbmFsID0gIXZhbCAmJiBwYXJhbS5pc09wdGlvbmFsO1xyXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiAoaXNPcHRpb25hbCB8fCAhIXBhcmFtLnR5cGUuaXModmFsKSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfSxcclxuICAgICQkcGFyZW50OiB1bmRlZmluZWRcclxuICB9O1xyXG5cclxuICB0aGlzLlBhcmFtU2V0ID0gUGFyYW1TZXQ7XHJcbn1cclxuXHJcbi8vIFJlZ2lzdGVyIGFzIGEgcHJvdmlkZXIgc28gaXQncyBhdmFpbGFibGUgdG8gb3RoZXIgcHJvdmlkZXJzXHJcbmFuZ3VsYXIubW9kdWxlKCd1aS5yb3V0ZXIudXRpbCcpLnByb3ZpZGVyKCckdXJsTWF0Y2hlckZhY3RvcnknLCAkVXJsTWF0Y2hlckZhY3RvcnkpO1xyXG5hbmd1bGFyLm1vZHVsZSgndWkucm91dGVyLnV0aWwnKS5ydW4oWyckdXJsTWF0Y2hlckZhY3RvcnknLCBmdW5jdGlvbigkdXJsTWF0Y2hlckZhY3RvcnkpIHsgfV0pO1xyXG5cclxuLyoqXHJcbiAqIEBuZ2RvYyBvYmplY3RcclxuICogQG5hbWUgdWkucm91dGVyLnJvdXRlci4kdXJsUm91dGVyUHJvdmlkZXJcclxuICpcclxuICogQHJlcXVpcmVzIHVpLnJvdXRlci51dGlsLiR1cmxNYXRjaGVyRmFjdG9yeVByb3ZpZGVyXHJcbiAqIEByZXF1aXJlcyAkbG9jYXRpb25Qcm92aWRlclxyXG4gKlxyXG4gKiBAZGVzY3JpcHRpb25cclxuICogYCR1cmxSb3V0ZXJQcm92aWRlcmAgaGFzIHRoZSByZXNwb25zaWJpbGl0eSBvZiB3YXRjaGluZyBgJGxvY2F0aW9uYC4gXHJcbiAqIFdoZW4gYCRsb2NhdGlvbmAgY2hhbmdlcyBpdCBydW5zIHRocm91Z2ggYSBsaXN0IG9mIHJ1bGVzIG9uZSBieSBvbmUgdW50aWwgYSBcclxuICogbWF0Y2ggaXMgZm91bmQuIGAkdXJsUm91dGVyUHJvdmlkZXJgIGlzIHVzZWQgYmVoaW5kIHRoZSBzY2VuZXMgYW55dGltZSB5b3Ugc3BlY2lmeSBcclxuICogYSB1cmwgaW4gYSBzdGF0ZSBjb25maWd1cmF0aW9uLiBBbGwgdXJscyBhcmUgY29tcGlsZWQgaW50byBhIFVybE1hdGNoZXIgb2JqZWN0LlxyXG4gKlxyXG4gKiBUaGVyZSBhcmUgc2V2ZXJhbCBtZXRob2RzIG9uIGAkdXJsUm91dGVyUHJvdmlkZXJgIHRoYXQgbWFrZSBpdCB1c2VmdWwgdG8gdXNlIGRpcmVjdGx5XHJcbiAqIGluIHlvdXIgbW9kdWxlIGNvbmZpZy5cclxuICovXHJcbiRVcmxSb3V0ZXJQcm92aWRlci4kaW5qZWN0ID0gWyckbG9jYXRpb25Qcm92aWRlcicsICckdXJsTWF0Y2hlckZhY3RvcnlQcm92aWRlciddO1xyXG5mdW5jdGlvbiAkVXJsUm91dGVyUHJvdmlkZXIoICAgJGxvY2F0aW9uUHJvdmlkZXIsICAgJHVybE1hdGNoZXJGYWN0b3J5KSB7XHJcbiAgdmFyIHJ1bGVzID0gW10sIG90aGVyd2lzZSA9IG51bGwsIGludGVyY2VwdERlZmVycmVkID0gZmFsc2UsIGxpc3RlbmVyO1xyXG5cclxuICAvLyBSZXR1cm5zIGEgc3RyaW5nIHRoYXQgaXMgYSBwcmVmaXggb2YgYWxsIHN0cmluZ3MgbWF0Y2hpbmcgdGhlIFJlZ0V4cFxyXG4gIGZ1bmN0aW9uIHJlZ0V4cFByZWZpeChyZSkge1xyXG4gICAgdmFyIHByZWZpeCA9IC9eXFxeKCg/OlxcXFxbXmEtekEtWjAtOV18W15cXFxcXFxbXFxdXFxeJCorPy4oKXx7fV0rKSopLy5leGVjKHJlLnNvdXJjZSk7XHJcbiAgICByZXR1cm4gKHByZWZpeCAhPSBudWxsKSA/IHByZWZpeFsxXS5yZXBsYWNlKC9cXFxcKC4pL2csIFwiJDFcIikgOiAnJztcclxuICB9XHJcblxyXG4gIC8vIEludGVycG9sYXRlcyBtYXRjaGVkIHZhbHVlcyBpbnRvIGEgU3RyaW5nLnJlcGxhY2UoKS1zdHlsZSBwYXR0ZXJuXHJcbiAgZnVuY3Rpb24gaW50ZXJwb2xhdGUocGF0dGVybiwgbWF0Y2gpIHtcclxuICAgIHJldHVybiBwYXR0ZXJuLnJlcGxhY2UoL1xcJChcXCR8XFxkezEsMn0pLywgZnVuY3Rpb24gKG0sIHdoYXQpIHtcclxuICAgICAgcmV0dXJuIG1hdGNoW3doYXQgPT09ICckJyA/IDAgOiBOdW1iZXIod2hhdCldO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAbmdkb2MgZnVuY3Rpb25cclxuICAgKiBAbmFtZSB1aS5yb3V0ZXIucm91dGVyLiR1cmxSb3V0ZXJQcm92aWRlciNydWxlXHJcbiAgICogQG1ldGhvZE9mIHVpLnJvdXRlci5yb3V0ZXIuJHVybFJvdXRlclByb3ZpZGVyXHJcbiAgICpcclxuICAgKiBAZGVzY3JpcHRpb25cclxuICAgKiBEZWZpbmVzIHJ1bGVzIHRoYXQgYXJlIHVzZWQgYnkgYCR1cmxSb3V0ZXJQcm92aWRlcmAgdG8gZmluZCBtYXRjaGVzIGZvclxyXG4gICAqIHNwZWNpZmljIFVSTHMuXHJcbiAgICpcclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIDxwcmU+XHJcbiAgICogdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbJ3VpLnJvdXRlci5yb3V0ZXInXSk7XHJcbiAgICpcclxuICAgKiBhcHAuY29uZmlnKGZ1bmN0aW9uICgkdXJsUm91dGVyUHJvdmlkZXIpIHtcclxuICAgKiAgIC8vIEhlcmUncyBhbiBleGFtcGxlIG9mIGhvdyB5b3UgbWlnaHQgYWxsb3cgY2FzZSBpbnNlbnNpdGl2ZSB1cmxzXHJcbiAgICogICAkdXJsUm91dGVyUHJvdmlkZXIucnVsZShmdW5jdGlvbiAoJGluamVjdG9yLCAkbG9jYXRpb24pIHtcclxuICAgKiAgICAgdmFyIHBhdGggPSAkbG9jYXRpb24ucGF0aCgpLFxyXG4gICAqICAgICAgICAgbm9ybWFsaXplZCA9IHBhdGgudG9Mb3dlckNhc2UoKTtcclxuICAgKlxyXG4gICAqICAgICBpZiAocGF0aCAhPT0gbm9ybWFsaXplZCkge1xyXG4gICAqICAgICAgIHJldHVybiBub3JtYWxpemVkO1xyXG4gICAqICAgICB9XHJcbiAgICogICB9KTtcclxuICAgKiB9KTtcclxuICAgKiA8L3ByZT5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBydWxlIEhhbmRsZXIgZnVuY3Rpb24gdGhhdCB0YWtlcyBgJGluamVjdG9yYCBhbmQgYCRsb2NhdGlvbmBcclxuICAgKiBzZXJ2aWNlcyBhcyBhcmd1bWVudHMuIFlvdSBjYW4gdXNlIHRoZW0gdG8gcmV0dXJuIGEgdmFsaWQgcGF0aCBhcyBhIHN0cmluZy5cclxuICAgKlxyXG4gICAqIEByZXR1cm4ge29iamVjdH0gYCR1cmxSb3V0ZXJQcm92aWRlcmAgLSBgJHVybFJvdXRlclByb3ZpZGVyYCBpbnN0YW5jZVxyXG4gICAqL1xyXG4gIHRoaXMucnVsZSA9IGZ1bmN0aW9uIChydWxlKSB7XHJcbiAgICBpZiAoIWlzRnVuY3Rpb24ocnVsZSkpIHRocm93IG5ldyBFcnJvcihcIidydWxlJyBtdXN0IGJlIGEgZnVuY3Rpb25cIik7XHJcbiAgICBydWxlcy5wdXNoKHJ1bGUpO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfTtcclxuXHJcbiAgLyoqXHJcbiAgICogQG5nZG9jIG9iamVjdFxyXG4gICAqIEBuYW1lIHVpLnJvdXRlci5yb3V0ZXIuJHVybFJvdXRlclByb3ZpZGVyI290aGVyd2lzZVxyXG4gICAqIEBtZXRob2RPZiB1aS5yb3V0ZXIucm91dGVyLiR1cmxSb3V0ZXJQcm92aWRlclxyXG4gICAqXHJcbiAgICogQGRlc2NyaXB0aW9uXHJcbiAgICogRGVmaW5lcyBhIHBhdGggdGhhdCBpcyB1c2VkIHdoZW4gYW4gaW52YWxpZCByb3V0ZSBpcyByZXF1ZXN0ZWQuXHJcbiAgICpcclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIDxwcmU+XHJcbiAgICogdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbJ3VpLnJvdXRlci5yb3V0ZXInXSk7XHJcbiAgICpcclxuICAgKiBhcHAuY29uZmlnKGZ1bmN0aW9uICgkdXJsUm91dGVyUHJvdmlkZXIpIHtcclxuICAgKiAgIC8vIGlmIHRoZSBwYXRoIGRvZXNuJ3QgbWF0Y2ggYW55IG9mIHRoZSB1cmxzIHlvdSBjb25maWd1cmVkXHJcbiAgICogICAvLyBvdGhlcndpc2Ugd2lsbCB0YWtlIGNhcmUgb2Ygcm91dGluZyB0aGUgdXNlciB0byB0aGVcclxuICAgKiAgIC8vIHNwZWNpZmllZCB1cmxcclxuICAgKiAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy9pbmRleCcpO1xyXG4gICAqXHJcbiAgICogICAvLyBFeGFtcGxlIG9mIHVzaW5nIGZ1bmN0aW9uIHJ1bGUgYXMgcGFyYW1cclxuICAgKiAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoZnVuY3Rpb24gKCRpbmplY3RvciwgJGxvY2F0aW9uKSB7XHJcbiAgICogICAgIHJldHVybiAnL2EvdmFsaWQvdXJsJztcclxuICAgKiAgIH0pO1xyXG4gICAqIH0pO1xyXG4gICAqIDwvcHJlPlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtzdHJpbmd8b2JqZWN0fSBydWxlIFRoZSB1cmwgcGF0aCB5b3Ugd2FudCB0byByZWRpcmVjdCB0byBvciBhIGZ1bmN0aW9uIFxyXG4gICAqIHJ1bGUgdGhhdCByZXR1cm5zIHRoZSB1cmwgcGF0aC4gVGhlIGZ1bmN0aW9uIHZlcnNpb24gaXMgcGFzc2VkIHR3byBwYXJhbXM6IFxyXG4gICAqIGAkaW5qZWN0b3JgIGFuZCBgJGxvY2F0aW9uYCBzZXJ2aWNlcywgYW5kIG11c3QgcmV0dXJuIGEgdXJsIHN0cmluZy5cclxuICAgKlxyXG4gICAqIEByZXR1cm4ge29iamVjdH0gYCR1cmxSb3V0ZXJQcm92aWRlcmAgLSBgJHVybFJvdXRlclByb3ZpZGVyYCBpbnN0YW5jZVxyXG4gICAqL1xyXG4gIHRoaXMub3RoZXJ3aXNlID0gZnVuY3Rpb24gKHJ1bGUpIHtcclxuICAgIGlmIChpc1N0cmluZyhydWxlKSkge1xyXG4gICAgICB2YXIgcmVkaXJlY3QgPSBydWxlO1xyXG4gICAgICBydWxlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVkaXJlY3Q7IH07XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICghaXNGdW5jdGlvbihydWxlKSkgdGhyb3cgbmV3IEVycm9yKFwiJ3J1bGUnIG11c3QgYmUgYSBmdW5jdGlvblwiKTtcclxuICAgIG90aGVyd2lzZSA9IHJ1bGU7XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9O1xyXG5cclxuXHJcbiAgZnVuY3Rpb24gaGFuZGxlSWZNYXRjaCgkaW5qZWN0b3IsIGhhbmRsZXIsIG1hdGNoKSB7XHJcbiAgICBpZiAoIW1hdGNoKSByZXR1cm4gZmFsc2U7XHJcbiAgICB2YXIgcmVzdWx0ID0gJGluamVjdG9yLmludm9rZShoYW5kbGVyLCBoYW5kbGVyLCB7ICRtYXRjaDogbWF0Y2ggfSk7XHJcbiAgICByZXR1cm4gaXNEZWZpbmVkKHJlc3VsdCkgPyByZXN1bHQgOiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQG5nZG9jIGZ1bmN0aW9uXHJcbiAgICogQG5hbWUgdWkucm91dGVyLnJvdXRlci4kdXJsUm91dGVyUHJvdmlkZXIjd2hlblxyXG4gICAqIEBtZXRob2RPZiB1aS5yb3V0ZXIucm91dGVyLiR1cmxSb3V0ZXJQcm92aWRlclxyXG4gICAqXHJcbiAgICogQGRlc2NyaXB0aW9uXHJcbiAgICogUmVnaXN0ZXJzIGEgaGFuZGxlciBmb3IgYSBnaXZlbiB1cmwgbWF0Y2hpbmcuIGlmIGhhbmRsZSBpcyBhIHN0cmluZywgaXQgaXNcclxuICAgKiB0cmVhdGVkIGFzIGEgcmVkaXJlY3QsIGFuZCBpcyBpbnRlcnBvbGF0ZWQgYWNjb3JkaW5nIHRvIHRoZSBzeW50YXggb2YgbWF0Y2hcclxuICAgKiAoaS5lLiBsaWtlIGBTdHJpbmcucmVwbGFjZSgpYCBmb3IgYFJlZ0V4cGAsIG9yIGxpa2UgYSBgVXJsTWF0Y2hlcmAgcGF0dGVybiBvdGhlcndpc2UpLlxyXG4gICAqXHJcbiAgICogSWYgdGhlIGhhbmRsZXIgaXMgYSBmdW5jdGlvbiwgaXQgaXMgaW5qZWN0YWJsZS4gSXQgZ2V0cyBpbnZva2VkIGlmIGAkbG9jYXRpb25gXHJcbiAgICogbWF0Y2hlcy4gWW91IGhhdmUgdGhlIG9wdGlvbiBvZiBpbmplY3QgdGhlIG1hdGNoIG9iamVjdCBhcyBgJG1hdGNoYC5cclxuICAgKlxyXG4gICAqIFRoZSBoYW5kbGVyIGNhbiByZXR1cm5cclxuICAgKlxyXG4gICAqIC0gKipmYWxzeSoqIHRvIGluZGljYXRlIHRoYXQgdGhlIHJ1bGUgZGlkbid0IG1hdGNoIGFmdGVyIGFsbCwgdGhlbiBgJHVybFJvdXRlcmBcclxuICAgKiAgIHdpbGwgY29udGludWUgdHJ5aW5nIHRvIGZpbmQgYW5vdGhlciBvbmUgdGhhdCBtYXRjaGVzLlxyXG4gICAqIC0gKipzdHJpbmcqKiB3aGljaCBpcyB0cmVhdGVkIGFzIGEgcmVkaXJlY3QgYW5kIHBhc3NlZCB0byBgJGxvY2F0aW9uLnVybCgpYFxyXG4gICAqIC0gKip2b2lkKiogb3IgYW55ICoqdHJ1dGh5KiogdmFsdWUgdGVsbHMgYCR1cmxSb3V0ZXJgIHRoYXQgdGhlIHVybCB3YXMgaGFuZGxlZC5cclxuICAgKlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogPHByZT5cclxuICAgKiB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcsIFsndWkucm91dGVyLnJvdXRlciddKTtcclxuICAgKlxyXG4gICAqIGFwcC5jb25maWcoZnVuY3Rpb24gKCR1cmxSb3V0ZXJQcm92aWRlcikge1xyXG4gICAqICAgJHVybFJvdXRlclByb3ZpZGVyLndoZW4oJHN0YXRlLnVybCwgZnVuY3Rpb24gKCRtYXRjaCwgJHN0YXRlUGFyYW1zKSB7XHJcbiAgICogICAgIGlmICgkc3RhdGUuJGN1cnJlbnQubmF2aWdhYmxlICE9PSBzdGF0ZSB8fFxyXG4gICAqICAgICAgICAgIWVxdWFsRm9yS2V5cygkbWF0Y2gsICRzdGF0ZVBhcmFtcykge1xyXG4gICAqICAgICAgJHN0YXRlLnRyYW5zaXRpb25UbyhzdGF0ZSwgJG1hdGNoLCBmYWxzZSk7XHJcbiAgICogICAgIH1cclxuICAgKiAgIH0pO1xyXG4gICAqIH0pO1xyXG4gICAqIDwvcHJlPlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtzdHJpbmd8b2JqZWN0fSB3aGF0IFRoZSBpbmNvbWluZyBwYXRoIHRoYXQgeW91IHdhbnQgdG8gcmVkaXJlY3QuXHJcbiAgICogQHBhcmFtIHtzdHJpbmd8b2JqZWN0fSBoYW5kbGVyIFRoZSBwYXRoIHlvdSB3YW50IHRvIHJlZGlyZWN0IHlvdXIgdXNlciB0by5cclxuICAgKi9cclxuICB0aGlzLndoZW4gPSBmdW5jdGlvbiAod2hhdCwgaGFuZGxlcikge1xyXG4gICAgdmFyIHJlZGlyZWN0LCBoYW5kbGVySXNTdHJpbmcgPSBpc1N0cmluZyhoYW5kbGVyKTtcclxuICAgIGlmIChpc1N0cmluZyh3aGF0KSkgd2hhdCA9ICR1cmxNYXRjaGVyRmFjdG9yeS5jb21waWxlKHdoYXQpO1xyXG5cclxuICAgIGlmICghaGFuZGxlcklzU3RyaW5nICYmICFpc0Z1bmN0aW9uKGhhbmRsZXIpICYmICFpc0FycmF5KGhhbmRsZXIpKVxyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJpbnZhbGlkICdoYW5kbGVyJyBpbiB3aGVuKClcIik7XHJcblxyXG4gICAgdmFyIHN0cmF0ZWdpZXMgPSB7XHJcbiAgICAgIG1hdGNoZXI6IGZ1bmN0aW9uICh3aGF0LCBoYW5kbGVyKSB7XHJcbiAgICAgICAgaWYgKGhhbmRsZXJJc1N0cmluZykge1xyXG4gICAgICAgICAgcmVkaXJlY3QgPSAkdXJsTWF0Y2hlckZhY3RvcnkuY29tcGlsZShoYW5kbGVyKTtcclxuICAgICAgICAgIGhhbmRsZXIgPSBbJyRtYXRjaCcsIGZ1bmN0aW9uICgkbWF0Y2gpIHsgcmV0dXJuIHJlZGlyZWN0LmZvcm1hdCgkbWF0Y2gpOyB9XTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGV4dGVuZChmdW5jdGlvbiAoJGluamVjdG9yLCAkbG9jYXRpb24pIHtcclxuICAgICAgICAgIHJldHVybiBoYW5kbGVJZk1hdGNoKCRpbmplY3RvciwgaGFuZGxlciwgd2hhdC5leGVjKCRsb2NhdGlvbi5wYXRoKCksICRsb2NhdGlvbi5zZWFyY2goKSkpO1xyXG4gICAgICAgIH0sIHtcclxuICAgICAgICAgIHByZWZpeDogaXNTdHJpbmcod2hhdC5wcmVmaXgpID8gd2hhdC5wcmVmaXggOiAnJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9LFxyXG4gICAgICByZWdleDogZnVuY3Rpb24gKHdoYXQsIGhhbmRsZXIpIHtcclxuICAgICAgICBpZiAod2hhdC5nbG9iYWwgfHwgd2hhdC5zdGlja3kpIHRocm93IG5ldyBFcnJvcihcIndoZW4oKSBSZWdFeHAgbXVzdCBub3QgYmUgZ2xvYmFsIG9yIHN0aWNreVwiKTtcclxuXHJcbiAgICAgICAgaWYgKGhhbmRsZXJJc1N0cmluZykge1xyXG4gICAgICAgICAgcmVkaXJlY3QgPSBoYW5kbGVyO1xyXG4gICAgICAgICAgaGFuZGxlciA9IFsnJG1hdGNoJywgZnVuY3Rpb24gKCRtYXRjaCkgeyByZXR1cm4gaW50ZXJwb2xhdGUocmVkaXJlY3QsICRtYXRjaCk7IH1dO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZXh0ZW5kKGZ1bmN0aW9uICgkaW5qZWN0b3IsICRsb2NhdGlvbikge1xyXG4gICAgICAgICAgcmV0dXJuIGhhbmRsZUlmTWF0Y2goJGluamVjdG9yLCBoYW5kbGVyLCB3aGF0LmV4ZWMoJGxvY2F0aW9uLnBhdGgoKSkpO1xyXG4gICAgICAgIH0sIHtcclxuICAgICAgICAgIHByZWZpeDogcmVnRXhwUHJlZml4KHdoYXQpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgdmFyIGNoZWNrID0geyBtYXRjaGVyOiAkdXJsTWF0Y2hlckZhY3RvcnkuaXNNYXRjaGVyKHdoYXQpLCByZWdleDogd2hhdCBpbnN0YW5jZW9mIFJlZ0V4cCB9O1xyXG5cclxuICAgIGZvciAodmFyIG4gaW4gY2hlY2spIHtcclxuICAgICAgaWYgKGNoZWNrW25dKSByZXR1cm4gdGhpcy5ydWxlKHN0cmF0ZWdpZXNbbl0od2hhdCwgaGFuZGxlcikpO1xyXG4gICAgfVxyXG5cclxuICAgIHRocm93IG5ldyBFcnJvcihcImludmFsaWQgJ3doYXQnIGluIHdoZW4oKVwiKTtcclxuICB9O1xyXG5cclxuICAvKipcclxuICAgKiBAbmdkb2MgZnVuY3Rpb25cclxuICAgKiBAbmFtZSB1aS5yb3V0ZXIucm91dGVyLiR1cmxSb3V0ZXJQcm92aWRlciNkZWZlckludGVyY2VwdFxyXG4gICAqIEBtZXRob2RPZiB1aS5yb3V0ZXIucm91dGVyLiR1cmxSb3V0ZXJQcm92aWRlclxyXG4gICAqXHJcbiAgICogQGRlc2NyaXB0aW9uXHJcbiAgICogRGlzYWJsZXMgKG9yIGVuYWJsZXMpIGRlZmVycmluZyBsb2NhdGlvbiBjaGFuZ2UgaW50ZXJjZXB0aW9uLlxyXG4gICAqXHJcbiAgICogSWYgeW91IHdpc2ggdG8gY3VzdG9taXplIHRoZSBiZWhhdmlvciBvZiBzeW5jaW5nIHRoZSBVUkwgKGZvciBleGFtcGxlLCBpZiB5b3Ugd2lzaCB0b1xyXG4gICAqIGRlZmVyIGEgdHJhbnNpdGlvbiBidXQgbWFpbnRhaW4gdGhlIGN1cnJlbnQgVVJMKSwgY2FsbCB0aGlzIG1ldGhvZCBhdCBjb25maWd1cmF0aW9uIHRpbWUuXHJcbiAgICogVGhlbiwgYXQgcnVuIHRpbWUsIGNhbGwgYCR1cmxSb3V0ZXIubGlzdGVuKClgIGFmdGVyIHlvdSBoYXZlIGNvbmZpZ3VyZWQgeW91ciBvd25cclxuICAgKiBgJGxvY2F0aW9uQ2hhbmdlU3VjY2Vzc2AgZXZlbnQgaGFuZGxlci5cclxuICAgKlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogPHByZT5cclxuICAgKiB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcsIFsndWkucm91dGVyLnJvdXRlciddKTtcclxuICAgKlxyXG4gICAqIGFwcC5jb25maWcoZnVuY3Rpb24gKCR1cmxSb3V0ZXJQcm92aWRlcikge1xyXG4gICAqXHJcbiAgICogICAvLyBQcmV2ZW50ICR1cmxSb3V0ZXIgZnJvbSBhdXRvbWF0aWNhbGx5IGludGVyY2VwdGluZyBVUkwgY2hhbmdlcztcclxuICAgKiAgIC8vIHRoaXMgYWxsb3dzIHlvdSB0byBjb25maWd1cmUgY3VzdG9tIGJlaGF2aW9yIGluIGJldHdlZW5cclxuICAgKiAgIC8vIGxvY2F0aW9uIGNoYW5nZXMgYW5kIHJvdXRlIHN5bmNocm9uaXphdGlvbjpcclxuICAgKiAgICR1cmxSb3V0ZXJQcm92aWRlci5kZWZlckludGVyY2VwdCgpO1xyXG4gICAqXHJcbiAgICogfSkucnVuKGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkdXJsUm91dGVyLCBVc2VyU2VydmljZSkge1xyXG4gICAqXHJcbiAgICogICAkcm9vdFNjb3BlLiRvbignJGxvY2F0aW9uQ2hhbmdlU3VjY2VzcycsIGZ1bmN0aW9uKGUpIHtcclxuICAgKiAgICAgLy8gVXNlclNlcnZpY2UgaXMgYW4gZXhhbXBsZSBzZXJ2aWNlIGZvciBtYW5hZ2luZyB1c2VyIHN0YXRlXHJcbiAgICogICAgIGlmIChVc2VyU2VydmljZS5pc0xvZ2dlZEluKCkpIHJldHVybjtcclxuICAgKlxyXG4gICAqICAgICAvLyBQcmV2ZW50ICR1cmxSb3V0ZXIncyBkZWZhdWx0IGhhbmRsZXIgZnJvbSBmaXJpbmdcclxuICAgKiAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAqXHJcbiAgICogICAgIFVzZXJTZXJ2aWNlLmhhbmRsZUxvZ2luKCkudGhlbihmdW5jdGlvbigpIHtcclxuICAgKiAgICAgICAvLyBPbmNlIHRoZSB1c2VyIGhhcyBsb2dnZWQgaW4sIHN5bmMgdGhlIGN1cnJlbnQgVVJMXHJcbiAgICogICAgICAgLy8gdG8gdGhlIHJvdXRlcjpcclxuICAgKiAgICAgICAkdXJsUm91dGVyLnN5bmMoKTtcclxuICAgKiAgICAgfSk7XHJcbiAgICogICB9KTtcclxuICAgKlxyXG4gICAqICAgLy8gQ29uZmlndXJlcyAkdXJsUm91dGVyJ3MgbGlzdGVuZXIgKmFmdGVyKiB5b3VyIGN1c3RvbSBsaXN0ZW5lclxyXG4gICAqICAgJHVybFJvdXRlci5saXN0ZW4oKTtcclxuICAgKiB9KTtcclxuICAgKiA8L3ByZT5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gZGVmZXIgSW5kaWNhdGVzIHdoZXRoZXIgdG8gZGVmZXIgbG9jYXRpb24gY2hhbmdlIGludGVyY2VwdGlvbi4gUGFzc2luZ1xyXG4gICAgICAgICAgICBubyBwYXJhbWV0ZXIgaXMgZXF1aXZhbGVudCB0byBgdHJ1ZWAuXHJcbiAgICovXHJcbiAgdGhpcy5kZWZlckludGVyY2VwdCA9IGZ1bmN0aW9uIChkZWZlcikge1xyXG4gICAgaWYgKGRlZmVyID09PSB1bmRlZmluZWQpIGRlZmVyID0gdHJ1ZTtcclxuICAgIGludGVyY2VwdERlZmVycmVkID0gZGVmZXI7XHJcbiAgfTtcclxuXHJcbiAgLyoqXHJcbiAgICogQG5nZG9jIG9iamVjdFxyXG4gICAqIEBuYW1lIHVpLnJvdXRlci5yb3V0ZXIuJHVybFJvdXRlclxyXG4gICAqXHJcbiAgICogQHJlcXVpcmVzICRsb2NhdGlvblxyXG4gICAqIEByZXF1aXJlcyAkcm9vdFNjb3BlXHJcbiAgICogQHJlcXVpcmVzICRpbmplY3RvclxyXG4gICAqIEByZXF1aXJlcyAkYnJvd3NlclxyXG4gICAqXHJcbiAgICogQGRlc2NyaXB0aW9uXHJcbiAgICpcclxuICAgKi9cclxuICB0aGlzLiRnZXQgPSAkZ2V0O1xyXG4gICRnZXQuJGluamVjdCA9IFsnJGxvY2F0aW9uJywgJyRyb290U2NvcGUnLCAnJGluamVjdG9yJywgJyRicm93c2VyJ107XHJcbiAgZnVuY3Rpb24gJGdldCggICAkbG9jYXRpb24sICAgJHJvb3RTY29wZSwgICAkaW5qZWN0b3IsICAgJGJyb3dzZXIpIHtcclxuXHJcbiAgICB2YXIgYmFzZUhyZWYgPSAkYnJvd3Nlci5iYXNlSHJlZigpLCBsb2NhdGlvbiA9ICRsb2NhdGlvbi51cmwoKSwgbGFzdFB1c2hlZFVybDtcclxuXHJcbiAgICBmdW5jdGlvbiBhcHBlbmRCYXNlUGF0aCh1cmwsIGlzSHRtbDUsIGFic29sdXRlKSB7XHJcbiAgICAgIGlmIChiYXNlSHJlZiA9PT0gJy8nKSByZXR1cm4gdXJsO1xyXG4gICAgICBpZiAoaXNIdG1sNSkgcmV0dXJuIGJhc2VIcmVmLnNsaWNlKDAsIC0xKSArIHVybDtcclxuICAgICAgaWYgKGFic29sdXRlKSByZXR1cm4gYmFzZUhyZWYuc2xpY2UoMSkgKyB1cmw7XHJcbiAgICAgIHJldHVybiB1cmw7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVE9ETzogT3B0aW1pemUgZ3JvdXBzIG9mIHJ1bGVzIHdpdGggbm9uLWVtcHR5IHByZWZpeCBpbnRvIHNvbWUgc29ydCBvZiBkZWNpc2lvbiB0cmVlXHJcbiAgICBmdW5jdGlvbiB1cGRhdGUoZXZ0KSB7XHJcbiAgICAgIGlmIChldnQgJiYgZXZ0LmRlZmF1bHRQcmV2ZW50ZWQpIHJldHVybjtcclxuICAgICAgdmFyIGlnbm9yZVVwZGF0ZSA9IGxhc3RQdXNoZWRVcmwgJiYgJGxvY2F0aW9uLnVybCgpID09PSBsYXN0UHVzaGVkVXJsO1xyXG4gICAgICBsYXN0UHVzaGVkVXJsID0gdW5kZWZpbmVkO1xyXG4gICAgICBpZiAoaWdub3JlVXBkYXRlKSByZXR1cm4gdHJ1ZTtcclxuXHJcbiAgICAgIGZ1bmN0aW9uIGNoZWNrKHJ1bGUpIHtcclxuICAgICAgICB2YXIgaGFuZGxlZCA9IHJ1bGUoJGluamVjdG9yLCAkbG9jYXRpb24pO1xyXG5cclxuICAgICAgICBpZiAoIWhhbmRsZWQpIHJldHVybiBmYWxzZTtcclxuICAgICAgICBpZiAoaXNTdHJpbmcoaGFuZGxlZCkpICRsb2NhdGlvbi5yZXBsYWNlKCkudXJsKGhhbmRsZWQpO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICAgIHZhciBuID0gcnVsZXMubGVuZ3RoLCBpO1xyXG5cclxuICAgICAgZm9yIChpID0gMDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgIGlmIChjaGVjayhydWxlc1tpXSkpIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICAvLyBhbHdheXMgY2hlY2sgb3RoZXJ3aXNlIGxhc3QgdG8gYWxsb3cgZHluYW1pYyB1cGRhdGVzIHRvIHRoZSBzZXQgb2YgcnVsZXNcclxuICAgICAgaWYgKG90aGVyd2lzZSkgY2hlY2sob3RoZXJ3aXNlKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBsaXN0ZW4oKSB7XHJcbiAgICAgIGxpc3RlbmVyID0gbGlzdGVuZXIgfHwgJHJvb3RTY29wZS4kb24oJyRsb2NhdGlvbkNoYW5nZVN1Y2Nlc3MnLCB1cGRhdGUpO1xyXG4gICAgICByZXR1cm4gbGlzdGVuZXI7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFpbnRlcmNlcHREZWZlcnJlZCkgbGlzdGVuKCk7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgLyoqXHJcbiAgICAgICAqIEBuZ2RvYyBmdW5jdGlvblxyXG4gICAgICAgKiBAbmFtZSB1aS5yb3V0ZXIucm91dGVyLiR1cmxSb3V0ZXIjc3luY1xyXG4gICAgICAgKiBAbWV0aG9kT2YgdWkucm91dGVyLnJvdXRlci4kdXJsUm91dGVyXHJcbiAgICAgICAqXHJcbiAgICAgICAqIEBkZXNjcmlwdGlvblxyXG4gICAgICAgKiBUcmlnZ2VycyBhbiB1cGRhdGU7IHRoZSBzYW1lIHVwZGF0ZSB0aGF0IGhhcHBlbnMgd2hlbiB0aGUgYWRkcmVzcyBiYXIgdXJsIGNoYW5nZXMsIGFrYSBgJGxvY2F0aW9uQ2hhbmdlU3VjY2Vzc2AuXHJcbiAgICAgICAqIFRoaXMgbWV0aG9kIGlzIHVzZWZ1bCB3aGVuIHlvdSBuZWVkIHRvIHVzZSBgcHJldmVudERlZmF1bHQoKWAgb24gdGhlIGAkbG9jYXRpb25DaGFuZ2VTdWNjZXNzYCBldmVudCxcclxuICAgICAgICogcGVyZm9ybSBzb21lIGN1c3RvbSBsb2dpYyAocm91dGUgcHJvdGVjdGlvbiwgYXV0aCwgY29uZmlnLCByZWRpcmVjdGlvbiwgZXRjKSBhbmQgdGhlbiBmaW5hbGx5IHByb2NlZWRcclxuICAgICAgICogd2l0aCB0aGUgdHJhbnNpdGlvbiBieSBjYWxsaW5nIGAkdXJsUm91dGVyLnN5bmMoKWAuXHJcbiAgICAgICAqXHJcbiAgICAgICAqIEBleGFtcGxlXHJcbiAgICAgICAqIDxwcmU+XHJcbiAgICAgICAqIGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbJ3VpLnJvdXRlciddKVxyXG4gICAgICAgKiAgIC5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSwgJHVybFJvdXRlcikge1xyXG4gICAgICAgKiAgICAgJHJvb3RTY29wZS4kb24oJyRsb2NhdGlvbkNoYW5nZVN1Y2Nlc3MnLCBmdW5jdGlvbihldnQpIHtcclxuICAgICAgICogICAgICAgLy8gSGFsdCBzdGF0ZSBjaGFuZ2UgZnJvbSBldmVuIHN0YXJ0aW5nXHJcbiAgICAgICAqICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgKiAgICAgICAvLyBQZXJmb3JtIGN1c3RvbSBsb2dpY1xyXG4gICAgICAgKiAgICAgICB2YXIgbWVldHNSZXF1aXJlbWVudCA9IC4uLlxyXG4gICAgICAgKiAgICAgICAvLyBDb250aW51ZSB3aXRoIHRoZSB1cGRhdGUgYW5kIHN0YXRlIHRyYW5zaXRpb24gaWYgbG9naWMgYWxsb3dzXHJcbiAgICAgICAqICAgICAgIGlmIChtZWV0c1JlcXVpcmVtZW50KSAkdXJsUm91dGVyLnN5bmMoKTtcclxuICAgICAgICogICAgIH0pO1xyXG4gICAgICAgKiB9KTtcclxuICAgICAgICogPC9wcmU+XHJcbiAgICAgICAqL1xyXG4gICAgICBzeW5jOiBmdW5jdGlvbigpIHtcclxuICAgICAgICB1cGRhdGUoKTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIGxpc3RlbjogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGxpc3RlbigpO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgdXBkYXRlOiBmdW5jdGlvbihyZWFkKSB7XHJcbiAgICAgICAgaWYgKHJlYWQpIHtcclxuICAgICAgICAgIGxvY2F0aW9uID0gJGxvY2F0aW9uLnVybCgpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoJGxvY2F0aW9uLnVybCgpID09PSBsb2NhdGlvbikgcmV0dXJuO1xyXG5cclxuICAgICAgICAkbG9jYXRpb24udXJsKGxvY2F0aW9uKTtcclxuICAgICAgICAkbG9jYXRpb24ucmVwbGFjZSgpO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgcHVzaDogZnVuY3Rpb24odXJsTWF0Y2hlciwgcGFyYW1zLCBvcHRpb25zKSB7XHJcbiAgICAgICAgJGxvY2F0aW9uLnVybCh1cmxNYXRjaGVyLmZvcm1hdChwYXJhbXMgfHwge30pKTtcclxuICAgICAgICBsYXN0UHVzaGVkVXJsID0gb3B0aW9ucyAmJiBvcHRpb25zLiQkYXZvaWRSZXN5bmMgPyAkbG9jYXRpb24udXJsKCkgOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5yZXBsYWNlKSAkbG9jYXRpb24ucmVwbGFjZSgpO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgLyoqXHJcbiAgICAgICAqIEBuZ2RvYyBmdW5jdGlvblxyXG4gICAgICAgKiBAbmFtZSB1aS5yb3V0ZXIucm91dGVyLiR1cmxSb3V0ZXIjaHJlZlxyXG4gICAgICAgKiBAbWV0aG9kT2YgdWkucm91dGVyLnJvdXRlci4kdXJsUm91dGVyXHJcbiAgICAgICAqXHJcbiAgICAgICAqIEBkZXNjcmlwdGlvblxyXG4gICAgICAgKiBBIFVSTCBnZW5lcmF0aW9uIG1ldGhvZCB0aGF0IHJldHVybnMgdGhlIGNvbXBpbGVkIFVSTCBmb3IgYSBnaXZlblxyXG4gICAgICAgKiB7QGxpbmsgdWkucm91dGVyLnV0aWwudHlwZTpVcmxNYXRjaGVyIGBVcmxNYXRjaGVyYH0sIHBvcHVsYXRlZCB3aXRoIHRoZSBwcm92aWRlZCBwYXJhbWV0ZXJzLlxyXG4gICAgICAgKlxyXG4gICAgICAgKiBAZXhhbXBsZVxyXG4gICAgICAgKiA8cHJlPlxyXG4gICAgICAgKiAkYm9iID0gJHVybFJvdXRlci5ocmVmKG5ldyBVcmxNYXRjaGVyKFwiL2Fib3V0LzpwZXJzb25cIiksIHtcclxuICAgICAgICogICBwZXJzb246IFwiYm9iXCJcclxuICAgICAgICogfSk7XHJcbiAgICAgICAqIC8vICRib2IgPT0gXCIvYWJvdXQvYm9iXCI7XHJcbiAgICAgICAqIDwvcHJlPlxyXG4gICAgICAgKlxyXG4gICAgICAgKiBAcGFyYW0ge1VybE1hdGNoZXJ9IHVybE1hdGNoZXIgVGhlIGBVcmxNYXRjaGVyYCBvYmplY3Qgd2hpY2ggaXMgdXNlZCBhcyB0aGUgdGVtcGxhdGUgb2YgdGhlIFVSTCB0byBnZW5lcmF0ZS5cclxuICAgICAgICogQHBhcmFtIHtvYmplY3Q9fSBwYXJhbXMgQW4gb2JqZWN0IG9mIHBhcmFtZXRlciB2YWx1ZXMgdG8gZmlsbCB0aGUgbWF0Y2hlcidzIHJlcXVpcmVkIHBhcmFtZXRlcnMuXHJcbiAgICAgICAqIEBwYXJhbSB7b2JqZWN0PX0gb3B0aW9ucyBPcHRpb25zIG9iamVjdC4gVGhlIG9wdGlvbnMgYXJlOlxyXG4gICAgICAgKlxyXG4gICAgICAgKiAtICoqYGFic29sdXRlYCoqIC0ge2Jvb2xlYW49ZmFsc2V9LCAgSWYgdHJ1ZSB3aWxsIGdlbmVyYXRlIGFuIGFic29sdXRlIHVybCwgZS5nLiBcImh0dHA6Ly93d3cuZXhhbXBsZS5jb20vZnVsbHVybFwiLlxyXG4gICAgICAgKlxyXG4gICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBmdWxseSBjb21waWxlZCBVUkwsIG9yIGBudWxsYCBpZiBgcGFyYW1zYCBmYWlsIHZhbGlkYXRpb24gYWdhaW5zdCBgdXJsTWF0Y2hlcmBcclxuICAgICAgICovXHJcbiAgICAgIGhyZWY6IGZ1bmN0aW9uKHVybE1hdGNoZXIsIHBhcmFtcywgb3B0aW9ucykge1xyXG4gICAgICAgIGlmICghdXJsTWF0Y2hlci52YWxpZGF0ZXMocGFyYW1zKSkgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgIHZhciBpc0h0bWw1ID0gJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKCk7XHJcbiAgICAgICAgaWYgKGFuZ3VsYXIuaXNPYmplY3QoaXNIdG1sNSkpIHtcclxuICAgICAgICAgIGlzSHRtbDUgPSBpc0h0bWw1LmVuYWJsZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciB1cmwgPSB1cmxNYXRjaGVyLmZvcm1hdChwYXJhbXMpO1xyXG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xyXG5cclxuICAgICAgICBpZiAoIWlzSHRtbDUgJiYgdXJsICE9PSBudWxsKSB7XHJcbiAgICAgICAgICB1cmwgPSBcIiNcIiArICRsb2NhdGlvblByb3ZpZGVyLmhhc2hQcmVmaXgoKSArIHVybDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdXJsID0gYXBwZW5kQmFzZVBhdGgodXJsLCBpc0h0bWw1LCBvcHRpb25zLmFic29sdXRlKTtcclxuXHJcbiAgICAgICAgaWYgKCFvcHRpb25zLmFic29sdXRlIHx8ICF1cmwpIHtcclxuICAgICAgICAgIHJldHVybiB1cmw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgc2xhc2ggPSAoIWlzSHRtbDUgJiYgdXJsID8gJy8nIDogJycpLCBwb3J0ID0gJGxvY2F0aW9uLnBvcnQoKTtcclxuICAgICAgICBwb3J0ID0gKHBvcnQgPT09IDgwIHx8IHBvcnQgPT09IDQ0MyA/ICcnIDogJzonICsgcG9ydCk7XHJcblxyXG4gICAgICAgIHJldHVybiBbJGxvY2F0aW9uLnByb3RvY29sKCksICc6Ly8nLCAkbG9jYXRpb24uaG9zdCgpLCBwb3J0LCBzbGFzaCwgdXJsXS5qb2luKCcnKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmFuZ3VsYXIubW9kdWxlKCd1aS5yb3V0ZXIucm91dGVyJykucHJvdmlkZXIoJyR1cmxSb3V0ZXInLCAkVXJsUm91dGVyUHJvdmlkZXIpO1xyXG5cclxuLyoqXHJcbiAqIEBuZ2RvYyBvYmplY3RcclxuICogQG5hbWUgdWkucm91dGVyLnN0YXRlLiRzdGF0ZVByb3ZpZGVyXHJcbiAqXHJcbiAqIEByZXF1aXJlcyB1aS5yb3V0ZXIucm91dGVyLiR1cmxSb3V0ZXJQcm92aWRlclxyXG4gKiBAcmVxdWlyZXMgdWkucm91dGVyLnV0aWwuJHVybE1hdGNoZXJGYWN0b3J5UHJvdmlkZXJcclxuICpcclxuICogQGRlc2NyaXB0aW9uXHJcbiAqIFRoZSBuZXcgYCRzdGF0ZVByb3ZpZGVyYCB3b3JrcyBzaW1pbGFyIHRvIEFuZ3VsYXIncyB2MSByb3V0ZXIsIGJ1dCBpdCBmb2N1c2VzIHB1cmVseVxyXG4gKiBvbiBzdGF0ZS5cclxuICpcclxuICogQSBzdGF0ZSBjb3JyZXNwb25kcyB0byBhIFwicGxhY2VcIiBpbiB0aGUgYXBwbGljYXRpb24gaW4gdGVybXMgb2YgdGhlIG92ZXJhbGwgVUkgYW5kXHJcbiAqIG5hdmlnYXRpb24uIEEgc3RhdGUgZGVzY3JpYmVzICh2aWEgdGhlIGNvbnRyb2xsZXIgLyB0ZW1wbGF0ZSAvIHZpZXcgcHJvcGVydGllcykgd2hhdFxyXG4gKiB0aGUgVUkgbG9va3MgbGlrZSBhbmQgZG9lcyBhdCB0aGF0IHBsYWNlLlxyXG4gKlxyXG4gKiBTdGF0ZXMgb2Z0ZW4gaGF2ZSB0aGluZ3MgaW4gY29tbW9uLCBhbmQgdGhlIHByaW1hcnkgd2F5IG9mIGZhY3RvcmluZyBvdXQgdGhlc2VcclxuICogY29tbW9uYWxpdGllcyBpbiB0aGlzIG1vZGVsIGlzIHZpYSB0aGUgc3RhdGUgaGllcmFyY2h5LCBpLmUuIHBhcmVudC9jaGlsZCBzdGF0ZXMgYWthXHJcbiAqIG5lc3RlZCBzdGF0ZXMuXHJcbiAqXHJcbiAqIFRoZSBgJHN0YXRlUHJvdmlkZXJgIHByb3ZpZGVzIGludGVyZmFjZXMgdG8gZGVjbGFyZSB0aGVzZSBzdGF0ZXMgZm9yIHlvdXIgYXBwLlxyXG4gKi9cclxuJFN0YXRlUHJvdmlkZXIuJGluamVjdCA9IFsnJHVybFJvdXRlclByb3ZpZGVyJywgJyR1cmxNYXRjaGVyRmFjdG9yeVByb3ZpZGVyJ107XHJcbmZ1bmN0aW9uICRTdGF0ZVByb3ZpZGVyKCAgICR1cmxSb3V0ZXJQcm92aWRlciwgICAkdXJsTWF0Y2hlckZhY3RvcnkpIHtcclxuXHJcbiAgdmFyIHJvb3QsIHN0YXRlcyA9IHt9LCAkc3RhdGUsIHF1ZXVlID0ge30sIGFic3RyYWN0S2V5ID0gJ2Fic3RyYWN0JztcclxuXHJcbiAgLy8gQnVpbGRzIHN0YXRlIHByb3BlcnRpZXMgZnJvbSBkZWZpbml0aW9uIHBhc3NlZCB0byByZWdpc3RlclN0YXRlKClcclxuICB2YXIgc3RhdGVCdWlsZGVyID0ge1xyXG5cclxuICAgIC8vIERlcml2ZSBwYXJlbnQgc3RhdGUgZnJvbSBhIGhpZXJhcmNoaWNhbCBuYW1lIG9ubHkgaWYgJ3BhcmVudCcgaXMgbm90IGV4cGxpY2l0bHkgZGVmaW5lZC5cclxuICAgIC8vIHN0YXRlLmNoaWxkcmVuID0gW107XHJcbiAgICAvLyBpZiAocGFyZW50KSBwYXJlbnQuY2hpbGRyZW4ucHVzaChzdGF0ZSk7XHJcbiAgICBwYXJlbnQ6IGZ1bmN0aW9uKHN0YXRlKSB7XHJcbiAgICAgIGlmIChpc0RlZmluZWQoc3RhdGUucGFyZW50KSAmJiBzdGF0ZS5wYXJlbnQpIHJldHVybiBmaW5kU3RhdGUoc3RhdGUucGFyZW50KTtcclxuICAgICAgLy8gcmVnZXggbWF0Y2hlcyBhbnkgdmFsaWQgY29tcG9zaXRlIHN0YXRlIG5hbWVcclxuICAgICAgLy8gd291bGQgbWF0Y2ggXCJjb250YWN0Lmxpc3RcIiBidXQgbm90IFwiY29udGFjdHNcIlxyXG4gICAgICB2YXIgY29tcG9zaXRlTmFtZSA9IC9eKC4rKVxcLlteLl0rJC8uZXhlYyhzdGF0ZS5uYW1lKTtcclxuICAgICAgcmV0dXJuIGNvbXBvc2l0ZU5hbWUgPyBmaW5kU3RhdGUoY29tcG9zaXRlTmFtZVsxXSkgOiByb290O1xyXG4gICAgfSxcclxuXHJcbiAgICAvLyBpbmhlcml0ICdkYXRhJyBmcm9tIHBhcmVudCBhbmQgb3ZlcnJpZGUgYnkgb3duIHZhbHVlcyAoaWYgYW55KVxyXG4gICAgZGF0YTogZnVuY3Rpb24oc3RhdGUpIHtcclxuICAgICAgaWYgKHN0YXRlLnBhcmVudCAmJiBzdGF0ZS5wYXJlbnQuZGF0YSkge1xyXG4gICAgICAgIHN0YXRlLmRhdGEgPSBzdGF0ZS5zZWxmLmRhdGEgPSBleHRlbmQoe30sIHN0YXRlLnBhcmVudC5kYXRhLCBzdGF0ZS5kYXRhKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gc3RhdGUuZGF0YTtcclxuICAgIH0sXHJcblxyXG4gICAgLy8gQnVpbGQgYSBVUkxNYXRjaGVyIGlmIG5lY2Vzc2FyeSwgZWl0aGVyIHZpYSBhIHJlbGF0aXZlIG9yIGFic29sdXRlIFVSTFxyXG4gICAgdXJsOiBmdW5jdGlvbihzdGF0ZSkge1xyXG4gICAgICB2YXIgdXJsID0gc3RhdGUudXJsLCBjb25maWcgPSB7IHBhcmFtczogc3RhdGUucGFyYW1zIHx8IHt9IH07XHJcblxyXG4gICAgICBpZiAoaXNTdHJpbmcodXJsKSkge1xyXG4gICAgICAgIGlmICh1cmwuY2hhckF0KDApID09ICdeJykgcmV0dXJuICR1cmxNYXRjaGVyRmFjdG9yeS5jb21waWxlKHVybC5zdWJzdHJpbmcoMSksIGNvbmZpZyk7XHJcbiAgICAgICAgcmV0dXJuIChzdGF0ZS5wYXJlbnQubmF2aWdhYmxlIHx8IHJvb3QpLnVybC5jb25jYXQodXJsLCBjb25maWcpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIXVybCB8fCAkdXJsTWF0Y2hlckZhY3RvcnkuaXNNYXRjaGVyKHVybCkpIHJldHVybiB1cmw7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgdXJsICdcIiArIHVybCArIFwiJyBpbiBzdGF0ZSAnXCIgKyBzdGF0ZSArIFwiJ1wiKTtcclxuICAgIH0sXHJcblxyXG4gICAgLy8gS2VlcCB0cmFjayBvZiB0aGUgY2xvc2VzdCBhbmNlc3RvciBzdGF0ZSB0aGF0IGhhcyBhIFVSTCAoaS5lLiBpcyBuYXZpZ2FibGUpXHJcbiAgICBuYXZpZ2FibGU6IGZ1bmN0aW9uKHN0YXRlKSB7XHJcbiAgICAgIHJldHVybiBzdGF0ZS51cmwgPyBzdGF0ZSA6IChzdGF0ZS5wYXJlbnQgPyBzdGF0ZS5wYXJlbnQubmF2aWdhYmxlIDogbnVsbCk7XHJcbiAgICB9LFxyXG5cclxuICAgIC8vIE93biBwYXJhbWV0ZXJzIGZvciB0aGlzIHN0YXRlLiBzdGF0ZS51cmwucGFyYW1zIGlzIGFscmVhZHkgYnVpbHQgYXQgdGhpcyBwb2ludC4gQ3JlYXRlIGFuZCBhZGQgbm9uLXVybCBwYXJhbXNcclxuICAgIG93blBhcmFtczogZnVuY3Rpb24oc3RhdGUpIHtcclxuICAgICAgdmFyIHBhcmFtcyA9IHN0YXRlLnVybCAmJiBzdGF0ZS51cmwucGFyYW1zIHx8IG5ldyAkJFVNRlAuUGFyYW1TZXQoKTtcclxuICAgICAgZm9yRWFjaChzdGF0ZS5wYXJhbXMgfHwge30sIGZ1bmN0aW9uKGNvbmZpZywgaWQpIHtcclxuICAgICAgICBpZiAoIXBhcmFtc1tpZF0pIHBhcmFtc1tpZF0gPSBuZXcgJCRVTUZQLlBhcmFtKGlkLCBudWxsLCBjb25maWcsIFwiY29uZmlnXCIpO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHBhcmFtcztcclxuICAgIH0sXHJcblxyXG4gICAgLy8gRGVyaXZlIHBhcmFtZXRlcnMgZm9yIHRoaXMgc3RhdGUgYW5kIGVuc3VyZSB0aGV5J3JlIGEgc3VwZXItc2V0IG9mIHBhcmVudCdzIHBhcmFtZXRlcnNcclxuICAgIHBhcmFtczogZnVuY3Rpb24oc3RhdGUpIHtcclxuICAgICAgcmV0dXJuIHN0YXRlLnBhcmVudCAmJiBzdGF0ZS5wYXJlbnQucGFyYW1zID8gZXh0ZW5kKHN0YXRlLnBhcmVudC5wYXJhbXMuJCRuZXcoKSwgc3RhdGUub3duUGFyYW1zKSA6IG5ldyAkJFVNRlAuUGFyYW1TZXQoKTtcclxuICAgIH0sXHJcblxyXG4gICAgLy8gSWYgdGhlcmUgaXMgbm8gZXhwbGljaXQgbXVsdGktdmlldyBjb25maWd1cmF0aW9uLCBtYWtlIG9uZSB1cCBzbyB3ZSBkb24ndCBoYXZlXHJcbiAgICAvLyB0byBoYW5kbGUgYm90aCBjYXNlcyBpbiB0aGUgdmlldyBkaXJlY3RpdmUgbGF0ZXIuIE5vdGUgdGhhdCBoYXZpbmcgYW4gZXhwbGljaXRcclxuICAgIC8vICd2aWV3cycgcHJvcGVydHkgd2lsbCBtZWFuIHRoZSBkZWZhdWx0IHVubmFtZWQgdmlldyBwcm9wZXJ0aWVzIGFyZSBpZ25vcmVkLiBUaGlzXHJcbiAgICAvLyBpcyBhbHNvIGEgZ29vZCB0aW1lIHRvIHJlc29sdmUgdmlldyBuYW1lcyB0byBhYnNvbHV0ZSBuYW1lcywgc28gZXZlcnl0aGluZyBpcyBhXHJcbiAgICAvLyBzdHJhaWdodCBsb29rdXAgYXQgbGluayB0aW1lLlxyXG4gICAgdmlld3M6IGZ1bmN0aW9uKHN0YXRlKSB7XHJcbiAgICAgIHZhciB2aWV3cyA9IHt9O1xyXG5cclxuICAgICAgZm9yRWFjaChpc0RlZmluZWQoc3RhdGUudmlld3MpID8gc3RhdGUudmlld3MgOiB7ICcnOiBzdGF0ZSB9LCBmdW5jdGlvbiAodmlldywgbmFtZSkge1xyXG4gICAgICAgIGlmIChuYW1lLmluZGV4T2YoJ0AnKSA8IDApIG5hbWUgKz0gJ0AnICsgc3RhdGUucGFyZW50Lm5hbWU7XHJcbiAgICAgICAgdmlld3NbbmFtZV0gPSB2aWV3O1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHZpZXdzO1xyXG4gICAgfSxcclxuXHJcbiAgICAvLyBLZWVwIGEgZnVsbCBwYXRoIGZyb20gdGhlIHJvb3QgZG93biB0byB0aGlzIHN0YXRlIGFzIHRoaXMgaXMgbmVlZGVkIGZvciBzdGF0ZSBhY3RpdmF0aW9uLlxyXG4gICAgcGF0aDogZnVuY3Rpb24oc3RhdGUpIHtcclxuICAgICAgcmV0dXJuIHN0YXRlLnBhcmVudCA/IHN0YXRlLnBhcmVudC5wYXRoLmNvbmNhdChzdGF0ZSkgOiBbXTsgLy8gZXhjbHVkZSByb290IGZyb20gcGF0aFxyXG4gICAgfSxcclxuXHJcbiAgICAvLyBTcGVlZCB1cCAkc3RhdGUuY29udGFpbnMoKSBhcyBpdCdzIHVzZWQgYSBsb3RcclxuICAgIGluY2x1ZGVzOiBmdW5jdGlvbihzdGF0ZSkge1xyXG4gICAgICB2YXIgaW5jbHVkZXMgPSBzdGF0ZS5wYXJlbnQgPyBleHRlbmQoe30sIHN0YXRlLnBhcmVudC5pbmNsdWRlcykgOiB7fTtcclxuICAgICAgaW5jbHVkZXNbc3RhdGUubmFtZV0gPSB0cnVlO1xyXG4gICAgICByZXR1cm4gaW5jbHVkZXM7XHJcbiAgICB9LFxyXG5cclxuICAgICRkZWxlZ2F0ZXM6IHt9XHJcbiAgfTtcclxuXHJcbiAgZnVuY3Rpb24gaXNSZWxhdGl2ZShzdGF0ZU5hbWUpIHtcclxuICAgIHJldHVybiBzdGF0ZU5hbWUuaW5kZXhPZihcIi5cIikgPT09IDAgfHwgc3RhdGVOYW1lLmluZGV4T2YoXCJeXCIpID09PSAwO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZmluZFN0YXRlKHN0YXRlT3JOYW1lLCBiYXNlKSB7XHJcbiAgICBpZiAoIXN0YXRlT3JOYW1lKSByZXR1cm4gdW5kZWZpbmVkO1xyXG5cclxuICAgIHZhciBpc1N0ciA9IGlzU3RyaW5nKHN0YXRlT3JOYW1lKSxcclxuICAgICAgICBuYW1lICA9IGlzU3RyID8gc3RhdGVPck5hbWUgOiBzdGF0ZU9yTmFtZS5uYW1lLFxyXG4gICAgICAgIHBhdGggID0gaXNSZWxhdGl2ZShuYW1lKTtcclxuXHJcbiAgICBpZiAocGF0aCkge1xyXG4gICAgICBpZiAoIWJhc2UpIHRocm93IG5ldyBFcnJvcihcIk5vIHJlZmVyZW5jZSBwb2ludCBnaXZlbiBmb3IgcGF0aCAnXCIgICsgbmFtZSArIFwiJ1wiKTtcclxuICAgICAgYmFzZSA9IGZpbmRTdGF0ZShiYXNlKTtcclxuICAgICAgXHJcbiAgICAgIHZhciByZWwgPSBuYW1lLnNwbGl0KFwiLlwiKSwgaSA9IDAsIHBhdGhMZW5ndGggPSByZWwubGVuZ3RoLCBjdXJyZW50ID0gYmFzZTtcclxuXHJcbiAgICAgIGZvciAoOyBpIDwgcGF0aExlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgaWYgKHJlbFtpXSA9PT0gXCJcIiAmJiBpID09PSAwKSB7XHJcbiAgICAgICAgICBjdXJyZW50ID0gYmFzZTtcclxuICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocmVsW2ldID09PSBcIl5cIikge1xyXG4gICAgICAgICAgaWYgKCFjdXJyZW50LnBhcmVudCkgdGhyb3cgbmV3IEVycm9yKFwiUGF0aCAnXCIgKyBuYW1lICsgXCInIG5vdCB2YWxpZCBmb3Igc3RhdGUgJ1wiICsgYmFzZS5uYW1lICsgXCInXCIpO1xyXG4gICAgICAgICAgY3VycmVudCA9IGN1cnJlbnQucGFyZW50O1xyXG4gICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIHJlbCA9IHJlbC5zbGljZShpKS5qb2luKFwiLlwiKTtcclxuICAgICAgbmFtZSA9IGN1cnJlbnQubmFtZSArIChjdXJyZW50Lm5hbWUgJiYgcmVsID8gXCIuXCIgOiBcIlwiKSArIHJlbDtcclxuICAgIH1cclxuICAgIHZhciBzdGF0ZSA9IHN0YXRlc1tuYW1lXTtcclxuXHJcbiAgICBpZiAoc3RhdGUgJiYgKGlzU3RyIHx8ICghaXNTdHIgJiYgKHN0YXRlID09PSBzdGF0ZU9yTmFtZSB8fCBzdGF0ZS5zZWxmID09PSBzdGF0ZU9yTmFtZSkpKSkge1xyXG4gICAgICByZXR1cm4gc3RhdGU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcXVldWVTdGF0ZShwYXJlbnROYW1lLCBzdGF0ZSkge1xyXG4gICAgaWYgKCFxdWV1ZVtwYXJlbnROYW1lXSkge1xyXG4gICAgICBxdWV1ZVtwYXJlbnROYW1lXSA9IFtdO1xyXG4gICAgfVxyXG4gICAgcXVldWVbcGFyZW50TmFtZV0ucHVzaChzdGF0ZSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBmbHVzaFF1ZXVlZENoaWxkcmVuKHBhcmVudE5hbWUpIHtcclxuICAgIHZhciBxdWV1ZWQgPSBxdWV1ZVtwYXJlbnROYW1lXSB8fCBbXTtcclxuICAgIHdoaWxlKHF1ZXVlZC5sZW5ndGgpIHtcclxuICAgICAgcmVnaXN0ZXJTdGF0ZShxdWV1ZWQuc2hpZnQoKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiByZWdpc3RlclN0YXRlKHN0YXRlKSB7XHJcbiAgICAvLyBXcmFwIGEgbmV3IG9iamVjdCBhcm91bmQgdGhlIHN0YXRlIHNvIHdlIGNhbiBzdG9yZSBvdXIgcHJpdmF0ZSBkZXRhaWxzIGVhc2lseS5cclxuICAgIHN0YXRlID0gaW5oZXJpdChzdGF0ZSwge1xyXG4gICAgICBzZWxmOiBzdGF0ZSxcclxuICAgICAgcmVzb2x2ZTogc3RhdGUucmVzb2x2ZSB8fCB7fSxcclxuICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5uYW1lOyB9XHJcbiAgICB9KTtcclxuXHJcbiAgICB2YXIgbmFtZSA9IHN0YXRlLm5hbWU7XHJcbiAgICBpZiAoIWlzU3RyaW5nKG5hbWUpIHx8IG5hbWUuaW5kZXhPZignQCcpID49IDApIHRocm93IG5ldyBFcnJvcihcIlN0YXRlIG11c3QgaGF2ZSBhIHZhbGlkIG5hbWVcIik7XHJcbiAgICBpZiAoc3RhdGVzLmhhc093blByb3BlcnR5KG5hbWUpKSB0aHJvdyBuZXcgRXJyb3IoXCJTdGF0ZSAnXCIgKyBuYW1lICsgXCInJyBpcyBhbHJlYWR5IGRlZmluZWRcIik7XHJcblxyXG4gICAgLy8gR2V0IHBhcmVudCBuYW1lXHJcbiAgICB2YXIgcGFyZW50TmFtZSA9IChuYW1lLmluZGV4T2YoJy4nKSAhPT0gLTEpID8gbmFtZS5zdWJzdHJpbmcoMCwgbmFtZS5sYXN0SW5kZXhPZignLicpKVxyXG4gICAgICAgIDogKGlzU3RyaW5nKHN0YXRlLnBhcmVudCkpID8gc3RhdGUucGFyZW50XHJcbiAgICAgICAgOiAoaXNPYmplY3Qoc3RhdGUucGFyZW50KSAmJiBpc1N0cmluZyhzdGF0ZS5wYXJlbnQubmFtZSkpID8gc3RhdGUucGFyZW50Lm5hbWVcclxuICAgICAgICA6ICcnO1xyXG5cclxuICAgIC8vIElmIHBhcmVudCBpcyBub3QgcmVnaXN0ZXJlZCB5ZXQsIGFkZCBzdGF0ZSB0byBxdWV1ZSBhbmQgcmVnaXN0ZXIgbGF0ZXJcclxuICAgIGlmIChwYXJlbnROYW1lICYmICFzdGF0ZXNbcGFyZW50TmFtZV0pIHtcclxuICAgICAgcmV0dXJuIHF1ZXVlU3RhdGUocGFyZW50TmFtZSwgc3RhdGUuc2VsZik7XHJcbiAgICB9XHJcblxyXG4gICAgZm9yICh2YXIga2V5IGluIHN0YXRlQnVpbGRlcikge1xyXG4gICAgICBpZiAoaXNGdW5jdGlvbihzdGF0ZUJ1aWxkZXJba2V5XSkpIHN0YXRlW2tleV0gPSBzdGF0ZUJ1aWxkZXJba2V5XShzdGF0ZSwgc3RhdGVCdWlsZGVyLiRkZWxlZ2F0ZXNba2V5XSk7XHJcbiAgICB9XHJcbiAgICBzdGF0ZXNbbmFtZV0gPSBzdGF0ZTtcclxuXHJcbiAgICAvLyBSZWdpc3RlciB0aGUgc3RhdGUgaW4gdGhlIGdsb2JhbCBzdGF0ZSBsaXN0IGFuZCB3aXRoICR1cmxSb3V0ZXIgaWYgbmVjZXNzYXJ5LlxyXG4gICAgaWYgKCFzdGF0ZVthYnN0cmFjdEtleV0gJiYgc3RhdGUudXJsKSB7XHJcbiAgICAgICR1cmxSb3V0ZXJQcm92aWRlci53aGVuKHN0YXRlLnVybCwgWyckbWF0Y2gnLCAnJHN0YXRlUGFyYW1zJywgZnVuY3Rpb24gKCRtYXRjaCwgJHN0YXRlUGFyYW1zKSB7XHJcbiAgICAgICAgaWYgKCRzdGF0ZS4kY3VycmVudC5uYXZpZ2FibGUgIT0gc3RhdGUgfHwgIWVxdWFsRm9yS2V5cygkbWF0Y2gsICRzdGF0ZVBhcmFtcykpIHtcclxuICAgICAgICAgICRzdGF0ZS50cmFuc2l0aW9uVG8oc3RhdGUsICRtYXRjaCwgeyBpbmhlcml0OiB0cnVlLCBsb2NhdGlvbjogZmFsc2UgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUmVnaXN0ZXIgYW55IHF1ZXVlZCBjaGlsZHJlblxyXG4gICAgZmx1c2hRdWV1ZWRDaGlsZHJlbihuYW1lKTtcclxuXHJcbiAgICByZXR1cm4gc3RhdGU7XHJcbiAgfVxyXG5cclxuICAvLyBDaGVja3MgdGV4dCB0byBzZWUgaWYgaXQgbG9va3MgbGlrZSBhIGdsb2IuXHJcbiAgZnVuY3Rpb24gaXNHbG9iICh0ZXh0KSB7XHJcbiAgICByZXR1cm4gdGV4dC5pbmRleE9mKCcqJykgPiAtMTtcclxuICB9XHJcblxyXG4gIC8vIFJldHVybnMgdHJ1ZSBpZiBnbG9iIG1hdGNoZXMgY3VycmVudCAkc3RhdGUgbmFtZS5cclxuICBmdW5jdGlvbiBkb2VzU3RhdGVNYXRjaEdsb2IgKGdsb2IpIHtcclxuICAgIHZhciBnbG9iU2VnbWVudHMgPSBnbG9iLnNwbGl0KCcuJyksXHJcbiAgICAgICAgc2VnbWVudHMgPSAkc3RhdGUuJGN1cnJlbnQubmFtZS5zcGxpdCgnLicpO1xyXG5cclxuICAgIC8vbWF0Y2ggZ3JlZWR5IHN0YXJ0c1xyXG4gICAgaWYgKGdsb2JTZWdtZW50c1swXSA9PT0gJyoqJykge1xyXG4gICAgICAgc2VnbWVudHMgPSBzZWdtZW50cy5zbGljZShpbmRleE9mKHNlZ21lbnRzLCBnbG9iU2VnbWVudHNbMV0pKTtcclxuICAgICAgIHNlZ21lbnRzLnVuc2hpZnQoJyoqJyk7XHJcbiAgICB9XHJcbiAgICAvL21hdGNoIGdyZWVkeSBlbmRzXHJcbiAgICBpZiAoZ2xvYlNlZ21lbnRzW2dsb2JTZWdtZW50cy5sZW5ndGggLSAxXSA9PT0gJyoqJykge1xyXG4gICAgICAgc2VnbWVudHMuc3BsaWNlKGluZGV4T2Yoc2VnbWVudHMsIGdsb2JTZWdtZW50c1tnbG9iU2VnbWVudHMubGVuZ3RoIC0gMl0pICsgMSwgTnVtYmVyLk1BWF9WQUxVRSk7XHJcbiAgICAgICBzZWdtZW50cy5wdXNoKCcqKicpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChnbG9iU2VnbWVudHMubGVuZ3RoICE9IHNlZ21lbnRzLmxlbmd0aCkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy9tYXRjaCBzaW5nbGUgc3RhcnNcclxuICAgIGZvciAodmFyIGkgPSAwLCBsID0gZ2xvYlNlZ21lbnRzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG4gICAgICBpZiAoZ2xvYlNlZ21lbnRzW2ldID09PSAnKicpIHtcclxuICAgICAgICBzZWdtZW50c1tpXSA9ICcqJztcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBzZWdtZW50cy5qb2luKCcnKSA9PT0gZ2xvYlNlZ21lbnRzLmpvaW4oJycpO1xyXG4gIH1cclxuXHJcblxyXG4gIC8vIEltcGxpY2l0IHJvb3Qgc3RhdGUgdGhhdCBpcyBhbHdheXMgYWN0aXZlXHJcbiAgcm9vdCA9IHJlZ2lzdGVyU3RhdGUoe1xyXG4gICAgbmFtZTogJycsXHJcbiAgICB1cmw6ICdeJyxcclxuICAgIHZpZXdzOiBudWxsLFxyXG4gICAgJ2Fic3RyYWN0JzogdHJ1ZVxyXG4gIH0pO1xyXG4gIHJvb3QubmF2aWdhYmxlID0gbnVsbDtcclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIEBuZ2RvYyBmdW5jdGlvblxyXG4gICAqIEBuYW1lIHVpLnJvdXRlci5zdGF0ZS4kc3RhdGVQcm92aWRlciNkZWNvcmF0b3JcclxuICAgKiBAbWV0aG9kT2YgdWkucm91dGVyLnN0YXRlLiRzdGF0ZVByb3ZpZGVyXHJcbiAgICpcclxuICAgKiBAZGVzY3JpcHRpb25cclxuICAgKiBBbGxvd3MgeW91IHRvIGV4dGVuZCAoY2FyZWZ1bGx5KSBvciBvdmVycmlkZSAoYXQgeW91ciBvd24gcGVyaWwpIHRoZSBcclxuICAgKiBgc3RhdGVCdWlsZGVyYCBvYmplY3QgdXNlZCBpbnRlcm5hbGx5IGJ5IGAkc3RhdGVQcm92aWRlcmAuIFRoaXMgY2FuIGJlIHVzZWQgXHJcbiAgICogdG8gYWRkIGN1c3RvbSBmdW5jdGlvbmFsaXR5IHRvIHVpLXJvdXRlciwgZm9yIGV4YW1wbGUgaW5mZXJyaW5nIHRlbXBsYXRlVXJsIFxyXG4gICAqIGJhc2VkIG9uIHRoZSBzdGF0ZSBuYW1lLlxyXG4gICAqXHJcbiAgICogV2hlbiBwYXNzaW5nIG9ubHkgYSBuYW1lLCBpdCByZXR1cm5zIHRoZSBjdXJyZW50IChvcmlnaW5hbCBvciBkZWNvcmF0ZWQpIGJ1aWxkZXJcclxuICAgKiBmdW5jdGlvbiB0aGF0IG1hdGNoZXMgYG5hbWVgLlxyXG4gICAqXHJcbiAgICogVGhlIGJ1aWxkZXIgZnVuY3Rpb25zIHRoYXQgY2FuIGJlIGRlY29yYXRlZCBhcmUgbGlzdGVkIGJlbG93LiBUaG91Z2ggbm90IGFsbFxyXG4gICAqIG5lY2Vzc2FyaWx5IGhhdmUgYSBnb29kIHVzZSBjYXNlIGZvciBkZWNvcmF0aW9uLCB0aGF0IGlzIHVwIHRvIHlvdSB0byBkZWNpZGUuXHJcbiAgICpcclxuICAgKiBJbiBhZGRpdGlvbiwgdXNlcnMgY2FuIGF0dGFjaCBjdXN0b20gZGVjb3JhdG9ycywgd2hpY2ggd2lsbCBnZW5lcmF0ZSBuZXcgXHJcbiAgICogcHJvcGVydGllcyB3aXRoaW4gdGhlIHN0YXRlJ3MgaW50ZXJuYWwgZGVmaW5pdGlvbi4gVGhlcmUgaXMgY3VycmVudGx5IG5vIGNsZWFyIFxyXG4gICAqIHVzZS1jYXNlIGZvciB0aGlzIGJleW9uZCBhY2Nlc3NpbmcgaW50ZXJuYWwgc3RhdGVzIChpLmUuICRzdGF0ZS4kY3VycmVudCksIFxyXG4gICAqIGhvd2V2ZXIsIGV4cGVjdCB0aGlzIHRvIGJlY29tZSBpbmNyZWFzaW5nbHkgcmVsZXZhbnQgYXMgd2UgaW50cm9kdWNlIGFkZGl0aW9uYWwgXHJcbiAgICogbWV0YS1wcm9ncmFtbWluZyBmZWF0dXJlcy5cclxuICAgKlxyXG4gICAqICoqV2FybmluZyoqOiBEZWNvcmF0b3JzIHNob3VsZCBub3QgYmUgaW50ZXJkZXBlbmRlbnQgYmVjYXVzZSB0aGUgb3JkZXIgb2YgXHJcbiAgICogZXhlY3V0aW9uIG9mIHRoZSBidWlsZGVyIGZ1bmN0aW9ucyBpbiBub24tZGV0ZXJtaW5pc3RpYy4gQnVpbGRlciBmdW5jdGlvbnMgXHJcbiAgICogc2hvdWxkIG9ubHkgYmUgZGVwZW5kZW50IG9uIHRoZSBzdGF0ZSBkZWZpbml0aW9uIG9iamVjdCBhbmQgc3VwZXIgZnVuY3Rpb24uXHJcbiAgICpcclxuICAgKlxyXG4gICAqIEV4aXN0aW5nIGJ1aWxkZXIgZnVuY3Rpb25zIGFuZCBjdXJyZW50IHJldHVybiB2YWx1ZXM6XHJcbiAgICpcclxuICAgKiAtICoqcGFyZW50KiogYHtvYmplY3R9YCAtIHJldHVybnMgdGhlIHBhcmVudCBzdGF0ZSBvYmplY3QuXHJcbiAgICogLSAqKmRhdGEqKiBge29iamVjdH1gIC0gcmV0dXJucyBzdGF0ZSBkYXRhLCBpbmNsdWRpbmcgYW55IGluaGVyaXRlZCBkYXRhIHRoYXQgaXMgbm90XHJcbiAgICogICBvdmVycmlkZGVuIGJ5IG93biB2YWx1ZXMgKGlmIGFueSkuXHJcbiAgICogLSAqKnVybCoqIGB7b2JqZWN0fWAgLSByZXR1cm5zIGEge0BsaW5rIHVpLnJvdXRlci51dGlsLnR5cGU6VXJsTWF0Y2hlciBVcmxNYXRjaGVyfVxyXG4gICAqICAgb3IgYG51bGxgLlxyXG4gICAqIC0gKipuYXZpZ2FibGUqKiBge29iamVjdH1gIC0gcmV0dXJucyBjbG9zZXN0IGFuY2VzdG9yIHN0YXRlIHRoYXQgaGFzIGEgVVJMIChha2EgaXMgXHJcbiAgICogICBuYXZpZ2FibGUpLlxyXG4gICAqIC0gKipwYXJhbXMqKiBge29iamVjdH1gIC0gcmV0dXJucyBhbiBhcnJheSBvZiBzdGF0ZSBwYXJhbXMgdGhhdCBhcmUgZW5zdXJlZCB0byBcclxuICAgKiAgIGJlIGEgc3VwZXItc2V0IG9mIHBhcmVudCdzIHBhcmFtcy5cclxuICAgKiAtICoqdmlld3MqKiBge29iamVjdH1gIC0gcmV0dXJucyBhIHZpZXdzIG9iamVjdCB3aGVyZSBlYWNoIGtleSBpcyBhbiBhYnNvbHV0ZSB2aWV3IFxyXG4gICAqICAgbmFtZSAoaS5lLiBcInZpZXdOYW1lQHN0YXRlTmFtZVwiKSBhbmQgZWFjaCB2YWx1ZSBpcyB0aGUgY29uZmlnIG9iamVjdCBcclxuICAgKiAgICh0ZW1wbGF0ZSwgY29udHJvbGxlcikgZm9yIHRoZSB2aWV3LiBFdmVuIHdoZW4geW91IGRvbid0IHVzZSB0aGUgdmlld3Mgb2JqZWN0IFxyXG4gICAqICAgZXhwbGljaXRseSBvbiBhIHN0YXRlIGNvbmZpZywgb25lIGlzIHN0aWxsIGNyZWF0ZWQgZm9yIHlvdSBpbnRlcm5hbGx5LlxyXG4gICAqICAgU28gYnkgZGVjb3JhdGluZyB0aGlzIGJ1aWxkZXIgZnVuY3Rpb24geW91IGhhdmUgYWNjZXNzIHRvIGRlY29yYXRpbmcgdGVtcGxhdGUgXHJcbiAgICogICBhbmQgY29udHJvbGxlciBwcm9wZXJ0aWVzLlxyXG4gICAqIC0gKipvd25QYXJhbXMqKiBge29iamVjdH1gIC0gcmV0dXJucyBhbiBhcnJheSBvZiBwYXJhbXMgdGhhdCBiZWxvbmcgdG8gdGhlIHN0YXRlLCBcclxuICAgKiAgIG5vdCBpbmNsdWRpbmcgYW55IHBhcmFtcyBkZWZpbmVkIGJ5IGFuY2VzdG9yIHN0YXRlcy5cclxuICAgKiAtICoqcGF0aCoqIGB7c3RyaW5nfWAgLSByZXR1cm5zIHRoZSBmdWxsIHBhdGggZnJvbSB0aGUgcm9vdCBkb3duIHRvIHRoaXMgc3RhdGUuIFxyXG4gICAqICAgTmVlZGVkIGZvciBzdGF0ZSBhY3RpdmF0aW9uLlxyXG4gICAqIC0gKippbmNsdWRlcyoqIGB7b2JqZWN0fWAgLSByZXR1cm5zIGFuIG9iamVjdCB0aGF0IGluY2x1ZGVzIGV2ZXJ5IHN0YXRlIHRoYXQgXHJcbiAgICogICB3b3VsZCBwYXNzIGEgYCRzdGF0ZS5pbmNsdWRlcygpYCB0ZXN0LlxyXG4gICAqXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiA8cHJlPlxyXG4gICAqIC8vIE92ZXJyaWRlIHRoZSBpbnRlcm5hbCAndmlld3MnIGJ1aWxkZXIgd2l0aCBhIGZ1bmN0aW9uIHRoYXQgdGFrZXMgdGhlIHN0YXRlXHJcbiAgICogLy8gZGVmaW5pdGlvbiwgYW5kIGEgcmVmZXJlbmNlIHRvIHRoZSBpbnRlcm5hbCBmdW5jdGlvbiBiZWluZyBvdmVycmlkZGVuOlxyXG4gICAqICRzdGF0ZVByb3ZpZGVyLmRlY29yYXRvcigndmlld3MnLCBmdW5jdGlvbiAoc3RhdGUsIHBhcmVudCkge1xyXG4gICAqICAgdmFyIHJlc3VsdCA9IHt9LFxyXG4gICAqICAgICAgIHZpZXdzID0gcGFyZW50KHN0YXRlKTtcclxuICAgKlxyXG4gICAqICAgYW5ndWxhci5mb3JFYWNoKHZpZXdzLCBmdW5jdGlvbiAoY29uZmlnLCBuYW1lKSB7XHJcbiAgICogICAgIHZhciBhdXRvTmFtZSA9IChzdGF0ZS5uYW1lICsgJy4nICsgbmFtZSkucmVwbGFjZSgnLicsICcvJyk7XHJcbiAgICogICAgIGNvbmZpZy50ZW1wbGF0ZVVybCA9IGNvbmZpZy50ZW1wbGF0ZVVybCB8fCAnL3BhcnRpYWxzLycgKyBhdXRvTmFtZSArICcuaHRtbCc7XHJcbiAgICogICAgIHJlc3VsdFtuYW1lXSA9IGNvbmZpZztcclxuICAgKiAgIH0pO1xyXG4gICAqICAgcmV0dXJuIHJlc3VsdDtcclxuICAgKiB9KTtcclxuICAgKlxyXG4gICAqICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdob21lJywge1xyXG4gICAqICAgdmlld3M6IHtcclxuICAgKiAgICAgJ2NvbnRhY3QubGlzdCc6IHsgY29udHJvbGxlcjogJ0xpc3RDb250cm9sbGVyJyB9LFxyXG4gICAqICAgICAnY29udGFjdC5pdGVtJzogeyBjb250cm9sbGVyOiAnSXRlbUNvbnRyb2xsZXInIH1cclxuICAgKiAgIH1cclxuICAgKiB9KTtcclxuICAgKlxyXG4gICAqIC8vIC4uLlxyXG4gICAqXHJcbiAgICogJHN0YXRlLmdvKCdob21lJyk7XHJcbiAgICogLy8gQXV0by1wb3B1bGF0ZXMgbGlzdCBhbmQgaXRlbSB2aWV3cyB3aXRoIC9wYXJ0aWFscy9ob21lL2NvbnRhY3QvbGlzdC5odG1sLFxyXG4gICAqIC8vIGFuZCAvcGFydGlhbHMvaG9tZS9jb250YWN0L2l0ZW0uaHRtbCwgcmVzcGVjdGl2ZWx5LlxyXG4gICAqIDwvcHJlPlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgVGhlIG5hbWUgb2YgdGhlIGJ1aWxkZXIgZnVuY3Rpb24gdG8gZGVjb3JhdGUuIFxyXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBmdW5jIEEgZnVuY3Rpb24gdGhhdCBpcyByZXNwb25zaWJsZSBmb3IgZGVjb3JhdGluZyB0aGUgb3JpZ2luYWwgXHJcbiAgICogYnVpbGRlciBmdW5jdGlvbi4gVGhlIGZ1bmN0aW9uIHJlY2VpdmVzIHR3byBwYXJhbWV0ZXJzOlxyXG4gICAqXHJcbiAgICogICAtIGB7b2JqZWN0fWAgLSBzdGF0ZSAtIFRoZSBzdGF0ZSBjb25maWcgb2JqZWN0LlxyXG4gICAqICAgLSBge29iamVjdH1gIC0gc3VwZXIgLSBUaGUgb3JpZ2luYWwgYnVpbGRlciBmdW5jdGlvbi5cclxuICAgKlxyXG4gICAqIEByZXR1cm4ge29iamVjdH0gJHN0YXRlUHJvdmlkZXIgLSAkc3RhdGVQcm92aWRlciBpbnN0YW5jZVxyXG4gICAqL1xyXG4gIHRoaXMuZGVjb3JhdG9yID0gZGVjb3JhdG9yO1xyXG4gIGZ1bmN0aW9uIGRlY29yYXRvcihuYW1lLCBmdW5jKSB7XHJcbiAgICAvKmpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cclxuICAgIGlmIChpc1N0cmluZyhuYW1lKSAmJiAhaXNEZWZpbmVkKGZ1bmMpKSB7XHJcbiAgICAgIHJldHVybiBzdGF0ZUJ1aWxkZXJbbmFtZV07XHJcbiAgICB9XHJcbiAgICBpZiAoIWlzRnVuY3Rpb24oZnVuYykgfHwgIWlzU3RyaW5nKG5hbWUpKSB7XHJcbiAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgaWYgKHN0YXRlQnVpbGRlcltuYW1lXSAmJiAhc3RhdGVCdWlsZGVyLiRkZWxlZ2F0ZXNbbmFtZV0pIHtcclxuICAgICAgc3RhdGVCdWlsZGVyLiRkZWxlZ2F0ZXNbbmFtZV0gPSBzdGF0ZUJ1aWxkZXJbbmFtZV07XHJcbiAgICB9XHJcbiAgICBzdGF0ZUJ1aWxkZXJbbmFtZV0gPSBmdW5jO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAbmdkb2MgZnVuY3Rpb25cclxuICAgKiBAbmFtZSB1aS5yb3V0ZXIuc3RhdGUuJHN0YXRlUHJvdmlkZXIjc3RhdGVcclxuICAgKiBAbWV0aG9kT2YgdWkucm91dGVyLnN0YXRlLiRzdGF0ZVByb3ZpZGVyXHJcbiAgICpcclxuICAgKiBAZGVzY3JpcHRpb25cclxuICAgKiBSZWdpc3RlcnMgYSBzdGF0ZSBjb25maWd1cmF0aW9uIHVuZGVyIGEgZ2l2ZW4gc3RhdGUgbmFtZS4gVGhlIHN0YXRlQ29uZmlnIG9iamVjdFxyXG4gICAqIGhhcyB0aGUgZm9sbG93aW5nIGFjY2VwdGFibGUgcHJvcGVydGllcy5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIEEgdW5pcXVlIHN0YXRlIG5hbWUsIGUuZy4gXCJob21lXCIsIFwiYWJvdXRcIiwgXCJjb250YWN0c1wiLlxyXG4gICAqIFRvIGNyZWF0ZSBhIHBhcmVudC9jaGlsZCBzdGF0ZSB1c2UgYSBkb3QsIGUuZy4gXCJhYm91dC5zYWxlc1wiLCBcImhvbWUubmV3ZXN0XCIuXHJcbiAgICogQHBhcmFtIHtvYmplY3R9IHN0YXRlQ29uZmlnIFN0YXRlIGNvbmZpZ3VyYXRpb24gb2JqZWN0LlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfGZ1bmN0aW9uPX0gc3RhdGVDb25maWcudGVtcGxhdGVcclxuICAgKiA8YSBpZD0ndGVtcGxhdGUnPjwvYT5cclxuICAgKiAgIGh0bWwgdGVtcGxhdGUgYXMgYSBzdHJpbmcgb3IgYSBmdW5jdGlvbiB0aGF0IHJldHVybnNcclxuICAgKiAgIGFuIGh0bWwgdGVtcGxhdGUgYXMgYSBzdHJpbmcgd2hpY2ggc2hvdWxkIGJlIHVzZWQgYnkgdGhlIHVpVmlldyBkaXJlY3RpdmVzLiBUaGlzIHByb3BlcnR5IFxyXG4gICAqICAgdGFrZXMgcHJlY2VkZW5jZSBvdmVyIHRlbXBsYXRlVXJsLlxyXG4gICAqICAgXHJcbiAgICogICBJZiBgdGVtcGxhdGVgIGlzIGEgZnVuY3Rpb24sIGl0IHdpbGwgYmUgY2FsbGVkIHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOlxyXG4gICAqXHJcbiAgICogICAtIHthcnJheS4mbHQ7b2JqZWN0Jmd0O30gLSBzdGF0ZSBwYXJhbWV0ZXJzIGV4dHJhY3RlZCBmcm9tIHRoZSBjdXJyZW50ICRsb2NhdGlvbi5wYXRoKCkgYnlcclxuICAgKiAgICAgYXBwbHlpbmcgdGhlIGN1cnJlbnQgc3RhdGVcclxuICAgKlxyXG4gICAqIDxwcmU+dGVtcGxhdGU6XHJcbiAgICogICBcIjxoMT5pbmxpbmUgdGVtcGxhdGUgZGVmaW5pdGlvbjwvaDE+XCIgK1xyXG4gICAqICAgXCI8ZGl2IHVpLXZpZXc+PC9kaXY+XCI8L3ByZT5cclxuICAgKiA8cHJlPnRlbXBsYXRlOiBmdW5jdGlvbihwYXJhbXMpIHtcclxuICAgKiAgICAgICByZXR1cm4gXCI8aDE+Z2VuZXJhdGVkIHRlbXBsYXRlPC9oMT5cIjsgfTwvcHJlPlxyXG4gICAqIDwvZGl2PlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtzdHJpbmd8ZnVuY3Rpb249fSBzdGF0ZUNvbmZpZy50ZW1wbGF0ZVVybFxyXG4gICAqIDxhIGlkPSd0ZW1wbGF0ZVVybCc+PC9hPlxyXG4gICAqXHJcbiAgICogICBwYXRoIG9yIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhIHBhdGggdG8gYW4gaHRtbFxyXG4gICAqICAgdGVtcGxhdGUgdGhhdCBzaG91bGQgYmUgdXNlZCBieSB1aVZpZXcuXHJcbiAgICogICBcclxuICAgKiAgIElmIGB0ZW1wbGF0ZVVybGAgaXMgYSBmdW5jdGlvbiwgaXQgd2lsbCBiZSBjYWxsZWQgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6XHJcbiAgICpcclxuICAgKiAgIC0ge2FycmF5LiZsdDtvYmplY3QmZ3Q7fSAtIHN0YXRlIHBhcmFtZXRlcnMgZXh0cmFjdGVkIGZyb20gdGhlIGN1cnJlbnQgJGxvY2F0aW9uLnBhdGgoKSBieSBcclxuICAgKiAgICAgYXBwbHlpbmcgdGhlIGN1cnJlbnQgc3RhdGVcclxuICAgKlxyXG4gICAqIDxwcmU+dGVtcGxhdGVVcmw6IFwiaG9tZS5odG1sXCI8L3ByZT5cclxuICAgKiA8cHJlPnRlbXBsYXRlVXJsOiBmdW5jdGlvbihwYXJhbXMpIHtcclxuICAgKiAgICAgcmV0dXJuIG15VGVtcGxhdGVzW3BhcmFtcy5wYWdlSWRdOyB9PC9wcmU+XHJcbiAgICpcclxuICAgKiBAcGFyYW0ge2Z1bmN0aW9uPX0gc3RhdGVDb25maWcudGVtcGxhdGVQcm92aWRlclxyXG4gICAqIDxhIGlkPSd0ZW1wbGF0ZVByb3ZpZGVyJz48L2E+XHJcbiAgICogICAgUHJvdmlkZXIgZnVuY3Rpb24gdGhhdCByZXR1cm5zIEhUTUwgY29udGVudCBzdHJpbmcuXHJcbiAgICogPHByZT4gdGVtcGxhdGVQcm92aWRlcjpcclxuICAgKiAgICAgICBmdW5jdGlvbihNeVRlbXBsYXRlU2VydmljZSwgcGFyYW1zKSB7XHJcbiAgICogICAgICAgICByZXR1cm4gTXlUZW1wbGF0ZVNlcnZpY2UuZ2V0VGVtcGxhdGUocGFyYW1zLnBhZ2VJZCk7XHJcbiAgICogICAgICAgfTwvcHJlPlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtzdHJpbmd8ZnVuY3Rpb249fSBzdGF0ZUNvbmZpZy5jb250cm9sbGVyXHJcbiAgICogPGEgaWQ9J2NvbnRyb2xsZXInPjwvYT5cclxuICAgKlxyXG4gICAqICBDb250cm9sbGVyIGZuIHRoYXQgc2hvdWxkIGJlIGFzc29jaWF0ZWQgd2l0aCBuZXdseVxyXG4gICAqICAgcmVsYXRlZCBzY29wZSBvciB0aGUgbmFtZSBvZiBhIHJlZ2lzdGVyZWQgY29udHJvbGxlciBpZiBwYXNzZWQgYXMgYSBzdHJpbmcuXHJcbiAgICogICBPcHRpb25hbGx5LCB0aGUgQ29udHJvbGxlckFzIG1heSBiZSBkZWNsYXJlZCBoZXJlLlxyXG4gICAqIDxwcmU+Y29udHJvbGxlcjogXCJNeVJlZ2lzdGVyZWRDb250cm9sbGVyXCI8L3ByZT5cclxuICAgKiA8cHJlPmNvbnRyb2xsZXI6XHJcbiAgICogICAgIFwiTXlSZWdpc3RlcmVkQ29udHJvbGxlciBhcyBmb29DdHJsXCJ9PC9wcmU+XHJcbiAgICogPHByZT5jb250cm9sbGVyOiBmdW5jdGlvbigkc2NvcGUsIE15U2VydmljZSkge1xyXG4gICAqICAgICAkc2NvcGUuZGF0YSA9IE15U2VydmljZS5nZXREYXRhKCk7IH08L3ByZT5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb249fSBzdGF0ZUNvbmZpZy5jb250cm9sbGVyUHJvdmlkZXJcclxuICAgKiA8YSBpZD0nY29udHJvbGxlclByb3ZpZGVyJz48L2E+XHJcbiAgICpcclxuICAgKiBJbmplY3RhYmxlIHByb3ZpZGVyIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgYWN0dWFsIGNvbnRyb2xsZXIgb3Igc3RyaW5nLlxyXG4gICAqIDxwcmU+Y29udHJvbGxlclByb3ZpZGVyOlxyXG4gICAqICAgZnVuY3Rpb24oTXlSZXNvbHZlRGF0YSkge1xyXG4gICAqICAgICBpZiAoTXlSZXNvbHZlRGF0YS5mb28pXHJcbiAgICogICAgICAgcmV0dXJuIFwiRm9vQ3RybFwiXHJcbiAgICogICAgIGVsc2UgaWYgKE15UmVzb2x2ZURhdGEuYmFyKVxyXG4gICAqICAgICAgIHJldHVybiBcIkJhckN0cmxcIjtcclxuICAgKiAgICAgZWxzZSByZXR1cm4gZnVuY3Rpb24oJHNjb3BlKSB7XHJcbiAgICogICAgICAgJHNjb3BlLmJheiA9IFwiUXV4XCI7XHJcbiAgICogICAgIH1cclxuICAgKiAgIH08L3ByZT5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nPX0gc3RhdGVDb25maWcuY29udHJvbGxlckFzXHJcbiAgICogPGEgaWQ9J2NvbnRyb2xsZXJBcyc+PC9hPlxyXG4gICAqIFxyXG4gICAqIEEgY29udHJvbGxlciBhbGlhcyBuYW1lLiBJZiBwcmVzZW50IHRoZSBjb250cm9sbGVyIHdpbGwgYmVcclxuICAgKiAgIHB1Ymxpc2hlZCB0byBzY29wZSB1bmRlciB0aGUgY29udHJvbGxlckFzIG5hbWUuXHJcbiAgICogPHByZT5jb250cm9sbGVyQXM6IFwibXlDdHJsXCI8L3ByZT5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7b2JqZWN0PX0gc3RhdGVDb25maWcucmVzb2x2ZVxyXG4gICAqIDxhIGlkPSdyZXNvbHZlJz48L2E+XHJcbiAgICpcclxuICAgKiBBbiBvcHRpb25hbCBtYXAmbHQ7c3RyaW5nLCBmdW5jdGlvbiZndDsgb2YgZGVwZW5kZW5jaWVzIHdoaWNoXHJcbiAgICogICBzaG91bGQgYmUgaW5qZWN0ZWQgaW50byB0aGUgY29udHJvbGxlci4gSWYgYW55IG9mIHRoZXNlIGRlcGVuZGVuY2llcyBhcmUgcHJvbWlzZXMsIFxyXG4gICAqICAgdGhlIHJvdXRlciB3aWxsIHdhaXQgZm9yIHRoZW0gYWxsIHRvIGJlIHJlc29sdmVkIGJlZm9yZSB0aGUgY29udHJvbGxlciBpcyBpbnN0YW50aWF0ZWQuXHJcbiAgICogICBJZiBhbGwgdGhlIHByb21pc2VzIGFyZSByZXNvbHZlZCBzdWNjZXNzZnVsbHksIHRoZSAkc3RhdGVDaGFuZ2VTdWNjZXNzIGV2ZW50IGlzIGZpcmVkXHJcbiAgICogICBhbmQgdGhlIHZhbHVlcyBvZiB0aGUgcmVzb2x2ZWQgcHJvbWlzZXMgYXJlIGluamVjdGVkIGludG8gYW55IGNvbnRyb2xsZXJzIHRoYXQgcmVmZXJlbmNlIHRoZW0uXHJcbiAgICogICBJZiBhbnkgIG9mIHRoZSBwcm9taXNlcyBhcmUgcmVqZWN0ZWQgdGhlICRzdGF0ZUNoYW5nZUVycm9yIGV2ZW50IGlzIGZpcmVkLlxyXG4gICAqXHJcbiAgICogICBUaGUgbWFwIG9iamVjdCBpczpcclxuICAgKiAgIFxyXG4gICAqICAgLSBrZXkgLSB7c3RyaW5nfTogbmFtZSBvZiBkZXBlbmRlbmN5IHRvIGJlIGluamVjdGVkIGludG8gY29udHJvbGxlclxyXG4gICAqICAgLSBmYWN0b3J5IC0ge3N0cmluZ3xmdW5jdGlvbn06IElmIHN0cmluZyB0aGVuIGl0IGlzIGFsaWFzIGZvciBzZXJ2aWNlLiBPdGhlcndpc2UgaWYgZnVuY3Rpb24sIFxyXG4gICAqICAgICBpdCBpcyBpbmplY3RlZCBhbmQgcmV0dXJuIHZhbHVlIGl0IHRyZWF0ZWQgYXMgZGVwZW5kZW5jeS4gSWYgcmVzdWx0IGlzIGEgcHJvbWlzZSwgaXQgaXMgXHJcbiAgICogICAgIHJlc29sdmVkIGJlZm9yZSBpdHMgdmFsdWUgaXMgaW5qZWN0ZWQgaW50byBjb250cm9sbGVyLlxyXG4gICAqXHJcbiAgICogPHByZT5yZXNvbHZlOiB7XHJcbiAgICogICAgIG15UmVzb2x2ZTE6XHJcbiAgICogICAgICAgZnVuY3Rpb24oJGh0dHAsICRzdGF0ZVBhcmFtcykge1xyXG4gICAqICAgICAgICAgcmV0dXJuICRodHRwLmdldChcIi9hcGkvZm9vcy9cIitzdGF0ZVBhcmFtcy5mb29JRCk7XHJcbiAgICogICAgICAgfVxyXG4gICAqICAgICB9PC9wcmU+XHJcbiAgICpcclxuICAgKiBAcGFyYW0ge3N0cmluZz19IHN0YXRlQ29uZmlnLnVybFxyXG4gICAqIDxhIGlkPSd1cmwnPjwvYT5cclxuICAgKlxyXG4gICAqICAgQSB1cmwgZnJhZ21lbnQgd2l0aCBvcHRpb25hbCBwYXJhbWV0ZXJzLiBXaGVuIGEgc3RhdGUgaXMgbmF2aWdhdGVkIG9yXHJcbiAgICogICB0cmFuc2l0aW9uZWQgdG8sIHRoZSBgJHN0YXRlUGFyYW1zYCBzZXJ2aWNlIHdpbGwgYmUgcG9wdWxhdGVkIHdpdGggYW55IFxyXG4gICAqICAgcGFyYW1ldGVycyB0aGF0IHdlcmUgcGFzc2VkLlxyXG4gICAqXHJcbiAgICogZXhhbXBsZXM6XHJcbiAgICogPHByZT51cmw6IFwiL2hvbWVcIlxyXG4gICAqIHVybDogXCIvdXNlcnMvOnVzZXJpZFwiXHJcbiAgICogdXJsOiBcIi9ib29rcy97Ym9va2lkOlthLXpBLVpfLV19XCJcclxuICAgKiB1cmw6IFwiL2Jvb2tzL3tjYXRlZ29yeWlkOmludH1cIlxyXG4gICAqIHVybDogXCIvYm9va3Mve3B1Ymxpc2hlcm5hbWU6c3RyaW5nfS97Y2F0ZWdvcnlpZDppbnR9XCJcclxuICAgKiB1cmw6IFwiL21lc3NhZ2VzP2JlZm9yZSZhZnRlclwiXHJcbiAgICogdXJsOiBcIi9tZXNzYWdlcz97YmVmb3JlOmRhdGV9JnthZnRlcjpkYXRlfVwiPC9wcmU+XHJcbiAgICogdXJsOiBcIi9tZXNzYWdlcy86bWFpbGJveGlkP3tiZWZvcmU6ZGF0ZX0me2FmdGVyOmRhdGV9XCJcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7b2JqZWN0PX0gc3RhdGVDb25maWcudmlld3NcclxuICAgKiA8YSBpZD0ndmlld3MnPjwvYT5cclxuICAgKiBhbiBvcHRpb25hbCBtYXAmbHQ7c3RyaW5nLCBvYmplY3QmZ3Q7IHdoaWNoIGRlZmluZWQgbXVsdGlwbGUgdmlld3MsIG9yIHRhcmdldHMgdmlld3NcclxuICAgKiBtYW51YWxseS9leHBsaWNpdGx5LlxyXG4gICAqXHJcbiAgICogRXhhbXBsZXM6XHJcbiAgICpcclxuICAgKiBUYXJnZXRzIHRocmVlIG5hbWVkIGB1aS12aWV3YHMgaW4gdGhlIHBhcmVudCBzdGF0ZSdzIHRlbXBsYXRlXHJcbiAgICogPHByZT52aWV3czoge1xyXG4gICAqICAgICBoZWFkZXI6IHtcclxuICAgKiAgICAgICBjb250cm9sbGVyOiBcImhlYWRlckN0cmxcIixcclxuICAgKiAgICAgICB0ZW1wbGF0ZVVybDogXCJoZWFkZXIuaHRtbFwiXHJcbiAgICogICAgIH0sIGJvZHk6IHtcclxuICAgKiAgICAgICBjb250cm9sbGVyOiBcImJvZHlDdHJsXCIsXHJcbiAgICogICAgICAgdGVtcGxhdGVVcmw6IFwiYm9keS5odG1sXCJcclxuICAgKiAgICAgfSwgZm9vdGVyOiB7XHJcbiAgICogICAgICAgY29udHJvbGxlcjogXCJmb290Q3RybFwiLFxyXG4gICAqICAgICAgIHRlbXBsYXRlVXJsOiBcImZvb3Rlci5odG1sXCJcclxuICAgKiAgICAgfVxyXG4gICAqICAgfTwvcHJlPlxyXG4gICAqXHJcbiAgICogVGFyZ2V0cyBuYW1lZCBgdWktdmlldz1cImhlYWRlclwiYCBmcm9tIGdyYW5kcGFyZW50IHN0YXRlICd0b3AnJ3MgdGVtcGxhdGUsIGFuZCBuYW1lZCBgdWktdmlldz1cImJvZHlcIiBmcm9tIHBhcmVudCBzdGF0ZSdzIHRlbXBsYXRlLlxyXG4gICAqIDxwcmU+dmlld3M6IHtcclxuICAgKiAgICAgJ2hlYWRlckB0b3AnOiB7XHJcbiAgICogICAgICAgY29udHJvbGxlcjogXCJtc2dIZWFkZXJDdHJsXCIsXHJcbiAgICogICAgICAgdGVtcGxhdGVVcmw6IFwibXNnSGVhZGVyLmh0bWxcIlxyXG4gICAqICAgICB9LCAnYm9keSc6IHtcclxuICAgKiAgICAgICBjb250cm9sbGVyOiBcIm1lc3NhZ2VzQ3RybFwiLFxyXG4gICAqICAgICAgIHRlbXBsYXRlVXJsOiBcIm1lc3NhZ2VzLmh0bWxcIlxyXG4gICAqICAgICB9XHJcbiAgICogICB9PC9wcmU+XHJcbiAgICpcclxuICAgKiBAcGFyYW0ge2Jvb2xlYW49fSBbc3RhdGVDb25maWcuYWJzdHJhY3Q9ZmFsc2VdXHJcbiAgICogPGEgaWQ9J2Fic3RyYWN0Jz48L2E+XHJcbiAgICogQW4gYWJzdHJhY3Qgc3RhdGUgd2lsbCBuZXZlciBiZSBkaXJlY3RseSBhY3RpdmF0ZWQsXHJcbiAgICogICBidXQgY2FuIHByb3ZpZGUgaW5oZXJpdGVkIHByb3BlcnRpZXMgdG8gaXRzIGNvbW1vbiBjaGlsZHJlbiBzdGF0ZXMuXHJcbiAgICogPHByZT5hYnN0cmFjdDogdHJ1ZTwvcHJlPlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtmdW5jdGlvbj19IHN0YXRlQ29uZmlnLm9uRW50ZXJcclxuICAgKiA8YSBpZD0nb25FbnRlcic+PC9hPlxyXG4gICAqXHJcbiAgICogQ2FsbGJhY2sgZnVuY3Rpb24gZm9yIHdoZW4gYSBzdGF0ZSBpcyBlbnRlcmVkLiBHb29kIHdheVxyXG4gICAqICAgdG8gdHJpZ2dlciBhbiBhY3Rpb24gb3IgZGlzcGF0Y2ggYW4gZXZlbnQsIHN1Y2ggYXMgb3BlbmluZyBhIGRpYWxvZy5cclxuICAgKiBJZiBtaW5pZnlpbmcgeW91ciBzY3JpcHRzLCBtYWtlIHN1cmUgdG8gZXhwbGljdGx5IGFubm90YXRlIHRoaXMgZnVuY3Rpb24sXHJcbiAgICogYmVjYXVzZSBpdCB3b24ndCBiZSBhdXRvbWF0aWNhbGx5IGFubm90YXRlZCBieSB5b3VyIGJ1aWxkIHRvb2xzLlxyXG4gICAqXHJcbiAgICogPHByZT5vbkVudGVyOiBmdW5jdGlvbihNeVNlcnZpY2UsICRzdGF0ZVBhcmFtcykge1xyXG4gICAqICAgICBNeVNlcnZpY2UuZm9vKCRzdGF0ZVBhcmFtcy5teVBhcmFtKTtcclxuICAgKiB9PC9wcmU+XHJcbiAgICpcclxuICAgKiBAcGFyYW0ge2Z1bmN0aW9uPX0gc3RhdGVDb25maWcub25FeGl0XHJcbiAgICogPGEgaWQ9J29uRXhpdCc+PC9hPlxyXG4gICAqXHJcbiAgICogQ2FsbGJhY2sgZnVuY3Rpb24gZm9yIHdoZW4gYSBzdGF0ZSBpcyBleGl0ZWQuIEdvb2Qgd2F5IHRvXHJcbiAgICogICB0cmlnZ2VyIGFuIGFjdGlvbiBvciBkaXNwYXRjaCBhbiBldmVudCwgc3VjaCBhcyBvcGVuaW5nIGEgZGlhbG9nLlxyXG4gICAqIElmIG1pbmlmeWluZyB5b3VyIHNjcmlwdHMsIG1ha2Ugc3VyZSB0byBleHBsaWN0bHkgYW5ub3RhdGUgdGhpcyBmdW5jdGlvbixcclxuICAgKiBiZWNhdXNlIGl0IHdvbid0IGJlIGF1dG9tYXRpY2FsbHkgYW5ub3RhdGVkIGJ5IHlvdXIgYnVpbGQgdG9vbHMuXHJcbiAgICpcclxuICAgKiA8cHJlPm9uRXhpdDogZnVuY3Rpb24oTXlTZXJ2aWNlLCAkc3RhdGVQYXJhbXMpIHtcclxuICAgKiAgICAgTXlTZXJ2aWNlLmNsZWFudXAoJHN0YXRlUGFyYW1zLm15UGFyYW0pO1xyXG4gICAqIH08L3ByZT5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7Ym9vbGVhbj19IFtzdGF0ZUNvbmZpZy5yZWxvYWRPblNlYXJjaD10cnVlXVxyXG4gICAqIDxhIGlkPSdyZWxvYWRPblNlYXJjaCc+PC9hPlxyXG4gICAqXHJcbiAgICogSWYgYGZhbHNlYCwgd2lsbCBub3QgcmV0cmlnZ2VyIHRoZSBzYW1lIHN0YXRlXHJcbiAgICogICBqdXN0IGJlY2F1c2UgYSBzZWFyY2gvcXVlcnkgcGFyYW1ldGVyIGhhcyBjaGFuZ2VkICh2aWEgJGxvY2F0aW9uLnNlYXJjaCgpIG9yICRsb2NhdGlvbi5oYXNoKCkpLiBcclxuICAgKiAgIFVzZWZ1bCBmb3Igd2hlbiB5b3UnZCBsaWtlIHRvIG1vZGlmeSAkbG9jYXRpb24uc2VhcmNoKCkgd2l0aG91dCB0cmlnZ2VyaW5nIGEgcmVsb2FkLlxyXG4gICAqIDxwcmU+cmVsb2FkT25TZWFyY2g6IGZhbHNlPC9wcmU+XHJcbiAgICpcclxuICAgKiBAcGFyYW0ge29iamVjdD19IHN0YXRlQ29uZmlnLmRhdGFcclxuICAgKiA8YSBpZD0nZGF0YSc+PC9hPlxyXG4gICAqXHJcbiAgICogQXJiaXRyYXJ5IGRhdGEgb2JqZWN0LCB1c2VmdWwgZm9yIGN1c3RvbSBjb25maWd1cmF0aW9uLiAgVGhlIHBhcmVudCBzdGF0ZSdzIGBkYXRhYCBpc1xyXG4gICAqICAgcHJvdG90eXBhbGx5IGluaGVyaXRlZC4gIEluIG90aGVyIHdvcmRzLCBhZGRpbmcgYSBkYXRhIHByb3BlcnR5IHRvIGEgc3RhdGUgYWRkcyBpdCB0b1xyXG4gICAqICAgdGhlIGVudGlyZSBzdWJ0cmVlIHZpYSBwcm90b3R5cGFsIGluaGVyaXRhbmNlLlxyXG4gICAqXHJcbiAgICogPHByZT5kYXRhOiB7XHJcbiAgICogICAgIHJlcXVpcmVkUm9sZTogJ2ZvbydcclxuICAgKiB9IDwvcHJlPlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtvYmplY3Q9fSBzdGF0ZUNvbmZpZy5wYXJhbXNcclxuICAgKiA8YSBpZD0ncGFyYW1zJz48L2E+XHJcbiAgICpcclxuICAgKiBBIG1hcCB3aGljaCBvcHRpb25hbGx5IGNvbmZpZ3VyZXMgcGFyYW1ldGVycyBkZWNsYXJlZCBpbiB0aGUgYHVybGAsIG9yXHJcbiAgICogICBkZWZpbmVzIGFkZGl0aW9uYWwgbm9uLXVybCBwYXJhbWV0ZXJzLiAgRm9yIGVhY2ggcGFyYW1ldGVyIGJlaW5nXHJcbiAgICogICBjb25maWd1cmVkLCBhZGQgYSBjb25maWd1cmF0aW9uIG9iamVjdCBrZXllZCB0byB0aGUgbmFtZSBvZiB0aGUgcGFyYW1ldGVyLlxyXG4gICAqXHJcbiAgICogICBFYWNoIHBhcmFtZXRlciBjb25maWd1cmF0aW9uIG9iamVjdCBtYXkgY29udGFpbiB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6XHJcbiAgICpcclxuICAgKiAgIC0gKiogdmFsdWUgKiogLSB7b2JqZWN0fGZ1bmN0aW9uPX06IHNwZWNpZmllcyB0aGUgZGVmYXVsdCB2YWx1ZSBmb3IgdGhpc1xyXG4gICAqICAgICBwYXJhbWV0ZXIuICBUaGlzIGltcGxpY2l0bHkgc2V0cyB0aGlzIHBhcmFtZXRlciBhcyBvcHRpb25hbC5cclxuICAgKlxyXG4gICAqICAgICBXaGVuIFVJLVJvdXRlciByb3V0ZXMgdG8gYSBzdGF0ZSBhbmQgbm8gdmFsdWUgaXNcclxuICAgKiAgICAgc3BlY2lmaWVkIGZvciB0aGlzIHBhcmFtZXRlciBpbiB0aGUgVVJMIG9yIHRyYW5zaXRpb24sIHRoZVxyXG4gICAqICAgICBkZWZhdWx0IHZhbHVlIHdpbGwgYmUgdXNlZCBpbnN0ZWFkLiAgSWYgYHZhbHVlYCBpcyBhIGZ1bmN0aW9uLFxyXG4gICAqICAgICBpdCB3aWxsIGJlIGluamVjdGVkIGFuZCBpbnZva2VkLCBhbmQgdGhlIHJldHVybiB2YWx1ZSB1c2VkLlxyXG4gICAqXHJcbiAgICogICAgICpOb3RlKjogYHVuZGVmaW5lZGAgaXMgdHJlYXRlZCBhcyBcIm5vIGRlZmF1bHQgdmFsdWVcIiB3aGlsZSBgbnVsbGBcclxuICAgKiAgICAgaXMgdHJlYXRlZCBhcyBcInRoZSBkZWZhdWx0IHZhbHVlIGlzIGBudWxsYFwiLlxyXG4gICAqXHJcbiAgICogICAgICpTaG9ydGhhbmQqOiBJZiB5b3Ugb25seSBuZWVkIHRvIGNvbmZpZ3VyZSB0aGUgZGVmYXVsdCB2YWx1ZSBvZiB0aGVcclxuICAgKiAgICAgcGFyYW1ldGVyLCB5b3UgbWF5IHVzZSBhIHNob3J0aGFuZCBzeW50YXguICAgSW4gdGhlICoqYHBhcmFtc2AqKlxyXG4gICAqICAgICBtYXAsIGluc3RlYWQgbWFwcGluZyB0aGUgcGFyYW0gbmFtZSB0byBhIGZ1bGwgcGFyYW1ldGVyIGNvbmZpZ3VyYXRpb25cclxuICAgKiAgICAgb2JqZWN0LCBzaW1wbHkgc2V0IG1hcCBpdCB0byB0aGUgZGVmYXVsdCBwYXJhbWV0ZXIgdmFsdWUsIGUuZy46XHJcbiAgICpcclxuICAgKiA8cHJlPi8vIGRlZmluZSBhIHBhcmFtZXRlcidzIGRlZmF1bHQgdmFsdWVcclxuICAgKiBwYXJhbXM6IHtcclxuICAgKiAgICAgcGFyYW0xOiB7IHZhbHVlOiBcImRlZmF1bHRWYWx1ZVwiIH1cclxuICAgKiB9XHJcbiAgICogLy8gc2hvcnRoYW5kIGRlZmF1bHQgdmFsdWVzXHJcbiAgICogcGFyYW1zOiB7XHJcbiAgICogICAgIHBhcmFtMTogXCJkZWZhdWx0VmFsdWVcIixcclxuICAgKiAgICAgcGFyYW0yOiBcInBhcmFtMkRlZmF1bHRcIlxyXG4gICAqIH08L3ByZT5cclxuICAgKlxyXG4gICAqICAgLSAqKiBhcnJheSAqKiAtIHtib29sZWFuPX06ICooZGVmYXVsdDogZmFsc2UpKiBJZiB0cnVlLCB0aGUgcGFyYW0gdmFsdWUgd2lsbCBiZVxyXG4gICAqICAgICB0cmVhdGVkIGFzIGFuIGFycmF5IG9mIHZhbHVlcy4gIElmIHlvdSBzcGVjaWZpZWQgYSBUeXBlLCB0aGUgdmFsdWUgd2lsbCBiZVxyXG4gICAqICAgICB0cmVhdGVkIGFzIGFuIGFycmF5IG9mIHRoZSBzcGVjaWZpZWQgVHlwZS4gIE5vdGU6IHF1ZXJ5IHBhcmFtZXRlciB2YWx1ZXNcclxuICAgKiAgICAgZGVmYXVsdCB0byBhIHNwZWNpYWwgYFwiYXV0b1wiYCBtb2RlLlxyXG4gICAqXHJcbiAgICogICAgIEZvciBxdWVyeSBwYXJhbWV0ZXJzIGluIGBcImF1dG9cImAgbW9kZSwgaWYgbXVsdGlwbGUgIHZhbHVlcyBmb3IgYSBzaW5nbGUgcGFyYW1ldGVyXHJcbiAgICogICAgIGFyZSBwcmVzZW50IGluIHRoZSBVUkwgKGUuZy46IGAvZm9vP2Jhcj0xJmJhcj0yJmJhcj0zYCkgdGhlbiB0aGUgdmFsdWVzXHJcbiAgICogICAgIGFyZSBtYXBwZWQgdG8gYW4gYXJyYXkgKGUuZy46IGB7IGZvbzogWyAnMScsICcyJywgJzMnIF0gfWApLiAgSG93ZXZlciwgaWZcclxuICAgKiAgICAgb25seSBvbmUgdmFsdWUgaXMgcHJlc2VudCAoZS5nLjogYC9mb28/YmFyPTFgKSB0aGVuIHRoZSB2YWx1ZSBpcyB0cmVhdGVkIGFzIHNpbmdsZVxyXG4gICAqICAgICB2YWx1ZSAoZS5nLjogYHsgZm9vOiAnMScgfWApLlxyXG4gICAqXHJcbiAgICogPHByZT5wYXJhbXM6IHtcclxuICAgKiAgICAgcGFyYW0xOiB7IGFycmF5OiB0cnVlIH1cclxuICAgKiB9PC9wcmU+XHJcbiAgICpcclxuICAgKiAgIC0gKiogc3F1YXNoICoqIC0ge2Jvb2x8c3RyaW5nPX06IGBzcXVhc2hgIGNvbmZpZ3VyZXMgaG93IGEgZGVmYXVsdCBwYXJhbWV0ZXIgdmFsdWUgaXMgcmVwcmVzZW50ZWQgaW4gdGhlIFVSTCB3aGVuXHJcbiAgICogICAgIHRoZSBjdXJyZW50IHBhcmFtZXRlciB2YWx1ZSBpcyB0aGUgc2FtZSBhcyB0aGUgZGVmYXVsdCB2YWx1ZS4gSWYgYHNxdWFzaGAgaXMgbm90IHNldCwgaXQgdXNlcyB0aGVcclxuICAgKiAgICAgY29uZmlndXJlZCBkZWZhdWx0IHNxdWFzaCBwb2xpY3kuXHJcbiAgICogICAgIChTZWUge0BsaW5rIHVpLnJvdXRlci51dGlsLiR1cmxNYXRjaGVyRmFjdG9yeSNtZXRob2RzX2RlZmF1bHRTcXVhc2hQb2xpY3kgYGRlZmF1bHRTcXVhc2hQb2xpY3koKWB9KVxyXG4gICAqXHJcbiAgICogICBUaGVyZSBhcmUgdGhyZWUgc3F1YXNoIHNldHRpbmdzOlxyXG4gICAqXHJcbiAgICogICAgIC0gZmFsc2U6IFRoZSBwYXJhbWV0ZXIncyBkZWZhdWx0IHZhbHVlIGlzIG5vdCBzcXVhc2hlZC4gIEl0IGlzIGVuY29kZWQgYW5kIGluY2x1ZGVkIGluIHRoZSBVUkxcclxuICAgKiAgICAgLSB0cnVlOiBUaGUgcGFyYW1ldGVyJ3MgZGVmYXVsdCB2YWx1ZSBpcyBvbWl0dGVkIGZyb20gdGhlIFVSTC4gIElmIHRoZSBwYXJhbWV0ZXIgaXMgcHJlY2VlZGVkIGFuZCBmb2xsb3dlZFxyXG4gICAqICAgICAgIGJ5IHNsYXNoZXMgaW4gdGhlIHN0YXRlJ3MgYHVybGAgZGVjbGFyYXRpb24sIHRoZW4gb25lIG9mIHRob3NlIHNsYXNoZXMgYXJlIG9taXR0ZWQuXHJcbiAgICogICAgICAgVGhpcyBjYW4gYWxsb3cgZm9yIGNsZWFuZXIgbG9va2luZyBVUkxzLlxyXG4gICAqICAgICAtIGBcIjxhcmJpdHJhcnkgc3RyaW5nPlwiYDogVGhlIHBhcmFtZXRlcidzIGRlZmF1bHQgdmFsdWUgaXMgcmVwbGFjZWQgd2l0aCBhbiBhcmJpdHJhcnkgcGxhY2Vob2xkZXIgb2YgIHlvdXIgY2hvaWNlLlxyXG4gICAqXHJcbiAgICogPHByZT5wYXJhbXM6IHtcclxuICAgKiAgICAgcGFyYW0xOiB7XHJcbiAgICogICAgICAgdmFsdWU6IFwiZGVmYXVsdElkXCIsXHJcbiAgICogICAgICAgc3F1YXNoOiB0cnVlXHJcbiAgICogfSB9XHJcbiAgICogLy8gc3F1YXNoIFwiZGVmYXVsdFZhbHVlXCIgdG8gXCJ+XCJcclxuICAgKiBwYXJhbXM6IHtcclxuICAgKiAgICAgcGFyYW0xOiB7XHJcbiAgICogICAgICAgdmFsdWU6IFwiZGVmYXVsdFZhbHVlXCIsXHJcbiAgICogICAgICAgc3F1YXNoOiBcIn5cIlxyXG4gICAqIH0gfVxyXG4gICAqIDwvcHJlPlxyXG4gICAqXHJcbiAgICpcclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIDxwcmU+XHJcbiAgICogLy8gU29tZSBzdGF0ZSBuYW1lIGV4YW1wbGVzXHJcbiAgICpcclxuICAgKiAvLyBzdGF0ZU5hbWUgY2FuIGJlIGEgc2luZ2xlIHRvcC1sZXZlbCBuYW1lIChtdXN0IGJlIHVuaXF1ZSkuXHJcbiAgICogJHN0YXRlUHJvdmlkZXIuc3RhdGUoXCJob21lXCIsIHt9KTtcclxuICAgKlxyXG4gICAqIC8vIE9yIGl0IGNhbiBiZSBhIG5lc3RlZCBzdGF0ZSBuYW1lLiBUaGlzIHN0YXRlIGlzIGEgY2hpbGQgb2YgdGhlXHJcbiAgICogLy8gYWJvdmUgXCJob21lXCIgc3RhdGUuXHJcbiAgICogJHN0YXRlUHJvdmlkZXIuc3RhdGUoXCJob21lLm5ld2VzdFwiLCB7fSk7XHJcbiAgICpcclxuICAgKiAvLyBOZXN0IHN0YXRlcyBhcyBkZWVwbHkgYXMgbmVlZGVkLlxyXG4gICAqICRzdGF0ZVByb3ZpZGVyLnN0YXRlKFwiaG9tZS5uZXdlc3QuYWJjLnh5ei5pbmNlcHRpb25cIiwge30pO1xyXG4gICAqXHJcbiAgICogLy8gc3RhdGUoKSByZXR1cm5zICRzdGF0ZVByb3ZpZGVyLCBzbyB5b3UgY2FuIGNoYWluIHN0YXRlIGRlY2xhcmF0aW9ucy5cclxuICAgKiAkc3RhdGVQcm92aWRlclxyXG4gICAqICAgLnN0YXRlKFwiaG9tZVwiLCB7fSlcclxuICAgKiAgIC5zdGF0ZShcImFib3V0XCIsIHt9KVxyXG4gICAqICAgLnN0YXRlKFwiY29udGFjdHNcIiwge30pO1xyXG4gICAqIDwvcHJlPlxyXG4gICAqXHJcbiAgICovXHJcbiAgdGhpcy5zdGF0ZSA9IHN0YXRlO1xyXG4gIGZ1bmN0aW9uIHN0YXRlKG5hbWUsIGRlZmluaXRpb24pIHtcclxuICAgIC8qanNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xyXG4gICAgaWYgKGlzT2JqZWN0KG5hbWUpKSBkZWZpbml0aW9uID0gbmFtZTtcclxuICAgIGVsc2UgZGVmaW5pdGlvbi5uYW1lID0gbmFtZTtcclxuICAgIHJlZ2lzdGVyU3RhdGUoZGVmaW5pdGlvbik7XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBuZ2RvYyBvYmplY3RcclxuICAgKiBAbmFtZSB1aS5yb3V0ZXIuc3RhdGUuJHN0YXRlXHJcbiAgICpcclxuICAgKiBAcmVxdWlyZXMgJHJvb3RTY29wZVxyXG4gICAqIEByZXF1aXJlcyAkcVxyXG4gICAqIEByZXF1aXJlcyB1aS5yb3V0ZXIuc3RhdGUuJHZpZXdcclxuICAgKiBAcmVxdWlyZXMgJGluamVjdG9yXHJcbiAgICogQHJlcXVpcmVzIHVpLnJvdXRlci51dGlsLiRyZXNvbHZlXHJcbiAgICogQHJlcXVpcmVzIHVpLnJvdXRlci5zdGF0ZS4kc3RhdGVQYXJhbXNcclxuICAgKiBAcmVxdWlyZXMgdWkucm91dGVyLnJvdXRlci4kdXJsUm91dGVyXHJcbiAgICpcclxuICAgKiBAcHJvcGVydHkge29iamVjdH0gcGFyYW1zIEEgcGFyYW0gb2JqZWN0LCBlLmcuIHtzZWN0aW9uSWQ6IHNlY3Rpb24uaWQpfSwgdGhhdCBcclxuICAgKiB5b3UnZCBsaWtlIHRvIHRlc3QgYWdhaW5zdCB0aGUgY3VycmVudCBhY3RpdmUgc3RhdGUuXHJcbiAgICogQHByb3BlcnR5IHtvYmplY3R9IGN1cnJlbnQgQSByZWZlcmVuY2UgdG8gdGhlIHN0YXRlJ3MgY29uZmlnIG9iamVjdC4gSG93ZXZlciBcclxuICAgKiB5b3UgcGFzc2VkIGl0IGluLiBVc2VmdWwgZm9yIGFjY2Vzc2luZyBjdXN0b20gZGF0YS5cclxuICAgKiBAcHJvcGVydHkge29iamVjdH0gdHJhbnNpdGlvbiBDdXJyZW50bHkgcGVuZGluZyB0cmFuc2l0aW9uLiBBIHByb21pc2UgdGhhdCdsbCBcclxuICAgKiByZXNvbHZlIG9yIHJlamVjdC5cclxuICAgKlxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqIGAkc3RhdGVgIHNlcnZpY2UgaXMgcmVzcG9uc2libGUgZm9yIHJlcHJlc2VudGluZyBzdGF0ZXMgYXMgd2VsbCBhcyB0cmFuc2l0aW9uaW5nXHJcbiAgICogYmV0d2VlbiB0aGVtLiBJdCBhbHNvIHByb3ZpZGVzIGludGVyZmFjZXMgdG8gYXNrIGZvciBjdXJyZW50IHN0YXRlIG9yIGV2ZW4gc3RhdGVzXHJcbiAgICogeW91J3JlIGNvbWluZyBmcm9tLlxyXG4gICAqL1xyXG4gIHRoaXMuJGdldCA9ICRnZXQ7XHJcbiAgJGdldC4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJywgJyRxJywgJyR2aWV3JywgJyRpbmplY3RvcicsICckcmVzb2x2ZScsICckc3RhdGVQYXJhbXMnLCAnJHVybFJvdXRlcicsICckbG9jYXRpb24nLCAnJHVybE1hdGNoZXJGYWN0b3J5J107XHJcbiAgZnVuY3Rpb24gJGdldCggICAkcm9vdFNjb3BlLCAgICRxLCAgICR2aWV3LCAgICRpbmplY3RvciwgICAkcmVzb2x2ZSwgICAkc3RhdGVQYXJhbXMsICAgJHVybFJvdXRlciwgICAkbG9jYXRpb24sICAgJHVybE1hdGNoZXJGYWN0b3J5KSB7XHJcblxyXG4gICAgdmFyIFRyYW5zaXRpb25TdXBlcnNlZGVkID0gJHEucmVqZWN0KG5ldyBFcnJvcigndHJhbnNpdGlvbiBzdXBlcnNlZGVkJykpO1xyXG4gICAgdmFyIFRyYW5zaXRpb25QcmV2ZW50ZWQgPSAkcS5yZWplY3QobmV3IEVycm9yKCd0cmFuc2l0aW9uIHByZXZlbnRlZCcpKTtcclxuICAgIHZhciBUcmFuc2l0aW9uQWJvcnRlZCA9ICRxLnJlamVjdChuZXcgRXJyb3IoJ3RyYW5zaXRpb24gYWJvcnRlZCcpKTtcclxuICAgIHZhciBUcmFuc2l0aW9uRmFpbGVkID0gJHEucmVqZWN0KG5ldyBFcnJvcigndHJhbnNpdGlvbiBmYWlsZWQnKSk7XHJcblxyXG4gICAgLy8gSGFuZGxlcyB0aGUgY2FzZSB3aGVyZSBhIHN0YXRlIHdoaWNoIGlzIHRoZSB0YXJnZXQgb2YgYSB0cmFuc2l0aW9uIGlzIG5vdCBmb3VuZCwgYW5kIHRoZSB1c2VyXHJcbiAgICAvLyBjYW4gb3B0aW9uYWxseSByZXRyeSBvciBkZWZlciB0aGUgdHJhbnNpdGlvblxyXG4gICAgZnVuY3Rpb24gaGFuZGxlUmVkaXJlY3QocmVkaXJlY3QsIHN0YXRlLCBwYXJhbXMsIG9wdGlvbnMpIHtcclxuICAgICAgLyoqXHJcbiAgICAgICAqIEBuZ2RvYyBldmVudFxyXG4gICAgICAgKiBAbmFtZSB1aS5yb3V0ZXIuc3RhdGUuJHN0YXRlIyRzdGF0ZU5vdEZvdW5kXHJcbiAgICAgICAqIEBldmVudE9mIHVpLnJvdXRlci5zdGF0ZS4kc3RhdGVcclxuICAgICAgICogQGV2ZW50VHlwZSBicm9hZGNhc3Qgb24gcm9vdCBzY29wZVxyXG4gICAgICAgKiBAZGVzY3JpcHRpb25cclxuICAgICAgICogRmlyZWQgd2hlbiBhIHJlcXVlc3RlZCBzdGF0ZSAqKmNhbm5vdCBiZSBmb3VuZCoqIHVzaW5nIHRoZSBwcm92aWRlZCBzdGF0ZSBuYW1lIGR1cmluZyB0cmFuc2l0aW9uLlxyXG4gICAgICAgKiBUaGUgZXZlbnQgaXMgYnJvYWRjYXN0IGFsbG93aW5nIGFueSBoYW5kbGVycyBhIHNpbmdsZSBjaGFuY2UgdG8gZGVhbCB3aXRoIHRoZSBlcnJvciAodXN1YWxseSBieVxyXG4gICAgICAgKiBsYXp5LWxvYWRpbmcgdGhlIHVuZm91bmQgc3RhdGUpLiBBIHNwZWNpYWwgYHVuZm91bmRTdGF0ZWAgb2JqZWN0IGlzIHBhc3NlZCB0byB0aGUgbGlzdGVuZXIgaGFuZGxlcixcclxuICAgICAgICogeW91IGNhbiBzZWUgaXRzIHRocmVlIHByb3BlcnRpZXMgaW4gdGhlIGV4YW1wbGUuIFlvdSBjYW4gdXNlIGBldmVudC5wcmV2ZW50RGVmYXVsdCgpYCB0byBhYm9ydCB0aGVcclxuICAgICAgICogdHJhbnNpdGlvbiBhbmQgdGhlIHByb21pc2UgcmV0dXJuZWQgZnJvbSBgZ29gIHdpbGwgYmUgcmVqZWN0ZWQgd2l0aCBhIGAndHJhbnNpdGlvbiBhYm9ydGVkJ2AgdmFsdWUuXHJcbiAgICAgICAqXHJcbiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBFdmVudCBvYmplY3QuXHJcbiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSB1bmZvdW5kU3RhdGUgVW5mb3VuZCBTdGF0ZSBpbmZvcm1hdGlvbi4gQ29udGFpbnM6IGB0bywgdG9QYXJhbXMsIG9wdGlvbnNgIHByb3BlcnRpZXMuXHJcbiAgICAgICAqIEBwYXJhbSB7U3RhdGV9IGZyb21TdGF0ZSBDdXJyZW50IHN0YXRlIG9iamVjdC5cclxuICAgICAgICogQHBhcmFtIHtPYmplY3R9IGZyb21QYXJhbXMgQ3VycmVudCBzdGF0ZSBwYXJhbXMuXHJcbiAgICAgICAqXHJcbiAgICAgICAqIEBleGFtcGxlXHJcbiAgICAgICAqXHJcbiAgICAgICAqIDxwcmU+XHJcbiAgICAgICAqIC8vIHNvbWV3aGVyZSwgYXNzdW1lIGxhenkuc3RhdGUgaGFzIG5vdCBiZWVuIGRlZmluZWRcclxuICAgICAgICogJHN0YXRlLmdvKFwibGF6eS5zdGF0ZVwiLCB7YToxLCBiOjJ9LCB7aW5oZXJpdDpmYWxzZX0pO1xyXG4gICAgICAgKlxyXG4gICAgICAgKiAvLyBzb21ld2hlcmUgZWxzZVxyXG4gICAgICAgKiAkc2NvcGUuJG9uKCckc3RhdGVOb3RGb3VuZCcsXHJcbiAgICAgICAqIGZ1bmN0aW9uKGV2ZW50LCB1bmZvdW5kU3RhdGUsIGZyb21TdGF0ZSwgZnJvbVBhcmFtcyl7XHJcbiAgICAgICAqICAgICBjb25zb2xlLmxvZyh1bmZvdW5kU3RhdGUudG8pOyAvLyBcImxhenkuc3RhdGVcIlxyXG4gICAgICAgKiAgICAgY29uc29sZS5sb2codW5mb3VuZFN0YXRlLnRvUGFyYW1zKTsgLy8ge2E6MSwgYjoyfVxyXG4gICAgICAgKiAgICAgY29uc29sZS5sb2codW5mb3VuZFN0YXRlLm9wdGlvbnMpOyAvLyB7aW5oZXJpdDpmYWxzZX0gKyBkZWZhdWx0IG9wdGlvbnNcclxuICAgICAgICogfSlcclxuICAgICAgICogPC9wcmU+XHJcbiAgICAgICAqL1xyXG4gICAgICB2YXIgZXZ0ID0gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCckc3RhdGVOb3RGb3VuZCcsIHJlZGlyZWN0LCBzdGF0ZSwgcGFyYW1zKTtcclxuXHJcbiAgICAgIGlmIChldnQuZGVmYXVsdFByZXZlbnRlZCkge1xyXG4gICAgICAgICR1cmxSb3V0ZXIudXBkYXRlKCk7XHJcbiAgICAgICAgcmV0dXJuIFRyYW5zaXRpb25BYm9ydGVkO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIWV2dC5yZXRyeSkge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBBbGxvdyB0aGUgaGFuZGxlciB0byByZXR1cm4gYSBwcm9taXNlIHRvIGRlZmVyIHN0YXRlIGxvb2t1cCByZXRyeVxyXG4gICAgICBpZiAob3B0aW9ucy4kcmV0cnkpIHtcclxuICAgICAgICAkdXJsUm91dGVyLnVwZGF0ZSgpO1xyXG4gICAgICAgIHJldHVybiBUcmFuc2l0aW9uRmFpbGVkO1xyXG4gICAgICB9XHJcbiAgICAgIHZhciByZXRyeVRyYW5zaXRpb24gPSAkc3RhdGUudHJhbnNpdGlvbiA9ICRxLndoZW4oZXZ0LnJldHJ5KTtcclxuXHJcbiAgICAgIHJldHJ5VHJhbnNpdGlvbi50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChyZXRyeVRyYW5zaXRpb24gIT09ICRzdGF0ZS50cmFuc2l0aW9uKSByZXR1cm4gVHJhbnNpdGlvblN1cGVyc2VkZWQ7XHJcbiAgICAgICAgcmVkaXJlY3Qub3B0aW9ucy4kcmV0cnkgPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiAkc3RhdGUudHJhbnNpdGlvblRvKHJlZGlyZWN0LnRvLCByZWRpcmVjdC50b1BhcmFtcywgcmVkaXJlY3Qub3B0aW9ucyk7XHJcbiAgICAgIH0sIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBUcmFuc2l0aW9uQWJvcnRlZDtcclxuICAgICAgfSk7XHJcbiAgICAgICR1cmxSb3V0ZXIudXBkYXRlKCk7XHJcblxyXG4gICAgICByZXR1cm4gcmV0cnlUcmFuc2l0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIHJvb3QubG9jYWxzID0geyByZXNvbHZlOiBudWxsLCBnbG9iYWxzOiB7ICRzdGF0ZVBhcmFtczoge30gfSB9O1xyXG5cclxuICAgICRzdGF0ZSA9IHtcclxuICAgICAgcGFyYW1zOiB7fSxcclxuICAgICAgY3VycmVudDogcm9vdC5zZWxmLFxyXG4gICAgICAkY3VycmVudDogcm9vdCxcclxuICAgICAgdHJhbnNpdGlvbjogbnVsbFxyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBuZ2RvYyBmdW5jdGlvblxyXG4gICAgICogQG5hbWUgdWkucm91dGVyLnN0YXRlLiRzdGF0ZSNyZWxvYWRcclxuICAgICAqIEBtZXRob2RPZiB1aS5yb3V0ZXIuc3RhdGUuJHN0YXRlXHJcbiAgICAgKlxyXG4gICAgICogQGRlc2NyaXB0aW9uXHJcbiAgICAgKiBBIG1ldGhvZCB0aGF0IGZvcmNlIHJlbG9hZHMgdGhlIGN1cnJlbnQgc3RhdGUuIEFsbCByZXNvbHZlcyBhcmUgcmUtcmVzb2x2ZWQsIGV2ZW50cyBhcmUgbm90IHJlLWZpcmVkLCBcclxuICAgICAqIGFuZCBjb250cm9sbGVycyByZWluc3RhbnRpYXRlZCAoYnVnIHdpdGggY29udHJvbGxlcnMgcmVpbnN0YW50aWF0aW5nIHJpZ2h0IG5vdywgZml4aW5nIHNvb24pLlxyXG4gICAgICpcclxuICAgICAqIEBleGFtcGxlXHJcbiAgICAgKiA8cHJlPlxyXG4gICAgICogdmFyIGFwcCBhbmd1bGFyLm1vZHVsZSgnYXBwJywgWyd1aS5yb3V0ZXInXSk7XHJcbiAgICAgKlxyXG4gICAgICogYXBwLmNvbnRyb2xsZXIoJ2N0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkc3RhdGUpIHtcclxuICAgICAqICAgJHNjb3BlLnJlbG9hZCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgKiAgICAgJHN0YXRlLnJlbG9hZCgpO1xyXG4gICAgICogICB9XHJcbiAgICAgKiB9KTtcclxuICAgICAqIDwvcHJlPlxyXG4gICAgICpcclxuICAgICAqIGByZWxvYWQoKWAgaXMganVzdCBhbiBhbGlhcyBmb3I6XHJcbiAgICAgKiA8cHJlPlxyXG4gICAgICogJHN0YXRlLnRyYW5zaXRpb25Ubygkc3RhdGUuY3VycmVudCwgJHN0YXRlUGFyYW1zLCB7IFxyXG4gICAgICogICByZWxvYWQ6IHRydWUsIGluaGVyaXQ6IGZhbHNlLCBub3RpZnk6IHRydWVcclxuICAgICAqIH0pO1xyXG4gICAgICogPC9wcmU+XHJcbiAgICAgKlxyXG4gICAgICogQHJldHVybnMge3Byb21pc2V9IEEgcHJvbWlzZSByZXByZXNlbnRpbmcgdGhlIHN0YXRlIG9mIHRoZSBuZXcgdHJhbnNpdGlvbi4gU2VlXHJcbiAgICAgKiB7QGxpbmsgdWkucm91dGVyLnN0YXRlLiRzdGF0ZSNtZXRob2RzX2dvICRzdGF0ZS5nb30uXHJcbiAgICAgKi9cclxuICAgICRzdGF0ZS5yZWxvYWQgPSBmdW5jdGlvbiByZWxvYWQoKSB7XHJcbiAgICAgIHJldHVybiAkc3RhdGUudHJhbnNpdGlvblRvKCRzdGF0ZS5jdXJyZW50LCAkc3RhdGVQYXJhbXMsIHsgcmVsb2FkOiB0cnVlLCBpbmhlcml0OiBmYWxzZSwgbm90aWZ5OiB0cnVlIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBuZ2RvYyBmdW5jdGlvblxyXG4gICAgICogQG5hbWUgdWkucm91dGVyLnN0YXRlLiRzdGF0ZSNnb1xyXG4gICAgICogQG1ldGhvZE9mIHVpLnJvdXRlci5zdGF0ZS4kc3RhdGVcclxuICAgICAqXHJcbiAgICAgKiBAZGVzY3JpcHRpb25cclxuICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCBmb3IgdHJhbnNpdGlvbmluZyB0byBhIG5ldyBzdGF0ZS4gYCRzdGF0ZS5nb2AgY2FsbHMgXHJcbiAgICAgKiBgJHN0YXRlLnRyYW5zaXRpb25Ub2AgaW50ZXJuYWxseSBidXQgYXV0b21hdGljYWxseSBzZXRzIG9wdGlvbnMgdG8gXHJcbiAgICAgKiBgeyBsb2NhdGlvbjogdHJ1ZSwgaW5oZXJpdDogdHJ1ZSwgcmVsYXRpdmU6ICRzdGF0ZS4kY3VycmVudCwgbm90aWZ5OiB0cnVlIH1gLiBcclxuICAgICAqIFRoaXMgYWxsb3dzIHlvdSB0byBlYXNpbHkgdXNlIGFuIGFic29sdXRlIG9yIHJlbGF0aXZlIHRvIHBhdGggYW5kIHNwZWNpZnkgXHJcbiAgICAgKiBvbmx5IHRoZSBwYXJhbWV0ZXJzIHlvdSdkIGxpa2UgdG8gdXBkYXRlICh3aGlsZSBsZXR0aW5nIHVuc3BlY2lmaWVkIHBhcmFtZXRlcnMgXHJcbiAgICAgKiBpbmhlcml0IGZyb20gdGhlIGN1cnJlbnRseSBhY3RpdmUgYW5jZXN0b3Igc3RhdGVzKS5cclxuICAgICAqXHJcbiAgICAgKiBAZXhhbXBsZVxyXG4gICAgICogPHByZT5cclxuICAgICAqIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJywgWyd1aS5yb3V0ZXInXSk7XHJcbiAgICAgKlxyXG4gICAgICogYXBwLmNvbnRyb2xsZXIoJ2N0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkc3RhdGUpIHtcclxuICAgICAqICAgJHNjb3BlLmNoYW5nZVN0YXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICogICAgICRzdGF0ZS5nbygnY29udGFjdC5kZXRhaWwnKTtcclxuICAgICAqICAgfTtcclxuICAgICAqIH0pO1xyXG4gICAgICogPC9wcmU+XHJcbiAgICAgKiA8aW1nIHNyYz0nLi4vbmdkb2NfYXNzZXRzL1N0YXRlR29FeGFtcGxlcy5wbmcnLz5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdG8gQWJzb2x1dGUgc3RhdGUgbmFtZSBvciByZWxhdGl2ZSBzdGF0ZSBwYXRoLiBTb21lIGV4YW1wbGVzOlxyXG4gICAgICpcclxuICAgICAqIC0gYCRzdGF0ZS5nbygnY29udGFjdC5kZXRhaWwnKWAgLSB3aWxsIGdvIHRvIHRoZSBgY29udGFjdC5kZXRhaWxgIHN0YXRlXHJcbiAgICAgKiAtIGAkc3RhdGUuZ28oJ14nKWAgLSB3aWxsIGdvIHRvIGEgcGFyZW50IHN0YXRlXHJcbiAgICAgKiAtIGAkc3RhdGUuZ28oJ14uc2libGluZycpYCAtIHdpbGwgZ28gdG8gYSBzaWJsaW5nIHN0YXRlXHJcbiAgICAgKiAtIGAkc3RhdGUuZ28oJy5jaGlsZC5ncmFuZGNoaWxkJylgIC0gd2lsbCBnbyB0byBncmFuZGNoaWxkIHN0YXRlXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHtvYmplY3Q9fSBwYXJhbXMgQSBtYXAgb2YgdGhlIHBhcmFtZXRlcnMgdGhhdCB3aWxsIGJlIHNlbnQgdG8gdGhlIHN0YXRlLCBcclxuICAgICAqIHdpbGwgcG9wdWxhdGUgJHN0YXRlUGFyYW1zLiBBbnkgcGFyYW1ldGVycyB0aGF0IGFyZSBub3Qgc3BlY2lmaWVkIHdpbGwgYmUgaW5oZXJpdGVkIGZyb20gY3VycmVudGx5IFxyXG4gICAgICogZGVmaW5lZCBwYXJhbWV0ZXJzLiBUaGlzIGFsbG93cywgZm9yIGV4YW1wbGUsIGdvaW5nIHRvIGEgc2libGluZyBzdGF0ZSB0aGF0IHNoYXJlcyBwYXJhbWV0ZXJzXHJcbiAgICAgKiBzcGVjaWZpZWQgaW4gYSBwYXJlbnQgc3RhdGUuIFBhcmFtZXRlciBpbmhlcml0YW5jZSBvbmx5IHdvcmtzIGJldHdlZW4gY29tbW9uIGFuY2VzdG9yIHN0YXRlcywgSS5lLlxyXG4gICAgICogdHJhbnNpdGlvbmluZyB0byBhIHNpYmxpbmcgd2lsbCBnZXQgeW91IHRoZSBwYXJhbWV0ZXJzIGZvciBhbGwgcGFyZW50cywgdHJhbnNpdGlvbmluZyB0byBhIGNoaWxkXHJcbiAgICAgKiB3aWxsIGdldCB5b3UgYWxsIGN1cnJlbnQgcGFyYW1ldGVycywgZXRjLlxyXG4gICAgICogQHBhcmFtIHtvYmplY3Q9fSBvcHRpb25zIE9wdGlvbnMgb2JqZWN0LiBUaGUgb3B0aW9ucyBhcmU6XHJcbiAgICAgKlxyXG4gICAgICogLSAqKmBsb2NhdGlvbmAqKiAtIHtib29sZWFuPXRydWV8c3RyaW5nPX0gLSBJZiBgdHJ1ZWAgd2lsbCB1cGRhdGUgdGhlIHVybCBpbiB0aGUgbG9jYXRpb24gYmFyLCBpZiBgZmFsc2VgXHJcbiAgICAgKiAgICB3aWxsIG5vdC4gSWYgc3RyaW5nLCBtdXN0IGJlIGBcInJlcGxhY2VcImAsIHdoaWNoIHdpbGwgdXBkYXRlIHVybCBhbmQgYWxzbyByZXBsYWNlIGxhc3QgaGlzdG9yeSByZWNvcmQuXHJcbiAgICAgKiAtICoqYGluaGVyaXRgKiogLSB7Ym9vbGVhbj10cnVlfSwgSWYgYHRydWVgIHdpbGwgaW5oZXJpdCB1cmwgcGFyYW1ldGVycyBmcm9tIGN1cnJlbnQgdXJsLlxyXG4gICAgICogLSAqKmByZWxhdGl2ZWAqKiAtIHtvYmplY3Q9JHN0YXRlLiRjdXJyZW50fSwgV2hlbiB0cmFuc2l0aW9uaW5nIHdpdGggcmVsYXRpdmUgcGF0aCAoZS5nICdeJyksIFxyXG4gICAgICogICAgZGVmaW5lcyB3aGljaCBzdGF0ZSB0byBiZSByZWxhdGl2ZSBmcm9tLlxyXG4gICAgICogLSAqKmBub3RpZnlgKiogLSB7Ym9vbGVhbj10cnVlfSwgSWYgYHRydWVgIHdpbGwgYnJvYWRjYXN0ICRzdGF0ZUNoYW5nZVN0YXJ0IGFuZCAkc3RhdGVDaGFuZ2VTdWNjZXNzIGV2ZW50cy5cclxuICAgICAqIC0gKipgcmVsb2FkYCoqICh2MC4yLjUpIC0ge2Jvb2xlYW49ZmFsc2V9LCBJZiBgdHJ1ZWAgd2lsbCBmb3JjZSB0cmFuc2l0aW9uIGV2ZW4gaWYgdGhlIHN0YXRlIG9yIHBhcmFtcyBcclxuICAgICAqICAgIGhhdmUgbm90IGNoYW5nZWQsIGFrYSBhIHJlbG9hZCBvZiB0aGUgc2FtZSBzdGF0ZS4gSXQgZGlmZmVycyBmcm9tIHJlbG9hZE9uU2VhcmNoIGJlY2F1c2UgeW91J2RcclxuICAgICAqICAgIHVzZSB0aGlzIHdoZW4geW91IHdhbnQgdG8gZm9yY2UgYSByZWxvYWQgd2hlbiAqZXZlcnl0aGluZyogaXMgdGhlIHNhbWUsIGluY2x1ZGluZyBzZWFyY2ggcGFyYW1zLlxyXG4gICAgICpcclxuICAgICAqIEByZXR1cm5zIHtwcm9taXNlfSBBIHByb21pc2UgcmVwcmVzZW50aW5nIHRoZSBzdGF0ZSBvZiB0aGUgbmV3IHRyYW5zaXRpb24uXHJcbiAgICAgKlxyXG4gICAgICogUG9zc2libGUgc3VjY2VzcyB2YWx1ZXM6XHJcbiAgICAgKlxyXG4gICAgICogLSAkc3RhdGUuY3VycmVudFxyXG4gICAgICpcclxuICAgICAqIDxici8+UG9zc2libGUgcmVqZWN0aW9uIHZhbHVlczpcclxuICAgICAqXHJcbiAgICAgKiAtICd0cmFuc2l0aW9uIHN1cGVyc2VkZWQnIC0gd2hlbiBhIG5ld2VyIHRyYW5zaXRpb24gaGFzIGJlZW4gc3RhcnRlZCBhZnRlciB0aGlzIG9uZVxyXG4gICAgICogLSAndHJhbnNpdGlvbiBwcmV2ZW50ZWQnIC0gd2hlbiBgZXZlbnQucHJldmVudERlZmF1bHQoKWAgaGFzIGJlZW4gY2FsbGVkIGluIGEgYCRzdGF0ZUNoYW5nZVN0YXJ0YCBsaXN0ZW5lclxyXG4gICAgICogLSAndHJhbnNpdGlvbiBhYm9ydGVkJyAtIHdoZW4gYGV2ZW50LnByZXZlbnREZWZhdWx0KClgIGhhcyBiZWVuIGNhbGxlZCBpbiBhIGAkc3RhdGVOb3RGb3VuZGAgbGlzdGVuZXIgb3JcclxuICAgICAqICAgd2hlbiBhIGAkc3RhdGVOb3RGb3VuZGAgYGV2ZW50LnJldHJ5YCBwcm9taXNlIGVycm9ycy5cclxuICAgICAqIC0gJ3RyYW5zaXRpb24gZmFpbGVkJyAtIHdoZW4gYSBzdGF0ZSBoYXMgYmVlbiB1bnN1Y2Nlc3NmdWxseSBmb3VuZCBhZnRlciAyIHRyaWVzLlxyXG4gICAgICogLSAqcmVzb2x2ZSBlcnJvciogLSB3aGVuIGFuIGVycm9yIGhhcyBvY2N1cnJlZCB3aXRoIGEgYHJlc29sdmVgXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICAkc3RhdGUuZ28gPSBmdW5jdGlvbiBnbyh0bywgcGFyYW1zLCBvcHRpb25zKSB7XHJcbiAgICAgIHJldHVybiAkc3RhdGUudHJhbnNpdGlvblRvKHRvLCBwYXJhbXMsIGV4dGVuZCh7IGluaGVyaXQ6IHRydWUsIHJlbGF0aXZlOiAkc3RhdGUuJGN1cnJlbnQgfSwgb3B0aW9ucykpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBuZ2RvYyBmdW5jdGlvblxyXG4gICAgICogQG5hbWUgdWkucm91dGVyLnN0YXRlLiRzdGF0ZSN0cmFuc2l0aW9uVG9cclxuICAgICAqIEBtZXRob2RPZiB1aS5yb3V0ZXIuc3RhdGUuJHN0YXRlXHJcbiAgICAgKlxyXG4gICAgICogQGRlc2NyaXB0aW9uXHJcbiAgICAgKiBMb3ctbGV2ZWwgbWV0aG9kIGZvciB0cmFuc2l0aW9uaW5nIHRvIGEgbmV3IHN0YXRlLiB7QGxpbmsgdWkucm91dGVyLnN0YXRlLiRzdGF0ZSNtZXRob2RzX2dvICRzdGF0ZS5nb31cclxuICAgICAqIHVzZXMgYHRyYW5zaXRpb25Ub2AgaW50ZXJuYWxseS4gYCRzdGF0ZS5nb2AgaXMgcmVjb21tZW5kZWQgaW4gbW9zdCBzaXR1YXRpb25zLlxyXG4gICAgICpcclxuICAgICAqIEBleGFtcGxlXHJcbiAgICAgKiA8cHJlPlxyXG4gICAgICogdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbJ3VpLnJvdXRlciddKTtcclxuICAgICAqXHJcbiAgICAgKiBhcHAuY29udHJvbGxlcignY3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsICRzdGF0ZSkge1xyXG4gICAgICogICAkc2NvcGUuY2hhbmdlU3RhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgKiAgICAgJHN0YXRlLnRyYW5zaXRpb25UbygnY29udGFjdC5kZXRhaWwnKTtcclxuICAgICAqICAgfTtcclxuICAgICAqIH0pO1xyXG4gICAgICogPC9wcmU+XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHRvIFN0YXRlIG5hbWUuXHJcbiAgICAgKiBAcGFyYW0ge29iamVjdD19IHRvUGFyYW1zIEEgbWFwIG9mIHRoZSBwYXJhbWV0ZXJzIHRoYXQgd2lsbCBiZSBzZW50IHRvIHRoZSBzdGF0ZSxcclxuICAgICAqIHdpbGwgcG9wdWxhdGUgJHN0YXRlUGFyYW1zLlxyXG4gICAgICogQHBhcmFtIHtvYmplY3Q9fSBvcHRpb25zIE9wdGlvbnMgb2JqZWN0LiBUaGUgb3B0aW9ucyBhcmU6XHJcbiAgICAgKlxyXG4gICAgICogLSAqKmBsb2NhdGlvbmAqKiAtIHtib29sZWFuPXRydWV8c3RyaW5nPX0gLSBJZiBgdHJ1ZWAgd2lsbCB1cGRhdGUgdGhlIHVybCBpbiB0aGUgbG9jYXRpb24gYmFyLCBpZiBgZmFsc2VgXHJcbiAgICAgKiAgICB3aWxsIG5vdC4gSWYgc3RyaW5nLCBtdXN0IGJlIGBcInJlcGxhY2VcImAsIHdoaWNoIHdpbGwgdXBkYXRlIHVybCBhbmQgYWxzbyByZXBsYWNlIGxhc3QgaGlzdG9yeSByZWNvcmQuXHJcbiAgICAgKiAtICoqYGluaGVyaXRgKiogLSB7Ym9vbGVhbj1mYWxzZX0sIElmIGB0cnVlYCB3aWxsIGluaGVyaXQgdXJsIHBhcmFtZXRlcnMgZnJvbSBjdXJyZW50IHVybC5cclxuICAgICAqIC0gKipgcmVsYXRpdmVgKiogLSB7b2JqZWN0PX0sIFdoZW4gdHJhbnNpdGlvbmluZyB3aXRoIHJlbGF0aXZlIHBhdGggKGUuZyAnXicpLCBcclxuICAgICAqICAgIGRlZmluZXMgd2hpY2ggc3RhdGUgdG8gYmUgcmVsYXRpdmUgZnJvbS5cclxuICAgICAqIC0gKipgbm90aWZ5YCoqIC0ge2Jvb2xlYW49dHJ1ZX0sIElmIGB0cnVlYCB3aWxsIGJyb2FkY2FzdCAkc3RhdGVDaGFuZ2VTdGFydCBhbmQgJHN0YXRlQ2hhbmdlU3VjY2VzcyBldmVudHMuXHJcbiAgICAgKiAtICoqYHJlbG9hZGAqKiAodjAuMi41KSAtIHtib29sZWFuPWZhbHNlfSwgSWYgYHRydWVgIHdpbGwgZm9yY2UgdHJhbnNpdGlvbiBldmVuIGlmIHRoZSBzdGF0ZSBvciBwYXJhbXMgXHJcbiAgICAgKiAgICBoYXZlIG5vdCBjaGFuZ2VkLCBha2EgYSByZWxvYWQgb2YgdGhlIHNhbWUgc3RhdGUuIEl0IGRpZmZlcnMgZnJvbSByZWxvYWRPblNlYXJjaCBiZWNhdXNlIHlvdSdkXHJcbiAgICAgKiAgICB1c2UgdGhpcyB3aGVuIHlvdSB3YW50IHRvIGZvcmNlIGEgcmVsb2FkIHdoZW4gKmV2ZXJ5dGhpbmcqIGlzIHRoZSBzYW1lLCBpbmNsdWRpbmcgc2VhcmNoIHBhcmFtcy5cclxuICAgICAqXHJcbiAgICAgKiBAcmV0dXJucyB7cHJvbWlzZX0gQSBwcm9taXNlIHJlcHJlc2VudGluZyB0aGUgc3RhdGUgb2YgdGhlIG5ldyB0cmFuc2l0aW9uLiBTZWVcclxuICAgICAqIHtAbGluayB1aS5yb3V0ZXIuc3RhdGUuJHN0YXRlI21ldGhvZHNfZ28gJHN0YXRlLmdvfS5cclxuICAgICAqL1xyXG4gICAgJHN0YXRlLnRyYW5zaXRpb25UbyA9IGZ1bmN0aW9uIHRyYW5zaXRpb25Ubyh0bywgdG9QYXJhbXMsIG9wdGlvbnMpIHtcclxuICAgICAgdG9QYXJhbXMgPSB0b1BhcmFtcyB8fCB7fTtcclxuICAgICAgb3B0aW9ucyA9IGV4dGVuZCh7XHJcbiAgICAgICAgbG9jYXRpb246IHRydWUsIGluaGVyaXQ6IGZhbHNlLCByZWxhdGl2ZTogbnVsbCwgbm90aWZ5OiB0cnVlLCByZWxvYWQ6IGZhbHNlLCAkcmV0cnk6IGZhbHNlXHJcbiAgICAgIH0sIG9wdGlvbnMgfHwge30pO1xyXG5cclxuICAgICAgdmFyIGZyb20gPSAkc3RhdGUuJGN1cnJlbnQsIGZyb21QYXJhbXMgPSAkc3RhdGUucGFyYW1zLCBmcm9tUGF0aCA9IGZyb20ucGF0aDtcclxuICAgICAgdmFyIGV2dCwgdG9TdGF0ZSA9IGZpbmRTdGF0ZSh0bywgb3B0aW9ucy5yZWxhdGl2ZSk7XHJcblxyXG4gICAgICBpZiAoIWlzRGVmaW5lZCh0b1N0YXRlKSkge1xyXG4gICAgICAgIHZhciByZWRpcmVjdCA9IHsgdG86IHRvLCB0b1BhcmFtczogdG9QYXJhbXMsIG9wdGlvbnM6IG9wdGlvbnMgfTtcclxuICAgICAgICB2YXIgcmVkaXJlY3RSZXN1bHQgPSBoYW5kbGVSZWRpcmVjdChyZWRpcmVjdCwgZnJvbS5zZWxmLCBmcm9tUGFyYW1zLCBvcHRpb25zKTtcclxuXHJcbiAgICAgICAgaWYgKHJlZGlyZWN0UmVzdWx0KSB7XHJcbiAgICAgICAgICByZXR1cm4gcmVkaXJlY3RSZXN1bHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBBbHdheXMgcmV0cnkgb25jZSBpZiB0aGUgJHN0YXRlTm90Rm91bmQgd2FzIG5vdCBwcmV2ZW50ZWRcclxuICAgICAgICAvLyAoaGFuZGxlcyBlaXRoZXIgcmVkaXJlY3QgY2hhbmdlZCBvciBzdGF0ZSBsYXp5LWRlZmluaXRpb24pXHJcbiAgICAgICAgdG8gPSByZWRpcmVjdC50bztcclxuICAgICAgICB0b1BhcmFtcyA9IHJlZGlyZWN0LnRvUGFyYW1zO1xyXG4gICAgICAgIG9wdGlvbnMgPSByZWRpcmVjdC5vcHRpb25zO1xyXG4gICAgICAgIHRvU3RhdGUgPSBmaW5kU3RhdGUodG8sIG9wdGlvbnMucmVsYXRpdmUpO1xyXG5cclxuICAgICAgICBpZiAoIWlzRGVmaW5lZCh0b1N0YXRlKSkge1xyXG4gICAgICAgICAgaWYgKCFvcHRpb25zLnJlbGF0aXZlKSB0aHJvdyBuZXcgRXJyb3IoXCJObyBzdWNoIHN0YXRlICdcIiArIHRvICsgXCInXCIpO1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ291bGQgbm90IHJlc29sdmUgJ1wiICsgdG8gKyBcIicgZnJvbSBzdGF0ZSAnXCIgKyBvcHRpb25zLnJlbGF0aXZlICsgXCInXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBpZiAodG9TdGF0ZVthYnN0cmFjdEtleV0pIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCB0cmFuc2l0aW9uIHRvIGFic3RyYWN0IHN0YXRlICdcIiArIHRvICsgXCInXCIpO1xyXG4gICAgICBpZiAob3B0aW9ucy5pbmhlcml0KSB0b1BhcmFtcyA9IGluaGVyaXRQYXJhbXMoJHN0YXRlUGFyYW1zLCB0b1BhcmFtcyB8fCB7fSwgJHN0YXRlLiRjdXJyZW50LCB0b1N0YXRlKTtcclxuICAgICAgaWYgKCF0b1N0YXRlLnBhcmFtcy4kJHZhbGlkYXRlcyh0b1BhcmFtcykpIHJldHVybiBUcmFuc2l0aW9uRmFpbGVkO1xyXG5cclxuICAgICAgdG9QYXJhbXMgPSB0b1N0YXRlLnBhcmFtcy4kJHZhbHVlcyh0b1BhcmFtcyk7XHJcbiAgICAgIHRvID0gdG9TdGF0ZTtcclxuXHJcbiAgICAgIHZhciB0b1BhdGggPSB0by5wYXRoO1xyXG5cclxuICAgICAgLy8gU3RhcnRpbmcgZnJvbSB0aGUgcm9vdCBvZiB0aGUgcGF0aCwga2VlcCBhbGwgbGV2ZWxzIHRoYXQgaGF2ZW4ndCBjaGFuZ2VkXHJcbiAgICAgIHZhciBrZWVwID0gMCwgc3RhdGUgPSB0b1BhdGhba2VlcF0sIGxvY2FscyA9IHJvb3QubG9jYWxzLCB0b0xvY2FscyA9IFtdO1xyXG5cclxuICAgICAgaWYgKCFvcHRpb25zLnJlbG9hZCkge1xyXG4gICAgICAgIHdoaWxlIChzdGF0ZSAmJiBzdGF0ZSA9PT0gZnJvbVBhdGhba2VlcF0gJiYgc3RhdGUub3duUGFyYW1zLiQkZXF1YWxzKHRvUGFyYW1zLCBmcm9tUGFyYW1zKSkge1xyXG4gICAgICAgICAgbG9jYWxzID0gdG9Mb2NhbHNba2VlcF0gPSBzdGF0ZS5sb2NhbHM7XHJcbiAgICAgICAgICBrZWVwKys7XHJcbiAgICAgICAgICBzdGF0ZSA9IHRvUGF0aFtrZWVwXTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIElmIHdlJ3JlIGdvaW5nIHRvIHRoZSBzYW1lIHN0YXRlIGFuZCBhbGwgbG9jYWxzIGFyZSBrZXB0LCB3ZSd2ZSBnb3Qgbm90aGluZyB0byBkby5cclxuICAgICAgLy8gQnV0IGNsZWFyICd0cmFuc2l0aW9uJywgYXMgd2Ugc3RpbGwgd2FudCB0byBjYW5jZWwgYW55IG90aGVyIHBlbmRpbmcgdHJhbnNpdGlvbnMuXHJcbiAgICAgIC8vIFRPRE86IFdlIG1heSBub3Qgd2FudCB0byBidW1wICd0cmFuc2l0aW9uJyBpZiB3ZSdyZSBjYWxsZWQgZnJvbSBhIGxvY2F0aW9uIGNoYW5nZVxyXG4gICAgICAvLyB0aGF0IHdlJ3ZlIGluaXRpYXRlZCBvdXJzZWx2ZXMsIGJlY2F1c2Ugd2UgbWlnaHQgYWNjaWRlbnRhbGx5IGFib3J0IGEgbGVnaXRpbWF0ZVxyXG4gICAgICAvLyB0cmFuc2l0aW9uIGluaXRpYXRlZCBmcm9tIGNvZGU/XHJcbiAgICAgIGlmIChzaG91bGRUcmlnZ2VyUmVsb2FkKHRvLCBmcm9tLCBsb2NhbHMsIG9wdGlvbnMpKSB7XHJcbiAgICAgICAgaWYgKHRvLnNlbGYucmVsb2FkT25TZWFyY2ggIT09IGZhbHNlKSAkdXJsUm91dGVyLnVwZGF0ZSgpO1xyXG4gICAgICAgICRzdGF0ZS50cmFuc2l0aW9uID0gbnVsbDtcclxuICAgICAgICByZXR1cm4gJHEud2hlbigkc3RhdGUuY3VycmVudCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEZpbHRlciBwYXJhbWV0ZXJzIGJlZm9yZSB3ZSBwYXNzIHRoZW0gdG8gZXZlbnQgaGFuZGxlcnMgZXRjLlxyXG4gICAgICB0b1BhcmFtcyA9IGZpbHRlckJ5S2V5cyh0by5wYXJhbXMuJCRrZXlzKCksIHRvUGFyYW1zIHx8IHt9KTtcclxuXHJcbiAgICAgIC8vIEJyb2FkY2FzdCBzdGFydCBldmVudCBhbmQgY2FuY2VsIHRoZSB0cmFuc2l0aW9uIGlmIHJlcXVlc3RlZFxyXG4gICAgICBpZiAob3B0aW9ucy5ub3RpZnkpIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBAbmdkb2MgZXZlbnRcclxuICAgICAgICAgKiBAbmFtZSB1aS5yb3V0ZXIuc3RhdGUuJHN0YXRlIyRzdGF0ZUNoYW5nZVN0YXJ0XHJcbiAgICAgICAgICogQGV2ZW50T2YgdWkucm91dGVyLnN0YXRlLiRzdGF0ZVxyXG4gICAgICAgICAqIEBldmVudFR5cGUgYnJvYWRjYXN0IG9uIHJvb3Qgc2NvcGVcclxuICAgICAgICAgKiBAZGVzY3JpcHRpb25cclxuICAgICAgICAgKiBGaXJlZCB3aGVuIHRoZSBzdGF0ZSB0cmFuc2l0aW9uICoqYmVnaW5zKiouIFlvdSBjYW4gdXNlIGBldmVudC5wcmV2ZW50RGVmYXVsdCgpYFxyXG4gICAgICAgICAqIHRvIHByZXZlbnQgdGhlIHRyYW5zaXRpb24gZnJvbSBoYXBwZW5pbmcgYW5kIHRoZW4gdGhlIHRyYW5zaXRpb24gcHJvbWlzZSB3aWxsIGJlXHJcbiAgICAgICAgICogcmVqZWN0ZWQgd2l0aCBhIGAndHJhbnNpdGlvbiBwcmV2ZW50ZWQnYCB2YWx1ZS5cclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBFdmVudCBvYmplY3QuXHJcbiAgICAgICAgICogQHBhcmFtIHtTdGF0ZX0gdG9TdGF0ZSBUaGUgc3RhdGUgYmVpbmcgdHJhbnNpdGlvbmVkIHRvLlxyXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSB0b1BhcmFtcyBUaGUgcGFyYW1zIHN1cHBsaWVkIHRvIHRoZSBgdG9TdGF0ZWAuXHJcbiAgICAgICAgICogQHBhcmFtIHtTdGF0ZX0gZnJvbVN0YXRlIFRoZSBjdXJyZW50IHN0YXRlLCBwcmUtdHJhbnNpdGlvbi5cclxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZnJvbVBhcmFtcyBUaGUgcGFyYW1zIHN1cHBsaWVkIHRvIHRoZSBgZnJvbVN0YXRlYC5cclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBleGFtcGxlXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiA8cHJlPlxyXG4gICAgICAgICAqICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VTdGFydCcsXHJcbiAgICAgICAgICogZnVuY3Rpb24oZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMpe1xyXG4gICAgICAgICAqICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAqICAgICAvLyB0cmFuc2l0aW9uVG8oKSBwcm9taXNlIHdpbGwgYmUgcmVqZWN0ZWQgd2l0aFxyXG4gICAgICAgICAqICAgICAvLyBhICd0cmFuc2l0aW9uIHByZXZlbnRlZCcgZXJyb3JcclxuICAgICAgICAgKiB9KVxyXG4gICAgICAgICAqIDwvcHJlPlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGlmICgkcm9vdFNjb3BlLiRicm9hZGNhc3QoJyRzdGF0ZUNoYW5nZVN0YXJ0JywgdG8uc2VsZiwgdG9QYXJhbXMsIGZyb20uc2VsZiwgZnJvbVBhcmFtcykuZGVmYXVsdFByZXZlbnRlZCkge1xyXG4gICAgICAgICAgJHVybFJvdXRlci51cGRhdGUoKTtcclxuICAgICAgICAgIHJldHVybiBUcmFuc2l0aW9uUHJldmVudGVkO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gUmVzb2x2ZSBsb2NhbHMgZm9yIHRoZSByZW1haW5pbmcgc3RhdGVzLCBidXQgZG9uJ3QgdXBkYXRlIGFueSBnbG9iYWwgc3RhdGUganVzdFxyXG4gICAgICAvLyB5ZXQgLS0gaWYgYW55dGhpbmcgZmFpbHMgdG8gcmVzb2x2ZSB0aGUgY3VycmVudCBzdGF0ZSBuZWVkcyB0byByZW1haW4gdW50b3VjaGVkLlxyXG4gICAgICAvLyBXZSBhbHNvIHNldCB1cCBhbiBpbmhlcml0YW5jZSBjaGFpbiBmb3IgdGhlIGxvY2FscyBoZXJlLiBUaGlzIGFsbG93cyB0aGUgdmlldyBkaXJlY3RpdmVcclxuICAgICAgLy8gdG8gcXVpY2tseSBsb29rIHVwIHRoZSBjb3JyZWN0IGRlZmluaXRpb24gZm9yIGVhY2ggdmlldyBpbiB0aGUgY3VycmVudCBzdGF0ZS4gRXZlblxyXG4gICAgICAvLyB0aG91Z2ggd2UgY3JlYXRlIHRoZSBsb2NhbHMgb2JqZWN0IGl0c2VsZiBvdXRzaWRlIHJlc29sdmVTdGF0ZSgpLCBpdCBpcyBpbml0aWFsbHlcclxuICAgICAgLy8gZW1wdHkgYW5kIGdldHMgZmlsbGVkIGFzeW5jaHJvbm91c2x5LiBXZSBuZWVkIHRvIGtlZXAgdHJhY2sgb2YgdGhlIHByb21pc2UgZm9yIHRoZVxyXG4gICAgICAvLyAoZnVsbHkgcmVzb2x2ZWQpIGN1cnJlbnQgbG9jYWxzLCBhbmQgcGFzcyB0aGlzIGRvd24gdGhlIGNoYWluLlxyXG4gICAgICB2YXIgcmVzb2x2ZWQgPSAkcS53aGVuKGxvY2Fscyk7XHJcblxyXG4gICAgICBmb3IgKHZhciBsID0ga2VlcDsgbCA8IHRvUGF0aC5sZW5ndGg7IGwrKywgc3RhdGUgPSB0b1BhdGhbbF0pIHtcclxuICAgICAgICBsb2NhbHMgPSB0b0xvY2Fsc1tsXSA9IGluaGVyaXQobG9jYWxzKTtcclxuICAgICAgICByZXNvbHZlZCA9IHJlc29sdmVTdGF0ZShzdGF0ZSwgdG9QYXJhbXMsIHN0YXRlID09PSB0bywgcmVzb2x2ZWQsIGxvY2Fscywgb3B0aW9ucyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIE9uY2UgZXZlcnl0aGluZyBpcyByZXNvbHZlZCwgd2UgYXJlIHJlYWR5IHRvIHBlcmZvcm0gdGhlIGFjdHVhbCB0cmFuc2l0aW9uXHJcbiAgICAgIC8vIGFuZCByZXR1cm4gYSBwcm9taXNlIGZvciB0aGUgbmV3IHN0YXRlLiBXZSBhbHNvIGtlZXAgdHJhY2sgb2Ygd2hhdCB0aGVcclxuICAgICAgLy8gY3VycmVudCBwcm9taXNlIGlzLCBzbyB0aGF0IHdlIGNhbiBkZXRlY3Qgb3ZlcmxhcHBpbmcgdHJhbnNpdGlvbnMgYW5kXHJcbiAgICAgIC8vIGtlZXAgb25seSB0aGUgb3V0Y29tZSBvZiB0aGUgbGFzdCB0cmFuc2l0aW9uLlxyXG4gICAgICB2YXIgdHJhbnNpdGlvbiA9ICRzdGF0ZS50cmFuc2l0aW9uID0gcmVzb2x2ZWQudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGwsIGVudGVyaW5nLCBleGl0aW5nO1xyXG5cclxuICAgICAgICBpZiAoJHN0YXRlLnRyYW5zaXRpb24gIT09IHRyYW5zaXRpb24pIHJldHVybiBUcmFuc2l0aW9uU3VwZXJzZWRlZDtcclxuXHJcbiAgICAgICAgLy8gRXhpdCAnZnJvbScgc3RhdGVzIG5vdCBrZXB0XHJcbiAgICAgICAgZm9yIChsID0gZnJvbVBhdGgubGVuZ3RoIC0gMTsgbCA+PSBrZWVwOyBsLS0pIHtcclxuICAgICAgICAgIGV4aXRpbmcgPSBmcm9tUGF0aFtsXTtcclxuICAgICAgICAgIGlmIChleGl0aW5nLnNlbGYub25FeGl0KSB7XHJcbiAgICAgICAgICAgICRpbmplY3Rvci5pbnZva2UoZXhpdGluZy5zZWxmLm9uRXhpdCwgZXhpdGluZy5zZWxmLCBleGl0aW5nLmxvY2Fscy5nbG9iYWxzKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGV4aXRpbmcubG9jYWxzID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEVudGVyICd0bycgc3RhdGVzIG5vdCBrZXB0XHJcbiAgICAgICAgZm9yIChsID0ga2VlcDsgbCA8IHRvUGF0aC5sZW5ndGg7IGwrKykge1xyXG4gICAgICAgICAgZW50ZXJpbmcgPSB0b1BhdGhbbF07XHJcbiAgICAgICAgICBlbnRlcmluZy5sb2NhbHMgPSB0b0xvY2Fsc1tsXTtcclxuICAgICAgICAgIGlmIChlbnRlcmluZy5zZWxmLm9uRW50ZXIpIHtcclxuICAgICAgICAgICAgJGluamVjdG9yLmludm9rZShlbnRlcmluZy5zZWxmLm9uRW50ZXIsIGVudGVyaW5nLnNlbGYsIGVudGVyaW5nLmxvY2Fscy5nbG9iYWxzKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJ1biBpdCBhZ2FpbiwgdG8gY2F0Y2ggYW55IHRyYW5zaXRpb25zIGluIGNhbGxiYWNrc1xyXG4gICAgICAgIGlmICgkc3RhdGUudHJhbnNpdGlvbiAhPT0gdHJhbnNpdGlvbikgcmV0dXJuIFRyYW5zaXRpb25TdXBlcnNlZGVkO1xyXG5cclxuICAgICAgICAvLyBVcGRhdGUgZ2xvYmFscyBpbiAkc3RhdGVcclxuICAgICAgICAkc3RhdGUuJGN1cnJlbnQgPSB0bztcclxuICAgICAgICAkc3RhdGUuY3VycmVudCA9IHRvLnNlbGY7XHJcbiAgICAgICAgJHN0YXRlLnBhcmFtcyA9IHRvUGFyYW1zO1xyXG4gICAgICAgIGNvcHkoJHN0YXRlLnBhcmFtcywgJHN0YXRlUGFyYW1zKTtcclxuICAgICAgICAkc3RhdGUudHJhbnNpdGlvbiA9IG51bGw7XHJcblxyXG4gICAgICAgIGlmIChvcHRpb25zLmxvY2F0aW9uICYmIHRvLm5hdmlnYWJsZSkge1xyXG4gICAgICAgICAgJHVybFJvdXRlci5wdXNoKHRvLm5hdmlnYWJsZS51cmwsIHRvLm5hdmlnYWJsZS5sb2NhbHMuZ2xvYmFscy4kc3RhdGVQYXJhbXMsIHtcclxuICAgICAgICAgICAgJCRhdm9pZFJlc3luYzogdHJ1ZSwgcmVwbGFjZTogb3B0aW9ucy5sb2NhdGlvbiA9PT0gJ3JlcGxhY2UnXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChvcHRpb25zLm5vdGlmeSkge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEBuZ2RvYyBldmVudFxyXG4gICAgICAgICAqIEBuYW1lIHVpLnJvdXRlci5zdGF0ZS4kc3RhdGUjJHN0YXRlQ2hhbmdlU3VjY2Vzc1xyXG4gICAgICAgICAqIEBldmVudE9mIHVpLnJvdXRlci5zdGF0ZS4kc3RhdGVcclxuICAgICAgICAgKiBAZXZlbnRUeXBlIGJyb2FkY2FzdCBvbiByb290IHNjb3BlXHJcbiAgICAgICAgICogQGRlc2NyaXB0aW9uXHJcbiAgICAgICAgICogRmlyZWQgb25jZSB0aGUgc3RhdGUgdHJhbnNpdGlvbiBpcyAqKmNvbXBsZXRlKiouXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgRXZlbnQgb2JqZWN0LlxyXG4gICAgICAgICAqIEBwYXJhbSB7U3RhdGV9IHRvU3RhdGUgVGhlIHN0YXRlIGJlaW5nIHRyYW5zaXRpb25lZCB0by5cclxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gdG9QYXJhbXMgVGhlIHBhcmFtcyBzdXBwbGllZCB0byB0aGUgYHRvU3RhdGVgLlxyXG4gICAgICAgICAqIEBwYXJhbSB7U3RhdGV9IGZyb21TdGF0ZSBUaGUgY3VycmVudCBzdGF0ZSwgcHJlLXRyYW5zaXRpb24uXHJcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGZyb21QYXJhbXMgVGhlIHBhcmFtcyBzdXBwbGllZCB0byB0aGUgYGZyb21TdGF0ZWAuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJyRzdGF0ZUNoYW5nZVN1Y2Nlc3MnLCB0by5zZWxmLCB0b1BhcmFtcywgZnJvbS5zZWxmLCBmcm9tUGFyYW1zKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgJHVybFJvdXRlci51cGRhdGUodHJ1ZSk7XHJcblxyXG4gICAgICAgIHJldHVybiAkc3RhdGUuY3VycmVudDtcclxuICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgaWYgKCRzdGF0ZS50cmFuc2l0aW9uICE9PSB0cmFuc2l0aW9uKSByZXR1cm4gVHJhbnNpdGlvblN1cGVyc2VkZWQ7XHJcblxyXG4gICAgICAgICRzdGF0ZS50cmFuc2l0aW9uID0gbnVsbDtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBAbmdkb2MgZXZlbnRcclxuICAgICAgICAgKiBAbmFtZSB1aS5yb3V0ZXIuc3RhdGUuJHN0YXRlIyRzdGF0ZUNoYW5nZUVycm9yXHJcbiAgICAgICAgICogQGV2ZW50T2YgdWkucm91dGVyLnN0YXRlLiRzdGF0ZVxyXG4gICAgICAgICAqIEBldmVudFR5cGUgYnJvYWRjYXN0IG9uIHJvb3Qgc2NvcGVcclxuICAgICAgICAgKiBAZGVzY3JpcHRpb25cclxuICAgICAgICAgKiBGaXJlZCB3aGVuIGFuICoqZXJyb3Igb2NjdXJzKiogZHVyaW5nIHRyYW5zaXRpb24uIEl0J3MgaW1wb3J0YW50IHRvIG5vdGUgdGhhdCBpZiB5b3VcclxuICAgICAgICAgKiBoYXZlIGFueSBlcnJvcnMgaW4geW91ciByZXNvbHZlIGZ1bmN0aW9ucyAoamF2YXNjcmlwdCBlcnJvcnMsIG5vbi1leGlzdGVudCBzZXJ2aWNlcywgZXRjKVxyXG4gICAgICAgICAqIHRoZXkgd2lsbCBub3QgdGhyb3cgdHJhZGl0aW9uYWxseS4gWW91IG11c3QgbGlzdGVuIGZvciB0aGlzICRzdGF0ZUNoYW5nZUVycm9yIGV2ZW50IHRvXHJcbiAgICAgICAgICogY2F0Y2ggKipBTEwqKiBlcnJvcnMuXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgRXZlbnQgb2JqZWN0LlxyXG4gICAgICAgICAqIEBwYXJhbSB7U3RhdGV9IHRvU3RhdGUgVGhlIHN0YXRlIGJlaW5nIHRyYW5zaXRpb25lZCB0by5cclxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gdG9QYXJhbXMgVGhlIHBhcmFtcyBzdXBwbGllZCB0byB0aGUgYHRvU3RhdGVgLlxyXG4gICAgICAgICAqIEBwYXJhbSB7U3RhdGV9IGZyb21TdGF0ZSBUaGUgY3VycmVudCBzdGF0ZSwgcHJlLXRyYW5zaXRpb24uXHJcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGZyb21QYXJhbXMgVGhlIHBhcmFtcyBzdXBwbGllZCB0byB0aGUgYGZyb21TdGF0ZWAuXHJcbiAgICAgICAgICogQHBhcmFtIHtFcnJvcn0gZXJyb3IgVGhlIHJlc29sdmUgZXJyb3Igb2JqZWN0LlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGV2dCA9ICRyb290U2NvcGUuJGJyb2FkY2FzdCgnJHN0YXRlQ2hhbmdlRXJyb3InLCB0by5zZWxmLCB0b1BhcmFtcywgZnJvbS5zZWxmLCBmcm9tUGFyYW1zLCBlcnJvcik7XHJcblxyXG4gICAgICAgIGlmICghZXZ0LmRlZmF1bHRQcmV2ZW50ZWQpIHtcclxuICAgICAgICAgICAgJHVybFJvdXRlci51cGRhdGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiAkcS5yZWplY3QoZXJyb3IpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJldHVybiB0cmFuc2l0aW9uO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBuZ2RvYyBmdW5jdGlvblxyXG4gICAgICogQG5hbWUgdWkucm91dGVyLnN0YXRlLiRzdGF0ZSNpc1xyXG4gICAgICogQG1ldGhvZE9mIHVpLnJvdXRlci5zdGF0ZS4kc3RhdGVcclxuICAgICAqXHJcbiAgICAgKiBAZGVzY3JpcHRpb25cclxuICAgICAqIFNpbWlsYXIgdG8ge0BsaW5rIHVpLnJvdXRlci5zdGF0ZS4kc3RhdGUjbWV0aG9kc19pbmNsdWRlcyAkc3RhdGUuaW5jbHVkZXN9LFxyXG4gICAgICogYnV0IG9ubHkgY2hlY2tzIGZvciB0aGUgZnVsbCBzdGF0ZSBuYW1lLiBJZiBwYXJhbXMgaXMgc3VwcGxpZWQgdGhlbiBpdCB3aWxsIGJlXHJcbiAgICAgKiB0ZXN0ZWQgZm9yIHN0cmljdCBlcXVhbGl0eSBhZ2FpbnN0IHRoZSBjdXJyZW50IGFjdGl2ZSBwYXJhbXMgb2JqZWN0LCBzbyBhbGwgcGFyYW1zXHJcbiAgICAgKiBtdXN0IG1hdGNoIHdpdGggbm9uZSBtaXNzaW5nIGFuZCBubyBleHRyYXMuXHJcbiAgICAgKlxyXG4gICAgICogQGV4YW1wbGVcclxuICAgICAqIDxwcmU+XHJcbiAgICAgKiAkc3RhdGUuJGN1cnJlbnQubmFtZSA9ICdjb250YWN0cy5kZXRhaWxzLml0ZW0nO1xyXG4gICAgICpcclxuICAgICAqIC8vIGFic29sdXRlIG5hbWVcclxuICAgICAqICRzdGF0ZS5pcygnY29udGFjdC5kZXRhaWxzLml0ZW0nKTsgLy8gcmV0dXJucyB0cnVlXHJcbiAgICAgKiAkc3RhdGUuaXMoY29udGFjdERldGFpbEl0ZW1TdGF0ZU9iamVjdCk7IC8vIHJldHVybnMgdHJ1ZVxyXG4gICAgICpcclxuICAgICAqIC8vIHJlbGF0aXZlIG5hbWUgKC4gYW5kIF4pLCB0eXBpY2FsbHkgZnJvbSBhIHRlbXBsYXRlXHJcbiAgICAgKiAvLyBFLmcuIGZyb20gdGhlICdjb250YWN0cy5kZXRhaWxzJyB0ZW1wbGF0ZVxyXG4gICAgICogPGRpdiBuZy1jbGFzcz1cIntoaWdobGlnaHRlZDogJHN0YXRlLmlzKCcuaXRlbScpfVwiPkl0ZW08L2Rpdj5cclxuICAgICAqIDwvcHJlPlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfG9iamVjdH0gc3RhdGVPck5hbWUgVGhlIHN0YXRlIG5hbWUgKGFic29sdXRlIG9yIHJlbGF0aXZlKSBvciBzdGF0ZSBvYmplY3QgeW91J2QgbGlrZSB0byBjaGVjay5cclxuICAgICAqIEBwYXJhbSB7b2JqZWN0PX0gcGFyYW1zIEEgcGFyYW0gb2JqZWN0LCBlLmcuIGB7c2VjdGlvbklkOiBzZWN0aW9uLmlkfWAsIHRoYXQgeW91J2QgbGlrZVxyXG4gICAgICogdG8gdGVzdCBhZ2FpbnN0IHRoZSBjdXJyZW50IGFjdGl2ZSBzdGF0ZS5cclxuICAgICAqIEBwYXJhbSB7b2JqZWN0PX0gb3B0aW9ucyBBbiBvcHRpb25zIG9iamVjdC4gIFRoZSBvcHRpb25zIGFyZTpcclxuICAgICAqXHJcbiAgICAgKiAtICoqYHJlbGF0aXZlYCoqIC0ge3N0cmluZ3xvYmplY3R9IC0gIElmIGBzdGF0ZU9yTmFtZWAgaXMgYSByZWxhdGl2ZSBzdGF0ZSBuYW1lIGFuZCBgb3B0aW9ucy5yZWxhdGl2ZWAgaXMgc2V0LCAuaXMgd2lsbFxyXG4gICAgICogdGVzdCByZWxhdGl2ZSB0byBgb3B0aW9ucy5yZWxhdGl2ZWAgc3RhdGUgKG9yIG5hbWUpLlxyXG4gICAgICpcclxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIHRydWUgaWYgaXQgaXMgdGhlIHN0YXRlLlxyXG4gICAgICovXHJcbiAgICAkc3RhdGUuaXMgPSBmdW5jdGlvbiBpcyhzdGF0ZU9yTmFtZSwgcGFyYW1zLCBvcHRpb25zKSB7XHJcbiAgICAgIG9wdGlvbnMgPSBleHRlbmQoeyByZWxhdGl2ZTogJHN0YXRlLiRjdXJyZW50IH0sIG9wdGlvbnMgfHwge30pO1xyXG4gICAgICB2YXIgc3RhdGUgPSBmaW5kU3RhdGUoc3RhdGVPck5hbWUsIG9wdGlvbnMucmVsYXRpdmUpO1xyXG5cclxuICAgICAgaWYgKCFpc0RlZmluZWQoc3RhdGUpKSB7IHJldHVybiB1bmRlZmluZWQ7IH1cclxuICAgICAgaWYgKCRzdGF0ZS4kY3VycmVudCAhPT0gc3RhdGUpIHsgcmV0dXJuIGZhbHNlOyB9XHJcbiAgICAgIHJldHVybiBwYXJhbXMgPyBlcXVhbEZvcktleXMoc3RhdGUucGFyYW1zLiQkdmFsdWVzKHBhcmFtcyksICRzdGF0ZVBhcmFtcykgOiB0cnVlO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBuZ2RvYyBmdW5jdGlvblxyXG4gICAgICogQG5hbWUgdWkucm91dGVyLnN0YXRlLiRzdGF0ZSNpbmNsdWRlc1xyXG4gICAgICogQG1ldGhvZE9mIHVpLnJvdXRlci5zdGF0ZS4kc3RhdGVcclxuICAgICAqXHJcbiAgICAgKiBAZGVzY3JpcHRpb25cclxuICAgICAqIEEgbWV0aG9kIHRvIGRldGVybWluZSBpZiB0aGUgY3VycmVudCBhY3RpdmUgc3RhdGUgaXMgZXF1YWwgdG8gb3IgaXMgdGhlIGNoaWxkIG9mIHRoZVxyXG4gICAgICogc3RhdGUgc3RhdGVOYW1lLiBJZiBhbnkgcGFyYW1zIGFyZSBwYXNzZWQgdGhlbiB0aGV5IHdpbGwgYmUgdGVzdGVkIGZvciBhIG1hdGNoIGFzIHdlbGwuXHJcbiAgICAgKiBOb3QgYWxsIHRoZSBwYXJhbWV0ZXJzIG5lZWQgdG8gYmUgcGFzc2VkLCBqdXN0IHRoZSBvbmVzIHlvdSdkIGxpa2UgdG8gdGVzdCBmb3IgZXF1YWxpdHkuXHJcbiAgICAgKlxyXG4gICAgICogQGV4YW1wbGVcclxuICAgICAqIFBhcnRpYWwgYW5kIHJlbGF0aXZlIG5hbWVzXHJcbiAgICAgKiA8cHJlPlxyXG4gICAgICogJHN0YXRlLiRjdXJyZW50Lm5hbWUgPSAnY29udGFjdHMuZGV0YWlscy5pdGVtJztcclxuICAgICAqXHJcbiAgICAgKiAvLyBVc2luZyBwYXJ0aWFsIG5hbWVzXHJcbiAgICAgKiAkc3RhdGUuaW5jbHVkZXMoXCJjb250YWN0c1wiKTsgLy8gcmV0dXJucyB0cnVlXHJcbiAgICAgKiAkc3RhdGUuaW5jbHVkZXMoXCJjb250YWN0cy5kZXRhaWxzXCIpOyAvLyByZXR1cm5zIHRydWVcclxuICAgICAqICRzdGF0ZS5pbmNsdWRlcyhcImNvbnRhY3RzLmRldGFpbHMuaXRlbVwiKTsgLy8gcmV0dXJucyB0cnVlXHJcbiAgICAgKiAkc3RhdGUuaW5jbHVkZXMoXCJjb250YWN0cy5saXN0XCIpOyAvLyByZXR1cm5zIGZhbHNlXHJcbiAgICAgKiAkc3RhdGUuaW5jbHVkZXMoXCJhYm91dFwiKTsgLy8gcmV0dXJucyBmYWxzZVxyXG4gICAgICpcclxuICAgICAqIC8vIFVzaW5nIHJlbGF0aXZlIG5hbWVzICguIGFuZCBeKSwgdHlwaWNhbGx5IGZyb20gYSB0ZW1wbGF0ZVxyXG4gICAgICogLy8gRS5nLiBmcm9tIHRoZSAnY29udGFjdHMuZGV0YWlscycgdGVtcGxhdGVcclxuICAgICAqIDxkaXYgbmctY2xhc3M9XCJ7aGlnaGxpZ2h0ZWQ6ICRzdGF0ZS5pbmNsdWRlcygnLml0ZW0nKX1cIj5JdGVtPC9kaXY+XHJcbiAgICAgKiA8L3ByZT5cclxuICAgICAqXHJcbiAgICAgKiBCYXNpYyBnbG9iYmluZyBwYXR0ZXJuc1xyXG4gICAgICogPHByZT5cclxuICAgICAqICRzdGF0ZS4kY3VycmVudC5uYW1lID0gJ2NvbnRhY3RzLmRldGFpbHMuaXRlbS51cmwnO1xyXG4gICAgICpcclxuICAgICAqICRzdGF0ZS5pbmNsdWRlcyhcIiouZGV0YWlscy4qLipcIik7IC8vIHJldHVybnMgdHJ1ZVxyXG4gICAgICogJHN0YXRlLmluY2x1ZGVzKFwiKi5kZXRhaWxzLioqXCIpOyAvLyByZXR1cm5zIHRydWVcclxuICAgICAqICRzdGF0ZS5pbmNsdWRlcyhcIioqLml0ZW0uKipcIik7IC8vIHJldHVybnMgdHJ1ZVxyXG4gICAgICogJHN0YXRlLmluY2x1ZGVzKFwiKi5kZXRhaWxzLml0ZW0udXJsXCIpOyAvLyByZXR1cm5zIHRydWVcclxuICAgICAqICRzdGF0ZS5pbmNsdWRlcyhcIiouZGV0YWlscy4qLnVybFwiKTsgLy8gcmV0dXJucyB0cnVlXHJcbiAgICAgKiAkc3RhdGUuaW5jbHVkZXMoXCIqLmRldGFpbHMuKlwiKTsgLy8gcmV0dXJucyBmYWxzZVxyXG4gICAgICogJHN0YXRlLmluY2x1ZGVzKFwiaXRlbS4qKlwiKTsgLy8gcmV0dXJucyBmYWxzZVxyXG4gICAgICogPC9wcmU+XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHN0YXRlT3JOYW1lIEEgcGFydGlhbCBuYW1lLCByZWxhdGl2ZSBuYW1lLCBvciBnbG9iIHBhdHRlcm5cclxuICAgICAqIHRvIGJlIHNlYXJjaGVkIGZvciB3aXRoaW4gdGhlIGN1cnJlbnQgc3RhdGUgbmFtZS5cclxuICAgICAqIEBwYXJhbSB7b2JqZWN0PX0gcGFyYW1zIEEgcGFyYW0gb2JqZWN0LCBlLmcuIGB7c2VjdGlvbklkOiBzZWN0aW9uLmlkfWAsXHJcbiAgICAgKiB0aGF0IHlvdSdkIGxpa2UgdG8gdGVzdCBhZ2FpbnN0IHRoZSBjdXJyZW50IGFjdGl2ZSBzdGF0ZS5cclxuICAgICAqIEBwYXJhbSB7b2JqZWN0PX0gb3B0aW9ucyBBbiBvcHRpb25zIG9iamVjdC4gIFRoZSBvcHRpb25zIGFyZTpcclxuICAgICAqXHJcbiAgICAgKiAtICoqYHJlbGF0aXZlYCoqIC0ge3N0cmluZ3xvYmplY3Q9fSAtICBJZiBgc3RhdGVPck5hbWVgIGlzIGEgcmVsYXRpdmUgc3RhdGUgcmVmZXJlbmNlIGFuZCBgb3B0aW9ucy5yZWxhdGl2ZWAgaXMgc2V0LFxyXG4gICAgICogLmluY2x1ZGVzIHdpbGwgdGVzdCByZWxhdGl2ZSB0byBgb3B0aW9ucy5yZWxhdGl2ZWAgc3RhdGUgKG9yIG5hbWUpLlxyXG4gICAgICpcclxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIHRydWUgaWYgaXQgZG9lcyBpbmNsdWRlIHRoZSBzdGF0ZVxyXG4gICAgICovXHJcbiAgICAkc3RhdGUuaW5jbHVkZXMgPSBmdW5jdGlvbiBpbmNsdWRlcyhzdGF0ZU9yTmFtZSwgcGFyYW1zLCBvcHRpb25zKSB7XHJcbiAgICAgIG9wdGlvbnMgPSBleHRlbmQoeyByZWxhdGl2ZTogJHN0YXRlLiRjdXJyZW50IH0sIG9wdGlvbnMgfHwge30pO1xyXG4gICAgICBpZiAoaXNTdHJpbmcoc3RhdGVPck5hbWUpICYmIGlzR2xvYihzdGF0ZU9yTmFtZSkpIHtcclxuICAgICAgICBpZiAoIWRvZXNTdGF0ZU1hdGNoR2xvYihzdGF0ZU9yTmFtZSkpIHtcclxuICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc3RhdGVPck5hbWUgPSAkc3RhdGUuJGN1cnJlbnQubmFtZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdmFyIHN0YXRlID0gZmluZFN0YXRlKHN0YXRlT3JOYW1lLCBvcHRpb25zLnJlbGF0aXZlKTtcclxuICAgICAgaWYgKCFpc0RlZmluZWQoc3RhdGUpKSB7IHJldHVybiB1bmRlZmluZWQ7IH1cclxuICAgICAgaWYgKCFpc0RlZmluZWQoJHN0YXRlLiRjdXJyZW50LmluY2x1ZGVzW3N0YXRlLm5hbWVdKSkgeyByZXR1cm4gZmFsc2U7IH1cclxuICAgICAgcmV0dXJuIHBhcmFtcyA/IGVxdWFsRm9yS2V5cyhzdGF0ZS5wYXJhbXMuJCR2YWx1ZXMocGFyYW1zKSwgJHN0YXRlUGFyYW1zLCBvYmplY3RLZXlzKHBhcmFtcykpIDogdHJ1ZTtcclxuICAgIH07XHJcblxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQG5nZG9jIGZ1bmN0aW9uXHJcbiAgICAgKiBAbmFtZSB1aS5yb3V0ZXIuc3RhdGUuJHN0YXRlI2hyZWZcclxuICAgICAqIEBtZXRob2RPZiB1aS5yb3V0ZXIuc3RhdGUuJHN0YXRlXHJcbiAgICAgKlxyXG4gICAgICogQGRlc2NyaXB0aW9uXHJcbiAgICAgKiBBIHVybCBnZW5lcmF0aW9uIG1ldGhvZCB0aGF0IHJldHVybnMgdGhlIGNvbXBpbGVkIHVybCBmb3IgdGhlIGdpdmVuIHN0YXRlIHBvcHVsYXRlZCB3aXRoIHRoZSBnaXZlbiBwYXJhbXMuXHJcbiAgICAgKlxyXG4gICAgICogQGV4YW1wbGVcclxuICAgICAqIDxwcmU+XHJcbiAgICAgKiBleHBlY3QoJHN0YXRlLmhyZWYoXCJhYm91dC5wZXJzb25cIiwgeyBwZXJzb246IFwiYm9iXCIgfSkpLnRvRXF1YWwoXCIvYWJvdXQvYm9iXCIpO1xyXG4gICAgICogPC9wcmU+XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd8b2JqZWN0fSBzdGF0ZU9yTmFtZSBUaGUgc3RhdGUgbmFtZSBvciBzdGF0ZSBvYmplY3QgeW91J2QgbGlrZSB0byBnZW5lcmF0ZSBhIHVybCBmcm9tLlxyXG4gICAgICogQHBhcmFtIHtvYmplY3Q9fSBwYXJhbXMgQW4gb2JqZWN0IG9mIHBhcmFtZXRlciB2YWx1ZXMgdG8gZmlsbCB0aGUgc3RhdGUncyByZXF1aXJlZCBwYXJhbWV0ZXJzLlxyXG4gICAgICogQHBhcmFtIHtvYmplY3Q9fSBvcHRpb25zIE9wdGlvbnMgb2JqZWN0LiBUaGUgb3B0aW9ucyBhcmU6XHJcbiAgICAgKlxyXG4gICAgICogLSAqKmBsb3NzeWAqKiAtIHtib29sZWFuPXRydWV9IC0gIElmIHRydWUsIGFuZCBpZiB0aGVyZSBpcyBubyB1cmwgYXNzb2NpYXRlZCB3aXRoIHRoZSBzdGF0ZSBwcm92aWRlZCBpbiB0aGVcclxuICAgICAqICAgIGZpcnN0IHBhcmFtZXRlciwgdGhlbiB0aGUgY29uc3RydWN0ZWQgaHJlZiB1cmwgd2lsbCBiZSBidWlsdCBmcm9tIHRoZSBmaXJzdCBuYXZpZ2FibGUgYW5jZXN0b3IgKGFrYVxyXG4gICAgICogICAgYW5jZXN0b3Igd2l0aCBhIHZhbGlkIHVybCkuXHJcbiAgICAgKiAtICoqYGluaGVyaXRgKiogLSB7Ym9vbGVhbj10cnVlfSwgSWYgYHRydWVgIHdpbGwgaW5oZXJpdCB1cmwgcGFyYW1ldGVycyBmcm9tIGN1cnJlbnQgdXJsLlxyXG4gICAgICogLSAqKmByZWxhdGl2ZWAqKiAtIHtvYmplY3Q9JHN0YXRlLiRjdXJyZW50fSwgV2hlbiB0cmFuc2l0aW9uaW5nIHdpdGggcmVsYXRpdmUgcGF0aCAoZS5nICdeJyksIFxyXG4gICAgICogICAgZGVmaW5lcyB3aGljaCBzdGF0ZSB0byBiZSByZWxhdGl2ZSBmcm9tLlxyXG4gICAgICogLSAqKmBhYnNvbHV0ZWAqKiAtIHtib29sZWFuPWZhbHNlfSwgIElmIHRydWUgd2lsbCBnZW5lcmF0ZSBhbiBhYnNvbHV0ZSB1cmwsIGUuZy4gXCJodHRwOi8vd3d3LmV4YW1wbGUuY29tL2Z1bGx1cmxcIi5cclxuICAgICAqIFxyXG4gICAgICogQHJldHVybnMge3N0cmluZ30gY29tcGlsZWQgc3RhdGUgdXJsXHJcbiAgICAgKi9cclxuICAgICRzdGF0ZS5ocmVmID0gZnVuY3Rpb24gaHJlZihzdGF0ZU9yTmFtZSwgcGFyYW1zLCBvcHRpb25zKSB7XHJcbiAgICAgIG9wdGlvbnMgPSBleHRlbmQoe1xyXG4gICAgICAgIGxvc3N5OiAgICB0cnVlLFxyXG4gICAgICAgIGluaGVyaXQ6ICB0cnVlLFxyXG4gICAgICAgIGFic29sdXRlOiBmYWxzZSxcclxuICAgICAgICByZWxhdGl2ZTogJHN0YXRlLiRjdXJyZW50XHJcbiAgICAgIH0sIG9wdGlvbnMgfHwge30pO1xyXG5cclxuICAgICAgdmFyIHN0YXRlID0gZmluZFN0YXRlKHN0YXRlT3JOYW1lLCBvcHRpb25zLnJlbGF0aXZlKTtcclxuXHJcbiAgICAgIGlmICghaXNEZWZpbmVkKHN0YXRlKSkgcmV0dXJuIG51bGw7XHJcbiAgICAgIGlmIChvcHRpb25zLmluaGVyaXQpIHBhcmFtcyA9IGluaGVyaXRQYXJhbXMoJHN0YXRlUGFyYW1zLCBwYXJhbXMgfHwge30sICRzdGF0ZS4kY3VycmVudCwgc3RhdGUpO1xyXG4gICAgICBcclxuICAgICAgdmFyIG5hdiA9IChzdGF0ZSAmJiBvcHRpb25zLmxvc3N5KSA/IHN0YXRlLm5hdmlnYWJsZSA6IHN0YXRlO1xyXG5cclxuICAgICAgaWYgKCFuYXYgfHwgbmF2LnVybCA9PT0gdW5kZWZpbmVkIHx8IG5hdi51cmwgPT09IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gJHVybFJvdXRlci5ocmVmKG5hdi51cmwsIGZpbHRlckJ5S2V5cyhzdGF0ZS5wYXJhbXMuJCRrZXlzKCksIHBhcmFtcyB8fCB7fSksIHtcclxuICAgICAgICBhYnNvbHV0ZTogb3B0aW9ucy5hYnNvbHV0ZVxyXG4gICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAbmdkb2MgZnVuY3Rpb25cclxuICAgICAqIEBuYW1lIHVpLnJvdXRlci5zdGF0ZS4kc3RhdGUjZ2V0XHJcbiAgICAgKiBAbWV0aG9kT2YgdWkucm91dGVyLnN0YXRlLiRzdGF0ZVxyXG4gICAgICpcclxuICAgICAqIEBkZXNjcmlwdGlvblxyXG4gICAgICogUmV0dXJucyB0aGUgc3RhdGUgY29uZmlndXJhdGlvbiBvYmplY3QgZm9yIGFueSBzcGVjaWZpYyBzdGF0ZSBvciBhbGwgc3RhdGVzLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfG9iamVjdD19IHN0YXRlT3JOYW1lIChhYnNvbHV0ZSBvciByZWxhdGl2ZSkgSWYgcHJvdmlkZWQsIHdpbGwgb25seSBnZXQgdGhlIGNvbmZpZyBmb3JcclxuICAgICAqIHRoZSByZXF1ZXN0ZWQgc3RhdGUuIElmIG5vdCBwcm92aWRlZCwgcmV0dXJucyBhbiBhcnJheSBvZiBBTEwgc3RhdGUgY29uZmlncy5cclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfG9iamVjdD19IGNvbnRleHQgV2hlbiBzdGF0ZU9yTmFtZSBpcyBhIHJlbGF0aXZlIHN0YXRlIHJlZmVyZW5jZSwgdGhlIHN0YXRlIHdpbGwgYmUgcmV0cmlldmVkIHJlbGF0aXZlIHRvIGNvbnRleHQuXHJcbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fEFycmF5fSBTdGF0ZSBjb25maWd1cmF0aW9uIG9iamVjdCBvciBhcnJheSBvZiBhbGwgb2JqZWN0cy5cclxuICAgICAqL1xyXG4gICAgJHN0YXRlLmdldCA9IGZ1bmN0aW9uIChzdGF0ZU9yTmFtZSwgY29udGV4dCkge1xyXG4gICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIG1hcChvYmplY3RLZXlzKHN0YXRlcyksIGZ1bmN0aW9uKG5hbWUpIHsgcmV0dXJuIHN0YXRlc1tuYW1lXS5zZWxmOyB9KTtcclxuICAgICAgdmFyIHN0YXRlID0gZmluZFN0YXRlKHN0YXRlT3JOYW1lLCBjb250ZXh0IHx8ICRzdGF0ZS4kY3VycmVudCk7XHJcbiAgICAgIHJldHVybiAoc3RhdGUgJiYgc3RhdGUuc2VsZikgPyBzdGF0ZS5zZWxmIDogbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gcmVzb2x2ZVN0YXRlKHN0YXRlLCBwYXJhbXMsIHBhcmFtc0FyZUZpbHRlcmVkLCBpbmhlcml0ZWQsIGRzdCwgb3B0aW9ucykge1xyXG4gICAgICAvLyBNYWtlIGEgcmVzdHJpY3RlZCAkc3RhdGVQYXJhbXMgd2l0aCBvbmx5IHRoZSBwYXJhbWV0ZXJzIHRoYXQgYXBwbHkgdG8gdGhpcyBzdGF0ZSBpZlxyXG4gICAgICAvLyBuZWNlc3NhcnkuIEluIGFkZGl0aW9uIHRvIGJlaW5nIGF2YWlsYWJsZSB0byB0aGUgY29udHJvbGxlciBhbmQgb25FbnRlci9vbkV4aXQgY2FsbGJhY2tzLFxyXG4gICAgICAvLyB3ZSBhbHNvIG5lZWQgJHN0YXRlUGFyYW1zIHRvIGJlIGF2YWlsYWJsZSBmb3IgYW55ICRpbmplY3RvciBjYWxscyB3ZSBtYWtlIGR1cmluZyB0aGVcclxuICAgICAgLy8gZGVwZW5kZW5jeSByZXNvbHV0aW9uIHByb2Nlc3MuXHJcbiAgICAgIHZhciAkc3RhdGVQYXJhbXMgPSAocGFyYW1zQXJlRmlsdGVyZWQpID8gcGFyYW1zIDogZmlsdGVyQnlLZXlzKHN0YXRlLnBhcmFtcy4kJGtleXMoKSwgcGFyYW1zKTtcclxuICAgICAgdmFyIGxvY2FscyA9IHsgJHN0YXRlUGFyYW1zOiAkc3RhdGVQYXJhbXMgfTtcclxuXHJcbiAgICAgIC8vIFJlc29sdmUgJ2dsb2JhbCcgZGVwZW5kZW5jaWVzIGZvciB0aGUgc3RhdGUsIGkuZS4gdGhvc2Ugbm90IHNwZWNpZmljIHRvIGEgdmlldy5cclxuICAgICAgLy8gV2UncmUgYWxzbyBpbmNsdWRpbmcgJHN0YXRlUGFyYW1zIGluIHRoaXM7IHRoYXQgd2F5IHRoZSBwYXJhbWV0ZXJzIGFyZSByZXN0cmljdGVkXHJcbiAgICAgIC8vIHRvIHRoZSBzZXQgdGhhdCBzaG91bGQgYmUgdmlzaWJsZSB0byB0aGUgc3RhdGUsIGFuZCBhcmUgaW5kZXBlbmRlbnQgb2Ygd2hlbiB3ZSB1cGRhdGVcclxuICAgICAgLy8gdGhlIGdsb2JhbCAkc3RhdGUgYW5kICRzdGF0ZVBhcmFtcyB2YWx1ZXMuXHJcbiAgICAgIGRzdC5yZXNvbHZlID0gJHJlc29sdmUucmVzb2x2ZShzdGF0ZS5yZXNvbHZlLCBsb2NhbHMsIGRzdC5yZXNvbHZlLCBzdGF0ZSk7XHJcbiAgICAgIHZhciBwcm9taXNlcyA9IFtkc3QucmVzb2x2ZS50aGVuKGZ1bmN0aW9uIChnbG9iYWxzKSB7XHJcbiAgICAgICAgZHN0Lmdsb2JhbHMgPSBnbG9iYWxzO1xyXG4gICAgICB9KV07XHJcbiAgICAgIGlmIChpbmhlcml0ZWQpIHByb21pc2VzLnB1c2goaW5oZXJpdGVkKTtcclxuXHJcbiAgICAgIC8vIFJlc29sdmUgdGVtcGxhdGUgYW5kIGRlcGVuZGVuY2llcyBmb3IgYWxsIHZpZXdzLlxyXG4gICAgICBmb3JFYWNoKHN0YXRlLnZpZXdzLCBmdW5jdGlvbiAodmlldywgbmFtZSkge1xyXG4gICAgICAgIHZhciBpbmplY3RhYmxlcyA9ICh2aWV3LnJlc29sdmUgJiYgdmlldy5yZXNvbHZlICE9PSBzdGF0ZS5yZXNvbHZlID8gdmlldy5yZXNvbHZlIDoge30pO1xyXG4gICAgICAgIGluamVjdGFibGVzLiR0ZW1wbGF0ZSA9IFsgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgcmV0dXJuICR2aWV3LmxvYWQobmFtZSwgeyB2aWV3OiB2aWV3LCBsb2NhbHM6IGxvY2FscywgcGFyYW1zOiAkc3RhdGVQYXJhbXMsIG5vdGlmeTogb3B0aW9ucy5ub3RpZnkgfSkgfHwgJyc7XHJcbiAgICAgICAgfV07XHJcblxyXG4gICAgICAgIHByb21pc2VzLnB1c2goJHJlc29sdmUucmVzb2x2ZShpbmplY3RhYmxlcywgbG9jYWxzLCBkc3QucmVzb2x2ZSwgc3RhdGUpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgLy8gUmVmZXJlbmNlcyB0byB0aGUgY29udHJvbGxlciAob25seSBpbnN0YW50aWF0ZWQgYXQgbGluayB0aW1lKVxyXG4gICAgICAgICAgaWYgKGlzRnVuY3Rpb24odmlldy5jb250cm9sbGVyUHJvdmlkZXIpIHx8IGlzQXJyYXkodmlldy5jb250cm9sbGVyUHJvdmlkZXIpKSB7XHJcbiAgICAgICAgICAgIHZhciBpbmplY3RMb2NhbHMgPSBhbmd1bGFyLmV4dGVuZCh7fSwgaW5qZWN0YWJsZXMsIGxvY2Fscyk7XHJcbiAgICAgICAgICAgIHJlc3VsdC4kJGNvbnRyb2xsZXIgPSAkaW5qZWN0b3IuaW52b2tlKHZpZXcuY29udHJvbGxlclByb3ZpZGVyLCBudWxsLCBpbmplY3RMb2NhbHMpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVzdWx0LiQkY29udHJvbGxlciA9IHZpZXcuY29udHJvbGxlcjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIC8vIFByb3ZpZGUgYWNjZXNzIHRvIHRoZSBzdGF0ZSBpdHNlbGYgZm9yIGludGVybmFsIHVzZVxyXG4gICAgICAgICAgcmVzdWx0LiQkc3RhdGUgPSBzdGF0ZTtcclxuICAgICAgICAgIHJlc3VsdC4kJGNvbnRyb2xsZXJBcyA9IHZpZXcuY29udHJvbGxlckFzO1xyXG4gICAgICAgICAgZHN0W25hbWVdID0gcmVzdWx0O1xyXG4gICAgICAgIH0pKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBXYWl0IGZvciBhbGwgdGhlIHByb21pc2VzIGFuZCB0aGVuIHJldHVybiB0aGUgYWN0aXZhdGlvbiBvYmplY3RcclxuICAgICAgcmV0dXJuICRxLmFsbChwcm9taXNlcykudGhlbihmdW5jdGlvbiAodmFsdWVzKSB7XHJcbiAgICAgICAgcmV0dXJuIGRzdDtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuICRzdGF0ZTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNob3VsZFRyaWdnZXJSZWxvYWQodG8sIGZyb20sIGxvY2Fscywgb3B0aW9ucykge1xyXG4gICAgaWYgKHRvID09PSBmcm9tICYmICgobG9jYWxzID09PSBmcm9tLmxvY2FscyAmJiAhb3B0aW9ucy5yZWxvYWQpIHx8ICh0by5zZWxmLnJlbG9hZE9uU2VhcmNoID09PSBmYWxzZSkpKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3VpLnJvdXRlci5zdGF0ZScpXHJcbiAgLnZhbHVlKCckc3RhdGVQYXJhbXMnLCB7fSlcclxuICAucHJvdmlkZXIoJyRzdGF0ZScsICRTdGF0ZVByb3ZpZGVyKTtcclxuXHJcblxyXG4kVmlld1Byb3ZpZGVyLiRpbmplY3QgPSBbXTtcclxuZnVuY3Rpb24gJFZpZXdQcm92aWRlcigpIHtcclxuXHJcbiAgdGhpcy4kZ2V0ID0gJGdldDtcclxuICAvKipcclxuICAgKiBAbmdkb2Mgb2JqZWN0XHJcbiAgICogQG5hbWUgdWkucm91dGVyLnN0YXRlLiR2aWV3XHJcbiAgICpcclxuICAgKiBAcmVxdWlyZXMgdWkucm91dGVyLnV0aWwuJHRlbXBsYXRlRmFjdG9yeVxyXG4gICAqIEByZXF1aXJlcyAkcm9vdFNjb3BlXHJcbiAgICpcclxuICAgKiBAZGVzY3JpcHRpb25cclxuICAgKlxyXG4gICAqL1xyXG4gICRnZXQuJGluamVjdCA9IFsnJHJvb3RTY29wZScsICckdGVtcGxhdGVGYWN0b3J5J107XHJcbiAgZnVuY3Rpb24gJGdldCggICAkcm9vdFNjb3BlLCAgICR0ZW1wbGF0ZUZhY3RvcnkpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIC8vICR2aWV3LmxvYWQoJ2Z1bGwudmlld05hbWUnLCB7IHRlbXBsYXRlOiAuLi4sIGNvbnRyb2xsZXI6IC4uLiwgcmVzb2x2ZTogLi4uLCBhc3luYzogZmFsc2UsIHBhcmFtczogLi4uIH0pXHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiBAbmdkb2MgZnVuY3Rpb25cclxuICAgICAgICogQG5hbWUgdWkucm91dGVyLnN0YXRlLiR2aWV3I2xvYWRcclxuICAgICAgICogQG1ldGhvZE9mIHVpLnJvdXRlci5zdGF0ZS4kdmlld1xyXG4gICAgICAgKlxyXG4gICAgICAgKiBAZGVzY3JpcHRpb25cclxuICAgICAgICpcclxuICAgICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgbmFtZVxyXG4gICAgICAgKiBAcGFyYW0ge29iamVjdH0gb3B0aW9ucyBvcHRpb24gb2JqZWN0LlxyXG4gICAgICAgKi9cclxuICAgICAgbG9hZDogZnVuY3Rpb24gbG9hZChuYW1lLCBvcHRpb25zKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCwgZGVmYXVsdHMgPSB7XHJcbiAgICAgICAgICB0ZW1wbGF0ZTogbnVsbCwgY29udHJvbGxlcjogbnVsbCwgdmlldzogbnVsbCwgbG9jYWxzOiBudWxsLCBub3RpZnk6IHRydWUsIGFzeW5jOiB0cnVlLCBwYXJhbXM6IHt9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBvcHRpb25zID0gZXh0ZW5kKGRlZmF1bHRzLCBvcHRpb25zKTtcclxuXHJcbiAgICAgICAgaWYgKG9wdGlvbnMudmlldykge1xyXG4gICAgICAgICAgcmVzdWx0ID0gJHRlbXBsYXRlRmFjdG9yeS5mcm9tQ29uZmlnKG9wdGlvbnMudmlldywgb3B0aW9ucy5wYXJhbXMsIG9wdGlvbnMubG9jYWxzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJlc3VsdCAmJiBvcHRpb25zLm5vdGlmeSkge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEBuZ2RvYyBldmVudFxyXG4gICAgICAgICAqIEBuYW1lIHVpLnJvdXRlci5zdGF0ZS4kc3RhdGUjJHZpZXdDb250ZW50TG9hZGluZ1xyXG4gICAgICAgICAqIEBldmVudE9mIHVpLnJvdXRlci5zdGF0ZS4kdmlld1xyXG4gICAgICAgICAqIEBldmVudFR5cGUgYnJvYWRjYXN0IG9uIHJvb3Qgc2NvcGVcclxuICAgICAgICAgKiBAZGVzY3JpcHRpb25cclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEZpcmVkIG9uY2UgdGhlIHZpZXcgKipiZWdpbnMgbG9hZGluZyoqLCAqYmVmb3JlKiB0aGUgRE9NIGlzIHJlbmRlcmVkLlxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50IEV2ZW50IG9iamVjdC5cclxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gdmlld0NvbmZpZyBUaGUgdmlldyBjb25maWcgcHJvcGVydGllcyAodGVtcGxhdGUsIGNvbnRyb2xsZXIsIGV0YykuXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAZXhhbXBsZVxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogPHByZT5cclxuICAgICAgICAgKiAkc2NvcGUuJG9uKCckdmlld0NvbnRlbnRMb2FkaW5nJyxcclxuICAgICAgICAgKiBmdW5jdGlvbihldmVudCwgdmlld0NvbmZpZyl7XHJcbiAgICAgICAgICogICAgIC8vIEFjY2VzcyB0byBhbGwgdGhlIHZpZXcgY29uZmlnIHByb3BlcnRpZXMuXHJcbiAgICAgICAgICogICAgIC8vIGFuZCBvbmUgc3BlY2lhbCBwcm9wZXJ0eSAndGFyZ2V0VmlldydcclxuICAgICAgICAgKiAgICAgLy8gdmlld0NvbmZpZy50YXJnZXRWaWV3XHJcbiAgICAgICAgICogfSk7XHJcbiAgICAgICAgICogPC9wcmU+XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJyR2aWV3Q29udGVudExvYWRpbmcnLCBvcHRpb25zKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmFuZ3VsYXIubW9kdWxlKCd1aS5yb3V0ZXIuc3RhdGUnKS5wcm92aWRlcignJHZpZXcnLCAkVmlld1Byb3ZpZGVyKTtcclxuXHJcbi8qKlxyXG4gKiBAbmdkb2Mgb2JqZWN0XHJcbiAqIEBuYW1lIHVpLnJvdXRlci5zdGF0ZS4kdWlWaWV3U2Nyb2xsUHJvdmlkZXJcclxuICpcclxuICogQGRlc2NyaXB0aW9uXHJcbiAqIFByb3ZpZGVyIHRoYXQgcmV0dXJucyB0aGUge0BsaW5rIHVpLnJvdXRlci5zdGF0ZS4kdWlWaWV3U2Nyb2xsfSBzZXJ2aWNlIGZ1bmN0aW9uLlxyXG4gKi9cclxuZnVuY3Rpb24gJFZpZXdTY3JvbGxQcm92aWRlcigpIHtcclxuXHJcbiAgdmFyIHVzZUFuY2hvclNjcm9sbCA9IGZhbHNlO1xyXG5cclxuICAvKipcclxuICAgKiBAbmdkb2MgZnVuY3Rpb25cclxuICAgKiBAbmFtZSB1aS5yb3V0ZXIuc3RhdGUuJHVpVmlld1Njcm9sbFByb3ZpZGVyI3VzZUFuY2hvclNjcm9sbFxyXG4gICAqIEBtZXRob2RPZiB1aS5yb3V0ZXIuc3RhdGUuJHVpVmlld1Njcm9sbFByb3ZpZGVyXHJcbiAgICpcclxuICAgKiBAZGVzY3JpcHRpb25cclxuICAgKiBSZXZlcnRzIGJhY2sgdG8gdXNpbmcgdGhlIGNvcmUgW2AkYW5jaG9yU2Nyb2xsYF0oaHR0cDovL2RvY3MuYW5ndWxhcmpzLm9yZy9hcGkvbmcuJGFuY2hvclNjcm9sbCkgc2VydmljZSBmb3JcclxuICAgKiBzY3JvbGxpbmcgYmFzZWQgb24gdGhlIHVybCBhbmNob3IuXHJcbiAgICovXHJcbiAgdGhpcy51c2VBbmNob3JTY3JvbGwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB1c2VBbmNob3JTY3JvbGwgPSB0cnVlO1xyXG4gIH07XHJcblxyXG4gIC8qKlxyXG4gICAqIEBuZ2RvYyBvYmplY3RcclxuICAgKiBAbmFtZSB1aS5yb3V0ZXIuc3RhdGUuJHVpVmlld1Njcm9sbFxyXG4gICAqXHJcbiAgICogQHJlcXVpcmVzICRhbmNob3JTY3JvbGxcclxuICAgKiBAcmVxdWlyZXMgJHRpbWVvdXRcclxuICAgKlxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqIFdoZW4gY2FsbGVkIHdpdGggYSBqcUxpdGUgZWxlbWVudCwgaXQgc2Nyb2xscyB0aGUgZWxlbWVudCBpbnRvIHZpZXcgKGFmdGVyIGFcclxuICAgKiBgJHRpbWVvdXRgIHNvIHRoZSBET00gaGFzIHRpbWUgdG8gcmVmcmVzaCkuXHJcbiAgICpcclxuICAgKiBJZiB5b3UgcHJlZmVyIHRvIHJlbHkgb24gYCRhbmNob3JTY3JvbGxgIHRvIHNjcm9sbCB0aGUgdmlldyB0byB0aGUgYW5jaG9yLFxyXG4gICAqIHRoaXMgY2FuIGJlIGVuYWJsZWQgYnkgY2FsbGluZyB7QGxpbmsgdWkucm91dGVyLnN0YXRlLiR1aVZpZXdTY3JvbGxQcm92aWRlciNtZXRob2RzX3VzZUFuY2hvclNjcm9sbCBgJHVpVmlld1Njcm9sbFByb3ZpZGVyLnVzZUFuY2hvclNjcm9sbCgpYH0uXHJcbiAgICovXHJcbiAgdGhpcy4kZ2V0ID0gWyckYW5jaG9yU2Nyb2xsJywgJyR0aW1lb3V0JywgZnVuY3Rpb24gKCRhbmNob3JTY3JvbGwsICR0aW1lb3V0KSB7XHJcbiAgICBpZiAodXNlQW5jaG9yU2Nyb2xsKSB7XHJcbiAgICAgIHJldHVybiAkYW5jaG9yU2Nyb2xsO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmdW5jdGlvbiAoJGVsZW1lbnQpIHtcclxuICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICRlbGVtZW50WzBdLnNjcm9sbEludG9WaWV3KCk7XHJcbiAgICAgIH0sIDAsIGZhbHNlKTtcclxuICAgIH07XHJcbiAgfV07XHJcbn1cclxuXHJcbmFuZ3VsYXIubW9kdWxlKCd1aS5yb3V0ZXIuc3RhdGUnKS5wcm92aWRlcignJHVpVmlld1Njcm9sbCcsICRWaWV3U2Nyb2xsUHJvdmlkZXIpO1xyXG5cclxuLyoqXHJcbiAqIEBuZ2RvYyBkaXJlY3RpdmVcclxuICogQG5hbWUgdWkucm91dGVyLnN0YXRlLmRpcmVjdGl2ZTp1aS12aWV3XHJcbiAqXHJcbiAqIEByZXF1aXJlcyB1aS5yb3V0ZXIuc3RhdGUuJHN0YXRlXHJcbiAqIEByZXF1aXJlcyAkY29tcGlsZVxyXG4gKiBAcmVxdWlyZXMgJGNvbnRyb2xsZXJcclxuICogQHJlcXVpcmVzICRpbmplY3RvclxyXG4gKiBAcmVxdWlyZXMgdWkucm91dGVyLnN0YXRlLiR1aVZpZXdTY3JvbGxcclxuICogQHJlcXVpcmVzICRkb2N1bWVudFxyXG4gKlxyXG4gKiBAcmVzdHJpY3QgRUNBXHJcbiAqXHJcbiAqIEBkZXNjcmlwdGlvblxyXG4gKiBUaGUgdWktdmlldyBkaXJlY3RpdmUgdGVsbHMgJHN0YXRlIHdoZXJlIHRvIHBsYWNlIHlvdXIgdGVtcGxhdGVzLlxyXG4gKlxyXG4gKiBAcGFyYW0ge3N0cmluZz19IG5hbWUgQSB2aWV3IG5hbWUuIFRoZSBuYW1lIHNob3VsZCBiZSB1bmlxdWUgYW1vbmdzdCB0aGUgb3RoZXIgdmlld3MgaW4gdGhlXHJcbiAqIHNhbWUgc3RhdGUuIFlvdSBjYW4gaGF2ZSB2aWV3cyBvZiB0aGUgc2FtZSBuYW1lIHRoYXQgbGl2ZSBpbiBkaWZmZXJlbnQgc3RhdGVzLlxyXG4gKlxyXG4gKiBAcGFyYW0ge3N0cmluZz19IGF1dG9zY3JvbGwgSXQgYWxsb3dzIHlvdSB0byBzZXQgdGhlIHNjcm9sbCBiZWhhdmlvciBvZiB0aGUgYnJvd3NlciB3aW5kb3dcclxuICogd2hlbiBhIHZpZXcgaXMgcG9wdWxhdGVkLiBCeSBkZWZhdWx0LCAkYW5jaG9yU2Nyb2xsIGlzIG92ZXJyaWRkZW4gYnkgdWktcm91dGVyJ3MgY3VzdG9tIHNjcm9sbFxyXG4gKiBzZXJ2aWNlLCB7QGxpbmsgdWkucm91dGVyLnN0YXRlLiR1aVZpZXdTY3JvbGx9LiBUaGlzIGN1c3RvbSBzZXJ2aWNlIGxldCdzIHlvdVxyXG4gKiBzY3JvbGwgdWktdmlldyBlbGVtZW50cyBpbnRvIHZpZXcgd2hlbiB0aGV5IGFyZSBwb3B1bGF0ZWQgZHVyaW5nIGEgc3RhdGUgYWN0aXZhdGlvbi5cclxuICpcclxuICogKk5vdGU6IFRvIHJldmVydCBiYWNrIHRvIG9sZCBbYCRhbmNob3JTY3JvbGxgXShodHRwOi8vZG9jcy5hbmd1bGFyanMub3JnL2FwaS9uZy4kYW5jaG9yU2Nyb2xsKVxyXG4gKiBmdW5jdGlvbmFsaXR5LCBjYWxsIGAkdWlWaWV3U2Nyb2xsUHJvdmlkZXIudXNlQW5jaG9yU2Nyb2xsKClgLipcclxuICpcclxuICogQHBhcmFtIHtzdHJpbmc9fSBvbmxvYWQgRXhwcmVzc2lvbiB0byBldmFsdWF0ZSB3aGVuZXZlciB0aGUgdmlldyB1cGRhdGVzLlxyXG4gKiBcclxuICogQGV4YW1wbGVcclxuICogQSB2aWV3IGNhbiBiZSB1bm5hbWVkIG9yIG5hbWVkLiBcclxuICogPHByZT5cclxuICogPCEtLSBVbm5hbWVkIC0tPlxyXG4gKiA8ZGl2IHVpLXZpZXc+PC9kaXY+IFxyXG4gKiBcclxuICogPCEtLSBOYW1lZCAtLT5cclxuICogPGRpdiB1aS12aWV3PVwidmlld05hbWVcIj48L2Rpdj5cclxuICogPC9wcmU+XHJcbiAqXHJcbiAqIFlvdSBjYW4gb25seSBoYXZlIG9uZSB1bm5hbWVkIHZpZXcgd2l0aGluIGFueSB0ZW1wbGF0ZSAob3Igcm9vdCBodG1sKS4gSWYgeW91IGFyZSBvbmx5IHVzaW5nIGEgXHJcbiAqIHNpbmdsZSB2aWV3IGFuZCBpdCBpcyB1bm5hbWVkIHRoZW4geW91IGNhbiBwb3B1bGF0ZSBpdCBsaWtlIHNvOlxyXG4gKiA8cHJlPlxyXG4gKiA8ZGl2IHVpLXZpZXc+PC9kaXY+IFxyXG4gKiAkc3RhdGVQcm92aWRlci5zdGF0ZShcImhvbWVcIiwge1xyXG4gKiAgIHRlbXBsYXRlOiBcIjxoMT5IRUxMTyE8L2gxPlwiXHJcbiAqIH0pXHJcbiAqIDwvcHJlPlxyXG4gKiBcclxuICogVGhlIGFib3ZlIGlzIGEgY29udmVuaWVudCBzaG9ydGN1dCBlcXVpdmFsZW50IHRvIHNwZWNpZnlpbmcgeW91ciB2aWV3IGV4cGxpY2l0bHkgd2l0aCB0aGUge0BsaW5rIHVpLnJvdXRlci5zdGF0ZS4kc3RhdGVQcm92aWRlciN2aWV3cyBgdmlld3NgfVxyXG4gKiBjb25maWcgcHJvcGVydHksIGJ5IG5hbWUsIGluIHRoaXMgY2FzZSBhbiBlbXB0eSBuYW1lOlxyXG4gKiA8cHJlPlxyXG4gKiAkc3RhdGVQcm92aWRlci5zdGF0ZShcImhvbWVcIiwge1xyXG4gKiAgIHZpZXdzOiB7XHJcbiAqICAgICBcIlwiOiB7XHJcbiAqICAgICAgIHRlbXBsYXRlOiBcIjxoMT5IRUxMTyE8L2gxPlwiXHJcbiAqICAgICB9XHJcbiAqICAgfSAgICBcclxuICogfSlcclxuICogPC9wcmU+XHJcbiAqIFxyXG4gKiBCdXQgdHlwaWNhbGx5IHlvdSdsbCBvbmx5IHVzZSB0aGUgdmlld3MgcHJvcGVydHkgaWYgeW91IG5hbWUgeW91ciB2aWV3IG9yIGhhdmUgbW9yZSB0aGFuIG9uZSB2aWV3IFxyXG4gKiBpbiB0aGUgc2FtZSB0ZW1wbGF0ZS4gVGhlcmUncyBub3QgcmVhbGx5IGEgY29tcGVsbGluZyByZWFzb24gdG8gbmFtZSBhIHZpZXcgaWYgaXRzIHRoZSBvbmx5IG9uZSwgXHJcbiAqIGJ1dCB5b3UgY291bGQgaWYgeW91IHdhbnRlZCwgbGlrZSBzbzpcclxuICogPHByZT5cclxuICogPGRpdiB1aS12aWV3PVwibWFpblwiPjwvZGl2PlxyXG4gKiA8L3ByZT4gXHJcbiAqIDxwcmU+XHJcbiAqICRzdGF0ZVByb3ZpZGVyLnN0YXRlKFwiaG9tZVwiLCB7XHJcbiAqICAgdmlld3M6IHtcclxuICogICAgIFwibWFpblwiOiB7XHJcbiAqICAgICAgIHRlbXBsYXRlOiBcIjxoMT5IRUxMTyE8L2gxPlwiXHJcbiAqICAgICB9XHJcbiAqICAgfSAgICBcclxuICogfSlcclxuICogPC9wcmU+XHJcbiAqIFxyXG4gKiBSZWFsbHkgdGhvdWdoLCB5b3UnbGwgdXNlIHZpZXdzIHRvIHNldCB1cCBtdWx0aXBsZSB2aWV3czpcclxuICogPHByZT5cclxuICogPGRpdiB1aS12aWV3PjwvZGl2PlxyXG4gKiA8ZGl2IHVpLXZpZXc9XCJjaGFydFwiPjwvZGl2PiBcclxuICogPGRpdiB1aS12aWV3PVwiZGF0YVwiPjwvZGl2PiBcclxuICogPC9wcmU+XHJcbiAqIFxyXG4gKiA8cHJlPlxyXG4gKiAkc3RhdGVQcm92aWRlci5zdGF0ZShcImhvbWVcIiwge1xyXG4gKiAgIHZpZXdzOiB7XHJcbiAqICAgICBcIlwiOiB7XHJcbiAqICAgICAgIHRlbXBsYXRlOiBcIjxoMT5IRUxMTyE8L2gxPlwiXHJcbiAqICAgICB9LFxyXG4gKiAgICAgXCJjaGFydFwiOiB7XHJcbiAqICAgICAgIHRlbXBsYXRlOiBcIjxjaGFydF90aGluZy8+XCJcclxuICogICAgIH0sXHJcbiAqICAgICBcImRhdGFcIjoge1xyXG4gKiAgICAgICB0ZW1wbGF0ZTogXCI8ZGF0YV90aGluZy8+XCJcclxuICogICAgIH1cclxuICogICB9ICAgIFxyXG4gKiB9KVxyXG4gKiA8L3ByZT5cclxuICpcclxuICogRXhhbXBsZXMgZm9yIGBhdXRvc2Nyb2xsYDpcclxuICpcclxuICogPHByZT5cclxuICogPCEtLSBJZiBhdXRvc2Nyb2xsIHByZXNlbnQgd2l0aCBubyBleHByZXNzaW9uLFxyXG4gKiAgICAgIHRoZW4gc2Nyb2xsIHVpLXZpZXcgaW50byB2aWV3IC0tPlxyXG4gKiA8dWktdmlldyBhdXRvc2Nyb2xsLz5cclxuICpcclxuICogPCEtLSBJZiBhdXRvc2Nyb2xsIHByZXNlbnQgd2l0aCB2YWxpZCBleHByZXNzaW9uLFxyXG4gKiAgICAgIHRoZW4gc2Nyb2xsIHVpLXZpZXcgaW50byB2aWV3IGlmIGV4cHJlc3Npb24gZXZhbHVhdGVzIHRvIHRydWUgLS0+XHJcbiAqIDx1aS12aWV3IGF1dG9zY3JvbGw9J3RydWUnLz5cclxuICogPHVpLXZpZXcgYXV0b3Njcm9sbD0nZmFsc2UnLz5cclxuICogPHVpLXZpZXcgYXV0b3Njcm9sbD0nc2NvcGVWYXJpYWJsZScvPlxyXG4gKiA8L3ByZT5cclxuICovXHJcbiRWaWV3RGlyZWN0aXZlLiRpbmplY3QgPSBbJyRzdGF0ZScsICckaW5qZWN0b3InLCAnJHVpVmlld1Njcm9sbCcsICckaW50ZXJwb2xhdGUnXTtcclxuZnVuY3Rpb24gJFZpZXdEaXJlY3RpdmUoICAgJHN0YXRlLCAgICRpbmplY3RvciwgICAkdWlWaWV3U2Nyb2xsLCAgICRpbnRlcnBvbGF0ZSkge1xyXG5cclxuICBmdW5jdGlvbiBnZXRTZXJ2aWNlKCkge1xyXG4gICAgcmV0dXJuICgkaW5qZWN0b3IuaGFzKSA/IGZ1bmN0aW9uKHNlcnZpY2UpIHtcclxuICAgICAgcmV0dXJuICRpbmplY3Rvci5oYXMoc2VydmljZSkgPyAkaW5qZWN0b3IuZ2V0KHNlcnZpY2UpIDogbnVsbDtcclxuICAgIH0gOiBmdW5jdGlvbihzZXJ2aWNlKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgcmV0dXJuICRpbmplY3Rvci5nZXQoc2VydmljZSk7XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHZhciBzZXJ2aWNlID0gZ2V0U2VydmljZSgpLFxyXG4gICAgICAkYW5pbWF0b3IgPSBzZXJ2aWNlKCckYW5pbWF0b3InKSxcclxuICAgICAgJGFuaW1hdGUgPSBzZXJ2aWNlKCckYW5pbWF0ZScpO1xyXG5cclxuICAvLyBSZXR1cm5zIGEgc2V0IG9mIERPTSBtYW5pcHVsYXRpb24gZnVuY3Rpb25zIGJhc2VkIG9uIHdoaWNoIEFuZ3VsYXIgdmVyc2lvblxyXG4gIC8vIGl0IHNob3VsZCB1c2VcclxuICBmdW5jdGlvbiBnZXRSZW5kZXJlcihhdHRycywgc2NvcGUpIHtcclxuICAgIHZhciBzdGF0aWNzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgZW50ZXI6IGZ1bmN0aW9uIChlbGVtZW50LCB0YXJnZXQsIGNiKSB7IHRhcmdldC5hZnRlcihlbGVtZW50KTsgY2IoKTsgfSxcclxuICAgICAgICBsZWF2ZTogZnVuY3Rpb24gKGVsZW1lbnQsIGNiKSB7IGVsZW1lbnQucmVtb3ZlKCk7IGNiKCk7IH1cclxuICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgaWYgKCRhbmltYXRlKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgZW50ZXI6IGZ1bmN0aW9uKGVsZW1lbnQsIHRhcmdldCwgY2IpIHtcclxuICAgICAgICAgIHZhciBwcm9taXNlID0gJGFuaW1hdGUuZW50ZXIoZWxlbWVudCwgbnVsbCwgdGFyZ2V0LCBjYik7XHJcbiAgICAgICAgICBpZiAocHJvbWlzZSAmJiBwcm9taXNlLnRoZW4pIHByb21pc2UudGhlbihjYik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBsZWF2ZTogZnVuY3Rpb24oZWxlbWVudCwgY2IpIHtcclxuICAgICAgICAgIHZhciBwcm9taXNlID0gJGFuaW1hdGUubGVhdmUoZWxlbWVudCwgY2IpO1xyXG4gICAgICAgICAgaWYgKHByb21pc2UgJiYgcHJvbWlzZS50aGVuKSBwcm9taXNlLnRoZW4oY2IpO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoJGFuaW1hdG9yKSB7XHJcbiAgICAgIHZhciBhbmltYXRlID0gJGFuaW1hdG9yICYmICRhbmltYXRvcihzY29wZSwgYXR0cnMpO1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBlbnRlcjogZnVuY3Rpb24oZWxlbWVudCwgdGFyZ2V0LCBjYikge2FuaW1hdGUuZW50ZXIoZWxlbWVudCwgbnVsbCwgdGFyZ2V0KTsgY2IoKTsgfSxcclxuICAgICAgICBsZWF2ZTogZnVuY3Rpb24oZWxlbWVudCwgY2IpIHsgYW5pbWF0ZS5sZWF2ZShlbGVtZW50KTsgY2IoKTsgfVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBzdGF0aWNzKCk7XHJcbiAgfVxyXG5cclxuICB2YXIgZGlyZWN0aXZlID0ge1xyXG4gICAgcmVzdHJpY3Q6ICdFQ0EnLFxyXG4gICAgdGVybWluYWw6IHRydWUsXHJcbiAgICBwcmlvcml0eTogNDAwLFxyXG4gICAgdHJhbnNjbHVkZTogJ2VsZW1lbnQnLFxyXG4gICAgY29tcGlsZTogZnVuY3Rpb24gKHRFbGVtZW50LCB0QXR0cnMsICR0cmFuc2NsdWRlKSB7XHJcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoc2NvcGUsICRlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgIHZhciBwcmV2aW91c0VsLCBjdXJyZW50RWwsIGN1cnJlbnRTY29wZSwgbGF0ZXN0TG9jYWxzLFxyXG4gICAgICAgICAgICBvbmxvYWRFeHAgICAgID0gYXR0cnMub25sb2FkIHx8ICcnLFxyXG4gICAgICAgICAgICBhdXRvU2Nyb2xsRXhwID0gYXR0cnMuYXV0b3Njcm9sbCxcclxuICAgICAgICAgICAgcmVuZGVyZXIgICAgICA9IGdldFJlbmRlcmVyKGF0dHJzLCBzY29wZSk7XHJcblxyXG4gICAgICAgIHNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3VjY2VzcycsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgdXBkYXRlVmlldyhmYWxzZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgc2NvcGUuJG9uKCckdmlld0NvbnRlbnRMb2FkaW5nJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICB1cGRhdGVWaWV3KGZhbHNlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdXBkYXRlVmlldyh0cnVlKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2xlYW51cExhc3RWaWV3KCkge1xyXG4gICAgICAgICAgaWYgKHByZXZpb3VzRWwpIHtcclxuICAgICAgICAgICAgcHJldmlvdXNFbC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgcHJldmlvdXNFbCA9IG51bGw7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgaWYgKGN1cnJlbnRTY29wZSkge1xyXG4gICAgICAgICAgICBjdXJyZW50U2NvcGUuJGRlc3Ryb3koKTtcclxuICAgICAgICAgICAgY3VycmVudFNjb3BlID0gbnVsbDtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBpZiAoY3VycmVudEVsKSB7XHJcbiAgICAgICAgICAgIHJlbmRlcmVyLmxlYXZlKGN1cnJlbnRFbCwgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgcHJldmlvdXNFbCA9IG51bGw7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcHJldmlvdXNFbCA9IGN1cnJlbnRFbDtcclxuICAgICAgICAgICAgY3VycmVudEVsID0gbnVsbDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVZpZXcoZmlyc3RUaW1lKSB7XHJcbiAgICAgICAgICB2YXIgbmV3U2NvcGUsXHJcbiAgICAgICAgICAgICAgbmFtZSAgICAgICAgICAgID0gZ2V0VWlWaWV3TmFtZShzY29wZSwgYXR0cnMsICRlbGVtZW50LCAkaW50ZXJwb2xhdGUpLFxyXG4gICAgICAgICAgICAgIHByZXZpb3VzTG9jYWxzICA9IG5hbWUgJiYgJHN0YXRlLiRjdXJyZW50ICYmICRzdGF0ZS4kY3VycmVudC5sb2NhbHNbbmFtZV07XHJcblxyXG4gICAgICAgICAgaWYgKCFmaXJzdFRpbWUgJiYgcHJldmlvdXNMb2NhbHMgPT09IGxhdGVzdExvY2FscykgcmV0dXJuOyAvLyBub3RoaW5nIHRvIGRvXHJcbiAgICAgICAgICBuZXdTY29wZSA9IHNjb3BlLiRuZXcoKTtcclxuICAgICAgICAgIGxhdGVzdExvY2FscyA9ICRzdGF0ZS4kY3VycmVudC5sb2NhbHNbbmFtZV07XHJcblxyXG4gICAgICAgICAgdmFyIGNsb25lID0gJHRyYW5zY2x1ZGUobmV3U2NvcGUsIGZ1bmN0aW9uKGNsb25lKSB7XHJcbiAgICAgICAgICAgIHJlbmRlcmVyLmVudGVyKGNsb25lLCAkZWxlbWVudCwgZnVuY3Rpb24gb25VaVZpZXdFbnRlcigpIHtcclxuICAgICAgICAgICAgICBpZihjdXJyZW50U2NvcGUpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRTY29wZS4kZW1pdCgnJHZpZXdDb250ZW50QW5pbWF0aW9uRW5kZWQnKTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZChhdXRvU2Nyb2xsRXhwKSAmJiAhYXV0b1Njcm9sbEV4cCB8fCBzY29wZS4kZXZhbChhdXRvU2Nyb2xsRXhwKSkge1xyXG4gICAgICAgICAgICAgICAgJHVpVmlld1Njcm9sbChjbG9uZSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgY2xlYW51cExhc3RWaWV3KCk7XHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICBjdXJyZW50RWwgPSBjbG9uZTtcclxuICAgICAgICAgIGN1cnJlbnRTY29wZSA9IG5ld1Njb3BlO1xyXG4gICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgKiBAbmdkb2MgZXZlbnRcclxuICAgICAgICAgICAqIEBuYW1lIHVpLnJvdXRlci5zdGF0ZS5kaXJlY3RpdmU6dWktdmlldyMkdmlld0NvbnRlbnRMb2FkZWRcclxuICAgICAgICAgICAqIEBldmVudE9mIHVpLnJvdXRlci5zdGF0ZS5kaXJlY3RpdmU6dWktdmlld1xyXG4gICAgICAgICAgICogQGV2ZW50VHlwZSBlbWl0cyBvbiB1aS12aWV3IGRpcmVjdGl2ZSBzY29wZVxyXG4gICAgICAgICAgICogQGRlc2NyaXB0aW9uICAgICAgICAgICAqXHJcbiAgICAgICAgICAgKiBGaXJlZCBvbmNlIHRoZSB2aWV3IGlzICoqbG9hZGVkKiosICphZnRlciogdGhlIERPTSBpcyByZW5kZXJlZC5cclxuICAgICAgICAgICAqXHJcbiAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgRXZlbnQgb2JqZWN0LlxyXG4gICAgICAgICAgICovXHJcbiAgICAgICAgICBjdXJyZW50U2NvcGUuJGVtaXQoJyR2aWV3Q29udGVudExvYWRlZCcpO1xyXG4gICAgICAgICAgY3VycmVudFNjb3BlLiRldmFsKG9ubG9hZEV4cCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHJldHVybiBkaXJlY3RpdmU7XHJcbn1cclxuXHJcbiRWaWV3RGlyZWN0aXZlRmlsbC4kaW5qZWN0ID0gWyckY29tcGlsZScsICckY29udHJvbGxlcicsICckc3RhdGUnLCAnJGludGVycG9sYXRlJ107XHJcbmZ1bmN0aW9uICRWaWV3RGlyZWN0aXZlRmlsbCAoICAkY29tcGlsZSwgICAkY29udHJvbGxlciwgICAkc3RhdGUsICAgJGludGVycG9sYXRlKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRUNBJyxcclxuICAgIHByaW9yaXR5OiAtNDAwLFxyXG4gICAgY29tcGlsZTogZnVuY3Rpb24gKHRFbGVtZW50KSB7XHJcbiAgICAgIHZhciBpbml0aWFsID0gdEVsZW1lbnQuaHRtbCgpO1xyXG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHNjb3BlLCAkZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICB2YXIgY3VycmVudCA9ICRzdGF0ZS4kY3VycmVudCxcclxuICAgICAgICAgICAgbmFtZSA9IGdldFVpVmlld05hbWUoc2NvcGUsIGF0dHJzLCAkZWxlbWVudCwgJGludGVycG9sYXRlKSxcclxuICAgICAgICAgICAgbG9jYWxzICA9IGN1cnJlbnQgJiYgY3VycmVudC5sb2NhbHNbbmFtZV07XHJcblxyXG4gICAgICAgIGlmICghIGxvY2Fscykge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGVsZW1lbnQuZGF0YSgnJHVpVmlldycsIHsgbmFtZTogbmFtZSwgc3RhdGU6IGxvY2Fscy4kJHN0YXRlIH0pO1xyXG4gICAgICAgICRlbGVtZW50Lmh0bWwobG9jYWxzLiR0ZW1wbGF0ZSA/IGxvY2Fscy4kdGVtcGxhdGUgOiBpbml0aWFsKTtcclxuXHJcbiAgICAgICAgdmFyIGxpbmsgPSAkY29tcGlsZSgkZWxlbWVudC5jb250ZW50cygpKTtcclxuXHJcbiAgICAgICAgaWYgKGxvY2Fscy4kJGNvbnRyb2xsZXIpIHtcclxuICAgICAgICAgIGxvY2Fscy4kc2NvcGUgPSBzY29wZTtcclxuICAgICAgICAgIHZhciBjb250cm9sbGVyID0gJGNvbnRyb2xsZXIobG9jYWxzLiQkY29udHJvbGxlciwgbG9jYWxzKTtcclxuICAgICAgICAgIGlmIChsb2NhbHMuJCRjb250cm9sbGVyQXMpIHtcclxuICAgICAgICAgICAgc2NvcGVbbG9jYWxzLiQkY29udHJvbGxlckFzXSA9IGNvbnRyb2xsZXI7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAkZWxlbWVudC5kYXRhKCckbmdDb250cm9sbGVyQ29udHJvbGxlcicsIGNvbnRyb2xsZXIpO1xyXG4gICAgICAgICAgJGVsZW1lbnQuY2hpbGRyZW4oKS5kYXRhKCckbmdDb250cm9sbGVyQ29udHJvbGxlcicsIGNvbnRyb2xsZXIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGluayhzY29wZSk7XHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNoYXJlZCB1aS12aWV3IGNvZGUgZm9yIGJvdGggZGlyZWN0aXZlczpcclxuICogR2l2ZW4gc2NvcGUsIGVsZW1lbnQsIGFuZCBpdHMgYXR0cmlidXRlcywgcmV0dXJuIHRoZSB2aWV3J3MgbmFtZVxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0VWlWaWV3TmFtZShzY29wZSwgYXR0cnMsIGVsZW1lbnQsICRpbnRlcnBvbGF0ZSkge1xyXG4gIHZhciBuYW1lID0gJGludGVycG9sYXRlKGF0dHJzLnVpVmlldyB8fCBhdHRycy5uYW1lIHx8ICcnKShzY29wZSk7XHJcbiAgdmFyIGluaGVyaXRlZCA9IGVsZW1lbnQuaW5oZXJpdGVkRGF0YSgnJHVpVmlldycpO1xyXG4gIHJldHVybiBuYW1lLmluZGV4T2YoJ0AnKSA+PSAwID8gIG5hbWUgOiAgKG5hbWUgKyAnQCcgKyAoaW5oZXJpdGVkID8gaW5oZXJpdGVkLnN0YXRlLm5hbWUgOiAnJykpO1xyXG59XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgndWkucm91dGVyLnN0YXRlJykuZGlyZWN0aXZlKCd1aVZpZXcnLCAkVmlld0RpcmVjdGl2ZSk7XHJcbmFuZ3VsYXIubW9kdWxlKCd1aS5yb3V0ZXIuc3RhdGUnKS5kaXJlY3RpdmUoJ3VpVmlldycsICRWaWV3RGlyZWN0aXZlRmlsbCk7XHJcblxyXG5mdW5jdGlvbiBwYXJzZVN0YXRlUmVmKHJlZiwgY3VycmVudCkge1xyXG4gIHZhciBwcmVwYXJzZWQgPSByZWYubWF0Y2goL15cXHMqKHtbXn1dKn0pXFxzKiQvKSwgcGFyc2VkO1xyXG4gIGlmIChwcmVwYXJzZWQpIHJlZiA9IGN1cnJlbnQgKyAnKCcgKyBwcmVwYXJzZWRbMV0gKyAnKSc7XHJcbiAgcGFyc2VkID0gcmVmLnJlcGxhY2UoL1xcbi9nLCBcIiBcIikubWF0Y2goL14oW14oXSs/KVxccyooXFwoKC4qKVxcKSk/JC8pO1xyXG4gIGlmICghcGFyc2VkIHx8IHBhcnNlZC5sZW5ndGggIT09IDQpIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgc3RhdGUgcmVmICdcIiArIHJlZiArIFwiJ1wiKTtcclxuICByZXR1cm4geyBzdGF0ZTogcGFyc2VkWzFdLCBwYXJhbUV4cHI6IHBhcnNlZFszXSB8fCBudWxsIH07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHN0YXRlQ29udGV4dChlbCkge1xyXG4gIHZhciBzdGF0ZURhdGEgPSBlbC5wYXJlbnQoKS5pbmhlcml0ZWREYXRhKCckdWlWaWV3Jyk7XHJcblxyXG4gIGlmIChzdGF0ZURhdGEgJiYgc3RhdGVEYXRhLnN0YXRlICYmIHN0YXRlRGF0YS5zdGF0ZS5uYW1lKSB7XHJcbiAgICByZXR1cm4gc3RhdGVEYXRhLnN0YXRlO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEBuZ2RvYyBkaXJlY3RpdmVcclxuICogQG5hbWUgdWkucm91dGVyLnN0YXRlLmRpcmVjdGl2ZTp1aS1zcmVmXHJcbiAqXHJcbiAqIEByZXF1aXJlcyB1aS5yb3V0ZXIuc3RhdGUuJHN0YXRlXHJcbiAqIEByZXF1aXJlcyAkdGltZW91dFxyXG4gKlxyXG4gKiBAcmVzdHJpY3QgQVxyXG4gKlxyXG4gKiBAZGVzY3JpcHRpb25cclxuICogQSBkaXJlY3RpdmUgdGhhdCBiaW5kcyBhIGxpbmsgKGA8YT5gIHRhZykgdG8gYSBzdGF0ZS4gSWYgdGhlIHN0YXRlIGhhcyBhbiBhc3NvY2lhdGVkIFxyXG4gKiBVUkwsIHRoZSBkaXJlY3RpdmUgd2lsbCBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlICYgdXBkYXRlIHRoZSBgaHJlZmAgYXR0cmlidXRlIHZpYSBcclxuICogdGhlIHtAbGluayB1aS5yb3V0ZXIuc3RhdGUuJHN0YXRlI21ldGhvZHNfaHJlZiAkc3RhdGUuaHJlZigpfSBtZXRob2QuIENsaWNraW5nIFxyXG4gKiB0aGUgbGluayB3aWxsIHRyaWdnZXIgYSBzdGF0ZSB0cmFuc2l0aW9uIHdpdGggb3B0aW9uYWwgcGFyYW1ldGVycy4gXHJcbiAqXHJcbiAqIEFsc28gbWlkZGxlLWNsaWNraW5nLCByaWdodC1jbGlja2luZywgYW5kIGN0cmwtY2xpY2tpbmcgb24gdGhlIGxpbmsgd2lsbCBiZSBcclxuICogaGFuZGxlZCBuYXRpdmVseSBieSB0aGUgYnJvd3Nlci5cclxuICpcclxuICogWW91IGNhbiBhbHNvIHVzZSByZWxhdGl2ZSBzdGF0ZSBwYXRocyB3aXRoaW4gdWktc3JlZiwganVzdCBsaWtlIHRoZSByZWxhdGl2ZSBcclxuICogcGF0aHMgcGFzc2VkIHRvIGAkc3RhdGUuZ28oKWAuIFlvdSBqdXN0IG5lZWQgdG8gYmUgYXdhcmUgdGhhdCB0aGUgcGF0aCBpcyByZWxhdGl2ZVxyXG4gKiB0byB0aGUgc3RhdGUgdGhhdCB0aGUgbGluayBsaXZlcyBpbiwgaW4gb3RoZXIgd29yZHMgdGhlIHN0YXRlIHRoYXQgbG9hZGVkIHRoZSBcclxuICogdGVtcGxhdGUgY29udGFpbmluZyB0aGUgbGluay5cclxuICpcclxuICogWW91IGNhbiBzcGVjaWZ5IG9wdGlvbnMgdG8gcGFzcyB0byB7QGxpbmsgdWkucm91dGVyLnN0YXRlLiRzdGF0ZSNnbyAkc3RhdGUuZ28oKX1cclxuICogdXNpbmcgdGhlIGB1aS1zcmVmLW9wdHNgIGF0dHJpYnV0ZS4gT3B0aW9ucyBhcmUgcmVzdHJpY3RlZCB0byBgbG9jYXRpb25gLCBgaW5oZXJpdGAsXHJcbiAqIGFuZCBgcmVsb2FkYC5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogSGVyZSdzIGFuIGV4YW1wbGUgb2YgaG93IHlvdSdkIHVzZSB1aS1zcmVmIGFuZCBob3cgaXQgd291bGQgY29tcGlsZS4gSWYgeW91IGhhdmUgdGhlIFxyXG4gKiBmb2xsb3dpbmcgdGVtcGxhdGU6XHJcbiAqIDxwcmU+XHJcbiAqIDxhIHVpLXNyZWY9XCJob21lXCI+SG9tZTwvYT4gfCA8YSB1aS1zcmVmPVwiYWJvdXRcIj5BYm91dDwvYT4gfCA8YSB1aS1zcmVmPVwie3BhZ2U6IDJ9XCI+TmV4dCBwYWdlPC9hPlxyXG4gKiBcclxuICogPHVsPlxyXG4gKiAgICAgPGxpIG5nLXJlcGVhdD1cImNvbnRhY3QgaW4gY29udGFjdHNcIj5cclxuICogICAgICAgICA8YSB1aS1zcmVmPVwiY29udGFjdHMuZGV0YWlsKHsgaWQ6IGNvbnRhY3QuaWQgfSlcIj57eyBjb250YWN0Lm5hbWUgfX08L2E+XHJcbiAqICAgICA8L2xpPlxyXG4gKiA8L3VsPlxyXG4gKiA8L3ByZT5cclxuICogXHJcbiAqIFRoZW4gdGhlIGNvbXBpbGVkIGh0bWwgd291bGQgYmUgKGFzc3VtaW5nIEh0bWw1TW9kZSBpcyBvZmYgYW5kIGN1cnJlbnQgc3RhdGUgaXMgY29udGFjdHMpOlxyXG4gKiA8cHJlPlxyXG4gKiA8YSBocmVmPVwiIy9ob21lXCIgdWktc3JlZj1cImhvbWVcIj5Ib21lPC9hPiB8IDxhIGhyZWY9XCIjL2Fib3V0XCIgdWktc3JlZj1cImFib3V0XCI+QWJvdXQ8L2E+IHwgPGEgaHJlZj1cIiMvY29udGFjdHM/cGFnZT0yXCIgdWktc3JlZj1cIntwYWdlOiAyfVwiPk5leHQgcGFnZTwvYT5cclxuICogXHJcbiAqIDx1bD5cclxuICogICAgIDxsaSBuZy1yZXBlYXQ9XCJjb250YWN0IGluIGNvbnRhY3RzXCI+XHJcbiAqICAgICAgICAgPGEgaHJlZj1cIiMvY29udGFjdHMvMVwiIHVpLXNyZWY9XCJjb250YWN0cy5kZXRhaWwoeyBpZDogY29udGFjdC5pZCB9KVwiPkpvZTwvYT5cclxuICogICAgIDwvbGk+XHJcbiAqICAgICA8bGkgbmctcmVwZWF0PVwiY29udGFjdCBpbiBjb250YWN0c1wiPlxyXG4gKiAgICAgICAgIDxhIGhyZWY9XCIjL2NvbnRhY3RzLzJcIiB1aS1zcmVmPVwiY29udGFjdHMuZGV0YWlsKHsgaWQ6IGNvbnRhY3QuaWQgfSlcIj5BbGljZTwvYT5cclxuICogICAgIDwvbGk+XHJcbiAqICAgICA8bGkgbmctcmVwZWF0PVwiY29udGFjdCBpbiBjb250YWN0c1wiPlxyXG4gKiAgICAgICAgIDxhIGhyZWY9XCIjL2NvbnRhY3RzLzNcIiB1aS1zcmVmPVwiY29udGFjdHMuZGV0YWlsKHsgaWQ6IGNvbnRhY3QuaWQgfSlcIj5Cb2I8L2E+XHJcbiAqICAgICA8L2xpPlxyXG4gKiA8L3VsPlxyXG4gKlxyXG4gKiA8YSB1aS1zcmVmPVwiaG9tZVwiIHVpLXNyZWYtb3B0cz1cIntyZWxvYWQ6IHRydWV9XCI+SG9tZTwvYT5cclxuICogPC9wcmU+XHJcbiAqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSB1aS1zcmVmICdzdGF0ZU5hbWUnIGNhbiBiZSBhbnkgdmFsaWQgYWJzb2x1dGUgb3IgcmVsYXRpdmUgc3RhdGVcclxuICogQHBhcmFtIHtPYmplY3R9IHVpLXNyZWYtb3B0cyBvcHRpb25zIHRvIHBhc3MgdG8ge0BsaW5rIHVpLnJvdXRlci5zdGF0ZS4kc3RhdGUjZ28gJHN0YXRlLmdvKCl9XHJcbiAqL1xyXG4kU3RhdGVSZWZEaXJlY3RpdmUuJGluamVjdCA9IFsnJHN0YXRlJywgJyR0aW1lb3V0J107XHJcbmZ1bmN0aW9uICRTdGF0ZVJlZkRpcmVjdGl2ZSgkc3RhdGUsICR0aW1lb3V0KSB7XHJcbiAgdmFyIGFsbG93ZWRPcHRpb25zID0gWydsb2NhdGlvbicsICdpbmhlcml0JywgJ3JlbG9hZCddO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgIHJlcXVpcmU6IFsnP151aVNyZWZBY3RpdmUnLCAnP151aVNyZWZBY3RpdmVFcSddLFxyXG4gICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCB1aVNyZWZBY3RpdmUpIHtcclxuICAgICAgdmFyIHJlZiA9IHBhcnNlU3RhdGVSZWYoYXR0cnMudWlTcmVmLCAkc3RhdGUuY3VycmVudC5uYW1lKTtcclxuICAgICAgdmFyIHBhcmFtcyA9IG51bGwsIHVybCA9IG51bGwsIGJhc2UgPSBzdGF0ZUNvbnRleHQoZWxlbWVudCkgfHwgJHN0YXRlLiRjdXJyZW50O1xyXG4gICAgICB2YXIgbmV3SHJlZiA9IG51bGwsIGlzQW5jaG9yID0gZWxlbWVudC5wcm9wKFwidGFnTmFtZVwiKSA9PT0gXCJBXCI7XHJcbiAgICAgIHZhciBpc0Zvcm0gPSBlbGVtZW50WzBdLm5vZGVOYW1lID09PSBcIkZPUk1cIjtcclxuICAgICAgdmFyIGF0dHIgPSBpc0Zvcm0gPyBcImFjdGlvblwiIDogXCJocmVmXCIsIG5hdiA9IHRydWU7XHJcblxyXG4gICAgICB2YXIgb3B0aW9ucyA9IHsgcmVsYXRpdmU6IGJhc2UsIGluaGVyaXQ6IHRydWUgfTtcclxuICAgICAgdmFyIG9wdGlvbnNPdmVycmlkZSA9IHNjb3BlLiRldmFsKGF0dHJzLnVpU3JlZk9wdHMpIHx8IHt9O1xyXG5cclxuICAgICAgYW5ndWxhci5mb3JFYWNoKGFsbG93ZWRPcHRpb25zLCBmdW5jdGlvbihvcHRpb24pIHtcclxuICAgICAgICBpZiAob3B0aW9uIGluIG9wdGlvbnNPdmVycmlkZSkge1xyXG4gICAgICAgICAgb3B0aW9uc1tvcHRpb25dID0gb3B0aW9uc092ZXJyaWRlW29wdGlvbl07XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHZhciB1cGRhdGUgPSBmdW5jdGlvbihuZXdWYWwpIHtcclxuICAgICAgICBpZiAobmV3VmFsKSBwYXJhbXMgPSBhbmd1bGFyLmNvcHkobmV3VmFsKTtcclxuICAgICAgICBpZiAoIW5hdikgcmV0dXJuO1xyXG5cclxuICAgICAgICBuZXdIcmVmID0gJHN0YXRlLmhyZWYocmVmLnN0YXRlLCBwYXJhbXMsIG9wdGlvbnMpO1xyXG5cclxuICAgICAgICB2YXIgYWN0aXZlRGlyZWN0aXZlID0gdWlTcmVmQWN0aXZlWzFdIHx8IHVpU3JlZkFjdGl2ZVswXTtcclxuICAgICAgICBpZiAoYWN0aXZlRGlyZWN0aXZlKSB7XHJcbiAgICAgICAgICBhY3RpdmVEaXJlY3RpdmUuJCRzZXRTdGF0ZUluZm8ocmVmLnN0YXRlLCBwYXJhbXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobmV3SHJlZiA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgbmF2ID0gZmFsc2U7XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGF0dHJzLiRzZXQoYXR0ciwgbmV3SHJlZik7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBpZiAocmVmLnBhcmFtRXhwcikge1xyXG4gICAgICAgIHNjb3BlLiR3YXRjaChyZWYucGFyYW1FeHByLCBmdW5jdGlvbihuZXdWYWwsIG9sZFZhbCkge1xyXG4gICAgICAgICAgaWYgKG5ld1ZhbCAhPT0gcGFyYW1zKSB1cGRhdGUobmV3VmFsKTtcclxuICAgICAgICB9LCB0cnVlKTtcclxuICAgICAgICBwYXJhbXMgPSBhbmd1bGFyLmNvcHkoc2NvcGUuJGV2YWwocmVmLnBhcmFtRXhwcikpO1xyXG4gICAgICB9XHJcbiAgICAgIHVwZGF0ZSgpO1xyXG5cclxuICAgICAgaWYgKGlzRm9ybSkgcmV0dXJuO1xyXG5cclxuICAgICAgZWxlbWVudC5iaW5kKFwiY2xpY2tcIiwgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgIHZhciBidXR0b24gPSBlLndoaWNoIHx8IGUuYnV0dG9uO1xyXG4gICAgICAgIGlmICggIShidXR0b24gPiAxIHx8IGUuY3RybEtleSB8fCBlLm1ldGFLZXkgfHwgZS5zaGlmdEtleSB8fCBlbGVtZW50LmF0dHIoJ3RhcmdldCcpKSApIHtcclxuICAgICAgICAgIC8vIEhBQ0s6IFRoaXMgaXMgdG8gYWxsb3cgbmctY2xpY2tzIHRvIGJlIHByb2Nlc3NlZCBiZWZvcmUgdGhlIHRyYW5zaXRpb24gaXMgaW5pdGlhdGVkOlxyXG4gICAgICAgICAgdmFyIHRyYW5zaXRpb24gPSAkdGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHN0YXRlLmdvKHJlZi5zdGF0ZSwgcGFyYW1zLCBvcHRpb25zKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgIC8vIGlmIHRoZSBzdGF0ZSBoYXMgbm8gVVJMLCBpZ25vcmUgb25lIHByZXZlbnREZWZhdWx0IGZyb20gdGhlIDxhPiBkaXJlY3RpdmUuXHJcbiAgICAgICAgICB2YXIgaWdub3JlUHJldmVudERlZmF1bHRDb3VudCA9IGlzQW5jaG9yICYmICFuZXdIcmVmID8gMTogMDtcclxuICAgICAgICAgIGUucHJldmVudERlZmF1bHQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKGlnbm9yZVByZXZlbnREZWZhdWx0Q291bnQtLSA8PSAwKVxyXG4gICAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbCh0cmFuc2l0aW9uKTtcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG59XHJcblxyXG4vKipcclxuICogQG5nZG9jIGRpcmVjdGl2ZVxyXG4gKiBAbmFtZSB1aS5yb3V0ZXIuc3RhdGUuZGlyZWN0aXZlOnVpLXNyZWYtYWN0aXZlXHJcbiAqXHJcbiAqIEByZXF1aXJlcyB1aS5yb3V0ZXIuc3RhdGUuJHN0YXRlXHJcbiAqIEByZXF1aXJlcyB1aS5yb3V0ZXIuc3RhdGUuJHN0YXRlUGFyYW1zXHJcbiAqIEByZXF1aXJlcyAkaW50ZXJwb2xhdGVcclxuICpcclxuICogQHJlc3RyaWN0IEFcclxuICpcclxuICogQGRlc2NyaXB0aW9uXHJcbiAqIEEgZGlyZWN0aXZlIHdvcmtpbmcgYWxvbmdzaWRlIHVpLXNyZWYgdG8gYWRkIGNsYXNzZXMgdG8gYW4gZWxlbWVudCB3aGVuIHRoZVxyXG4gKiByZWxhdGVkIHVpLXNyZWYgZGlyZWN0aXZlJ3Mgc3RhdGUgaXMgYWN0aXZlLCBhbmQgcmVtb3ZpbmcgdGhlbSB3aGVuIGl0IGlzIGluYWN0aXZlLlxyXG4gKiBUaGUgcHJpbWFyeSB1c2UtY2FzZSBpcyB0byBzaW1wbGlmeSB0aGUgc3BlY2lhbCBhcHBlYXJhbmNlIG9mIG5hdmlnYXRpb24gbWVudXNcclxuICogcmVseWluZyBvbiBgdWktc3JlZmAsIGJ5IGhhdmluZyB0aGUgXCJhY3RpdmVcIiBzdGF0ZSdzIG1lbnUgYnV0dG9uIGFwcGVhciBkaWZmZXJlbnQsXHJcbiAqIGRpc3Rpbmd1aXNoaW5nIGl0IGZyb20gdGhlIGluYWN0aXZlIG1lbnUgaXRlbXMuXHJcbiAqXHJcbiAqIHVpLXNyZWYtYWN0aXZlIGNhbiBsaXZlIG9uIHRoZSBzYW1lIGVsZW1lbnQgYXMgdWktc3JlZiBvciBvbiBhIHBhcmVudCBlbGVtZW50LiBUaGUgZmlyc3RcclxuICogdWktc3JlZi1hY3RpdmUgZm91bmQgYXQgdGhlIHNhbWUgbGV2ZWwgb3IgYWJvdmUgdGhlIHVpLXNyZWYgd2lsbCBiZSB1c2VkLlxyXG4gKlxyXG4gKiBXaWxsIGFjdGl2YXRlIHdoZW4gdGhlIHVpLXNyZWYncyB0YXJnZXQgc3RhdGUgb3IgYW55IGNoaWxkIHN0YXRlIGlzIGFjdGl2ZS4gSWYgeW91XHJcbiAqIG5lZWQgdG8gYWN0aXZhdGUgb25seSB3aGVuIHRoZSB1aS1zcmVmIHRhcmdldCBzdGF0ZSBpcyBhY3RpdmUgYW5kICpub3QqIGFueSBvZlxyXG4gKiBpdCdzIGNoaWxkcmVuLCB0aGVuIHlvdSB3aWxsIHVzZVxyXG4gKiB7QGxpbmsgdWkucm91dGVyLnN0YXRlLmRpcmVjdGl2ZTp1aS1zcmVmLWFjdGl2ZS1lcSB1aS1zcmVmLWFjdGl2ZS1lcX1cclxuICpcclxuICogQGV4YW1wbGVcclxuICogR2l2ZW4gdGhlIGZvbGxvd2luZyB0ZW1wbGF0ZTpcclxuICogPHByZT5cclxuICogPHVsPlxyXG4gKiAgIDxsaSB1aS1zcmVmLWFjdGl2ZT1cImFjdGl2ZVwiIGNsYXNzPVwiaXRlbVwiPlxyXG4gKiAgICAgPGEgaHJlZiB1aS1zcmVmPVwiYXBwLnVzZXIoe3VzZXI6ICdiaWxib2JhZ2dpbnMnfSlcIj5AYmlsYm9iYWdnaW5zPC9hPlxyXG4gKiAgIDwvbGk+XHJcbiAqIDwvdWw+XHJcbiAqIDwvcHJlPlxyXG4gKlxyXG4gKlxyXG4gKiBXaGVuIHRoZSBhcHAgc3RhdGUgaXMgXCJhcHAudXNlclwiIChvciBhbnkgY2hpbGRyZW4gc3RhdGVzKSwgYW5kIGNvbnRhaW5zIHRoZSBzdGF0ZSBwYXJhbWV0ZXIgXCJ1c2VyXCIgd2l0aCB2YWx1ZSBcImJpbGJvYmFnZ2luc1wiLFxyXG4gKiB0aGUgcmVzdWx0aW5nIEhUTUwgd2lsbCBhcHBlYXIgYXMgKG5vdGUgdGhlICdhY3RpdmUnIGNsYXNzKTpcclxuICogPHByZT5cclxuICogPHVsPlxyXG4gKiAgIDxsaSB1aS1zcmVmLWFjdGl2ZT1cImFjdGl2ZVwiIGNsYXNzPVwiaXRlbSBhY3RpdmVcIj5cclxuICogICAgIDxhIHVpLXNyZWY9XCJhcHAudXNlcih7dXNlcjogJ2JpbGJvYmFnZ2lucyd9KVwiIGhyZWY9XCIvdXNlcnMvYmlsYm9iYWdnaW5zXCI+QGJpbGJvYmFnZ2luczwvYT5cclxuICogICA8L2xpPlxyXG4gKiA8L3VsPlxyXG4gKiA8L3ByZT5cclxuICpcclxuICogVGhlIGNsYXNzIG5hbWUgaXMgaW50ZXJwb2xhdGVkICoqb25jZSoqIGR1cmluZyB0aGUgZGlyZWN0aXZlcyBsaW5rIHRpbWUgKGFueSBmdXJ0aGVyIGNoYW5nZXMgdG8gdGhlXHJcbiAqIGludGVycG9sYXRlZCB2YWx1ZSBhcmUgaWdub3JlZCkuXHJcbiAqXHJcbiAqIE11bHRpcGxlIGNsYXNzZXMgbWF5IGJlIHNwZWNpZmllZCBpbiBhIHNwYWNlLXNlcGFyYXRlZCBmb3JtYXQ6XHJcbiAqIDxwcmU+XHJcbiAqIDx1bD5cclxuICogICA8bGkgdWktc3JlZi1hY3RpdmU9J2NsYXNzMSBjbGFzczIgY2xhc3MzJz5cclxuICogICAgIDxhIHVpLXNyZWY9XCJhcHAudXNlclwiPmxpbms8L2E+XHJcbiAqICAgPC9saT5cclxuICogPC91bD5cclxuICogPC9wcmU+XHJcbiAqL1xyXG5cclxuLyoqXHJcbiAqIEBuZ2RvYyBkaXJlY3RpdmVcclxuICogQG5hbWUgdWkucm91dGVyLnN0YXRlLmRpcmVjdGl2ZTp1aS1zcmVmLWFjdGl2ZS1lcVxyXG4gKlxyXG4gKiBAcmVxdWlyZXMgdWkucm91dGVyLnN0YXRlLiRzdGF0ZVxyXG4gKiBAcmVxdWlyZXMgdWkucm91dGVyLnN0YXRlLiRzdGF0ZVBhcmFtc1xyXG4gKiBAcmVxdWlyZXMgJGludGVycG9sYXRlXHJcbiAqXHJcbiAqIEByZXN0cmljdCBBXHJcbiAqXHJcbiAqIEBkZXNjcmlwdGlvblxyXG4gKiBUaGUgc2FtZSBhcyB7QGxpbmsgdWkucm91dGVyLnN0YXRlLmRpcmVjdGl2ZTp1aS1zcmVmLWFjdGl2ZSB1aS1zcmVmLWFjdGl2ZX0gYnV0IHdpbGwgb25seSBhY3RpdmF0ZVxyXG4gKiB3aGVuIHRoZSBleGFjdCB0YXJnZXQgc3RhdGUgdXNlZCBpbiB0aGUgYHVpLXNyZWZgIGlzIGFjdGl2ZTsgbm8gY2hpbGQgc3RhdGVzLlxyXG4gKlxyXG4gKi9cclxuJFN0YXRlUmVmQWN0aXZlRGlyZWN0aXZlLiRpbmplY3QgPSBbJyRzdGF0ZScsICckc3RhdGVQYXJhbXMnLCAnJGludGVycG9sYXRlJ107XHJcbmZ1bmN0aW9uICRTdGF0ZVJlZkFjdGl2ZURpcmVjdGl2ZSgkc3RhdGUsICRzdGF0ZVBhcmFtcywgJGludGVycG9sYXRlKSB7XHJcbiAgcmV0dXJuICB7XHJcbiAgICByZXN0cmljdDogXCJBXCIsXHJcbiAgICBjb250cm9sbGVyOiBbJyRzY29wZScsICckZWxlbWVudCcsICckYXR0cnMnLCBmdW5jdGlvbiAoJHNjb3BlLCAkZWxlbWVudCwgJGF0dHJzKSB7XHJcbiAgICAgIHZhciBzdGF0ZSwgcGFyYW1zLCBhY3RpdmVDbGFzcztcclxuXHJcbiAgICAgIC8vIFRoZXJlIHByb2JhYmx5IGlzbid0IG11Y2ggcG9pbnQgaW4gJG9ic2VydmluZyB0aGlzXHJcbiAgICAgIC8vIHVpU3JlZkFjdGl2ZSBhbmQgdWlTcmVmQWN0aXZlRXEgc2hhcmUgdGhlIHNhbWUgZGlyZWN0aXZlIG9iamVjdCB3aXRoIHNvbWVcclxuICAgICAgLy8gc2xpZ2h0IGRpZmZlcmVuY2UgaW4gbG9naWMgcm91dGluZ1xyXG4gICAgICBhY3RpdmVDbGFzcyA9ICRpbnRlcnBvbGF0ZSgkYXR0cnMudWlTcmVmQWN0aXZlRXEgfHwgJGF0dHJzLnVpU3JlZkFjdGl2ZSB8fCAnJywgZmFsc2UpKCRzY29wZSk7XHJcblxyXG4gICAgICAvLyBBbGxvdyB1aVNyZWYgdG8gY29tbXVuaWNhdGUgd2l0aCB1aVNyZWZBY3RpdmVbRXF1YWxzXVxyXG4gICAgICB0aGlzLiQkc2V0U3RhdGVJbmZvID0gZnVuY3Rpb24gKG5ld1N0YXRlLCBuZXdQYXJhbXMpIHtcclxuICAgICAgICBzdGF0ZSA9ICRzdGF0ZS5nZXQobmV3U3RhdGUsIHN0YXRlQ29udGV4dCgkZWxlbWVudCkpO1xyXG4gICAgICAgIHBhcmFtcyA9IG5ld1BhcmFtcztcclxuICAgICAgICB1cGRhdGUoKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgICRzY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN1Y2Nlc3MnLCB1cGRhdGUpO1xyXG5cclxuICAgICAgLy8gVXBkYXRlIHJvdXRlIHN0YXRlXHJcbiAgICAgIGZ1bmN0aW9uIHVwZGF0ZSgpIHtcclxuICAgICAgICBpZiAoaXNNYXRjaCgpKSB7XHJcbiAgICAgICAgICAkZWxlbWVudC5hZGRDbGFzcyhhY3RpdmVDbGFzcyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICRlbGVtZW50LnJlbW92ZUNsYXNzKGFjdGl2ZUNsYXNzKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIGlzTWF0Y2goKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiAkYXR0cnMudWlTcmVmQWN0aXZlRXEgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICByZXR1cm4gc3RhdGUgJiYgJHN0YXRlLmlzKHN0YXRlLm5hbWUsIHBhcmFtcyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiBzdGF0ZSAmJiAkc3RhdGUuaW5jbHVkZXMoc3RhdGUubmFtZSwgcGFyYW1zKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1dXHJcbiAgfTtcclxufVxyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3VpLnJvdXRlci5zdGF0ZScpXHJcbiAgLmRpcmVjdGl2ZSgndWlTcmVmJywgJFN0YXRlUmVmRGlyZWN0aXZlKVxyXG4gIC5kaXJlY3RpdmUoJ3VpU3JlZkFjdGl2ZScsICRTdGF0ZVJlZkFjdGl2ZURpcmVjdGl2ZSlcclxuICAuZGlyZWN0aXZlKCd1aVNyZWZBY3RpdmVFcScsICRTdGF0ZVJlZkFjdGl2ZURpcmVjdGl2ZSk7XHJcblxyXG4vKipcclxuICogQG5nZG9jIGZpbHRlclxyXG4gKiBAbmFtZSB1aS5yb3V0ZXIuc3RhdGUuZmlsdGVyOmlzU3RhdGVcclxuICpcclxuICogQHJlcXVpcmVzIHVpLnJvdXRlci5zdGF0ZS4kc3RhdGVcclxuICpcclxuICogQGRlc2NyaXB0aW9uXHJcbiAqIFRyYW5zbGF0ZXMgdG8ge0BsaW5rIHVpLnJvdXRlci5zdGF0ZS4kc3RhdGUjbWV0aG9kc19pcyAkc3RhdGUuaXMoXCJzdGF0ZU5hbWVcIil9LlxyXG4gKi9cclxuJElzU3RhdGVGaWx0ZXIuJGluamVjdCA9IFsnJHN0YXRlJ107XHJcbmZ1bmN0aW9uICRJc1N0YXRlRmlsdGVyKCRzdGF0ZSkge1xyXG4gIHZhciBpc0ZpbHRlciA9IGZ1bmN0aW9uIChzdGF0ZSkge1xyXG4gICAgcmV0dXJuICRzdGF0ZS5pcyhzdGF0ZSk7XHJcbiAgfTtcclxuICBpc0ZpbHRlci4kc3RhdGVmdWwgPSB0cnVlO1xyXG4gIHJldHVybiBpc0ZpbHRlcjtcclxufVxyXG5cclxuLyoqXHJcbiAqIEBuZ2RvYyBmaWx0ZXJcclxuICogQG5hbWUgdWkucm91dGVyLnN0YXRlLmZpbHRlcjppbmNsdWRlZEJ5U3RhdGVcclxuICpcclxuICogQHJlcXVpcmVzIHVpLnJvdXRlci5zdGF0ZS4kc3RhdGVcclxuICpcclxuICogQGRlc2NyaXB0aW9uXHJcbiAqIFRyYW5zbGF0ZXMgdG8ge0BsaW5rIHVpLnJvdXRlci5zdGF0ZS4kc3RhdGUjbWV0aG9kc19pbmNsdWRlcyAkc3RhdGUuaW5jbHVkZXMoJ2Z1bGxPclBhcnRpYWxTdGF0ZU5hbWUnKX0uXHJcbiAqL1xyXG4kSW5jbHVkZWRCeVN0YXRlRmlsdGVyLiRpbmplY3QgPSBbJyRzdGF0ZSddO1xyXG5mdW5jdGlvbiAkSW5jbHVkZWRCeVN0YXRlRmlsdGVyKCRzdGF0ZSkge1xyXG4gIHZhciBpbmNsdWRlc0ZpbHRlciA9IGZ1bmN0aW9uIChzdGF0ZSkge1xyXG4gICAgcmV0dXJuICRzdGF0ZS5pbmNsdWRlcyhzdGF0ZSk7XHJcbiAgfTtcclxuICBpbmNsdWRlc0ZpbHRlci4kc3RhdGVmdWwgPSB0cnVlO1xyXG4gIHJldHVybiAgaW5jbHVkZXNGaWx0ZXI7XHJcbn1cclxuXHJcbmFuZ3VsYXIubW9kdWxlKCd1aS5yb3V0ZXIuc3RhdGUnKVxyXG4gIC5maWx0ZXIoJ2lzU3RhdGUnLCAkSXNTdGF0ZUZpbHRlcilcclxuICAuZmlsdGVyKCdpbmNsdWRlZEJ5U3RhdGUnLCAkSW5jbHVkZWRCeVN0YXRlRmlsdGVyKTtcclxufSkod2luZG93LCB3aW5kb3cuYW5ndWxhcik7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuLypyZXF1aXJlKCcuL3RocmlmdC5qcycpO1xyXG5yZXF1aXJlKCcuLi8uLi9nZW4tanMvYmVkYXRhX3R5cGVzLmpzJyk7XHJcbnJlcXVpcmUoJy4uLy4uL2dlbi1qcy9tZXNzYWdlc2VydmljZV90eXBlcy5qcycpO1xyXG5yZXF1aXJlKCcuLi8uLi9nZW4tanMvTWVzc2FnZVNlcnZpY2UuanMnKTtcclxucmVxdWlyZSgnLi4vLi4vZ2VuLWpzL0RpYWxvZ1NlcnZpY2UuanMnKTtcclxucmVxdWlyZSgnLi4vLi4vZ2VuLWpzL3VzZXJzZXJ2aWNlX3R5cGVzLmpzJyk7XHJcbnJlcXVpcmUoJy4uLy4uL2dlbi1qcy9Vc2VyU2VydmljZS5qcycpO1xyXG5yZXF1aXJlKCcuLi8uLi9nZW4tanMvYXV0aHNlcnZpY2VfdHlwZXMuanMnKTtcclxucmVxdWlyZSgnLi4vLi4vZ2VuLWpzL0F1dGhTZXJ2aWNlLmpzJyk7XHJcbnJlcXVpcmUoJy4uLy4uL2dlbi1qcy91dGlsaXR5c2VydmNlc190eXBlcy5qcycpO1xyXG5yZXF1aXJlKCcuLi8uLi9nZW4tanMvVXRpbGl0eVNlcnZpY2UuanMnKTtcclxucmVxdWlyZSgnLi4vLi4vZ2VuLWpzL2ZpbGV1dGlsc190eXBlcy5qcycpO1xyXG5yZXF1aXJlKCcuLi8uLi9nZW4tanMvRmlsZVNlcnZpY2UuanMnKTtcclxucmVxdWlyZSgnLi4vLi4vZ2VuLWpzL2J1c2luZXNzX3R5cGVzLmpzJyk7XHJcbnJlcXVpcmUoJy4uLy4uL2dlbi1qcy9CdXNpbmVzc1NlcnZpY2UuanMnKTsqL1xyXG5cclxucmVxdWlyZSgnYW5ndWxhci11aS1yb3V0ZXInKTtcclxucmVxdWlyZSgnYW5ndWxhci1maWxlLXVwbG9hZCcpO1xyXG5cclxucmVxdWlyZSgnLi9kaXJlY3RpdmVzLmpzJyk7XHJcbnJlcXVpcmUoJy4vc2VydmljZXMnKTtcclxucmVxdWlyZSgnLi9jb250cm9sbGVycycpO1xyXG5cclxudmFyIG1haW4gPSBhbmd1bGFyLm1vZHVsZSgnZm9ydW0nLCBbXHJcbiAgLy8nbmdSb3V0ZScsXHJcbiAgJ3VpLnJvdXRlcicsXHJcbiAgJ2FuZ3VsYXJGaWxlVXBsb2FkJyxcclxuIC8qICdmb3J1bS5maWx0ZXJzJywqL1xyXG4gICdmb3J1bS5zZXJ2aWNlcycsXHJcbiAgJ2ZvcnVtLmRpcmVjdGl2ZXMnLFxyXG4gIC8vJ2ZvcnVtLmNvbnRyb2xsZXJzJyxcclxuICAnVk9Db250cm9sbGVycydcclxuXSlcclxuICAgIC5jb25maWcocmVxdWlyZSgnLi9jb25maWcnKSk7XHJcblxyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG52YXIgY29uZmlnID0gZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlciwkbG9jYXRpb25Qcm92aWRlcikge1xyXG5cclxuICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoXCIvbWFpblwiKTtcclxuXHJcbiAgICAkc3RhdGVQcm92aWRlclxyXG4gICAgICAgIC5zdGF0ZSgnbWFpbicsIHtcclxuICAgICAgICAgICAgdXJsOiBcIi9tYWluXCIsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi9zdGF0aWMvcGFydGlhbHMvbWFpbi5odG1sXCIsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICd3YWxsQ3RybCBhcyBsZW50YSdcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5zdGF0ZSgnd2FsbC1zaW5nbGUnLCB7XHJcbiAgICAgICAgICAgIHVybDogXCIvd2FsbC1zaW5nbGUvOnRvcGljSWRcIixcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiL3N0YXRpYy9wYXJ0aWFscy93YWxsLXNpbmdsZS5odG1sXCIsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICd3YWxsU2luZ2xlQ3RybCBhcyB3YWxsU2luZ2xlJ1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnN0YXRlKCd0YWxrcycsIHtcclxuICAgICAgICAgICAgdXJsOiBcIi90YWxrc1wiLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIvc3RhdGljL3BhcnRpYWxzL3RhbGtzLmh0bWxcIixcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ3RhbGtzQ3RybCBhcyB0YWxrcydcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5zdGF0ZSgndGFsa3Mtc2luZ2xlJywge1xyXG4gICAgICAgICAgICB1cmw6IFwiL3RhbGtzLXNpbmdsZS86dGFsa0lkXCIsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi9zdGF0aWMvcGFydGlhbHMvdGFsa3Mtc2luZ2xlLmh0bWxcIixcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ3RhbGtzU2luZ2xlQ3RybCBhcyB0YWxrcydcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5zdGF0ZSgncHJvZml0Jywge1xyXG4gICAgICAgICAgICB1cmw6IFwiL3Byb2ZpdFwiLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIvc3RhdGljL3BhcnRpYWxzL3Byb2ZpdC5odG1sXCIsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhZHZlcnRzQ3RybCBhcyBhZHZlcnRzJ1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnN0YXRlKCdwcm9maXQtc2luZ2xlJywge1xyXG4gICAgICAgICAgICB1cmw6IFwiL3Byb2ZpdC1zaW5nbGUvOmFkdmVydElkXCIsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi9zdGF0aWMvcGFydGlhbHMvcHJvZml0LXNpbmdsZS5odG1sXCIsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhZHZlcnRzU2luZ2xlQ3RybCBhcyBhZHZlcnRzJ1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnN0YXRlKCdkaWFsb2dzJywge1xyXG4gICAgICAgICAgICB1cmw6IFwiL2RpYWxvZ3NcIixcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiL3N0YXRpYy9wYXJ0aWFscy9kaWFsb2dzLmh0bWxcIixcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2RpYWxvZ3NDdHJsIGFzIGRpYWxvZ3MnXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc3RhdGUoJ2RpYWxvZy1zaW5nbGUnLCB7XHJcbiAgICAgICAgICAgIHVybDogXCIvZGlhbG9nLXNpbmdsZS86ZGlhbG9nSWRcIixcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiL3N0YXRpYy9wYXJ0aWFscy9kaWFsb2ctc2luZ2xlLmh0bWxcIixcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2RpYWxvZ0N0cmwgYXMgZGlhbG9nJ1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnN0YXRlKCduZWlnaGJvdXJzJywge1xyXG4gICAgICAgICAgICB1cmw6IFwiL25laWdoYm91cnNcIixcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiL3N0YXRpYy9wYXJ0aWFscy9uZWlnaGJvdXJzLmh0bWxcIixcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ25laWdoYm91cnNDdHJsIGFzIG5laWdoYm91cnMnXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc3RhdGUoJ3Byb2ZpbGUnLCB7XHJcbiAgICAgICAgICAgIHVybDogXCIvcHJvZmlsZS86dXNlcklkXCIsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi9zdGF0aWMvcGFydGlhbHMvcHJvZmlsZS5odG1sXCIsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdwcm9maWxlQ3RybCBhcyBwcm9maWxlJ1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnN0YXRlKCdwcm9maWxlLmNoYW5nZS1hdmF0YXInLCB7XHJcbiAgICAgICAgICAgIHVybDogXCIvY2hhbmdlLWF2YXRhclwiLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIvc3RhdGljL3BhcnRpYWxzL3Byb2ZpbGUuY2hhbmdlQXZhdGFyLmh0bWxcIixcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2NoYW5nZUF2YXRhckN0cmwgYXMgY2hhbmdlQXZhdGFyJ1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnN0YXRlKCdzZXR0aW5ncycsIHtcclxuICAgICAgICAgICAgdXJsOiBcIi9zZXR0aW5nc1wiLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIvc3RhdGljL3BhcnRpYWxzL3NldHRpbmdzLmh0bWxcIixcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ3NldHRpbmdzQ3RybCBhcyBzZXR0aW5ncydcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5zdGF0ZSgnbWFwcycsIHtcclxuICAgICAgICAgICAgdXJsOiBcIi9tYXBzXCIsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi9zdGF0aWMvcGFydGlhbHMvbWFwcy5odG1sXCIsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdtYXBzQ3RybCBhcyBtYXBzJ1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnN0YXRlKCdzZXQtaW5mbycsIHtcclxuICAgICAgICAgICAgdXJsOiBcIi9zZXQtaW5mb1wiLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIvc3RhdGljL3BhcnRpYWxzL3NldC1pbmZvLmh0bWxcIixcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ3NldEluZm9DdHJsIGFzIHNldEluZm8nXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc3RhdGUoJ2NvdW50ZXJzJywge1xyXG4gICAgICAgICAgICB1cmw6IFwiL2NvdW50ZXJzXCIsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi9zdGF0aWMvcGFydGlhbHMvY291bnRlcnMuaHRtbFwiLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnY291bnRlcnNDdHJsIGFzIGNvdW50ZXJzJ1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnN0YXRlKCdjb3VudGVycy1oaXN0b3J5Jywge1xyXG4gICAgICAgICAgICB1cmw6IFwiL2NvdW50ZXJzLWhpc3RvcnkvOmNvdW50ZXJJZFwiLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIvc3RhdGljL3BhcnRpYWxzL2NvdW50ZXJzLWhpc3RvcnkuaHRtbFwiLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnY291bnRlcnNIaXN0b3J5Q3RybCBhcyBjb3VudGVyc0hpc3RvcnknXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc3RhdGUoJ2ltcG9ydGFudCcsIHtcclxuICAgICAgICAgICAgdXJsOiBcIi9pbXBvcnRhbnRcIixcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiL3N0YXRpYy9wYXJ0aWFscy9pbXBvcnRhbnQuaHRtbFwiLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnaW1wb3J0YW50Q3RybCBhcyBpbXBvcnRhbnQnXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc3RhdGUoJ25lYXJieScsIHtcclxuICAgICAgICAgICAgdXJsOiBcIi9uZWFyYnlcIixcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiL3N0YXRpYy9wYXJ0aWFscy9uZWFyYnkuaHRtbFwiLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnbmVhcmJ5Q3RybCBhcyBuZWFyYnknXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc3RhdGUoJ25lYXJieS1zaW5nbGUnLCB7XHJcbiAgICAgICAgICAgIHVybDogXCIvbmVhcmJ5LXNpbmdsZS86bmVhcmJ5SWRcIixcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiL3N0YXRpYy9wYXJ0aWFscy9uZWFyYnktc2luZ2xlLmh0bWxcIixcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ25lYXJieVNpbmdsZUN0cmwgYXMgbmVhcmJ5J1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnN0YXRlKCdydWJyaWNzJywge1xyXG4gICAgICAgICAgICB1cmw6IFwiL3J1YnJpY3MvOnJ1YnJpY0lkXCIsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi9zdGF0aWMvcGFydGlhbHMvcnVicmljcy5odG1sXCIsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdydWJyaWNzQ3RybCBhcyB0YWxrcydcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5zdGF0ZSgncnVicmljcy1zaW5nbGUnLCB7XHJcbiAgICAgICAgICAgIHVybDogXCIvcnVicmljLXNpbmdsZS86cnVicmljSWRcIixcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiL3N0YXRpYy9wYXJ0aWFscy9ydWJyaWNzLXNpbmdsZS5odG1sXCIsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdydWJyaWNzU2luZ2xlQ3RybCBhcyB0YWxrcydcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5zdGF0ZSgnYmxvZycsIHtcclxuICAgICAgICAgICAgdXJsOiBcIi9ibG9nXCJcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5zdGF0ZSgnYWJvdXQnLCB7XHJcbiAgICAgICAgICAgIHVybDogXCIvYWJvdXRcIlxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnN0YXRlKCdjb250YWN0cycsIHtcclxuICAgICAgICAgICAgdXJsOiBcIi9jb250YWN0c1wiXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc3RhdGUoJ2NhYmluZXQnLCB7XHJcbiAgICAgICAgICAgIHVybDogXCIvY2FiaW5ldFwiLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIvc3RhdGljL3BhcnRpYWxzL2J1c2luZXNzL2NhYmluZXQuaHRtbFwiLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnY2FiaW5ldEN0cmwgYXMgbmVhcmJ5J1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnN0YXRlKCdlZGl0Jywge1xyXG4gICAgICAgICAgICB1cmw6IFwiL2VkaXRcIixcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiL3N0YXRpYy9wYXJ0aWFscy9idXNpbmVzcy9lZGl0Lmh0bWxcIixcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2VkaXRDdHJsIGFzIGVkaXQnXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc3RhdGUoJ3N0YXRpc3RpYycsIHtcclxuICAgICAgICAgICAgdXJsOiBcIi9zdGF0aXN0aWNcIixcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiL3N0YXRpYy9wYXJ0aWFscy9idXNpbmVzcy9zdGF0aXN0aWMuaHRtbFwiLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnc3RhdGlzdGljQ3RybCBhcyBtYXBzJ1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gWyAnJHN0YXRlUHJvdmlkZXInLCckdXJsUm91dGVyUHJvdmlkZXInLCckbG9jYXRpb25Qcm92aWRlcicsIGNvbmZpZyBdO1xyXG5cclxuLyptYWluLmNvbmZpZyhmdW5jdGlvbigkbG9jYXRpb25Qcm92aWRlcil7XHJcbiAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XHJcbn0pOyovXHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbnZhciBhYm91dEN0cmwgPSBmdW5jdGlvbigkcm9vdFNjb3BlKSB7XHJcblxyXG4gICAgJHJvb3RTY29wZS5iYXNlLmlzRm9vdGVyQm90dG9tID0gdHJ1ZTtcclxuXHJcbiAgICAkKCcubmctY2xvYWsnKS5yZW1vdmVDbGFzcygnbmctY2xvYWsnKTtcclxuXHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFsgJyRyb290U2NvcGUnLCBhYm91dEN0cmwgXTsiLCJcclxudmFyIGFkdmVydHNDdHJsID0gZnVuY3Rpb24oJHJvb3RTY29wZSwkYykge1xyXG4gICAgICAgIHZhciBhZHZlcnRzID0gdGhpcztcclxuXHJcbiAgICAgICAgYWR2ZXJ0cy5hdHRhY2hJZCA9IFwiMDAwMDBcIjtcclxuICAgICAgICAkcm9vdFNjb3BlLnNldFRhYigzKTtcclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2Uuc2hvd0FsbEdyb3VwcygpO1xyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5pc0Zvb3RlckJvdHRvbSA9IGZhbHNlO1xyXG4gICAgICAgICRjLnNob3dHcm91cE92ZXJCdWlsZGluZygkcm9vdFNjb3BlLmdyb3Vwcyk7XHJcblxyXG4gICAgICAgIC8qaWYoISRyb290U2NvcGUuaW1wb3J0YW50SXNMb2FkZWRGcm9tVG9wKVxyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmltcG9ydGFudFRvcGljcyA9IG1lc3NhZ2VDbGllbnQuZ2V0SW1wb3J0YW50TmV3cygkcm9vdFNjb3BlLmN1cnJlbnRHcm91cC5pZCk7XHJcbiAgICAgICAgJHJvb3RTY29wZS5pbXBvcnRhbnRJc0xvYWRlZEZyb21Ub3AgPSBmYWxzZTsqL1xyXG5cclxuICAgICAgICAvKmluaXRBdHRhY2hJbWFnZSgkKCcjYXR0YWNoSW1hZ2UtMDAwMDAnKSwgJCgnI2F0dGFjaC1hcmVhLTAwMDAwJykpOyAvLyDQtNC70Y8g0L7QsdGB0YPQttC00LXQvdC40LlcclxuICAgICAgICBpbml0QXR0YWNoRG9jKCQoJyNhdHRhY2hEb2MtMDAwMDAnKSwgJCgnI2F0dGFjaC1kb2MtYXJlYS0wMDAwMCcpKTsgLy8g0LTQu9GPINC+0LHRgdGD0LbQtNC10L3QuNC5Ki9cclxuICAgICAgICAkYy5pbml0RmFuY3lCb3goJCgnLmFkdmVydHMnKSk7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5jcmVhdGVUb3BpY0lzSGlkZSA9IHRydWU7XHJcbiAgICAgICAgYWR2ZXJ0cy5pc0FkdmVydHNMb2FkZWQgPSBmYWxzZTtcclxuICAgICAgICBhZHZlcnRzLmdyb3VwcyA9ICRjLnVzZXJDbGllbnRHcm91cHM7XHJcblxyXG4gICAgICAgIGFkdmVydHMuaXNUYWxrID0gdHJ1ZTtcclxuICAgICAgICBhZHZlcnRzLmlzQWR2ZXJ0ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgYWR2ZXJ0cy5tZXNzYWdlID0ge307XHJcbiAgICAgICAgYWR2ZXJ0cy5tZXNzYWdlLmNvbnRlbnQgPSBhZHZlcnRzLm1lc3NhZ2UuZGVmYXVsdCA9ICRjLlRFWFRfREVGQVVMVF8zO1xyXG4gICAgICAgIGFkdmVydHMuc3ViamVjdCA9ICRjLlRFWFRfREVGQVVMVF80O1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UuYnVmZmVyU2VsZWN0ZWRHcm91cCA9IGFkdmVydHMuc2VsZWN0ZWRHcm91cCA9XHJcbiAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50R3JvdXAgPSAkYy51c2VyQ2xpZW50R3JvdXBzWzNdO1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRSdWJyaWMgPSBudWxsO1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UuaW5pdFN0YXJ0UGFyYW1zRm9yQ3JlYXRlVG9waWMoYWR2ZXJ0cyk7XHJcblxyXG4gICAgICAgIGFkdmVydHMuYW5zd2VyRmlyc3RNZXNzYWdlID0gJGMuVEVYVF9ERUZBVUxUXzI7XHJcblxyXG4gICAgICAgIGFkdmVydHMudG9waWNzID0gJGMubWVzc2FnZUNsaWVudC5nZXRBZHZlcnRzKGFkdmVydHMuc2VsZWN0ZWRHcm91cC5pZCwgMCwgMTAwMCkudG9waWNzO1xyXG5cclxuICAgICAgICBpbml0QWR2ZXJ0cygpO1xyXG5cclxuICAgICAgICBpZiAoIWFkdmVydHMudG9waWNzKSBhZHZlcnRzLnRvcGljcyA9IFtdO1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLnNlbGVjdEdyb3VwSW5Ecm9wZG93bl9hZHZlcnRzID0gZnVuY3Rpb24oZ3JvdXBJZCl7XHJcbiAgICAgICAgICAgIGFkdmVydHMuc2VsZWN0ZWRHcm91cCA9ICRyb290U2NvcGUuYmFzZS5idWZmZXJTZWxlY3RlZEdyb3VwID0gJGMuc2VsZWN0R3JvdXBJbkRyb3Bkb3duKGdyb3VwSWQpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGluaXRBZHZlcnRzKCl7XHJcbiAgICAgICAgICAgIHZhciB0b3BpY0xlbmd0aDtcclxuICAgICAgICAgICAgYWR2ZXJ0cy50b3BpY3MgPyB0b3BpY0xlbmd0aCA9IGFkdmVydHMudG9waWNzLmxlbmd0aCA6IHRvcGljTGVuZ3RoID0gMDtcclxuXHJcbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB0b3BpY0xlbmd0aDtpKyspe1xyXG4gICAgICAgICAgICAgICAgYWR2ZXJ0cy50b3BpY3NbaV0ubGFzdFVwZGF0ZUVkaXQgPSAkYy5nZXRUaW1pbmcoYWR2ZXJ0cy50b3BpY3NbaV0ubGFzdFVwZGF0ZSk7XHJcbiAgICAgICAgICAgICAgICBhZHZlcnRzLnRvcGljc1tpXS5sYWJlbCA9ICRjLmdldExhYmVsKGFkdmVydHMuZ3JvdXBzLGFkdmVydHMudG9waWNzW2ldLmdyb3VwVHlwZSk7XHJcbiAgICAgICAgICAgICAgICBhZHZlcnRzLnRvcGljc1tpXS50YWdDb2xvciA9ICRjLmdldFRhZ0NvbG9yKGFkdmVydHMudG9waWNzW2ldLmxhYmVsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS5hZHZlcnRzQ2hhbmdlR3JvdXAgPSBmdW5jdGlvbihncm91cElkKXtcclxuXHJcbiAgICAgICAgICAgIGFkdmVydHMudG9waWNzID0gJGMubWVzc2FnZUNsaWVudC5nZXRBZHZlcnRzKGdyb3VwSWQsMCwxMDAwKS50b3BpY3M7XHJcblxyXG4gICAgICAgICAgICBpZihhZHZlcnRzLnRvcGljcykge1xyXG4gICAgICAgICAgICAgICAgaW5pdEFkdmVydHMoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLnNlbGVjdEdyb3VwKCRjLmdldEJ1aWxkaW5nR3JvdXAoJHJvb3RTY29wZS5jdXJyZW50R3JvdXApKTtcclxuXHJcbiAgICAgICAgJCgnLm5nLWNsb2FrJykucmVtb3ZlQ2xhc3MoJ25nLWNsb2FrJyk7XHJcblxyXG4gICAgfTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gWyAnJHJvb3RTY29wZScsJyRjJywgYWR2ZXJ0c0N0cmwgXTsiLCJcclxudmFyIGFkdmVydHNTaW5nbGVDdHJsID0gZnVuY3Rpb24oJHJvb3RTY29wZSwkc3RhdGVQYXJhbXMsJGMpIHtcclxuICAgICAgICB2YXIgYWR2ZXJ0ID0gdGhpcyxcclxuICAgICAgICAgICAgZnVsbFRhbGtNZXNzYWdlc0xlbmd0aCxcclxuICAgICAgICAgICAgYWR2ZXJ0SWQgPSAkc3RhdGVQYXJhbXMuYWR2ZXJ0SWQ7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5pc0Zvb3RlckJvdHRvbSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UubGFzdExvYWRlZElkID0gMDtcclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UuaXNFYXJsaWVzdE1lc3NhZ2VzID0gZmFsc2U7XHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLmVuZE9mTG9hZGVkID0gZmFsc2U7XHJcblxyXG4gICAgICAgIC8qaWYoISRyb290U2NvcGUuaW1wb3J0YW50SXNMb2FkZWRGcm9tVG9wKVxyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmltcG9ydGFudFRvcGljcyA9IG1lc3NhZ2VDbGllbnQuZ2V0SW1wb3J0YW50TmV3cygkcm9vdFNjb3BlLmN1cnJlbnRHcm91cC5pZCk7XHJcbiAgICAgICAgJHJvb3RTY29wZS5pbXBvcnRhbnRJc0xvYWRlZEZyb21Ub3AgPSBmYWxzZTsqL1xyXG5cclxuICAgICAgICBhZHZlcnQuYXR0YWNoSWQgPSBcIjAwMDAwXCI7XHJcbiAgICAgICAgYWR2ZXJ0LnNlbGVjdGVkR3JvdXAgPSAkcm9vdFNjb3BlLmN1cnJlbnRHcm91cDtcclxuICAgICAgICBhZHZlcnQudG9waWNzID0gJGMubWVzc2FnZUNsaWVudC5nZXRBZHZlcnRzKGFkdmVydC5zZWxlY3RlZEdyb3VwLmlkLCAwLCAxMDAwKS50b3BpY3M7XHJcbiAgICAgICAgYWR2ZXJ0LmZ1bGxUYWxrVG9waWMgPSB7fTtcclxuICAgICAgICBhZHZlcnQuZnVsbFRhbGtNZXNzYWdlcyA9IHt9O1xyXG4gICAgICAgIGFkdmVydC5mdWxsVGFsa0ZpcnN0TWVzc2FnZXMgPSBbXTtcclxuICAgICAgICBhZHZlcnQuZ3JvdXBzID0gJGMudXNlckNsaWVudEdyb3VwcztcclxuXHJcbiAgICAgICAgYWR2ZXJ0LmlzVGFsayA9IHRydWU7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5pbml0U3RhcnRQYXJhbXNGb3JDcmVhdGVNZXNzYWdlKGFkdmVydCk7XHJcblxyXG4gICAgICAgIHZhciBzaG93RnVsbFRhbGsgPSBmdW5jdGlvbihhZHZlcnQsYWR2ZXJ0T3V0c2lkZUlkKXtcclxuXHJcbiAgICAgICAgICAgICRjLmluaXRGYW5jeUJveCgkKCcuYWR2ZXJ0cy1zaW5nbGUnKSk7XHJcbiAgICAgICAgICAgIHZhciB0b3BpY0xlbmd0aDtcclxuICAgICAgICAgICAgYWR2ZXJ0LnRvcGljcyA/IHRvcGljTGVuZ3RoID0gYWR2ZXJ0LnRvcGljcy5sZW5ndGggOiB0b3BpY0xlbmd0aCA9IDA7XHJcblxyXG4gICAgICAgICAgICB2YXIgYWR2ZXJ0SWQgPSBhZHZlcnRPdXRzaWRlSWQsXHJcbiAgICAgICAgICAgICAgICBmdWxsVGFsa0ZpcnN0TWVzc2FnZXNMZW5ndGg7XHJcbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB0b3BpY0xlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgICAgIGlmKGFkdmVydElkID09IGFkdmVydC50b3BpY3NbaV0uaWQpe1xyXG4gICAgICAgICAgICAgICAgICAgIGFkdmVydC5mdWxsVGFsa1RvcGljID0gYWR2ZXJ0LnRvcGljc1tpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmluaXRTdGFydFBhcmFtc0ZvckNyZWF0ZVRvcGljKGFkdmVydC5mdWxsVGFsa1RvcGljKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYWR2ZXJ0LmZ1bGxUYWxrVG9waWMuaXNUYWxrID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBhZHZlcnQuZnVsbFRhbGtUb3BpYy5pc0FkdmVydCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYWR2ZXJ0LmZ1bGxUYWxrVG9waWMubWVzc2FnZS5jcmVhdGVkRWRpdCA9ICRjLmdldFRpbWluZyhhZHZlcnQuZnVsbFRhbGtUb3BpYy5tZXNzYWdlLmNyZWF0ZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGFkdmVydC5mdWxsVGFsa1RvcGljLmxhYmVsID0gJGMuZ2V0TGFiZWwoYWR2ZXJ0Lmdyb3VwcyxhZHZlcnQuZnVsbFRhbGtUb3BpYy5ncm91cFR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGFkdmVydC5mdWxsVGFsa1RvcGljLnRhZ0NvbG9yID0gJGMuZ2V0VGFnQ29sb3IoYWR2ZXJ0LmZ1bGxUYWxrVG9waWMubGFiZWwpO1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihhZHZlcnQuZnVsbFRhbGtUb3BpYy5wb2xsICE9IG51bGwpe1xyXG4gICAgICAgICAgICAgICAgJGMuc2V0UG9sbEVkaXROYW1lcyhhZHZlcnQuZnVsbFRhbGtUb3BpYy5wb2xsKTtcclxuICAgICAgICAgICAgICAgIGFkdmVydC5mdWxsVGFsa1RvcGljLm1ldGFUeXBlID0gXCJwb2xsXCI7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgYWR2ZXJ0LmZ1bGxUYWxrVG9waWMubWV0YVR5cGUgPSBcIm1lc3NhZ2VcIjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgYWR2ZXJ0LmZ1bGxUYWxrRmlyc3RNZXNzYWdlcyA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0Rmlyc3RMZXZlbE1lc3NhZ2VzKGFkdmVydElkLGFkdmVydC5zZWxlY3RlZEdyb3VwLmlkLDYsJHJvb3RTY29wZS5iYXNlLmxhc3RMb2FkZWRJZCwwLDEwKS5tZXNzYWdlcztcclxuXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5sYXN0TG9hZGVkSWQgPSAkcm9vdFNjb3BlLmJhc2UuaW5pdEZpcnN0TWVzc2FnZXMoYWR2ZXJ0LmZ1bGxUYWxrRmlyc3RNZXNzYWdlcyk7XHJcblxyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UuaXNBZHZlcnRUaXRsZXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLm1haW5Db250ZW50VG9wSXNIaWRlID0gdHJ1ZTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmNyZWF0ZVRvcGljSXNIaWRlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5hZHZlcnQgPSBhZHZlcnQ7XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHNob3dGdWxsVGFsayhhZHZlcnQsYWR2ZXJ0SWQpO1xyXG5cclxuICAgICAgICB2YXIgaW5pdEZsYWdzVG9waWMgPSBbXTtcclxuICAgICAgICBhZHZlcnQuc2hvd1RvcGljQW5zd2VySW5wdXQgPSBmdW5jdGlvbihldmVudCxmdWxsVGFsa1RvcGljKXtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIGFkdmVydC5hbnN3ZXJTaG93ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIGlmKCFpbml0RmxhZ3NUb3BpY1tmdWxsVGFsa1RvcGljLmlkXSkge1xyXG4gICAgICAgICAgICAgICAvLyBpbml0QXR0YWNoSW1hZ2UoJCgnI2F0dGFjaEltYWdlLScgKyBmdWxsVGFsa1RvcGljLmlkKSwgJCgnI2F0dGFjaC1hcmVhLScgKyBmdWxsVGFsa1RvcGljLmlkKSk7XHJcbiAgICAgICAgICAgICAgICAvL2luaXRBdHRhY2hEb2MoJCgnI2F0dGFjaERvYy0nICsgZnVsbFRhbGtUb3BpYy5pZCksICQoJyNhdHRhY2gtZG9jLWFyZWEtJyArIGZ1bGxUYWxrVG9waWMuaWQpKTtcclxuICAgICAgICAgICAgICAgIGluaXRGbGFnc1RvcGljW2Z1bGxUYWxrVG9waWMuaWRdID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgYWR2ZXJ0LmZ1bGxUYWxrVG9waWMuYW5zd2VySW5wdXRJc1Nob3cgP1xyXG4gICAgICAgICAgICAgICAgYWR2ZXJ0LmZ1bGxUYWxrVG9waWMuYW5zd2VySW5wdXRJc1Nob3cgPSBmYWxzZSA6XHJcbiAgICAgICAgICAgICAgICBhZHZlcnQuZnVsbFRhbGtUb3BpYy5hbnN3ZXJJbnB1dElzU2hvdyA9IHRydWUgO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpbml0RmxhZ3NNZXNzYWdlID0gW107XHJcbiAgICAgICAgYWR2ZXJ0LnNob3dNZXNzYWdlQW5zd2VySW5wdXQgPSBmdW5jdGlvbihldmVudCxmdWxsVGFsa1RvcGljLGZpcnN0TWVzc2FnZSxtZXNzYWdlKXtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgdmFyIGF0dGFjaElkO1xyXG5cclxuICAgICAgICAgICAgaWYoIW1lc3NhZ2Upe1xyXG4gICAgICAgICAgICAgICAgLy8g0LXRgdC70Lgg0Y3RgtC+INGB0L7QvtCx0YnQtdC90LjQtSDQv9C10YDQstC+0LPQviDRg9GA0L7QstC90Y9cclxuICAgICAgICAgICAgICAgIGF0dGFjaElkID0gZnVsbFRhbGtUb3BpYy5pZCsnLScrZmlyc3RNZXNzYWdlLmlkO1xyXG5cclxuICAgICAgICAgICAgICAgIGZpcnN0TWVzc2FnZS5pc1RhbGsgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKCFhZHZlcnQuZnVsbGFkdmVydEZpcnN0TWVzc2FnZXMpIGFkdmVydC5mdWxsYWR2ZXJ0Rmlyc3RNZXNzYWdlcyA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0Rmlyc3RMZXZlbE1lc3NhZ2VzKGFkdmVydElkLGFkdmVydC5zZWxlY3RlZEdyb3VwLmlkLDYsMCwwLDEwMDApLm1lc3NhZ2VzO1xyXG4gICAgICAgICAgICAgICAgdmFyIGZ1bGxhZHZlcnRGaXJzdE1lc3NhZ2VzTGVuZ3RoID0gYWR2ZXJ0LmZ1bGxhZHZlcnRGaXJzdE1lc3NhZ2VzLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UuaW5pdFN0YXJ0UGFyYW1zRm9yQ3JlYXRlTWVzc2FnZShmaXJzdE1lc3NhZ2UpO1xyXG5cclxuICAgICAgICAgICAgICAgIGZpcnN0TWVzc2FnZS5hbnN3ZXJJbnB1dElzU2hvdyA/XHJcbiAgICAgICAgICAgICAgICAgICAgZmlyc3RNZXNzYWdlLmFuc3dlcklucHV0SXNTaG93ID0gZmFsc2UgOlxyXG4gICAgICAgICAgICAgICAgICAgIGZpcnN0TWVzc2FnZS5hbnN3ZXJJbnB1dElzU2hvdyA9IHRydWU7XHJcblxyXG5cclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAvLyDQtdGB0LvQuCDQv9GA0L7RgdGC0L7QtSDRgdC+0L7QsdGJ0LXQvdC40LVcclxuICAgICAgICAgICAgICAgIGF0dGFjaElkID0gZnVsbFRhbGtUb3BpYy5pZCsnLScrbWVzc2FnZS5pZDtcclxuXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLmlzVGFsayA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYoIWFkdmVydC5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF0pIGFkdmVydC5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF0gPSAkYy5tZXNzYWdlQ2xpZW50LmdldE1lc3NhZ2VzKGFkdmVydElkLGFkdmVydC5zZWxlY3RlZEdyb3VwLmlkLDYsZmlyc3RNZXNzYWdlLmlkLDAsMTAwMCkubWVzc2FnZXM7XHJcbiAgICAgICAgICAgICAgICB2YXIgIGZ1bGxUYWxrTWVzc2FnZXNMZW5ndGggPSBhZHZlcnQuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UuaW5pdFN0YXJ0UGFyYW1zRm9yQ3JlYXRlTWVzc2FnZShtZXNzYWdlKTtcclxuXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLmFuc3dlcklucHV0SXNTaG93ID9cclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmFuc3dlcklucHV0SXNTaG93ID0gZmFsc2UgOlxyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuYW5zd2VySW5wdXRJc1Nob3cgPSB0cnVlO1xyXG5cclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmKCFpbml0RmxhZ3NNZXNzYWdlW2F0dGFjaElkXSkge1xyXG4gICAgICAgICAgICAgICAgLy9pbml0QXR0YWNoSW1hZ2UoJCgnI2F0dGFjaEltYWdlLScgKyBhdHRhY2hJZCksICQoJyNhdHRhY2gtYXJlYS0nICsgYXR0YWNoSWQpKTtcclxuICAgICAgICAgICAgICAgIC8vaW5pdEF0dGFjaERvYygkKCcjYXR0YWNoRG9jLScgKyBhdHRhY2hJZCksICQoJyNhdHRhY2gtZG9jLWFyZWEtJyArIGF0dGFjaElkKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaW5pdEZsYWdzTWVzc2FnZVthdHRhY2hJZF0gPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgYWR2ZXJ0LnRvZ2dsZVRyZWVGaXJzdE1lc3NhZ2UgPSBmdW5jdGlvbihldmVudCxmaXJzdE1lc3NhZ2Upe1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgZmlyc3RNZXNzYWdlLmlzVHJlZU9wZW4gP1xyXG4gICAgICAgICAgICAgICAgZmlyc3RNZXNzYWdlLmlzVHJlZU9wZW4gPSBmYWxzZSA6XHJcbiAgICAgICAgICAgICAgICBmaXJzdE1lc3NhZ2UuaXNUcmVlT3BlbiA9IHRydWUgO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vIC0tLS0tLS0tXHJcblxyXG4gICAgICAgICAgICBhZHZlcnQuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdID0gJGMubWVzc2FnZUNsaWVudC5nZXRNZXNzYWdlcyhhZHZlcnRJZCxhZHZlcnQuc2VsZWN0ZWRHcm91cC5pZCwxLGZpcnN0TWVzc2FnZS5pZCwwLDEwMDApLm1lc3NhZ2VzO1xyXG4gICAgICAgICAgICBhZHZlcnQuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdID9cclxuICAgICAgICAgICAgICAgIGZ1bGxUYWxrTWVzc2FnZXNMZW5ndGggPSBhZHZlcnQuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdLmxlbmd0aDpcclxuICAgICAgICAgICAgICAgIGZ1bGxUYWxrTWVzc2FnZXNMZW5ndGggPSAwO1xyXG4gICAgICAgICAgICBpZihhZHZlcnQuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdID09PSBudWxsKSBhZHZlcnQuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdID0gW107XHJcblxyXG4gICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgZnVsbFRhbGtNZXNzYWdlc0xlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgICAgIGFkdmVydC5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uYW5zd2VySW5wdXRJc1Nob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGFkdmVydC5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uaXNUcmVlT3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBhZHZlcnQuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmlzT3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBhZHZlcnQuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmlzUGFyZW50T3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBhZHZlcnQuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmNyZWF0ZWRFZGl0ID0gJGMuZ2V0VGltaW5nKGFkdmVydC5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uY3JlYXRlZCk7XHJcbiAgICAgICAgICAgICAgICBhZHZlcnQuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmFuc3dlck1lc3NhZ2UgPSAkYy5URVhUX0RFRkFVTFRfMjtcclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgYWR2ZXJ0LnRvZ2dsZVRyZWUgPSBmdW5jdGlvbihldmVudCxtZXNzYWdlLGZpcnN0TWVzc2FnZSl7XHJcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICBpZighYWR2ZXJ0LmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXSkgYWR2ZXJ0LmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXSA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0TWVzc2FnZXMoYWR2ZXJ0SWQsYWR2ZXJ0LnNlbGVjdGVkR3JvdXAuaWQsMSxmaXJzdE1lc3NhZ2UuaWQsMCwxMDAwKS5tZXNzYWdlcztcclxuICAgICAgICAgICAgdmFyIGZ1bGxUYWxrTWVzc2FnZXNMZW5ndGggPSBhZHZlcnQuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIG1lc3NhZ2UuaXNUcmVlT3BlbiA/XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLmlzVHJlZU9wZW4gPSBmYWxzZSA6XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLmlzVHJlZU9wZW4gPSB0cnVlIDtcclxuXHJcbiAgICAgICAgICAgIHZhciBhZnRlckN1cnJlbnRJbmRleCA9IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbmV4dE1lc3NhZ2VPbkN1cnJlbnRMZXZlbCA9IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbG9vcE1lc3NhZ2VPZmZzZXQsXHJcbiAgICAgICAgICAgICAgICBwYXJlbnRPcGVuU3RhdHVzLFxyXG4gICAgICAgICAgICAgICAgYXJlQWxsTXlQYXJlbnRzVHJlZU9wZW4gPSBbXSxcclxuICAgICAgICAgICAgICAgIGNoZWNrQXJlQWxsTXlQYXJlbnRzVHJlZU9wZW4gPSB0cnVlLFxyXG4gICAgICAgICAgICAgICAgYmVnaW5PZmZzZXQgPSBtZXNzYWdlLm9mZnNldCxcclxuICAgICAgICAgICAgICAgIHBhcmVudE9wZW5TdGF0dXNBcnJheSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGZ1bGxUYWxrTWVzc2FnZXNMZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICBsb29wTWVzc2FnZU9mZnNldCA9IGFkdmVydC5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0ub2Zmc2V0O1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKGFmdGVyQ3VycmVudEluZGV4ICYmICFuZXh0TWVzc2FnZU9uQ3VycmVudExldmVsXHJcbiAgICAgICAgICAgICAgICAgICAgJiYgbWVzc2FnZS5vZmZzZXQgPCBsb29wTWVzc2FnZU9mZnNldCl7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGFyZUFsbE15UGFyZW50c1RyZWVPcGVuW2xvb3BNZXNzYWdlT2Zmc2V0XSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGxvb3BNZXNzYWdlT2Zmc2V0IC0gbWVzc2FnZS5vZmZzZXQgPT0gMSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8v0LXRgdC70Lgg0Y3RgtC+INC90LXQv9C+0YHRgNC10LTRgdGC0LLQtdC90L3Ri9C5INC/0L7RgtC+0LzQvtC6XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhZHZlcnQuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmlzT3BlbiA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZHZlcnQuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmlzT3BlbiA9IGZhbHNlIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkdmVydC5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uaXNPcGVuID0gdHJ1ZSA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRPcGVuU3RhdHVzQXJyYXlbbG9vcE1lc3NhZ2VPZmZzZXRdID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50T3BlblN0YXR1cyA9IGFkdmVydC5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uaXNPcGVuO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhZHZlcnQuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmlzVHJlZU9wZW4pe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJlQWxsTXlQYXJlbnRzVHJlZU9wZW5bbG9vcE1lc3NhZ2VPZmZzZXRdID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g0LXRgdC70Lgg0Y3RgtC+INC/0YLQvtC80LrQuCDQv9C+0YLQvtC80LrQsFxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tBcmVBbGxNeVBhcmVudHNUcmVlT3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaiA9IGJlZ2luT2Zmc2V0OyBqIDwgbG9vcE1lc3NhZ2VPZmZzZXQ7IGorKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQv9GA0L7QstC10YDRj9C10Lwg0L3QtdGCINC70Lgg0YMg0LrQvtCz0L4g0LIg0L/RgNC10LTQutCw0YUgaXNUcmVlT3BlbiA9IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhcmVBbGxNeVBhcmVudHNUcmVlT3BlbltqXSA9PSBmYWxzZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tBcmVBbGxNeVBhcmVudHNUcmVlT3BlbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudE9wZW5TdGF0dXMgJiYgY2hlY2tBcmVBbGxNeVBhcmVudHNUcmVlT3BlbiA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZHZlcnQuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmlzT3BlbiA9IHRydWUgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWR2ZXJ0LmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXVtpXS5pc09wZW4gPSBmYWxzZSA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWFkdmVydC5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uaXNUcmVlT3Blbil7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQtdGB0LvQuCDRgyDQutC+0LPQvi3RgtC+INC40Lcg0L/RgNC10LTQutC+0LIg0L3QtSDQvtGC0LrRgNGL0YLQviDQtNC10YDQtdCy0L5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZUFsbE15UGFyZW50c1RyZWVPcGVuW2xvb3BNZXNzYWdlT2Zmc2V0XSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRPcGVuU3RhdHVzQXJyYXlbbG9vcE1lc3NhZ2VPZmZzZXRdID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGFmdGVyQ3VycmVudEluZGV4ICYmIGxvb3BNZXNzYWdlT2Zmc2V0ID09IG1lc3NhZ2Uub2Zmc2V0KXtcclxuICAgICAgICAgICAgICAgICAgICBuZXh0TWVzc2FnZU9uQ3VycmVudExldmVsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKG1lc3NhZ2UuaWQgPT0gYWR2ZXJ0LmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXVtpXS5pZCl7XHJcbiAgICAgICAgICAgICAgICAgICAgYWZ0ZXJDdXJyZW50SW5kZXggPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGJ1ZmYsbGFzdExvYWRlZElkRkY7XHJcbiAgICAgICAgYWR2ZXJ0LmFkZE1vcmVJdGVtcyA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHZhciB0ZW1wID0gJGMubWVzc2FnZUNsaWVudC5nZXRGaXJzdExldmVsTWVzc2FnZXMoYWR2ZXJ0SWQsYWR2ZXJ0LnNlbGVjdGVkR3JvdXAuaWQsMSwkcm9vdFNjb3BlLmJhc2UubGFzdExvYWRlZElkLDAsMTApLFxyXG4gICAgICAgICAgICAgICAgYnVmZiA9IHRlbXAubWVzc2FnZXM7XHJcbiAgICAgICAgICAgIGlmKGJ1ZmYpIHtcclxuICAgICAgICAgICAgICAgIHZhciBidWZmTGVuZ3RoID0gYnVmZi5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYoYnVmZkxlbmd0aCAhPSAwKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5sYXN0TG9hZGVkSWQgPSBidWZmW2J1ZmZMZW5ndGggLSAxXS5pZDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYobGFzdExvYWRlZElkRkYgIT0gJHJvb3RTY29wZS5iYXNlLmxhc3RMb2FkZWRJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UuaW5pdEZpcnN0TWVzc2FnZXMoYnVmZik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkdmVydC5mdWxsVGFsa0ZpcnN0TWVzc2FnZXMgPSBhZHZlcnQuZnVsbFRhbGtGaXJzdE1lc3NhZ2VzLmNvbmNhdChidWZmKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGxhc3RMb2FkZWRJZEZGID0gJHJvb3RTY29wZS5iYXNlLmxhc3RMb2FkZWRJZDtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmVuZE9mTG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkKCcubmctY2xvYWsnKS5yZW1vdmVDbGFzcygnbmctY2xvYWsnKTtcclxuICAgIH1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gWyAnJHJvb3RTY29wZScsJyRzdGF0ZVBhcmFtcycsIGFkdmVydHNTaW5nbGVDdHJsIF07IiwiLy92YXIgZm9ydW1Db250cm9sbGVycyA9IGFuZ3VsYXIubW9kdWxlKCdmb3J1bS5jb250cm9sbGVycycsIFsndWkuc2VsZWN0MicsJ2luZmluaXRlLXNjcm9sbCcsJ25nU2FuaXRpemUnLCd5YU1hcCcsJ3VpLmJvb3RzdHJhcCddKTtcclxuXHJcbnZhciBiYXNlQ3RybCA9IGZ1bmN0aW9uKCRzY29wZSwkcm9vdFNjb3BlLCRzdGF0ZSwkZmlsdGVyLCRsb2NhdGlvbiwkYykge1xyXG5cclxuICAgICRyb290U2NvcGUuSVNfQlVTSU5FU1MgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnVk9faXNfYnVzaW5lc3MnKTtcclxuXHJcbiAgICAgICAgdmFyIGJhc2UgPSB0aGlzO1xyXG4gICAgICAgIGJhc2UudXJsID0gJGxvY2F0aW9uLnVybCgpO1xyXG4gICAgICAgICRzY29wZS4kb24oJyRsb2NhdGlvbkNoYW5nZVN1Y2Nlc3MnLCBmdW5jdGlvbigkZXZlbnQsbmV3U3RhdGUsb2xkU3RhdGUpe1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnY2hhbmdlJyk7XHJcbiAgICAgICAgICAgIGlmIChuZXdTdGF0ZS5pbmRleE9mKCdibG9nJykgPT0gLTEgJiYgbmV3U3RhdGUuaW5kZXhPZignYWJvdXQnKSA9PSAtMSAmJiBuZXdTdGF0ZS5pbmRleE9mKCdjb250YWN0cycpID09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXNMb2dpbiA9ICRjLmF1dGhDbGllbnQuY2hlY2tJZkF1dGhvcml6ZWQoKTtcclxuICAgICAgICAgICAgICAgIGlmKCFpc0xvZ2luKSBkb2N1bWVudC5sb2NhdGlvbi5yZXBsYWNlKCcvbG9naW4nKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZighJGMudXNlckNsaWVudEdyb3VwcykgJGMudXNlckNsaWVudEdyb3VwcyA9ICRjLnVzZXJDbGllbnQuZ2V0VXNlckdyb3VwcygpO1xyXG4gICAgICAgICAgICAgICAgaWYoISRjLnNob3J0VXNlckluZm8pICRjLnNob3J0VXNlckluZm8gPSAkYy51c2VyQ2xpZW50LmdldFNob3J0VXNlckluZm8oKTtcclxuICAgICAgICAgICAgICAgIGlmKCFoYXNTdGFydCkgc3RhcnQoKTtcclxuICAgICAgICAgICAgICAgIGJhc2UudXJsID0gJGxvY2F0aW9uLnVybCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgaWYoYmFzZS51cmwgIT0gJy9ibG9nJyAmJiBiYXNlLnVybCAhPSAnL2Fib3V0JyAmJiBiYXNlLnVybCAhPSAnL2NvbnRhY3RzJykge1xyXG4gICAgICAgIGlmKCFoYXNTdGFydCkgc3RhcnQoKTtcclxuICAgIH1cclxuICAgIHZhciBoYXNTdGFydCA9IGZhbHNlO1xyXG5cclxuICAgIGZ1bmN0aW9uIHN0YXJ0KCl7XHJcbiAgICAgICAgY29uc29sZS5sb2coJzEnLCRjLnNob3J0VXNlckluZm8pO1xyXG4gICAgICAgIGhhc1N0YXJ0ID0gdHJ1ZTtcclxuICAgICAgICAkcm9vdFNjb3BlLmlzVG9wU2VhcmNoU2hvdyA9IHRydWU7XHJcbiAgICAgICAgYmFzZS5uZWlnaGJvdXJzTG9hZFN0YXR1cyA9IFwiXCI7XHJcbiAgICAgICAgYmFzZS5wcml2YXRlTWVzc2FnZXNMb2FkU3RhdHVzID0gXCJcIjtcclxuICAgICAgICBiYXNlLnByb2ZpbGVMb2FkU3RhdHVzID0gXCJcIjtcclxuICAgICAgICBiYXNlLnNldHRpbmdzTG9hZFN0YXR1cyA9IFwiXCI7XHJcbiAgICAgICAgYmFzZS5tYXBzTG9hZFN0YXR1cyA9IFwiXCI7XHJcblxyXG4gICAgICAgIGJhc2UubWFpbkNvbnRlbnRUb3BJc0hpZGUgPSBmYWxzZTtcclxuICAgICAgICBiYXNlLmNyZWF0ZVRvcGljSXNIaWRlID0gdHJ1ZTtcclxuICAgICAgICBiYXNlLm1lID0gJGMuc2hvcnRVc2VySW5mbztcclxuXHJcbiAgICAgICAgYmFzZS5pc0Zvb3RlckJvdHRvbSA9IGZhbHNlO1xyXG5cclxuICAgICAgICBiYXNlLmlzVGFsa1RpdGxlcyA9IHRydWU7XHJcblxyXG4gICAgICAgICRjLnJlc2V0UGFnZXMoYmFzZSk7XHJcbiAgICAgICAgYmFzZS5sZW50YUlzQWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICBiYXNlLmVtcHR5TWVzc2FnZSA9IFwi0KHQvtC+0LHRidC10L3QuNC5INC/0L7QutCwINC90LXRglwiO1xyXG5cclxuICAgICAgICBiYXNlLnRleHRhcmVhQmx1ciA9IGZ1bmN0aW9uIChtZXNzYWdlLCBkZWZhdWx0VGV4dCwgY3RybCwgaXNUb3BpYykge1xyXG4gICAgICAgICAgICBpZiAoaXNUb3BpYykge1xyXG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UgPT0gXCJcIikgY3RybC5tZXNzYWdlLmNvbnRlbnQgPSBkZWZhdWx0VGV4dDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlID09IFwiXCIpIGN0cmwuY29tbWVudFRleHQgPSBkZWZhdWx0VGV4dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBiYXNlLmlzTGVudGFGb2N1cyA9IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGJhc2UudGV4dGFyZWFGb2N1cyA9IGZ1bmN0aW9uIChtZXNzYWdlLCBkZWZhdWx0VGV4dCwgY3RybCwgaXNUb3BpYykge1xyXG4gICAgICAgICAgICBpZiAoaXNUb3BpYykge1xyXG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UgPT0gZGVmYXVsdFRleHQpIGN0cmwubWVzc2FnZS5jb250ZW50ID0gXCJcIjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlID09IGRlZmF1bHRUZXh0KSBjdHJsLmNvbW1lbnRUZXh0ID0gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBiYXNlLmFkZFBvbGxJbnB1dCA9IGZ1bmN0aW9uIChldmVudCwgb2JqLCBpc0ZvY3VzKSB7XHJcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgbmV3SW5wdXQgPSB7Y291bnRlcjogMCwgbmFtZTogXCJcIiB9O1xyXG4gICAgICAgICAgICBvYmoucG9sbElucHV0cy5wdXNoKG5ld0lucHV0KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpc0ZvY3VzKSB7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHNldE5ld0ZvY3VzLCAyMDAsICQoZXZlbnQudGFyZ2V0KSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0TmV3Rm9jdXMoZWwpIHtcclxuICAgICAgICAgICAgZWwucHJldigpLmZpbmQoJ2lucHV0JykuZm9jdXMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGJhc2Uuc2hvd1BvbGwgPSBmdW5jdGlvbiAoZXZlbnQsIG9iaikge1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgb2JqLmlzUG9sbFNob3cgPSB0cnVlO1xyXG4gICAgICAgICAgICBvYmoucG9sbFN1YmplY3QgPSBcIlwiO1xyXG4gICAgICAgICAgICBvYmoucG9sbCA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICBvYmoucG9sbElucHV0cyA9IFtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjb3VudGVyOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiXCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY291bnRlcjogMSxcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIlwiXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF07XHJcbiAgICAgICAgICAgIG9iai5pc1BvbGxBdmFpbGFibGUgPSBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBiYXNlLmRvUG9sbCA9IGZ1bmN0aW9uIChldmVudCwgcG9sbCkge1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICBwb2xsLnZhbHVlcyA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgcG9sbE5hbWVzTGVuZ3RoID0gcG9sbC5lZGl0TmFtZXMubGVuZ3RoO1xyXG4gICAgICAgICAgICB2YXIgaXRlbTtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9sbE5hbWVzTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChwb2xsLmVkaXROYW1lc1tpXS52YWx1ZSA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciB0ZW1wUG9sbCA9ICRjLm1lc3NhZ2VDbGllbnQuZG9Qb2xsKHBvbGwucG9sbElkLCBpdGVtKTtcclxuICAgICAgICAgICAgcG9sbC5hbHJlYWR5UG9sbCA9IHRydWU7XHJcbiAgICAgICAgICAgIHBvbGwudmFsdWVzID0gdGVtcFBvbGwudmFsdWVzO1xyXG5cclxuICAgICAgICAgICAgJGMuc2V0UG9sbEVkaXROYW1lcyhwb2xsKTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgYmFzZS5vbGRUZXh0TGVuZ3RoID0gMDtcclxuICAgICAgICBiYXNlLm1lc3NhZ2VDaGFuZ2UgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBlbCA9IGV2ZW50LnRhcmdldCxcclxuICAgICAgICAgICAgICAgIGNsaWVudEhlaWdodCA9IGVsLmNsaWVudEhlaWdodCxcclxuICAgICAgICAgICAgICAgIHNjcm9sbEhlaWdodCA9IGVsLnNjcm9sbEhlaWdodCxcclxuICAgICAgICAgICAgICAgIHRleHRMZW5ndGggPSBlbC50ZXh0TGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgY2xpZW50V2lkdGggPSBlbC5jbGllbnRXaWR0aCxcclxuICAgICAgICAgICAgICAgIHRleHRMZW5ndGhQWCwgbmV3SGVpZ2h0LCByZW1vdmVSb3dDb3VudCxcclxuICAgICAgICAgICAgICAgIGRlZmF1bHRIZWlnaHQsIG5ld1Jvd0NvdW50O1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdEhlaWdodCA9ICRjLlRFWFRBUkVBX0RFRkFVTFRfSEVJR0hUO1xyXG5cclxuICAgICAgICAgICAgLypcclxuICAgICAgICAgICAgINCY0YHRhdC+0LTQvdGL0LUg0LTQsNC90L3Ri9C1OlxyXG4gICAgICAgICAgICAg0J3QsCDQvtC00LjQvSDRgdC40LzQstC+0Lsg0L/RgNC40YXQvtC00LjRgtGB0Y8gfjhweCDQsiDRiNC40YDQuNC90YNcclxuICAgICAgICAgICAgINCS0YvRgdC+0YLQsCDRgdGC0YDQvtC60Lgg0YLQtdC60YHRgtCwIH4xNHB4XHJcblxyXG4gICAgICAgICAgICAgKiDQl9C00LXRgdGMINCy0YvQv9C+0LvQvdGP0LXQvCDRgtCw0LrQuNC1INC00LXQudGB0YLQstC40Y8gOlxyXG4gICAgICAgICAgICAgKiAxKSDQodGH0LjRgtCw0LXQvCDQtNC70LjQvdGDINGC0LXQutGB0YLQsCDQsiDQv9C40LrRgdC10LvRj9GFXHJcbiAgICAgICAgICAgICAqIDIpINCe0L/RgNC10LTQtdC70Y/QtdC8INGG0LXQu9C+0LUg0LrQvtC70LjRh9C10YHRgtC+0LIg0YHRgtGA0L7Quiwg0LrQvtGC0L7RgNGL0LUg0YPQtNCw0LvQuNC70LhcclxuICAgICAgICAgICAgICogMykg0J7Qv9GA0LXQtNC10LvRj9C8INC90L7QstGD0Y4g0LLRi9GB0L7RgtGDINGBINGD0YfQtdGC0L7QvCDQstGL0YHQvtGC0Ysg0YPQtNCw0LvQtdC90L3QvtCz0L4g0YLQtdC60YHRgtCwXHJcbiAgICAgICAgICAgICAqICovXHJcblxyXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiMCBcIitzY3JvbGxIZWlnaHQrXCIgXCIrY2xpZW50SGVpZ2h0KTtcclxuICAgICAgICAgICAgaWYgKHNjcm9sbEhlaWdodCA+IGNsaWVudEhlaWdodCkge1xyXG5cclxuICAgICAgICAgICAgICAgIGVsLnN0eWxlLmhlaWdodCA9IHNjcm9sbEhlaWdodCArICdweCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2Nyb2xsSGVpZ2h0ID4gZGVmYXVsdEhlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgdGV4dExlbmd0aFBYID0gKHBhcnNlSW50KGJhc2Uub2xkVGV4dExlbmd0aCkgLSB0ZXh0TGVuZ3RoKSAqIDg7IC8vIDFcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCIyIFwiK3RleHRMZW5ndGhQWCtcIiBcIitjbGllbnRXaWR0aCtcIiBcIit0ZXh0TGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgIGlmICh0ZXh0TGVuZ3RoUFggPiBjbGllbnRXaWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiMyBcIit0ZXh0TGVuZ3RoUFgrXCIgXCIrY2xpZW50V2lkdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZVJvd0NvdW50ID0gTWF0aC5mbG9vcih0ZXh0TGVuZ3RoUFggLyBjbGllbnRXaWR0aCk7IC8vIDJcclxuICAgICAgICAgICAgICAgICAgICBuZXdIZWlnaHQgPSBwYXJzZUludChldmVudC50YXJnZXQuc3R5bGUuaGVpZ2h0KSAtIHJlbW92ZVJvd0NvdW50ICogMTQ7IC8vIDNcclxuICAgICAgICAgICAgICAgICAgICBuZXdIZWlnaHQgPiBkZWZhdWx0SGVpZ2h0ID8gZXZlbnQudGFyZ2V0LnN0eWxlLmhlaWdodCA9IG5ld0hlaWdodCArIFwicHhcIiA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5zdHlsZS5oZWlnaHQgPSBkZWZhdWx0SGVpZ2h0ICsgJ3B4JztcclxuXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsLnN0eWxlLmhlaWdodCA9IHNjcm9sbEhlaWdodCAtIDYgKyAncHgnO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiNSBcIit0ZXh0TGVuZ3RoK1wiIFwiK3RleHRMZW5ndGgqOC9jbGllbnRXaWR0aCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCc0Jyk7XHJcbiAgICAgICAgICAgICAgICBlbC5zdHlsZS5oZWlnaHQgPSBkZWZhdWx0SGVpZ2h0ICsgJ3B4JztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBiYXNlLm9sZFRleHRMZW5ndGggPSB0ZXh0TGVuZ3RoO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGJhc2UuZ2V0VGV4dGFyZWFIZWlnaHQgPSBmdW5jdGlvbiAodGV4dExlbmd0aCwgY2xpZW50V2lkdGgsIGlzVG9waWMpIHtcclxuICAgICAgICAgICAgLyppZihpc1RvcGljKXtcclxuICAgICAgICAgICAgIHZhciBrMSA9IDEwLFxyXG4gICAgICAgICAgICAgazIgPSAxOTtcclxuICAgICAgICAgICAgIH1lbHNleyovXHJcbiAgICAgICAgICAgIHZhciBrMSA9IDEyLFxyXG4gICAgICAgICAgICAgICAgazIgPSAxNDtcclxuICAgICAgICAgICAgLy99XHJcblxyXG4gICAgICAgICAgICB2YXIgc3RyaW5nTGVuID0gdGV4dExlbmd0aCAqIGsxO1xyXG4gICAgICAgICAgICBpZiAoc3RyaW5nTGVuID4gY2xpZW50V2lkdGgpIHtcclxuICAgICAgICAgICAgICAgIHZhciByb3dDb3VudCA9IHBhcnNlSW50KHN0cmluZ0xlbiAvIGNsaWVudFdpZHRoKTsgLy8g0YHQutC+0LvRjNC60L4g0YHRgtGA0L7QulxyXG4gICAgICAgICAgICAgICAgdmFyIGFyZWFIZWlnaHQgPSByb3dDb3VudCAqIGsyO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYXJlYUhlaWdodCA9ICRjLlRFWFRBUkVBX0RFRkFVTFRfSEVJR0hUO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gYXJlYUhlaWdodDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBiYXNlLmluaXRGaXJzdE1lc3NhZ2VzID0gZnVuY3Rpb24gKGZpcnN0TWVzc2FnZXMpIHtcclxuICAgICAgICAgICAgdmFyIGZ1bGxUYWxrRmlyc3RNZXNzYWdlc0xlbmd0aCxcclxuICAgICAgICAgICAgICAgIGxhc3RMb2FkZWRJZDtcclxuXHJcbiAgICAgICAgICAgIGZpcnN0TWVzc2FnZXMgP1xyXG4gICAgICAgICAgICAgICAgZnVsbFRhbGtGaXJzdE1lc3NhZ2VzTGVuZ3RoID0gZmlyc3RNZXNzYWdlcy5sZW5ndGggOlxyXG4gICAgICAgICAgICAgICAgZnVsbFRhbGtGaXJzdE1lc3NhZ2VzTGVuZ3RoID0gMDtcclxuXHJcbiAgICAgICAgICAgIGlmIChmdWxsVGFsa0ZpcnN0TWVzc2FnZXNMZW5ndGggIT0gMCkgbGFzdExvYWRlZElkID0gZmlyc3RNZXNzYWdlc1tmdWxsVGFsa0ZpcnN0TWVzc2FnZXNMZW5ndGggLSAxXS5pZDtcclxuXHJcbiAgICAgICAgICAgIGlmIChmaXJzdE1lc3NhZ2VzID09PSBudWxsKSBmaXJzdE1lc3NhZ2VzID0gW107XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZ1bGxUYWxrRmlyc3RNZXNzYWdlc0xlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBmaXJzdE1lc3NhZ2VzW2ldLmFuc3dlcklucHV0SXNTaG93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBmaXJzdE1lc3NhZ2VzW2ldLmlzVHJlZU9wZW4gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGZpcnN0TWVzc2FnZXNbaV0uaXNMb2FkZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGZpcnN0TWVzc2FnZXNbaV0uYW5zd2VyTWVzc2FnZSA9ICRjLlRFWFRfREVGQVVMVF8yO1xyXG4gICAgICAgICAgICAgICAgZmlyc3RNZXNzYWdlc1tpXS5jcmVhdGVkRWRpdCA9ICRjLmdldFRpbWluZyhmaXJzdE1lc3NhZ2VzW2ldLmNyZWF0ZWQpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGxhc3RMb2FkZWRJZDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBiYXNlLmRlbGV0ZU1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSwgbWVzc2FnZXNBcnJheSwgaXNUb3BpYywgaXNXYWxsLCBpc0RpYWxvZykge1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzVG9waWMgJiYgIWlzV2FsbCB8fCBtZXNzYWdlLmlzV2FsbFNpbmdsZSkge1xyXG4gICAgICAgICAgICAgICAgLy8g0LXRgdC70LggdGFsay1zaW5nbGUg0LjQu9C4IHByb2ZpdC1zaW5nbGVcclxuXHJcbiAgICAgICAgICAgICAgICBib290Ym94LmNvbmZpcm0oXCLQktGLINGD0LLQtdGA0LXQvdGLLCDRh9GC0L4g0YXQvtGC0LjRgtC1INGD0LTQsNC70LjRgtGMINGN0YLRgyDRgtC10LzRgz9cIiwgZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGVsZXRlUmVzdWx0ID0gJGMubWVzc2FnZUNsaWVudC5kZWxldGVUb3BpYyhtZXNzYWdlLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UubWVzc2FnZS5jb250ZW50ID0gZGVsZXRlUmVzdWx0Lm1lc3NhZ2UuY29udGVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g0LLQtdGA0L3Rg9C7IG51bGwsINC30L3QsNGH0LjRgiDQv9C+0YLQvtC80LrQvtCyINC90LXRglxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5tZXNzYWdlLnR5cGUgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCd0YWxrcycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1lc3NhZ2UubWVzc2FnZS50eXBlID09IDYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygncHJvZml0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5tZXNzYWdlLnR5cGUgPT0gNSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdtYWluJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNUb3BpYykge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZGVsZXRlUmVzdWx0ID0gJGMubWVzc2FnZUNsaWVudC5kZWxldGVUb3BpYyhtZXNzYWdlLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLm1lc3NhZ2UuY29udGVudCA9IGRlbGV0ZVJlc3VsdC5tZXNzYWdlLmNvbnRlbnQ7XHJcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g0LLQtdGA0L3Rg9C7IG51bGwsINC30L3QsNGH0LjRgiDRg9C00LDQu9C10L3QuNC1INC/0YDQvtC40LfQvtGI0LvQviDRh9C40YHRgtC+XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VzQXJyYXlMZW5ndGggPSBtZXNzYWdlc0FycmF5Lmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlc0FycmF5TGVuZ3RoOyBpKyspIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50SWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzV2FsbCA/IGN1cnJlbnRJZCA9IG1lc3NhZ2VzQXJyYXlbaV0udG9waWMuaWQgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudElkID0gbWVzc2FnZXNBcnJheVtpXS5pZDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50SWQgPT0gbWVzc2FnZS5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZXNBcnJheS5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChpc0RpYWxvZykge1xyXG4gICAgICAgICAgICAgICAgICAgICRjLmRpYWxvZ0NsaWVudC5kZWxldGVEaWFsb2dNZXNzYWdlKG1lc3NhZ2UuaWQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlc0FycmF5TGVuZ3RoID0gbWVzc2FnZXNBcnJheS5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlc0FycmF5TGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2VzQXJyYXlbaV0uaWQgPT0gbWVzc2FnZS5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZXNBcnJheS5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZVJlc3VsdCA9ICRjLm1lc3NhZ2VDbGllbnQuZGVsZXRlTWVzc2FnZShtZXNzYWdlLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5jb250ZW50ID0gZGVsZXRlUmVzdWx0LmNvbnRlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VzQXJyYXlMZW5ndGggPSBtZXNzYWdlc0FycmF5Lmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXNzYWdlc0FycmF5TGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlc0FycmF5W2ldLmlkID09IG1lc3NhZ2UuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlc0FycmF5LnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBiYXNlLnNldEVkaXQgPSBmdW5jdGlvbiAoZXZlbnQsIG1lc3NhZ2UsIGlzTmVlZEFuc3dlclNob3cpIHtcclxuICAgICAgICAgICAgaWYoIW1lc3NhZ2UucnVicmljKSB7XHJcbiAgICAgICAgICAgICAgICAvL21lc3NhZ2Uuc2VsUnVicmljTmFtZSA9IFwi0J7QsdGJ0LXQtVwiO1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZS5ydWJyaWMgPSB7fTtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2UucnVicmljLnZpc2libGVOYW1lID0gXCLQntCx0YnQtdC1XCI7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLnJ1YnJpYy5pZCA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vJHJvb3RTY29wZS5jdXJyZW50UnVicmljID0gbWVzc2FnZS5ydWJyaWM7XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc2V0RWRpdCcsJHJvb3RTY29wZS5jdXJyZW50UnVicmljKTtcclxuICAgICAgICAgICAgdmFyIGlzVG9waWM7XHJcbiAgICAgICAgICAgIChtZXNzYWdlLm1lc3NhZ2UpID8gaXNUb3BpYyA9IHRydWUgOiBpc1RvcGljID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICBpZiAobWVzc2FnZS5pc0VkaXQpIHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2UuaXNFZGl0ID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGlzVG9waWMpIHtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLm1lc3NhZ2UuY29udGVudCA9ICRmaWx0ZXIoJ2xpbmt5JykobWVzc2FnZS5tZXNzYWdlLmNvbnRlbnQsICdibGFuaycpO1xyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UubWVzc2FnZS5jb250ZW50ID0gJGMud2l0aFRhZ3MobWVzc2FnZS5tZXNzYWdlLmNvbnRlbnQpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmNvbnRlbnQgPSAkZmlsdGVyKCdsaW5reScpKG1lc3NhZ2UuY29tbWVudFRleHQsICdibGFuaycpO1xyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuY29udGVudCA9ICRjLndpdGhUYWdzKG1lc3NhZ2UuY29udGVudCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChpc1RvcGljKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5tZXNzYWdlLmNvbnRlbnQgPSAkYy53aXRob3V0VGFncyhtZXNzYWdlLm1lc3NhZ2UuY29udGVudCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuY29tbWVudFRleHQgPSAkYy53aXRob3V0VGFncyhtZXNzYWdlLmNvbnRlbnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBlbCA9IGV2ZW50LnRhcmdldDtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgaDAgPSAkKGVsKS5jbG9zZXN0KCcudGV4dC1jb250YWluZXInKS5maW5kKCcudGV4dDplcSgwKScpLmhlaWdodCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIGgxID0gJChlbCkuY2xvc2VzdCgnLnRleHQtY29udGFpbmVyJykuZmluZCgnLnRleHQ6ZXEoMSknKS5oZWlnaHQoKSxcclxuICAgICAgICAgICAgICAgICAgICBoO1xyXG5cclxuICAgICAgICAgICAgICAgIChoMCA+IGgxKSA/IGggPSBoMCArIDI0IDogaCA9IGgxO1xyXG5cclxuICAgICAgICAgICAgICAgIG1lc3NhZ2UuaXNFZGl0ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5hbnN3ZXJJbnB1dElzU2hvdykgbWVzc2FnZS5hbnN3ZXJJbnB1dElzU2hvdyA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChpc1RvcGljKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRleHRMZW4gPSBtZXNzYWdlLm1lc3NhZ2UuY29udGVudC5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHRMZW4gPSBtZXNzYWdlLmNvbnRlbnQubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8qaWYodGV4dExlbiA+IGJhc2UuY29udGVudExlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICAgaCA9ICh0ZXh0TGVuL2Jhc2UuY29udGVudExlbmd0aCkudG9GaXhlZCgwKSooaC0yNCk7XHJcbiAgICAgICAgICAgICAgICAgfSovXHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGggPCAkYy5URVhUQVJFQV9ERUZBVUxUX0hFSUdIVCkgaCA9ICRjLlRFWFRBUkVBX0RFRkFVTFRfSEVJR0hUO1xyXG5cclxuICAgICAgICAgICAgICAgICQoZWwpLmNsb3Nlc3QoJy50ZXh0LWNvbnRhaW5lcicpLmZpbmQoJy5lZGl0LW1lc3NhZ2UgdGV4dGFyZWEnKS5oZWlnaHQoaCArICdweCcpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoaXNOZWVkQW5zd2VyU2hvdykge1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZS5hbnN3ZXJTaG93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2UuY29tbWVudFRleHQgPSBtZXNzYWdlLmNvbnRlbnQ7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLmlzVGFsayA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChtZXNzYWdlLmlzRWRpdCkge1xyXG4gICAgICAgICAgICAgICAgLy8g0LfQtNC10YHRjCDRgNCw0YHRgdC80LDRgtGA0LjQstCw0LXRgtGB0Y8g0YHQuNGC0YPQsNGG0LjRjyDQutC+0LPQtNCwINC80Ysg0LLQvtC30LLRgNCw0YnQsNC10LzRgdGPINC40Lcg0YDQtdC00LDQutGC0LjRgNC+0LLQsNC90LjRjyxcclxuICAgICAgICAgICAgICAgIC8vINC90L4g0LLRi9GI0LUg0LzRiyDRg9C20LUg0L/QtdGA0LXQutC70Y7Rh9C40LTQuCDRhNC70LDQsywg0L/QvtGN0YLQvtC80YMg0L/QuNGI0YMgbWVzc2FnZS5pc0VkaXQsINCwINC90LUgIW1lc3NhZ2UuaXNFZGl0XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNUb3BpYykge1xyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UubWVzc2FnZS5jb250ZW50ID0gJGMud2l0aG91dFRhZ3MobWVzc2FnZS5tZXNzYWdlLmNvbnRlbnQpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmNvbW1lbnRUZXh0ID0gJGMud2l0aG91dFRhZ3MobWVzc2FnZS5jb250ZW50KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBiYXNlLnBhZ2VUaXRsZSA9IFwi0J3QvtCy0L7RgdGC0LhcIjtcclxuXHJcbiAgICAgICAgYmFzZS51c2VyID0gJGMuc2hvcnRVc2VySW5mbztcclxuXHJcbiAgICAgICAgYmFzZS5idWZmZXJTZWxlY3RlZEdyb3VwID0gJGMudXNlckNsaWVudEdyb3Vwc1szXTtcclxuXHJcbiAgICAgICAgYmFzZS5tYXJrSW1wb3J0YW50ID0gZnVuY3Rpb24gKGV2ZW50LCBtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHZhciBpc0ltcG9ydGFudDtcclxuXHJcbiAgICAgICAgICAgIGlmIChtZXNzYWdlLmltcG9ydGFudCA9PSAzIHx8IG1lc3NhZ2UuaW1wb3J0YW50ID09IDIpIHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2UuaW1wb3J0YW50ID0gMTtcclxuICAgICAgICAgICAgICAgIGlzSW1wb3J0YW50ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2UuaW1wb3J0YW50VGV4dCA9ICfQodC90Y/RgtGMINC80LXRgtC60YMgXCLQktCw0LbQvdC+0LVcIic7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLmltcG9ydGFudCA9IDM7XHJcbiAgICAgICAgICAgICAgICBpc0ltcG9ydGFudCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZS5pbXBvcnRhbnRUZXh0ID0gJ9Cf0L7QvNC10YLQuNGC0Ywg0LrQsNC6IFwi0JLQsNC20L3QvtC1XCInO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkYy5tZXNzYWdlQ2xpZW50Lm1hcmtNZXNzYWdlSW1wb3J0YW50KG1lc3NhZ2UuaWQsIGlzSW1wb3J0YW50KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBiYXNlLm1hcmtMaWtlID0gZnVuY3Rpb24gKGV2ZW50LCBtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHZhciBpc0xpa2U7XHJcblxyXG4gICAgICAgICAgICBpZiAobWVzc2FnZS5saWtlID09IDEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAkKCcjbGlrZS1oZWxwLScgKyBtZXNzYWdlLmlkKS5mYWRlSW4oMjAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGhpZGVMaWtlSGVscCwgMjAwMCwgbWVzc2FnZS5pZCk7XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBtZXNzYWdlLmxpa2UgPSAxO1xyXG4gICAgICAgICAgICAkYy5tZXNzYWdlQ2xpZW50Lm1hcmtNZXNzYWdlTGlrZShtZXNzYWdlLmlkKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBiYXNlLmluaXRTdGFydFBhcmFtc0ZvckNyZWF0ZVRvcGljID0gZnVuY3Rpb24gKGN0cmwpIHtcclxuICAgICAgICAgICAgY3RybC5zZWxlY3RlZEdyb3VwID0gJHJvb3RTY29wZS5iYXNlLmJ1ZmZlclNlbGVjdGVkR3JvdXAgPSAkcm9vdFNjb3BlLmN1cnJlbnRHcm91cDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGN0cmwuaXNFZGl0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGN0cmwuaXNDcmVhdGVNZXNzYWdlRXJyb3IgPSBmYWxzZTtcclxuICAgICAgICAgICAgY3RybC5pc1BvbGxBdmFpbGFibGUgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgaWYgKGN0cmwuaWQpIHtcclxuICAgICAgICAgICAgICAgIC8vINC10YHQu9C4INGA0LXQtNCw0LrRgtC40YDQvtCy0LDQvdC40LVcclxuICAgICAgICAgICAgICAgIGlmIChjdHJsLnBvbGwgJiYgY3RybC5wb2xsLnBvbGxJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuaXNQb2xsU2hvdyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwucG9sbFN1YmplY3QgPSBjdHJsLnBvbGwuc3ViamVjdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZXNMZW5ndGggPSBjdHJsLnBvbGwubmFtZXMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwucG9sbElucHV0cyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmFtZXNMZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHJsLnBvbGxJbnB1dHNbaV0gPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3RybC5wb2xsSW5wdXRzW2ldLmNvdW50ZXIgPSBpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHJsLnBvbGxJbnB1dHNbaV0ubmFtZSA9IGN0cmwucG9sbC5uYW1lc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5pc1BvbGxBdmFpbGFibGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vINC10YHQu9C4INGB0L7Qt9C00LDQvdC40LVcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgY3RybC5pc1BvbGxTaG93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBjdHJsLnBvbGxTdWJqZWN0ID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIGN0cmwucG9sbElucHV0cyA9IFtcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50ZXI6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiXCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnRlcjogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJcIlxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIF07XHJcbiAgICAgICAgICAgICAgICBjdHJsLmF0dGFjaGVkSW1hZ2VzID0gW107XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgaGlkZUxpa2VIZWxwID0gZnVuY3Rpb24gKG1lc3NhZ2VJZCkge1xyXG4gICAgICAgICAgICAkKCcjbGlrZS1oZWxwLScgKyBtZXNzYWdlSWQpLmZhZGVPdXQoMjAwKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBiYXNlLnNob3dBbGxHcm91cHMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBncm91cHNMZW5ndGggPSAkcm9vdFNjb3BlLmdyb3Vwcy5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ3JvdXBzTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuZ3JvdXBzW2ldLmlzU2hvdyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmdyb3Vwc1tpXS5zZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuZ3JvdXBzWzBdLnNlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmJ1ZmZlclNlbGVjdGVkR3JvdXAgPSAkcm9vdFNjb3BlLmdyb3Vwc1swXTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBiYXNlLmdyb3VwcyA9ICRjLnVzZXJDbGllbnRHcm91cHM7XHJcbiAgICAgICAgYmFzZS5ydWJyaWNzID0gJGMudXNlckNsaWVudFJ1YnJpY3M7XHJcblxyXG4gICAgICAgIGJhc2UuZ29Ub0RpYWxvZyA9IGZ1bmN0aW9uICh1c2VySWQpIHtcclxuICAgICAgICAgICAgdmFyIHVzZXJzID0gW107XHJcbiAgICAgICAgICAgIHVzZXJzWzBdID0gdXNlcklkO1xyXG4gICAgICAgICAgICB2YXIgZGlhbG9nID0gJGMuZGlhbG9nQ2xpZW50LmdldERpYWxvZyh1c2VycywgMCk7XHJcblxyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2RpYWxvZy1zaW5nbGUnLCB7ICdkaWFsb2dJZCc6IGRpYWxvZy5pZH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGJhc2Uuc2VsZWN0R3JvdXBJbkRyb3Bkb3duID0gZnVuY3Rpb24gKGdyb3VwSWQsIGN0cmwpIHtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmJ1ZmZlclNlbGVjdGVkR3JvdXAgPSAkYy5zZWxlY3RHcm91cEluRHJvcGRvd24oZ3JvdXBJZCk7XHJcblxyXG4gICAgICAgICAgICAvL2lmKCFjdHJsLmlzRWRpdCl7XHJcbiAgICAgICAgICAgIGN0cmwuc2VsZWN0ZWRHcm91cCA9ICRyb290U2NvcGUuYmFzZS5idWZmZXJTZWxlY3RlZEdyb3VwO1xyXG4gICAgICAgICAgICAvL31cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBiYXNlLnJlbW92ZUF0dGFjaCA9IGZ1bmN0aW9uIChtZXNzYWdlLCBpbmRleCwgaXNJbWFnZSkge1xyXG4gICAgICAgICAgICBpc0ltYWdlID9cclxuICAgICAgICAgICAgICAgIG1lc3NhZ2UuaW1hZ2VzLnNwbGljZShpbmRleCwgMSkgOlxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZS5kb2N1bWVudHMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLmluaXRDcmVhdGVUb3BpYyA9IGZ1bmN0aW9uIChjdHJsKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoY3RybC5pZCkge1xyXG4gICAgICAgICAgICAgICAgLy8g0LfQvdCw0YfQuNGCINGA0LXQtNCw0LrRgtC40YDQvtCy0LDQvdC40LVcclxuXHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHBvbGxBdHRhY2gsIDIwMCwgY3RybC5pZCwgdHJ1ZSk7IC8vINC20LTQtdC8INC/0L7QutCwINC30LDQs9GA0YPQt9C40YLRgdGPXHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8g0LfQvdCw0YfQuNGCINGB0L7Qt9C00LDQvdC40LVcclxuXHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHBvbGxBdHRhY2gsIDIwMCwgY3RybC5hdHRhY2hJZCwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLmluaXRDcmVhdGVNZXNzYWdlID0gZnVuY3Rpb24gKGN0cmxJZCwgaXNFZGl0KSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoaXNFZGl0KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChwb2xsQXR0YWNoLCAyMDAsIGN0cmxJZCwgdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQocG9sbEF0dGFjaCwgMjAwLCBjdHJsSWQsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcG9sbEF0dGFjaChjdHJsSWQsIGlzRWRpdCkge1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzRWRpdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCQoJyNhdHRhY2hJbWFnZS1lZGl0LScgKyBjdHJsSWQpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRjLmluaXRBdHRhY2hJbWFnZSgkKCcjYXR0YWNoSW1hZ2UtZWRpdC0nICsgY3RybElkKSwgJCgnI2F0dGFjaC1hcmVhLWVkaXQtJyArIGN0cmxJZCkpOyAvLyDvv73vv73vv70g77+977+977+977+977+9IO+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/vVxyXG4gICAgICAgICAgICAgICAgICAgICRjLmluaXRBdHRhY2hEb2MoJCgnI2F0dGFjaERvYy1lZGl0LScgKyBjdHJsSWQpLCAkKCcjYXR0YWNoLWRvYy1hcmVhLWVkaXQtJyArIGN0cmxJZCksIGlzRWRpdCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQocG9sbEF0dGFjaCwgMjAwLCBjdHJsSWQsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKCQoJyNhdHRhY2hJbWFnZS0nICsgY3RybElkKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkYy5pbml0QXR0YWNoSW1hZ2UoJCgnI2F0dGFjaEltYWdlLScgKyBjdHJsSWQpLCAkKCcjYXR0YWNoLWFyZWEtJyArIGN0cmxJZCkpOyAvLyDvv73vv73vv70g77+977+977+977+977+9IO+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/vVxyXG4gICAgICAgICAgICAgICAgICAgICRjLmluaXRBdHRhY2hEb2MoJCgnI2F0dGFjaERvYy0nICsgY3RybElkKSwgJCgnI2F0dGFjaC1kb2MtYXJlYS0nICsgY3RybElkKSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQocG9sbEF0dGFjaCwgMjAwLCBjdHJsSWQsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWRkU2luZ2xlVGFsayh0YWxrKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhZGRTaW5nbGVUYWxrLTAnLCRyb290U2NvcGUuY3VycmVudFJ1YnJpYyk7XHJcblxyXG4gICAgICAgICAgICB0YWxrLnNlbGVjdGVkUnVicmljID0gJHJvb3RTY29wZS5jdXJyZW50UnVicmljO1xyXG4gICAgICAgICAgICBpZighdGFsay5zZWxlY3RlZFJ1YnJpYykge1xyXG4gICAgICAgICAgICAgICAgdGFsay5zZWxlY3RlZFJ1YnJpYyA9IHt9O1xyXG4gICAgICAgICAgICAgICAgdGFsay5zZWxlY3RlZFJ1YnJpYy5pZCA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0YWxrLmlzRWRpdCkge1xyXG4gICAgICAgICAgICAgICAgdGFsay5hdHRhY2hlZEltYWdlcyA9ICRjLmdldEF0dGFjaGVkSW1hZ2VzKCQoJyNhdHRhY2gtYXJlYS1lZGl0LScgKyB0YWxrLmlkKSk7XHJcbiAgICAgICAgICAgICAgICB0YWxrLmF0dGFjaGVkRG9jcyA9ICRjLmdldEF0dGFjaGVkRG9jcygkKCcjYXR0YWNoLWRvYy1hcmVhLWVkaXQtJyArIHRhbGsuaWQpLCB0YWxrLmlzRWRpdCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0YWxrLmF0dGFjaGVkSW1hZ2VzID0gJGMuZ2V0QXR0YWNoZWRJbWFnZXMoJCgnI2F0dGFjaC1hcmVhLScgKyB0YWxrLmF0dGFjaElkKSk7XHJcbiAgICAgICAgICAgICAgICB0YWxrLmF0dGFjaGVkRG9jcyA9ICRjLmdldEF0dGFjaGVkRG9jcygkKCcjYXR0YWNoLWRvYy1hcmVhLScgKyB0YWxrLmF0dGFjaElkKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0YWxrLnN1YmplY3QgPT0gJGMuVEVYVF9ERUZBVUxUXzQgfHwgdGFsay5zdWJqZWN0ID09IFwiXCIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB0YWxrLmlzQ3JlYXRlVGFsa0Vycm9yID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRhbGsuY3JlYXRlVGFsa0Vycm9yVGV4dCA9IFwi0JLRiyDQvdC1INGD0LrQsNC30LDQu9C4INC30LDQs9C+0LvQvtCy0L7QulwiO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0YWxrLmF0dGFjaGVkSW1hZ2VzLmxlbmd0aCA9PSAwICYmICh0YWxrLmF0dGFjaGVkRG9jcyA9PT0gdW5kZWZpbmVkIHx8IHRhbGsuYXR0YWNoZWREb2NzLmxlbmd0aCA9PSAwKSAmJiAhdGFsay5pc1BvbGxTaG93XHJcbiAgICAgICAgICAgICAgICAmJiAodGFsay5tZXNzYWdlLmNvbnRlbnQgPT0gJGMuVEVYVF9ERUZBVUxUXzMgfHwgIXRhbGsubWVzc2FnZS5jb250ZW50KSkge1xyXG5cclxuICAgICAgICAgICAgICAgIHRhbGsuaXNDcmVhdGVUYWxrRXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGFsay5jcmVhdGVUYWxrRXJyb3JUZXh0ID0gXCLQktGLINC90LUg0LLQstC10LvQuCDRgdC+0L7QsdGJ0LXQvdC40LVcIjtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFsay5pc1BvbGxTaG93ICYmICghdGFsay5wb2xsU3ViamVjdCB8fCB0YWxrLnBvbGxJbnB1dHNbMF0ubmFtZSA9PSBcIlwiIHx8IHRhbGsucG9sbElucHV0c1sxXS5uYW1lID09IFwiXCIpKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdGFsay5pc0NyZWF0ZVRhbGtFcnJvciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0YWxrLmNyZWF0ZVRhbGtFcnJvclRleHQgPSBcItCS0Ysg0L3QtSDRg9C60LDQt9Cw0LvQuCDQtNCw0L3QvdGL0LUg0LTQu9GPINC+0L/RgNC+0YHQsFwiO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGFsay5tZXNzYWdlLmNvbnRlbnQgPT0gJGMuVEVYVF9ERUZBVUxUXzMgJiYgKHRhbGsuYXR0YWNoZWRJbWFnZXMgfHwgdGFsay5hdHRhY2hlZERvY3MgfHwgdGFsay5pc1BvbGxTaG93KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRhbGsubWVzc2FnZS5jb250ZW50ID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRhbGsuaXNDcmVhdGVUYWxrRXJyb3IgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgaXNXYWxsID0gMCwgaXNBZHZlcnQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGlmICh0YWxrLmlzQWR2ZXJ0KSBpc0FkdmVydCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2FkZFNpbmdsZVRhbGsnLCRyb290U2NvcGUuY3VycmVudFJ1YnJpYyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgbmV3VG9waWMgPSAkYy5wb3N0VG9waWModGFsaywgaXNXYWxsLCBpc0FkdmVydCwgJGZpbHRlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG5ld1RvcGljLnBvbGwgJiYgdGFsay5wb2xsKSB0YWxrLnBvbGwucG9sbElkID0gbmV3VG9waWMucG9sbC5wb2xsSWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgbmV3VG9waWMubGFiZWwgPSAkYy5nZXRMYWJlbChiYXNlLmdyb3VwcywgbmV3VG9waWMuZ3JvdXBUeXBlKTtcclxuICAgICAgICAgICAgICAgIG5ld1RvcGljLnRhZ0NvbG9yID0gJGMuZ2V0VGFnQ29sb3IobmV3VG9waWMubGFiZWwpO1xyXG5cclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5jcmVhdGVUb3BpY0lzSGlkZSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRhbGsuaXNFZGl0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGMuY2xlYW5BdHRhY2hlZCgkKCcjYXR0YWNoLWFyZWEtZWRpdC0nICsgdGFsay5pZCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICRjLmNsZWFuQXR0YWNoZWQoJCgnI2F0dGFjaC1kb2MtYXJlYS1lZGl0LScgKyB0YWxrLmlkKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFsay5pc0VkaXQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGMuY2xlYW5BdHRhY2hlZCgkKCcjYXR0YWNoLWFyZWEtJyArIHRhbGsuYXR0YWNoSWQpKTtcclxuICAgICAgICAgICAgICAgICAgICAkYy5jbGVhbkF0dGFjaGVkKCQoJyNhdHRhY2gtZG9jLWFyZWEtJyArIHRhbGsuYXR0YWNoSWQpKTtcclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnNlbGVjdEdyb3VwKCRyb290U2NvcGUuYmFzZS5idWZmZXJTZWxlY3RlZEdyb3VwKTtcclxuICAgICAgICAgICAgICAgICAgICB0YWxrLnN1YmplY3QgPSAkYy5URVhUX0RFRkFVTFRfNDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlV2FsbFRvcGljKGN0cmwpIHtcclxuXHJcbiAgICAgICAgICAgIGlmKGN0cmwuaXNFZGl0ICYmICEkcm9vdFNjb3BlLmN1cnJlbnRSdWJyaWMpIHtcclxuICAgICAgICAgICAgICAgIGN0cmwuc2VsZWN0ZWRSdWJyaWMgPSBjdHJsLnJ1YnJpYztcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICBjdHJsLnNlbGVjdGVkUnVicmljID0gJHJvb3RTY29wZS5jdXJyZW50UnVicmljO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdXYWxsVG9waWMnLGN0cmwuc2VsZWN0ZWRSdWJyaWMpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGN0cmwuaXNFZGl0KSB7XHJcbiAgICAgICAgICAgICAgICBjdHJsLmF0dGFjaGVkSW1hZ2VzID0gJGMuZ2V0QXR0YWNoZWRJbWFnZXMoJCgnI2F0dGFjaC1hcmVhLWVkaXQtJyArIGN0cmwuaWQpKTtcclxuICAgICAgICAgICAgICAgIGN0cmwuYXR0YWNoZWREb2NzID0gJGMuZ2V0QXR0YWNoZWREb2NzKCQoJyNhdHRhY2gtZG9jLWFyZWEtZWRpdC0nICsgY3RybC5pZCksIGN0cmwuaXNFZGl0KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGN0cmwuYXR0YWNoZWRJbWFnZXMgPSAkYy5nZXRBdHRhY2hlZEltYWdlcygkKCcjYXR0YWNoLWFyZWEtJyArIGN0cmwuYXR0YWNoSWQpKTtcclxuICAgICAgICAgICAgICAgIGN0cmwuYXR0YWNoZWREb2NzID0gJGMuZ2V0QXR0YWNoZWREb2NzKCQoJyNhdHRhY2gtZG9jLWFyZWEtJyArIGN0cmwuYXR0YWNoSWQpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGN0cmwuYXR0YWNoZWRJbWFnZXMubGVuZ3RoID09IDAgJiYgY3RybC5hdHRhY2hlZERvY3MgJiYgY3RybC5hdHRhY2hlZERvY3MubGVuZ3RoID09IDAgJiYgIWN0cmwuaXNQb2xsU2hvd1xyXG4gICAgICAgICAgICAgICAgJiYgKGN0cmwubWVzc2FnZS5jb250ZW50ID09ICRjLlRFWFRfREVGQVVMVF8xIHx8ICFjdHJsLm1lc3NhZ2UuY29udGVudCkpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBjdHJsLmlzQ3JlYXRlTWVzc2FnZUVycm9yID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGN0cmwuaXNDcmVhdGVNZXNzYWdlR3JvdXBFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgY3RybC5pc0NyZWF0ZU1lc3NhZ2VSdWJyaWNFcnJvciA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIGN0cmwuY3JlYXRlTWVzc2FnZUVycm9yVGV4dCA9IFwi0JLRiyDQvdC1INCy0LLQtdC70Lgg0YHQvtC+0LHRidC10L3QuNC1XCI7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGN0cmwuaXNQb2xsU2hvdyAmJiAoIWN0cmwucG9sbFN1YmplY3QgfHwgY3RybC5wb2xsSW5wdXRzWzBdLm5hbWUgPT0gXCJcIiB8fCBjdHJsLnBvbGxJbnB1dHNbMV0ubmFtZSA9PSBcIlwiKSkge1xyXG5cclxuICAgICAgICAgICAgICAgIGN0cmwuaXNDcmVhdGVNZXNzYWdlRXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgY3RybC5pc0NyZWF0ZU1lc3NhZ2VHcm91cEVycm9yID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBjdHJsLmlzQ3JlYXRlTWVzc2FnZVJ1YnJpY0Vycm9yID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgY3RybC5jcmVhdGVNZXNzYWdlRXJyb3JUZXh0ID0gXCLQktGLINC90LUg0YPQutCw0LfQsNC70Lgg0LTQsNC90L3Ri9C1INC00LvRjyDQvtC/0YDQvtGB0LBcIjtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSBpZighY3RybC5zZWxlY3RlZEdyb3VwKXtcclxuXHJcbiAgICAgICAgICAgICAgICBjdHJsLmlzQ3JlYXRlTWVzc2FnZUVycm9yID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBjdHJsLmlzR3JvdXBzSW5NZXNzU2hvdyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBjdHJsLmlzQ3JlYXRlTWVzc2FnZUdyb3VwRXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgY3RybC5pc0NyZWF0ZU1lc3NhZ2VSdWJyaWNFcnJvciA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgfWVsc2UgaWYoY3RybC5zZWxlY3RlZFJ1YnJpYyA9PT0gbnVsbCB8fCBjdHJsLnNlbGVjdGVkUnVicmljLmlkID09PSB1bmRlZmluZWQpe1xyXG5cclxuICAgICAgICAgICAgICAgIGN0cmwuaXNDcmVhdGVNZXNzYWdlRXJyb3IgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGN0cmwuaXNDcmVhdGVNZXNzYWdlR3JvdXBFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgY3RybC5pc0NyZWF0ZU1lc3NhZ2VSdWJyaWNFcnJvciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBjdHJsLmlzUnVicmljc0luTWVzc1Nob3cgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgfWVsc2V7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGN0cmwubWVzc2FnZS5jb250ZW50ID09ICRjLlRFWFRfREVGQVVMVF8xICYmIChjdHJsLmF0dGFjaGVkSW1hZ2VzIHx8IGN0cmwuYXR0YWNoZWREb2NzIHx8IGN0cmwuaXNQb2xsU2hvdykpIHtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLm1lc3NhZ2UuY29udGVudCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjdHJsLmlzQ3JlYXRlTWVzc2FnZUVycm9yID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBjdHJsLmlzT3Blbk1lc3NhZ2VCYXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGN0cmwuaXNHcm91cHNJbk1lc3NTaG93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBjdHJsLmlzUnVicmljc0luTWVzc1Nob3cgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdjcmVhdGVXYWxsVG9waWMnLGN0cmwuc2VsZWN0ZWRSdWJyaWMpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBpc1dhbGwgPSAxLFxyXG4gICAgICAgICAgICAgICAgICAgIG5ld1RvcGljID0gJGMucG9zdFRvcGljKGN0cmwsIGlzV2FsbCwgZmFsc2UsICRmaWx0ZXIpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChjdHJsLmlzRWRpdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRjLmNsZWFuQXR0YWNoZWQoJCgnI2F0dGFjaC1hcmVhLWVkaXQtJyArIGN0cmwuaWQpKTtcclxuICAgICAgICAgICAgICAgICAgICAkYy5jbGVhbkF0dGFjaGVkKCQoJyNhdHRhY2gtZG9jLWFyZWEtZWRpdC0nICsgY3RybC5pZCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuaXNFZGl0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN0cmwucG9sbCAmJiBuZXdUb3BpYy5wb2xsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwucG9sbC5hbHJlYWR5UG9sbCA9IG5ld1RvcGljLnBvbGwuYWxyZWFkeVBvbGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwucG9sbC5wb2xsSWQgPSBuZXdUb3BpYy5wb2xsLnBvbGxJZDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuc2VsZWN0ZWRHcm91cCA9IGN0cmwuc2VsR3JvdXBOYW1lID0gY3RybC5zZWxSdWJyaWNOYW1lID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLnNlbGVjdGVkUnVicmljID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgJGMuY2xlYW5BdHRhY2hlZCgkKCcjYXR0YWNoLWFyZWEtJyArIGN0cmwuYXR0YWNoSWQpKTtcclxuICAgICAgICAgICAgICAgICAgICAkYy5jbGVhbkF0dGFjaGVkKCQoJyNhdHRhY2gtZG9jLWFyZWEtJyArIGN0cmwuYXR0YWNoSWQpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIWN0cmwuaXNXYWxsU2luZ2xlKSAkcm9vdFNjb3BlLnNlbGVjdEdyb3VwKCRyb290U2NvcGUuYmFzZS5idWZmZXJTZWxlY3RlZEdyb3VwKTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuY3JlYXRlVG9waWMgPSBmdW5jdGlvbiAoZXZlbnQsIGN0cmwpIHtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghY3RybC5pc0VkaXQpIHtcclxuICAgICAgICAgICAgICAgICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCcubWVzc2FnZS1pbnB1dCcpLmZpbmQoJy50b3BpYy10ZXh0YXJlYScpLmhlaWdodCgkYy5URVhUQVJFQV9ERUZBVUxUX0hFSUdIVCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChjdHJsLmlzVGFsaykge1xyXG4gICAgICAgICAgICAgICAgLy8g0LfQvdCw0YfQuNGCINGN0YLQviB0YWxrXHJcbiAgICAgICAgICAgICAgICBhZGRTaW5nbGVUYWxrKGN0cmwpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8g0LfQvdCw0YfQuNGCINGN0YLQviB3YWxsXHJcbiAgICAgICAgICAgICAgICBjcmVhdGVXYWxsVG9waWMoY3RybCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVXYWxsTWVzc2FnZSh3YWxsSXRlbSkge1xyXG4gICAgICAgICAgICAvL3dhbGxJdGVtLmdyb3VwSWQgPSBsZW50YS5zZWxlY3RlZEdyb3VwSW5Ub3AuaWQ7XHJcbiAgICAgICAgICAgIHdhbGxJdGVtLmdyb3VwSWQgPSAkcm9vdFNjb3BlLmJhc2UuYnVmZmVyU2VsZWN0ZWRHcm91cC5pZDtcclxuXHJcbiAgICAgICAgICAgIHZhciBpc1dhbGwgPSB0cnVlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZSA9ICRjLnBvc3RNZXNzYWdlTXkod2FsbEl0ZW0sIGlzV2FsbCwgZmFsc2UsICRmaWx0ZXIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKG1lc3NhZ2UgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgd2FsbEl0ZW0uaXNDcmVhdGVDb21tZW50RXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgd2FsbEl0ZW0uY3JlYXRlQ29tbWVudEVycm9yVGV4dCA9IFwi0JLRiyDQvdC1INCy0LLQtdC70Lgg0YHQvtC+0LHRidC10L3QuNC1XCI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB3YWxsSXRlbS5pc0NyZWF0ZUNvbW1lbnRFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgYmFzZS5pbml0U3RhcnRQYXJhbXNGb3JDcmVhdGVNZXNzYWdlKG1lc3NhZ2UpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh3YWxsSXRlbS5tZXNzYWdlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHdhbGxJdGVtLm1lc3NhZ2VzLnB1c2gobWVzc2FnZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtZXNMZW4gPSB3YWxsSXRlbS5tZXNzYWdlcy5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIChtZXNMZW4gPj0gJHJvb3RTY29wZS5DT01NRU5UU19ERUZBVUxUX0NPVU5UICYmICF3YWxsSXRlbS5pc09wZW4pID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgd2FsbEl0ZW0uYnVmZmVyTWVzc2FnZXMgPSB3YWxsSXRlbS5tZXNzYWdlcy5zbGljZShtZXNMZW4gLSAkcm9vdFNjb3BlLkNPTU1FTlRTX0RFRkFVTFRfQ09VTlQpIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2FsbEl0ZW0uYnVmZmVyTWVzc2FnZXMgPSB3YWxsSXRlbS5tZXNzYWdlcztcclxuXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHdhbGxJdGVtLm1lc3NhZ2VzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgd2FsbEl0ZW0ubWVzc2FnZXNbMF0gPSBtZXNzYWdlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB3YWxsSXRlbS5idWZmZXJNZXNzYWdlcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIHdhbGxJdGVtLmJ1ZmZlck1lc3NhZ2VzWzBdID0gd2FsbEl0ZW0ubWVzc2FnZXNbMF07XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBhZGRTaW5nbGVGaXJzdE1lc3NhZ2UodGFsaykge1xyXG4gICAgICAgICAgICBpZiAodGFsay5mdWxsVGFsa1RvcGljKXRhbGsudG9waWNJZCA9IHRhbGsuZnVsbFRhbGtUb3BpYy5pZDtcclxuXHJcbiAgICAgICAgICAgIHRhbGsubWVzc2FnZUlkID0gdGFsay5pZDtcclxuXHJcbiAgICAgICAgICAgIHZhciBpc1dhbGwgPSBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGlzRmlyc3RMZXZlbCA9IHRydWUsXHJcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlID0gJGMucG9zdE1lc3NhZ2VNeSh0YWxrLCBpc1dhbGwsIGlzRmlyc3RMZXZlbCwgJGZpbHRlcik7XHJcblxyXG4gICAgICAgICAgICBpZiAobmV3TWVzc2FnZSA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICB0YWxrLmlzQ3JlYXRlRmlyc3RNZXNzYWdlRXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGFsay5jcmVhdGVGaXJzdE1lc3NhZ2VFcnJvclRleHQgPSBcItCS0Ysg0L3QtSDQstCy0LXQu9C4INGB0L7QvtCx0YnQtdC90LjQtVwiO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa1RvcGljID9cclxuICAgICAgICAgICAgICAgICAgICB0YWxrLmZ1bGxUYWxrVG9waWMuYW5zd2VySW5wdXRJc1Nob3cgPSBmYWxzZSA6XHJcbiAgICAgICAgICAgICAgICAgICAgdGFsay5hbnN3ZXJJbnB1dElzU2hvdyA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIHRhbGsuaXNDcmVhdGVGaXJzdE1lc3NhZ2VFcnJvciA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIC8qaWYodGFsay5mdWxsVGFsa1RvcGljICYmICF0YWxrLmZ1bGxUYWxrRmlyc3RNZXNzYWdlcyl7XHJcbiAgICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa0ZpcnN0TWVzc2FnZXMgPSBbXTtcclxuICAgICAgICAgICAgICAgICB0YWxrLmZ1bGxUYWxrRmlyc3RNZXNzYWdlc1swXSA9IG5ld01lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICAgfSovXHJcblxyXG4gICAgICAgICAgICAgICAgdGFsay5pc0VkaXQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGFsay5mdWxsVGFsa1RvcGljKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhbGsuZnVsbFRhbGtGaXJzdE1lc3NhZ2VzKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFsay5mdWxsVGFsa0ZpcnN0TWVzc2FnZXMubGVuZ3RoIDwgMTAgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5pc0VhcmxpZXN0TWVzc2FnZXMgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5lbmRPZkxvYWRlZCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5sYXN0TG9hZGVkSWQgPSBuZXdNZXNzYWdlLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa0ZpcnN0TWVzc2FnZXMucHVzaChuZXdNZXNzYWdlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa0ZpcnN0TWVzc2FnZXMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa0ZpcnN0TWVzc2FnZXNbMF0gPSBuZXdNZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UubGFzdExvYWRlZElkID0gbmV3TWVzc2FnZS5pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmlzRWFybGllc3RNZXNzYWdlcyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWRkU2luZ2xlTWVzc2FnZShmaXJzdE1lc3NhZ2UsIHRvcGljSWQsIHRhbGssIG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgaWYgKCF0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXSlcclxuICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdID1cclxuICAgICAgICAgICAgICAgICAgICAkYy5tZXNzYWdlQ2xpZW50LmdldE1lc3NhZ2VzKHRvcGljSWQsIHRhbGsuc2VsZWN0ZWRHcm91cC5pZCwgMSwgZmlyc3RNZXNzYWdlLmlkLCAwLCAxMDAwKS5tZXNzYWdlcztcclxuXHJcbiAgICAgICAgICAgIHZhciBmdWxsVGFsa01lc3NhZ2VzTGVuZ3RoO1xyXG4gICAgICAgICAgICB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXSA/XHJcbiAgICAgICAgICAgICAgICBmdWxsVGFsa01lc3NhZ2VzTGVuZ3RoID0gdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF0ubGVuZ3RoIDpcclxuICAgICAgICAgICAgICAgIGZ1bGxUYWxrTWVzc2FnZXNMZW5ndGggPSAwO1xyXG5cclxuICAgICAgICAgICAgdmFyIG5ld01lc3NhZ2UsIGFuc3dlciwgcGFyZW50SWQ7XHJcblxyXG4gICAgICAgICAgICBpZiAoIW1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgIC8vINC10YHQu9C4INC00L7QsdCw0LLQu9GP0LXQvCDQuiDRgdC+0L7QsdGJ0LXQvdC40Y4g0L/QtdGA0LLQvtCz0L4g0YPRgNC+0LLQvdGPXHJcbiAgICAgICAgICAgICAgICB0YWxrLm1lc3NhZ2VJZCA9IGZpcnN0TWVzc2FnZS5pZDtcclxuICAgICAgICAgICAgICAgIHRhbGsubWVzc2FnZSA9IGZpcnN0TWVzc2FnZTtcclxuXHJcbiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBmaXJzdE1lc3NhZ2UuY29tbWVudFRleHQ7XHJcbiAgICAgICAgICAgICAgICBmaXJzdE1lc3NhZ2UuaXNUcmVlT3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBmaXJzdE1lc3NhZ2UuY29tbWVudFRleHQgPSAkYy5URVhUX0RFRkFVTFRfMjtcclxuICAgICAgICAgICAgICAgIHBhcmVudElkID0gZmlyc3RNZXNzYWdlLmlkO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghZmlyc3RNZXNzYWdlLmNoaWxkQ291bnQgfHwgZmlyc3RNZXNzYWdlLmNoaWxkQ291bnQgPT0gMCkgZmlyc3RNZXNzYWdlLmNoaWxkQ291bnQgPSAxO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vINC10YHQu9C4INC00L7QsdCw0LLQu9GP0LXQvCDQuiDQv9GA0L7RgdGC0L7QvNGDINGB0L7QvtCx0YnQtdC90LjRjlxyXG4gICAgICAgICAgICAgICAgdGFsay5tZXNzYWdlSWQgPSBtZXNzYWdlLmlkO1xyXG4gICAgICAgICAgICAgICAgdGFsay5tZXNzYWdlID0gbWVzc2FnZTtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZ1bGxUYWxrTWVzc2FnZXNMZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXVtpXS5pZCA9PSBtZXNzYWdlLmlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uYW5zd2VySW5wdXRJc1Nob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uaXNUcmVlT3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmlzT3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmlzUGFyZW50T3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmNyZWF0ZWRFZGl0ID0gJGMuZ2V0VGltaW5nKHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmNyZWF0ZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbnN3ZXIgPSB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXVtpXS5jb21tZW50VGV4dDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBwYXJlbnRJZCA9IG1lc3NhZ2UuaWQ7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBpc1dhbGwgPSBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGlzRmlyc3RMZXZlbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0YWxrLnRvcGljSWQgPSB0b3BpY0lkO1xyXG4gICAgICAgICAgICB0YWxrLnBhcmVudElkID0gcGFyZW50SWQ7XHJcbiAgICAgICAgICAgIHRhbGsuY29tbWVudFRleHQgPSBhbnN3ZXI7XHJcblxyXG4gICAgICAgICAgICBuZXdNZXNzYWdlID0gJGMucG9zdE1lc3NhZ2VNeSh0YWxrLCBpc1dhbGwsIGlzRmlyc3RMZXZlbCwgJGZpbHRlcik7XHJcblxyXG4gICAgICAgICAgICBpZiAobmV3TWVzc2FnZSA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICB0YWxrLmlzQ3JlYXRlTWVzc2FnZVRvRmlyc3RFcnJvciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFsay5jcmVhdGVNZXNzYWdlVG9GaXJzdEVycm9yVGV4dCA9IFwi0JLRiyDQvdC1INCy0LLQtdC70Lgg0YHQvtC+0LHRidC10L3QuNC1XCI7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRhbGsuaXNDcmVhdGVNZXNzYWdlRXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRhbGsuY3JlYXRlTWVzc2FnZUVycm9yVGV4dCA9IFwi0JLRiyDQvdC1INCy0LLQtdC70Lgg0YHQvtC+0LHRidC10L3QuNC1XCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICB0YWxrLmlzQ3JlYXRlTWVzc2FnZVRvRmlyc3RFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGZpcnN0TWVzc2FnZS5hbnN3ZXJJbnB1dElzU2hvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGZpcnN0TWVzc2FnZS5pc0VkaXQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRhbGsuaXNDcmVhdGVNZXNzYWdlRXJyb3IgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZ1bGxUYWxrTWVzc2FnZXNMZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uaWQgPT0gbWVzc2FnZS5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uYW5zd2VySW5wdXRJc1Nob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmlzRWRpdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdID0gJGMubWVzc2FnZUNsaWVudC5nZXRNZXNzYWdlcyh0b3BpY0lkLCB0YWxrLnNlbGVjdGVkR3JvdXAuaWQsIDEsIGZpcnN0TWVzc2FnZS5pZCwgMCwgMTAwMCkubWVzc2FnZXM7XHJcblxyXG4gICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF0gP1xyXG4gICAgICAgICAgICAgICAgICAgIGZ1bGxUYWxrTWVzc2FnZXNMZW5ndGggPSB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXS5sZW5ndGggOlxyXG4gICAgICAgICAgICAgICAgICAgIGZ1bGxUYWxrTWVzc2FnZXNMZW5ndGggPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZnVsbFRhbGtNZXNzYWdlc0xlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uYW5zd2VySW5wdXRJc1Nob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXVtpXS5pc1RyZWVPcGVuID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXVtpXS5pc09wZW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmlzUGFyZW50T3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uY3JlYXRlZEVkaXQgPSAkYy5nZXRUaW1pbmcodGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uY3JlYXRlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uY29tbWVudFRleHQgPSAkYy5URVhUX0RFRkFVTFRfMjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWRkRGlhbG9nTWVzc2FnZShjdHJsKSB7XHJcbiAgICAgICAgICAgIHZhciBhdHRhY2ggPSBbXTtcclxuXHJcbiAgICAgICAgICAgIGlmICgoY3RybC5jb21tZW50VGV4dCAhPSAkYy5URVhUX0RFRkFVTFRfMSAmJiBjdHJsLmNvbW1lbnRUZXh0ICE9IFwiXCIpIHx8IGF0dGFjaC5sZW5ndGggIT0gMCkge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChjdHJsLmlzRWRpdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vINC30L3QsNGH0LjRgiDRgNC10LTQsNC60YLQuNGA0L7QstCw0L3QuNC1XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhdHRhY2hJbWcgPSAkYy5nZXRBdHRhY2hlZEltYWdlcygkKCcjYXR0YWNoLWFyZWEtZWRpdC0nICsgY3RybC5hdHRhY2hJZCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhdHRhY2hEb2MgPSAkYy5nZXRBdHRhY2hlZERvY3MoJCgnI2F0dGFjaC1kb2MtYXJlYS1lZGl0LScgKyBjdHJsLmF0dGFjaElkKSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYXR0YWNoID0gYXR0YWNoSW1nLmNvbmNhdChhdHRhY2hEb2MpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyDQtdGJ0LUgYXR0YWNoXHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5jb21tZW50VGV4dCA9ICRmaWx0ZXIoJ2xpbmt5JykoY3RybC5jb21tZW50VGV4dCwgJ2JsYW5rJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5jb21tZW50VGV4dCA9ICRjLndpdGhUYWdzKGN0cmwuY29tbWVudFRleHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICRjLmRpYWxvZ0NsaWVudC51cGRhdGVEaWFsb2dNZXNzYWdlKGN0cmwuaWQsIGN0cmwuY29tbWVudFRleHQsIGF0dGFjaCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRjLmNsZWFuQXR0YWNoZWQoJCgnI2F0dGFjaC1hcmVhLWVkaXQtJyArIGN0cmwuYXR0YWNoSWQpKTtcclxuICAgICAgICAgICAgICAgICAgICAkYy5jbGVhbkF0dGFjaGVkKCQoJyNhdHRhY2gtZG9jLWFyZWEtZWRpdC0nICsgY3RybC5hdHRhY2hJZCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjdHJsLmNvbnRlbnQgPSBjdHJsLmNvbW1lbnRUZXh0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjdHJsLmltYWdlcyA9IGF0dGFjaEltZztcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLmRvY3VtZW50cyA9IGF0dGFjaERvYztcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLmlzRWRpdCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g0LfQvdCw0YfQuNGCINGB0L7Qt9C00LDQvdC40LVcclxuICAgICAgICAgICAgICAgICAgICBhdHRhY2ggPSAkYy5nZXRBdHRhY2hlZEltYWdlcygkKCcjYXR0YWNoLWFyZWEtJyArIGN0cmwuYXR0YWNoSWQpKS5jb25jYXQoJGMuZ2V0QXR0YWNoZWREb2NzKCQoJyNhdHRhY2gtZG9jLWFyZWEtJyArIGN0cmwuYXR0YWNoSWQpKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXdEaWFsb2dNZXNzYWdlID0gbmV3IGNvbS52bWVzdGVvbmxpbmUuYmUudGhyaWZ0Lm1lc3NhZ2VzZXJ2aWNlLkRpYWxvZ01lc3NhZ2UoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgKGN0cmwuY29tbWVudFRleHQgPT0gJGMuVEVYVF9ERUZBVUxUXzEpID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3RGlhbG9nTWVzc2FnZS5jb250ZW50ID0gXCJcIiA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0RpYWxvZ01lc3NhZ2UuY29udGVudCA9IGN0cmwuY29tbWVudFRleHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIG5ld0RpYWxvZ01lc3NhZ2UuYXV0aG9yID0gJHJvb3RTY29wZS5iYXNlLm1lLmlkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBuZXdEaWFsb2dNZXNzYWdlLmNyZWF0ZWQgPSBEYXRlLnBhcnNlKG5ldyBEYXRlKCkpIC8gMTAwMDtcclxuICAgICAgICAgICAgICAgICAgICBuZXdEaWFsb2dNZXNzYWdlLmF1dGhvclByb2ZpbGUgPSAkYy51c2VyQ2xpZW50LmdldFVzZXJQcm9maWxlKG5ld0RpYWxvZ01lc3NhZ2UuYXV0aG9yKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbmV3RGlhbG9nTWVzc2FnZS5jb250ZW50ID0gJGZpbHRlcignbGlua3knKShuZXdEaWFsb2dNZXNzYWdlLmNvbnRlbnQsICdibGFuaycpO1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld0RpYWxvZ01lc3NhZ2UuY29udGVudCA9ICRjLndpdGhUYWdzKG5ld0RpYWxvZ01lc3NhZ2UuY29udGVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXBNZXNzYWdlID0gJGMuZGlhbG9nQ2xpZW50LnBvc3RNZXNzYWdlKGN0cmwuZGlhbG9nSWQsIG5ld0RpYWxvZ01lc3NhZ2UuY29udGVudCwgYXR0YWNoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbmV3RGlhbG9nTWVzc2FnZS5pbWFnZXMgPSB0ZW1wTWVzc2FnZS5pbWFnZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3RGlhbG9nTWVzc2FnZS5kb2N1bWVudHMgPSB0ZW1wTWVzc2FnZS5kb2N1bWVudHM7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3RGlhbG9nTWVzc2FnZS5pZCA9IHRlbXBNZXNzYWdlLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld0RpYWxvZ01lc3NhZ2UuaXNEaWFsb2cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld0RpYWxvZ01lc3NhZ2UuYXR0YWNoSWQgPSBjdHJsLmRpYWxvZ0lkICsgXCItXCIgKyBuZXdEaWFsb2dNZXNzYWdlLmlkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL2N0cmwucHJpdmF0ZU1lc3NhZ2VzLnVuc2hpZnQobmV3RGlhbG9nTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLnByaXZhdGVNZXNzYWdlcy51bnNoaWZ0KG5ld0RpYWxvZ01lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5pbml0U3RhcnRQYXJhbXNGb3JDcmVhdGVNZXNzYWdlKG5ld0RpYWxvZ01lc3NhZ2UpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoY3RybC5wcml2YXRlTWVzc2FnZXMubGVuZ3RoID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g0L3QsCDRgdC70YPRh9Cw0Lkg0LXRgdC70Lgg0YEgMCDQtNC+0LHQsNCy0LvRj9C10YLRgdGPINCx0L7Qu9C10LUgMjAg0YHQvtC+0LHRidC10L3QuNC5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vINGH0YLQvtCx0Ysg0L/QvtC00LPRgNGD0LbQsNC7INC+0YIgMdCz0L4g0YHQvtC+0LHRidC10L3QuNGPINCwINC90LUg0L7RgiAwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5sYXN0TG9hZGVkSWQgPSBuZXdEaWFsb2dNZXNzYWdlLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5jb21tZW50VGV4dCA9ICRjLlRFWFRfREVGQVVMVF8xO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkYy5jbGVhbkF0dGFjaGVkKCQoJyNhdHRhY2gtYXJlYS0nICsgY3RybC5hdHRhY2hJZCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICRjLmNsZWFuQXR0YWNoZWQoJCgnI2F0dGFjaC1kb2MtYXJlYS0nICsgY3RybC5hdHRhY2hJZCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuY3JlYXRlTWVzc2FnZSA9IGZ1bmN0aW9uIChlLCBjdHJsLCB0b3BpY0lkLCB0YWxrLCBtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghY3RybC5pc0VkaXQpIHtcclxuICAgICAgICAgICAgICAgICQoZS50YXJnZXQpLmNsb3Nlc3QoJy5hbnN3ZXItYmxvY2snKS5maW5kKCcubWVzc2FnZS10ZXh0YXJlYScpLmhlaWdodCgkYy5URVhUQVJFQV9ERUZBVUxUX0hFSUdIVCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChjdHJsLmlzVGFsaykge1xyXG4gICAgICAgICAgICAgICAgLy9hbGVydCgnMTExICcrY3RybC5mdWxsQWR2ZXJ0VG9waWMrXCIgXCIrY3RybC5wYXJlbnRJZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoKGN0cmwuZnVsbFRhbGtUb3BpYyB8fCBjdHJsLnBhcmVudElkID09IDApICYmICF0b3BpY0lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9hbGVydCgnMScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGFkZFNpbmdsZUZpcnN0TWVzc2FnZShjdHJsKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vYWxlcnQoJzInKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWRkU2luZ2xlTWVzc2FnZShjdHJsLCB0b3BpY0lkLCB0YWxrKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2FsZXJ0KCczJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZFNpbmdsZU1lc3NhZ2UobWVzc2FnZSwgdG9waWNJZCwgdGFsaywgY3RybCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSBlbHNlIGlmIChjdHJsLmlzRGlhbG9nKSB7XHJcbiAgICAgICAgICAgICAgICBhZGREaWFsb2dNZXNzYWdlKGN0cmwpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY3JlYXRlV2FsbE1lc3NhZ2UoY3RybCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgYmFzZS5pbml0U3RhcnRQYXJhbXNGb3JDcmVhdGVNZXNzYWdlID0gZnVuY3Rpb24gKGN0cmwpIHtcclxuXHJcbiAgICAgICAgICAgIGN0cmwuaXNFZGl0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGN0cmwuYW5zd2VyU2hvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBjdHJsLmlzRm9jdXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgY3RybC5pc0NyZWF0ZUNvbW1lbnRFcnJvciA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgaWYgKGN0cmwuaXNEaWFsb2cpIHtcclxuICAgICAgICAgICAgICAgIGN0cmwuZGVmYXVsdCA9IGN0cmwuY29tbWVudFRleHQgPSAkYy5URVhUX0RFRkFVTFRfMTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGN0cmwuZGVmYXVsdCA9IGN0cmwuY29tbWVudFRleHQgPSAkYy5URVhUX0RFRkFVTFRfMjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGN0cmwuaWQgfHwgY3RybC5pc0RpYWxvZykge1xyXG4gICAgICAgICAgICAgICAgLy8g0LfQsNC90YfQuNGCINGA0LXQtNCw0LrRgtC40YDQvtCy0LDQvdC40LVcclxuICAgICAgICAgICAgICAgIGlmICghY3RybC5pc1RhbGspIGN0cmwuY29tbWVudFRleHQgPSBjdHJsLmNvbnRlbnQ7XHJcbiAgICAgICAgICAgICAgICBjdHJsLmFuc3dlclNob3cgPSB0cnVlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8g0LfQvdCw0YfQuNGCINGB0L7Qt9C00LDQvdC40LVcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBiYXNlLmdldFVzZXJDb2xvciA9IGZ1bmN0aW9uIChncm91cFR5cGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRjLmdldFRhZ0NvbG9yKCRjLmdldExhYmVsKGJhc2UuZ3JvdXBzLCBncm91cFR5cGUpKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBiYXNlLnRvZ2dsZUZ1bGxUZXh0ID0gZnVuY3Rpb24gKGN0cmwpIHtcclxuICAgICAgICAgICAgY3RybC5pc0Z1bGxUZXh0ID8gY3RybC5pc0Z1bGxUZXh0ID0gZmFsc2UgOiBjdHJsLmlzRnVsbFRleHQgPSB0cnVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGJhc2Uuc2V0UHJpdmF0ZU1lc3NhZ2VzID0gZnVuY3Rpb24gKGRpYWxvZ0lkLCBsb2FkZWRMZW5ndGgpIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5wcml2YXRlTWVzc2FnZXMgPSAkYy5kaWFsb2dDbGllbnQuZ2V0RGlhbG9nTWVzc2FnZXMoZGlhbG9nSWQsIDAsIGxvYWRlZExlbmd0aCwgMCk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnZGlhbG9ncycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBwcml2YXRlTWVzc2FnZXNMZW5ndGggPSAkcm9vdFNjb3BlLmJhc2UucHJpdmF0ZU1lc3NhZ2VzLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIGlmIChwcml2YXRlTWVzc2FnZXNMZW5ndGggIT0gMCkgJHJvb3RTY29wZS5iYXNlLmxhc3RMb2FkZWRJZCA9ICRyb290U2NvcGUuYmFzZS5wcml2YXRlTWVzc2FnZXNbcHJpdmF0ZU1lc3NhZ2VzTGVuZ3RoIC0gMV0uaWQ7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByaXZhdGVNZXNzYWdlc0xlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UucHJpdmF0ZU1lc3NhZ2VzW2ldLmF1dGhvclByb2ZpbGUgPSAkYy51c2VyQ2xpZW50LmdldFVzZXJQcm9maWxlKCRyb290U2NvcGUuYmFzZS5wcml2YXRlTWVzc2FnZXNbaV0uYXV0aG9yKTtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5wcml2YXRlTWVzc2FnZXNbaV0uaXNEaWFsb2cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLnByaXZhdGVNZXNzYWdlc1tpXS5hdHRhY2hJZCA9IGRpYWxvZ0lkICsgXCItXCIgKyAkcm9vdFNjb3BlLmJhc2UucHJpdmF0ZU1lc3NhZ2VzW2ldLmlkO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmluaXRTdGFydFBhcmFtc0ZvckNyZWF0ZU1lc3NhZ2UoJHJvb3RTY29wZS5iYXNlLnByaXZhdGVNZXNzYWdlc1tpXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBiYXNlLm5ld1ByaXZhdGVNZXNzYWdlc0NvdW50ID0gMDtcclxuICAgICAgICBiYXNlLmJpZ2dlc3RDb3VudERpYWxvZ0lkID0gMDtcclxuICAgICAgICAkcm9vdFNjb3BlLm5ld01lc3NhZ2VzID0gW107XHJcbiAgICAgICAgJHJvb3RTY29wZS5uZXdJbXBvcnRhbnRDb3VudCA9IDA7XHJcblxyXG4gICAgICAgIHZhciB0aW1lU3RhbXAgPSAwO1xyXG4gICAgICAgIGJhc2UuY2hlY2tVcGRhdGVzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgdGltZVN0YW1wID0gJGMubWVzc2FnZUNsaWVudC5jaGVja1VwZGF0ZXModGltZVN0YW1wKTtcclxuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24ucmVwbGFjZSgnL2xvZ2luJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciB1cGRhdGVNYXAsXHJcbiAgICAgICAgICAgICAgICBvbGQgPSAwO1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ3RpbWVzdGVtcCAnICsgdGltZVN0YW1wKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aW1lU3RhbXAgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVNYXAgPSAkYy5tZXNzYWdlQ2xpZW50LmdldERpYWxvZ1VwZGF0ZXMoKTtcclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5yZXBsYWNlKCcvbG9naW4nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gMCxcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50RGlhbG9nSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgY291bnRlciA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYoJHJvb3RTY29wZS5iYXNlICYmICRyb290U2NvcGUuYmFzZS5jdXJyZW50RGlhbG9nSWQpY3VycmVudERpYWxvZ0lkID0gJHJvb3RTY29wZS5iYXNlLmN1cnJlbnREaWFsb2dJZDtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5uZXdNZXNzYWdlcyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGRpYWxvZ0lkIGluIHVwZGF0ZU1hcCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUubmV3TWVzc2FnZXNbY291bnRlcisrXSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nSWQ6IGRpYWxvZ0lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogdXBkYXRlTWFwW2RpYWxvZ0lkXVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRpYWxvZ0lkICE9IGN1cnJlbnREaWFsb2dJZCB8fCAkcm9vdFNjb3BlLmN1cnJlbnRQYWdlICE9ICdkaWFsb2ctc2luZ2xlJykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcCArPSB1cGRhdGVNYXBbZGlhbG9nSWRdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVwZGF0ZU1hcFtkaWFsb2dJZF0gPiBvbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2UuYmlnZ2VzdENvdW50RGlhbG9nSWQgPSBkaWFsb2dJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgb2xkID0gdXBkYXRlTWFwW2RpYWxvZ0lkXTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYXNlLnNldFByaXZhdGVNZXNzYWdlcyhjdXJyZW50RGlhbG9nSWQsIDIwKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgYmFzZS5uZXdQcml2YXRlTWVzc2FnZXNDb3VudCA9IHRlbXA7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGRpZ2VzdCgpO1xyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnInKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGltZVN0YW1wID09IDEpIHtcclxuICAgICAgICAgICAgICAgIC8vIG5vdGlmaWNhdGlvblxyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5uZXdNZXNzYWdlcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgYmFzZS5tZS5ub3RpZmljYXRpb25Jc1Nob3cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgYmFzZS5tZS51c2VyTm90aWZpY2F0aW9uID0gJGMubWVzc2FnZUNsaWVudC5nZXRNdWx0aWNhc3RNZXNzYWdlKCk7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRpbWVTdGFtcCA+PSAyICYmIHRpbWVTdGFtcCA8IDEwMDAwKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpbXBvcnRhbnQgbWVzc2FnZXNcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdpbXBvcnRhbnQgJyArIHRpbWVTdGFtcCk7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLm5ld01lc3NhZ2VzID0gW107XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLm5ld0ltcG9ydGFudENvdW50ID0gdGltZVN0YW1wO1xyXG5cclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuaW1wb3J0YW50VG9waWNzID0gJGMubWVzc2FnZUNsaWVudC5nZXRJbXBvcnRhbnROZXdzKCRyb290U2NvcGUuY3VycmVudEdyb3VwLmlkKTtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLm5ld01lc3NhZ2VzID0gW107XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLm5ld0ltcG9ydGFudENvdW50ID0gMDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBzZXRJbnRlcnZhbChiYXNlLmNoZWNrVXBkYXRlcywgNTAwMCk7XHJcblxyXG4gICAgICAgIGJhc2UubmV4dE5vdGlmaWNhdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgYmFzZS5tZS51c2VyTm90aWZpY2F0aW9uID0gJGMubWVzc2FnZUNsaWVudC5nZXROZXh0TXVsdGljYXN0TWVzc2FnZSgpO1xyXG4gICAgICAgICAgICBpZiAoIWJhc2UubWUudXNlck5vdGlmaWNhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgYmFzZS5tZS5ub3RpZmljYXRpb25Jc1Nob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGJhc2UuZ3JvdXBBZGRyZXNlc0xpc3QgPSBbXTtcclxuICAgICAgICBiYXNlLmlzQWRkcmVzZXNMaXN0U2hvdyA9IFtdO1xyXG4gICAgICAgIGJhc2Uuc2hvd0dyb3VwQWRyZXNzZXNMaXN0ID0gZnVuY3Rpb24obWVzc2FnZUlkKXtcclxuICAgICAgICAgICAgaWYoIWJhc2UuZ3JvdXBBZGRyZXNlc0xpc3RbbWVzc2FnZUlkXSkge1xyXG4gICAgICAgICAgICAgICAgYmFzZS5ncm91cEFkZHJlc2VzTGlzdFttZXNzYWdlSWRdID0gJGMudXNlckNsaWVudC5nZXRBZGRyZXNzTGlzdEJ5TWVzc2FnZUlkKG1lc3NhZ2VJZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYmFzZS5pc0FkZHJlc2VzTGlzdFNob3dbbWVzc2FnZUlkXSA9IHRydWU7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBiYXNlLmhpZGVHcm91cEFkcmVzc2VzTGlzdCA9IGZ1bmN0aW9uKG1lc3NhZ2VJZCl7XHJcbiAgICAgICAgICAgIGJhc2UuaXNBZGRyZXNlc0xpc3RTaG93W21lc3NhZ2VJZF0gPSBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBiYXNlLnVzZXJNZW51VG9nZ2xlID0gZnVuY3Rpb24oJGV2ZW50KXtcclxuICAgICAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgYmFzZS5pc1VzZXJNZW51U2hvdyA/IGJhc2UuaXNVc2VyTWVudVNob3cgPSBmYWxzZSA6IGJhc2UuaXNVc2VyTWVudVNob3cgPSB0cnVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGJhc2UuaXNBdHRhY2hEcm9wZG93blNob3cgPSBbXTtcclxuICAgICAgICBiYXNlLmlzSGFzaHRhZ0Ryb3Bkb3duU2hvdyA9IGZhbHNlO1xyXG4gICAgICAgIGJhc2UuaXNSdWJyaWNzRHJvcGRvd25TaG93ID0gZmFsc2U7XHJcblxyXG4gICAgICAgIGJhc2UudG9nZ2xlQXR0YWNoRHJvcGRvd24gPSBmdW5jdGlvbigkZXZlbnQsY3RybCxjdHJsSWQpe1xyXG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgaWQ7XHJcbiAgICAgICAgICAgIGlmKGN0cmwpIHtcclxuICAgICAgICAgICAgICAgIChjdHJsLmlzRWRpdCkgPyBpZCA9IGN0cmwuaWQgOiBpZCA9IGN0cmwuYXR0YWNoSWQ7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgaWQgPSBjdHJsSWQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGJhc2UuaXNBdHRhY2hEcm9wZG93blNob3dbaWRdID9cclxuICAgICAgICAgICAgICAgIGJhc2UuaXNBdHRhY2hEcm9wZG93blNob3dbaWRdID0gZmFsc2UgOlxyXG4gICAgICAgICAgICAgICAgICAgIGJhc2UuaXNBdHRhY2hEcm9wZG93blNob3dbaWRdID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coJzMnLGlkLGJhc2UuaXNBdHRhY2hEcm9wZG93blNob3dbaWRdKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGJhc2UudG9nZ2xlSGFzaHRhZ0Ryb3Bkb3duID0gZnVuY3Rpb24oJGV2ZW50KXtcclxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICBiYXNlLmlzSGFzaHRhZ0Ryb3Bkb3duU2hvdyA/IGJhc2UuaXNIYXNodGFnRHJvcGRvd25TaG93ID0gZmFsc2UgOiBiYXNlLmlzSGFzaHRhZ0Ryb3Bkb3duU2hvdyA9IHRydWU7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBiYXNlLnRvZ2dsZVJ1YnJpY3NEcm9wZG93biA9IGZ1bmN0aW9uKCRldmVudCl7XHJcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgYmFzZS5pc1J1YnJpY3NEcm9wZG93blNob3cgPyBiYXNlLmlzUnVicmljc0Ryb3Bkb3duU2hvdyA9IGZhbHNlIDogYmFzZS5pc1J1YnJpY3NEcm9wZG93blNob3cgPSB0cnVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGJhc2UuaGlkZURyb3Bkb3duID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgYmFzZS5pc1VzZXJNZW51U2hvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBiYXNlLmlzQXR0YWNoRHJvcGRvd25TaG93ID0gW107XHJcbiAgICAgICAgICAgIGJhc2UuaXNIYXNodGFnRHJvcGRvd25TaG93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGJhc2UuaXNSdWJyaWNzRHJvcGRvd25TaG93ID0gZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgYmFzZS5jb250ZW50TGVuZ3RoID0gNTAwO1xyXG5cclxuICAgICAgICAvKnZhciBsc0dyb3VwSWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZ3JvdXBJZCcpLFxyXG4gICAgICAgICAgICBncm91cHNMZW5ndGggPSBiYXNlLmdyb3Vwcy5sZW5ndGg7Ki9cclxuXHJcbiAgICAgICAgLyppZiAoIWxzR3JvdXBJZCkgeyovXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudEdyb3VwID0gJGMuZ2V0RGVmYXVsdEdyb3VwKGJhc2UuZ3JvdXBzKTtcclxuICAgICAgICAvKn0gZWxzZSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ3JvdXBzTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChiYXNlLmdyb3Vwc1tpXS5pZCA9PSBsc0dyb3VwSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRHcm91cCA9IGJhc2UuZ3JvdXBzW2ldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghJHJvb3RTY29wZS5jdXJyZW50R3JvdXApIHtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudEdyb3VwID0gJGMuZ2V0RGVmYXVsdEdyb3VwKGJhc2UuZ3JvdXBzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0qL1xyXG5cclxuICAgICAgICBiYXNlLmlzTGVudGFGb2N1cyA9IGZhbHNlO1xyXG5cclxuICAgICAgICBiYXNlLmNoZWNrVXBkYXRlcygpO1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRQYWdlID0gJ2xlbnRhJztcclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS5sZWZ0YmFyID0ge307XHJcbiAgICB9XHJcblxyXG4gICAgJHJvb3RTY29wZS5iYXNlID0gYmFzZTtcclxuXHJcbiAgICB9O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBbICckc2NvcGUnLCckcm9vdFNjb3BlJywnJHN0YXRlJywnJGZpbHRlcicsJyRsb2NhdGlvbicsJyRjJywgYmFzZUN0cmwgXTsiLCJcclxudmFyIGJsb2dDdHJsID0gZnVuY3Rpb24oJHJvb3RTY29wZSwkYykge1xyXG4gICAgdmFyIGJsb2cgPSB0aGlzO1xyXG5cclxuICAgICRyb290U2NvcGUuYmFzZS5pc0Zvb3RlckJvdHRvbSA9IHRydWU7XHJcblxyXG4gICAgYmxvZy5pc0F1dGggPSAkYy5hdXRoQ2xpZW50LmNoZWNrSWZBdXRob3JpemVkKCk7XHJcblxyXG4gICAgaWYoYmxvZy5pc0F1dGgpe1xyXG4gICAgICAgIC8vbWUgPSB1c2VyQ2xpZW50LmdldFVzZXJQcm9maWxlKCk7XHJcbiAgICAgICAgLy8kKCcuYW5vbk5hbWUnKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XHJcbiAgICB9XHJcblxyXG4gICAgYmxvZy5wb3N0cyA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0QmxvZygwLDEwMDApO1xyXG5cclxuICAgIHZhciBsZW4gPSBibG9nLnBvc3RzLnRvcGljcy5sZW5ndGg7XHJcbiAgICBmb3IodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspe1xyXG4gICAgICAgIGJsb2cucG9zdHMudG9waWNzW2ldLmlzQ29tbWVudFNob3cgPSBmYWxzZTtcclxuICAgICAgICBibG9nLnBvc3RzLnRvcGljc1tpXS5pc0lucHV0U2hvdyA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGJsb2cudG9nZ2xlQ29tbSA9IGZ1bmN0aW9uKCRldmVudCxwb3N0KXtcclxuICAgICAgICAkZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgaWYgKHBvc3QuaXNDb21tZW50U2hvdyl7XHJcbiAgICAgICAgICAgIHBvc3QuaXNDb21tZW50U2hvdyA9IGZhbHNlO1xyXG5cclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgcG9zdC5pc0NvbW1lbnRTaG93ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIGlmKCFwb3N0LmNvbW1lbnRzKSB7XHJcbiAgICAgICAgICAgICAgICBwb3N0LmNvbW1lbnRzID0gJGMubWVzc2FnZUNsaWVudC5nZXRNZXNzYWdlc0FzTGlzdChwb3N0LmlkLCA3LCAwLCBmYWxzZSwgMTAwMCkubWVzc2FnZXM7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZmluaXNoJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICBibG9nLnRvZ2dsZUlucHV0ID0gZnVuY3Rpb24oJGV2ZW50LHBvc3Qpe1xyXG4gICAgICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICBwb3N0LmlzSW5wdXRTaG93ID8gcG9zdC5pc0lucHV0U2hvdyA9IGZhbHNlIDogcG9zdC5pc0lucHV0U2hvdyA9IHRydWU7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdpbnB1dCcscG9zdC5pc0lucHV0U2hvdyk7XHJcblxyXG4gICAgICAgIC8vJCh0aGlzKS5jbG9zZXN0KCcucG9zdCcpLmZpbmQoJy5pbnB1dC1ncm91cCcpLnNsaWRlVG9nZ2xlKDIwMCxmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAvKmlmKHVzZXJOYW1lKXtcclxuICAgICAgICAgICAgICAgICQodGhpcykuZmluZCgndGV4dGFyZWEnKS52YWwodXNlck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgc2V0Q2FyZXRUb1BvcygkKHRoaXMpLmZpbmQoJ3RleHRhcmVhJylbMF0sdXNlck5hbWUubGVuZ3RoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkKHRoaXMpLmZpbmQoJ3RleHRhcmVhJykuZm9jdXMoKTsqL1xyXG4gICAgICAgIC8vfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGJsb2cuc2VuZENvbW0gPSBmdW5jdGlvbigkZXZlbnQscG9zdCl7XHJcbiAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQubWVzc2FnZXNlcnZpY2UuTWVzc2FnZSgpO1xyXG5cclxuICAgICAgICBtZXNzYWdlLmlkID0gMDtcclxuICAgICAgICBtZXNzYWdlLnRvcGljSWQgPSBwb3N0LmlkO1xyXG4gICAgICAgIG1lc3NhZ2UudHlwZSA9IGNvbS52bWVzdGVvbmxpbmUuYmUudGhyaWZ0Lm1lc3NhZ2VzZXJ2aWNlLk1lc3NhZ2VUeXBlLkJMT0c7Ly83O1xyXG4gICAgICAgIG1lc3NhZ2UuZ3JvdXBJZCA9IDA7XHJcbiAgICAgICAgbWVzc2FnZS5jb250ZW50ID0gcG9zdC5jb21tZW50aW5nO1xyXG4gICAgICAgIG1lc3NhZ2UucGFyZW50SWQgPSAwO1xyXG4gICAgICAgIG1lc3NhZ2UuY3JlYXRlZCA9IERhdGUucGFyc2UobmV3IERhdGUoKSkvMTAwMDtcclxuXHJcbiAgICAgICAgaWYoIWJsb2cuaXNBdXRoKXtcclxuICAgICAgICAgICAgbWVzc2FnZS5hbm9uTmFtZSA9IHBvc3QuYW5vbk5hbWU7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIG1lc3NhZ2UuYW5vbk5hbWUgPSBcIlwiO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZXR1cm5Db21tZW50ID0gJGMubWVzc2FnZUNsaWVudC5wb3N0QmxvZ01lc3NhZ2UobWVzc2FnZSk7XHJcbiAgICAgICAgaWYocG9zdC5jb21tZW50cyAmJiBwb3N0LmNvbW1lbnRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBwb3N0LmNvbW1lbnRzLnB1c2gocmV0dXJuQ29tbWVudCk7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHBvc3QuY29tbWVudHMgPSBbXTtcclxuICAgICAgICAgICAgcG9zdC5jb21tZW50c1swXSA9IHJldHVybkNvbW1lbnQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH07XHJcblxyXG4gICAgYmxvZy5nZXRUaW1pbmcgPSBmdW5jdGlvbihtZXNzYWdlT2JqRGF0ZSl7XHJcbiAgICAgICAgdmFyIG1pbnV0ZSA9IDYwKjEwMDAsXHJcbiAgICAgICAgICAgIGhvdXIgPSBtaW51dGUqNjAsXHJcbiAgICAgICAgICAgIGRheSA9IGhvdXIqMjQsXHJcbiAgICAgICAgICAgIHRocmVlRGF5cyA9IGRheSogMyxcclxuICAgICAgICAgICAgbm93ID0gRGF0ZS5wYXJzZShuZXcgRGF0ZSgpKSxcclxuICAgICAgICAgICAgdGltaW5nID0gKG5vdyAtIG1lc3NhZ2VPYmpEYXRlKjEwMDApLFxyXG4gICAgICAgICAgICB0aW1lVGVtcDtcclxuXHJcbiAgICAgICAgaWYodGltaW5nIDwgbWludXRlKXtcclxuICAgICAgICAgICAgdGltaW5nID0gXCLRgtC+0LvRjNC60L4g0YfRgtC+XCI7XHJcbiAgICAgICAgfWVsc2UgaWYodGltaW5nIDwgaG91cil7XHJcbiAgICAgICAgICAgIHRpbWluZyA9IG5ldyBEYXRlKHRpbWluZyk7XHJcbiAgICAgICAgICAgIHRpbWluZyA9IHRpbWluZy5nZXRNaW51dGVzKCkrXCIg0LzQuNC9INC90LDQt9Cw0LRcIjtcclxuICAgICAgICB9ZWxzZSBpZih0aW1pbmcgPCBkYXkpe1xyXG4gICAgICAgICAgICB0aW1pbmcgPSBuZXcgRGF0ZSh0aW1pbmcpO1xyXG4gICAgICAgICAgICB0aW1lVGVtcCA9IHRpbWluZy5nZXRIb3VycygpO1xyXG4gICAgICAgICAgICBpZih0aW1lVGVtcCA9PSAxIHx8IHRpbWVUZW1wID09IDApe1xyXG4gICAgICAgICAgICAgICAgdGltaW5nID0gXCIxINGH0LDRgSDQvdCw0LfQsNC0XCI7XHJcbiAgICAgICAgICAgIH1lbHNlIGlmKHRpbWVUZW1wID4gMSAmJiB0aW1lVGVtcCA8IDUpe1xyXG4gICAgICAgICAgICAgICAgdGltaW5nID0gdGltZVRlbXAgKyBcIiDRh9Cw0YHQsCDQvdCw0LfQsNC0XCI7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdGltaW5nID0gdGltZVRlbXAgKyBcIiDRh9Cw0YHQvtCyINC90LDQt9Cw0LRcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1lbHNlIGlmKHRpbWluZyA8IHRocmVlRGF5cyl7XHJcbiAgICAgICAgICAgIHRpbWluZyA9IG5ldyBEYXRlKHRpbWluZyk7XHJcbiAgICAgICAgICAgIHRpbWVUZW1wID0gdGltaW5nLmdldERhdGUoKTtcclxuICAgICAgICAgICAgaWYodGltZVRlbXAgPT0gMSl7XHJcbiAgICAgICAgICAgICAgICB0aW1pbmcgPSB0aW1lVGVtcCtcIiDQtNC10L3RjCDQvdCw0LfQsNC0XCI7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdGltaW5nID0gdGltZVRlbXArXCIg0LTQvdC10Lkg0L3QsNC30LDQtFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHRpbWVUZW1wID0gbmV3IERhdGUobWVzc2FnZU9iakRhdGUqMTAwMCkudG9Mb2NhbGVEYXRlU3RyaW5nKCk7XHJcbiAgICAgICAgICAgIHZhciBhcnIgPSB0aW1lVGVtcC5zcGxpdCgnLicpO1xyXG4gICAgICAgICAgICBpZihhcnJbMF0ubGVuZ3RoID09IDEpIGFyclswXSA9IFwiMFwiK2FyclswXTtcclxuICAgICAgICAgICAgaWYoYXJyWzFdLmxlbmd0aCA9PSAxKSBhcnJbMV0gPSBcIjBcIithcnJbMV07XHJcbiAgICAgICAgICAgIHRpbWluZyA9IGFyclswXStcIi5cIithcnJbMV0rXCIuXCIrYXJyWzJdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRpbWluZztcclxuICAgIH07XHJcblxyXG4gICAgLyokKCcuaXRlbWRpdicpLmVhY2goZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgc3BhbiA9ICQodGhpcykuZmluZCgnLmxlbnRhLWl0ZW0tYm90dG9tIHNwYW4nKTtcclxuICAgICAgICB2YXIgY3JlYXRlZCA9IHNwYW4uYXR0cignZGF0YS1jcmVhdGVkJyk7XHJcblxyXG4gICAgICAgIHNwYW4udGV4dChnZXRUaW1pbmcoY3JlYXRlZCkpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdmFyIGggPSAkKHdpbmRvdykuaGVpZ2h0KCktMTA1O1xyXG4gICAgJCgnLmNvbnRhaW5lci5jb21pbmctc29vbiAubWFpbi1jb250YWluZXInKS5jc3MoeydtaW4taGVpZ2h0JzogaH0pO1xyXG5cclxuICAgICQoJy5wb3N0JykuZWFjaChmdW5jdGlvbigpe1xyXG4gICAgICAgIHZhciBsaW5rID0gJCh0aGlzKS5hdHRyKCdkYXRhLXBvc3RsaW5rJyk7XHJcblxyXG4gICAgICAgICQodGhpcykuZmluZCgnLnRvcGljJykubG9hZChsaW5rKycgLnBvc3QnLCBmdW5jdGlvbigpe1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdmFyIGlzQ29tbWVudHNMb2FkZWQgPSBbXTtcclxuICAgICQoJy5zaG93LWNvbW1lbnQnKS5jbGljayhmdW5jdGlvbihlKXtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgIGlmKCQodGhpcykudGV4dCgpID09IFwi0J/QvtC60LDQt9Cw0YLRjCDQutC+0LzQvNC10L3RgtCw0YDQuNC4XCIpe1xyXG4gICAgICAgICAgICAkKHRoaXMpLnRleHQoXCLQodC60YDRi9GC0Ywg0LrQvtC80LzQtdC90YLQsNGA0LjQuFwiKTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgJCh0aGlzKS50ZXh0KFwi0J/QvtC60LDQt9Cw0YLRjCDQutC+0LzQvNC10L3RgtCw0YDQuNC4XCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHRvcGljSWQgPSAkKHRoaXMpLmNsb3Nlc3QoJy5wb3N0JykuYXR0cignZGF0YS10b3BpY2lkJyksXHJcbiAgICAgICAgICAgIGRpYWxvZ3MgPSAkKHRoaXMpLmNsb3Nlc3QoJy5wb3N0JykuZmluZCgnLmRpYWxvZ3MnKTtcclxuXHJcbiAgICAgICAgLy9pZighaXNDb21tZW50c0xvYWRlZFt0b3BpY0lkXSl7XHJcbiAgICAgICAgdmFyIGNvbW1lbnRzID0gYy5tZXNzYWdlQ2xpZW50LmdldE1lc3NhZ2VzQXNMaXN0KHRvcGljSWQsIDcsIDAsZmFsc2UsMTAwMCkubWVzc2FnZXM7XHJcbiAgICAgICAgLy9hbGVydChjb21tZW50cy5sZW5ndGgpO1xyXG5cclxuICAgICAgICBpZihjb21tZW50cyl7XHJcbiAgICAgICAgICAgIHZhciBjb21tZW50c0xlbmd0aCA9IGNvbW1lbnRzLmxlbmd0aCxcclxuICAgICAgICAgICAgICAgIGNvbW1lbnRzSFRNTCA9IFwiXCI7XHJcblxyXG4gICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgY29tbWVudHNMZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2xhc3NOb0xpbmsgPSBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VBdmF0YXIsXHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZU5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVVzZXJJZDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZighY29tbWVudHNbaV0udXNlckluZm8pe1xyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VBdmF0YXIgPSBcImRhdGEvZGEuZ2lmXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVVzZXJJZCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOb0xpbmsgPSBcIm5vLWxpbmtcIjtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIC8vbWVzc2FnZU5hbWUgPSBjb21tZW50c1tpXS51c2VySW5mby5maXJzdE5hbWUrXCIgXCIrY29tbWVudHNbaV0udXNlckluZm8ubGFzdE5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZUF2YXRhciA9IGNvbW1lbnRzW2ldLnVzZXJJbmZvLmF2YXRhcjtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVXNlcklkID0gY29tbWVudHNbaV0udXNlckluZm8uaWQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZU5hbWUgPSBjb21tZW50c1tpXS5hbm9uTmFtZTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb21tZW50c0hUTUwgKz0gJzxkaXYgY2xhc3M9XCJpdGVtZGl2IGRpYWxvZ2RpdiBuZXdcIj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICc8YSBocmVmPVwicHJvZmlsZS0nK21lc3NhZ2VVc2VySWQrJ1wiIGNsYXNzPVwidXNlciAnK2NsYXNzTm9MaW5rKydcIj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiYXZhdGFyIHNob3J0MlwiIHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKCcrbWVzc2FnZUF2YXRhcisnKVwiPjwvZGl2PicrXHJcbiAgICAgICAgICAgICAgICAgICAgJzwvYT4nK1xyXG4gICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiYm9keVwiPicrXHJcbiAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJuYW1lXCI+JytcclxuICAgICAgICAgICAgICAgICAgICAnPGEgaHJlZj1cInByb2ZpbGUtJyttZXNzYWdlVXNlcklkKydcIiBjbGFzcz1cIicrY2xhc3NOb0xpbmsrJ1wiPicrbWVzc2FnZU5hbWUrJzwvYT4nK1xyXG4gICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nK1xyXG4gICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwidGV4dFwiPicrY29tbWVudHNbaV0uY29udGVudCsnPC9kaXY+JytcclxuICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImxlbnRhLWl0ZW0tYm90dG9tXCI+JytcclxuICAgICAgICAgICAgICAgICAgICAnPHNwYW4+JysgZ2V0VGltaW5nKGNvbW1lbnRzW2ldLmNyZWF0ZWQpICsnPC9zcGFuPicrXHJcbiAgICAgICAgICAgICAgICAgICAgJzxhIGhyZWY9XCIjXCI+INCe0YLQstC10YLQuNGC0Yw8L2E+JytcclxuICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JytcclxuICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JytcclxuICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZGlhbG9ncy5odG1sKFwiXCIpO1xyXG4gICAgICAgIGRpYWxvZ3MucHJlcGVuZChjb21tZW50c0hUTUwpO1xyXG5cclxuICAgICAgICBpbml0Tm9MaW5rKCQodGhpcykuY2xvc2VzdCgnLnBvc3QnKSk7XHJcbiAgICAgICAgaW5pdEFuc3dlclRvQ29tbWVudCgkKCcubmV3IC5sZW50YS1pdGVtLWJvdHRvbSBhJykpO1xyXG4gICAgICAgICQoJy5uZXcnKS5yZW1vdmVDbGFzcygnbmV3Jyk7XHJcblxyXG4gICAgICAgIGlzQ29tbWVudHNMb2FkZWRbdG9waWNJZF0gPSB0cnVlO1xyXG5cclxuICAgICAgICAvL31cclxuXHJcbiAgICAgICAgZGlhbG9ncy5zbGlkZVRvZ2dsZSgyMDApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZnVuY3Rpb24gaW5pdEFuc3dlclRvQ29tbWVudChzZWxlY3Rvcil7XHJcbiAgICAgICAgc2VsZWN0b3IuY2xpY2soZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciB1c2VyTmFtZSA9ICQodGhpcykuY2xvc2VzdCgnLmJvZHknKS5maW5kKCcubmFtZSBhJykudGV4dCgpK1wiLCBcIjtcclxuICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCcucG9zdCcpLmZpbmQoJy5tYWtlLWNvbW1lbnQnKS50cmlnZ2VyKCdjbGljaycsdXNlck5hbWUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgaW5pdEFuc3dlclRvQ29tbWVudCgkKCcubGVudGEtaXRlbS1ib3R0b20gYScpKTtcclxuXHJcbiAgICAkKCcubWFrZS1jb21tZW50JykuY2xpY2soZnVuY3Rpb24oZSx1c2VyTmFtZSl7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJy5wb3N0JykuZmluZCgnLmlucHV0LWdyb3VwJykuc2xpZGVUb2dnbGUoMjAwLGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIGlmKHVzZXJOYW1lKXtcclxuICAgICAgICAgICAgICAgICQodGhpcykuZmluZCgndGV4dGFyZWEnKS52YWwodXNlck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgc2V0Q2FyZXRUb1BvcygkKHRoaXMpLmZpbmQoJ3RleHRhcmVhJylbMF0sdXNlck5hbWUubGVuZ3RoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkKHRoaXMpLmZpbmQoJ3RleHRhcmVhJykuZm9jdXMoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGZ1bmN0aW9uIGluaXROb0xpbmsoc2VsZWN0b3Ipe1xyXG5cclxuICAgICAgICBzZWxlY3Rvci5maW5kKCcubm8tbGluaycpLmNsaWNrKGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuICAgIGluaXROb0xpbmsoJCgnLmJsb2cnKSk7XHJcblxyXG4gICAgJCgnLnNlbmQtaW4tYmxvZycpLmNsaWNrKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQubWVzc2FnZXNlcnZpY2UuTWVzc2FnZSgpO1xyXG5cclxuICAgICAgICBtZXNzYWdlLmlkID0gMDtcclxuICAgICAgICBtZXNzYWdlLnRvcGljSWQgPSAkKHRoaXMpLmNsb3Nlc3QoJy5wb3N0JykuYXR0cignZGF0YS10b3BpY2lkJyk7XHJcbiAgICAgICAgbWVzc2FnZS50eXBlID0gY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQubWVzc2FnZXNlcnZpY2UuTWVzc2FnZVR5cGUuQkxPRzsvLzc7XHJcbiAgICAgICAgbWVzc2FnZS5ncm91cElkID0gMDtcclxuICAgICAgICBtZXNzYWdlLmNvbnRlbnQgPSAkKHRoaXMpLmNsb3Nlc3QoJy5pbnB1dC1ncm91cCcpLmZpbmQoJy5tZXNzYWdlLXRleHRhcmVhJykudmFsKCk7XHJcbiAgICAgICAgbWVzc2FnZS5wYXJlbnRJZCA9IDA7XHJcbiAgICAgICAgbWVzc2FnZS5jcmVhdGVkID0gRGF0ZS5wYXJzZShuZXcgRGF0ZSgpKS8xMDAwO1xyXG5cclxuICAgICAgICBpZighaXNBdXRoKXtcclxuICAgICAgICAgICAgbWVzc2FnZS5hbm9uTmFtZSA9ICQodGhpcykuY2xvc2VzdCgnLmlucHV0LWdyb3VwJykuZmluZCgnLmFub25OYW1lJykudmFsKCk7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIG1lc3NhZ2UuYW5vbk5hbWUgPSBcIlwiO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZXR1cm5Db21tZW50ID0gYy5tZXNzYWdlQ2xpZW50LnBvc3RCbG9nTWVzc2FnZShtZXNzYWdlKTtcclxuICAgICAgICB2YXIgY29tbWVudHMgPSAkKHRoaXMpLmNsb3Nlc3QoJy5wb3N0JykuZmluZCgnLmRpYWxvZ3MnKTtcclxuXHJcbiAgICAgICAgdmFyIGNsYXNzTm9MaW5rID0gXCJcIjtcclxuXHJcbiAgICAgICAgaWYoIWlzQXV0aCl7XHJcbiAgICAgICAgICAgIG1lc3NhZ2UuYXZhdGFyID0gXCJkYXRhL2RhLmdpZlwiO1xyXG4gICAgICAgICAgICBtZXNzYWdlLm5hbWUgPSBtZXNzYWdlLmFub25OYW1lO1xyXG4gICAgICAgICAgICBtZXNzYWdlLnVzZXJJZCA9IDA7XHJcbiAgICAgICAgICAgIGNsYXNzTm9MaW5rID0gXCJuby1saW5rXCI7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIG1lc3NhZ2UuYXZhdGFyID0gcmV0dXJuQ29tbWVudC51c2VySW5mby5hdmF0YXI7XHJcbiAgICAgICAgICAgIG1lc3NhZ2UubmFtZSA9IHJldHVybkNvbW1lbnQudXNlckluZm8uZmlyc3ROYW1lK1wiIFwiK3JldHVybkNvbW1lbnQudXNlckluZm8ubGFzdE5hbWU7XHJcbiAgICAgICAgICAgIG1lc3NhZ2UudXNlcklkID0gcmV0dXJuQ29tbWVudC51c2VySW5mby5pZCA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgbmV3Q29tbWVudEhUTUwgPSAnPGRpdiBjbGFzcz1cIml0ZW1kaXYgZGlhbG9nZGl2IG5ld1wiPicrXHJcbiAgICAgICAgICAgICc8YSBocmVmPVwicHJvZmlsZS0nKyBtZXNzYWdlLnVzZXJJZCArJ1wiIGNsYXNzPVwidXNlciAnKyBjbGFzc05vTGluayArJ1wiPicrXHJcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiYXZhdGFyIHNob3J0MlwiIHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKCcrIG1lc3NhZ2UuYXZhdGFyICsnKVwiPjwvZGl2PicrXHJcbiAgICAgICAgICAgICc8L2E+JytcclxuICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJib2R5XCI+JytcclxuICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJuYW1lXCI+JytcclxuICAgICAgICAgICAgJzxhIGhyZWY9XCJwcm9maWxlLScrIG1lc3NhZ2UudXNlcklkICsnXCIgY2xhc3M9XCInKyBjbGFzc05vTGluayArJ1wiID4nKyBtZXNzYWdlLm5hbWUgKyc8L2E+JytcclxuICAgICAgICAgICAgJzwvZGl2PicrXHJcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwidGV4dFwiPicrIG1lc3NhZ2UuY29udGVudCArJzwvZGl2PicrXHJcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwibGVudGEtaXRlbS1ib3R0b21cIj4nK1xyXG4gICAgICAgICAgICAnPHNwYW4+JysgZ2V0VGltaW5nKG1lc3NhZ2UuY3JlYXRlZCkgKyc8L3NwYW4+JytcclxuICAgICAgICAgICAgJzxhIGhyZWY9XCIjXCI+0J7RgtCy0LXRgtC40YLRjDwvYT4nK1xyXG4gICAgICAgICAgICAnPC9kaXY+JytcclxuICAgICAgICAgICAgJzwvZGl2PicrXHJcbiAgICAgICAgICAgICc8L2Rpdj4nO1xyXG5cclxuICAgICAgICBpZihjb21tZW50cy5jc3MoJ2Rpc3BsYXknKSA9PSAnbm9uZScpe1xyXG5cclxuICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCcucG9zdCcpLmZpbmQoJy5zaG93LWNvbW1lbnQnKS50cmlnZ2VyKCdjbGljaycpO1xyXG5cclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgY29tbWVudHMuYXBwZW5kKG5ld0NvbW1lbnRIVE1MKTtcclxuXHJcbiAgICAgICAgICAgIGluaXROb0xpbmsoJCgnLm5ldycpKTtcclxuICAgICAgICAgICAgaW5pdEFuc3dlclRvQ29tbWVudCgkKCcubmV3IC5sZW50YS1pdGVtLWJvdHRvbSBhJykpO1xyXG4gICAgICAgICAgICAkKCcubmV3JykucmVtb3ZlQ2xhc3MoJ25ldycpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9zZXRUaW1lb3V0KHRlbXBGdW5jLDEwMDAsY29tbWVudHMsbmV3Q29tbWVudEhUTUwsbWVzc2FnZSwkKHRoaXMpKTtcclxuXHJcbiAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCcuaW5wdXQtZ3JvdXAnKS5oaWRlKCk7XHJcbiAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCcuaW5wdXQtZ3JvdXAnKS5maW5kKCd0ZXh0YXJlYScpLnZhbChcIlwiKTtcclxuXHJcbiAgICB9KTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXRUaW1pbmcobWVzc2FnZU9iakRhdGUpe1xyXG4gICAgICAgIHZhciBtaW51dGUgPSA2MCoxMDAwLFxyXG4gICAgICAgICAgICBob3VyID0gbWludXRlKjYwLFxyXG4gICAgICAgICAgICBkYXkgPSBob3VyKjI0LFxyXG4gICAgICAgICAgICB0aHJlZURheXMgPSBkYXkqIDMsXHJcbiAgICAgICAgICAgIG5vdyA9IERhdGUucGFyc2UobmV3IERhdGUoKSksXHJcbiAgICAgICAgICAgIHRpbWluZyA9IChub3cgLSBtZXNzYWdlT2JqRGF0ZSoxMDAwKSxcclxuICAgICAgICAgICAgdGltZVRlbXA7XHJcblxyXG4gICAgICAgIGlmKHRpbWluZyA8IG1pbnV0ZSl7XHJcbiAgICAgICAgICAgIHRpbWluZyA9IFwi0YLQvtC70YzQutC+INGH0YLQvlwiO1xyXG4gICAgICAgIH1lbHNlIGlmKHRpbWluZyA8IGhvdXIpe1xyXG4gICAgICAgICAgICB0aW1pbmcgPSBuZXcgRGF0ZSh0aW1pbmcpO1xyXG4gICAgICAgICAgICB0aW1pbmcgPSB0aW1pbmcuZ2V0TWludXRlcygpK1wiINC80LjQvSDQvdCw0LfQsNC0XCI7XHJcbiAgICAgICAgfWVsc2UgaWYodGltaW5nIDwgZGF5KXtcclxuICAgICAgICAgICAgdGltaW5nID0gbmV3IERhdGUodGltaW5nKTtcclxuICAgICAgICAgICAgdGltZVRlbXAgPSB0aW1pbmcuZ2V0SG91cnMoKTtcclxuICAgICAgICAgICAgaWYodGltZVRlbXAgPT0gMSB8fCB0aW1lVGVtcCA9PSAwKXtcclxuICAgICAgICAgICAgICAgIHRpbWluZyA9IFwiMSDRh9Cw0YEg0L3QsNC30LDQtFwiO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZih0aW1lVGVtcCA+IDEgJiYgdGltZVRlbXAgPCA1KXtcclxuICAgICAgICAgICAgICAgIHRpbWluZyA9IHRpbWVUZW1wICsgXCIg0YfQsNGB0LAg0L3QsNC30LDQtFwiO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHRpbWluZyA9IHRpbWVUZW1wICsgXCIg0YfQsNGB0L7QsiDQvdCw0LfQsNC0XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9ZWxzZSBpZih0aW1pbmcgPCB0aHJlZURheXMpe1xyXG4gICAgICAgICAgICB0aW1pbmcgPSBuZXcgRGF0ZSh0aW1pbmcpO1xyXG4gICAgICAgICAgICB0aW1lVGVtcCA9IHRpbWluZy5nZXREYXRlKCk7XHJcbiAgICAgICAgICAgIGlmKHRpbWVUZW1wID09IDEpe1xyXG4gICAgICAgICAgICAgICAgdGltaW5nID0gdGltZVRlbXArXCIg0LTQtdC90Ywg0L3QsNC30LDQtFwiO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHRpbWluZyA9IHRpbWVUZW1wK1wiINC00L3QtdC5INC90LDQt9Cw0LRcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICB0aW1lVGVtcCA9IG5ldyBEYXRlKG1lc3NhZ2VPYmpEYXRlKjEwMDApLnRvTG9jYWxlRGF0ZVN0cmluZygpO1xyXG4gICAgICAgICAgICB2YXIgYXJyID0gdGltZVRlbXAuc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgaWYoYXJyWzBdLmxlbmd0aCA9PSAxKSBhcnJbMF0gPSBcIjBcIithcnJbMF07XHJcbiAgICAgICAgICAgIGlmKGFyclsxXS5sZW5ndGggPT0gMSkgYXJyWzFdID0gXCIwXCIrYXJyWzFdO1xyXG4gICAgICAgICAgICB0aW1pbmcgPSBhcnJbMF0rXCIuXCIrYXJyWzFdK1wiLlwiK2FyclsyXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aW1pbmc7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gc2V0U2VsZWN0aW9uUmFuZ2UoaW5wdXQsIHNlbGVjdGlvblN0YXJ0LCBzZWxlY3Rpb25FbmQpIHtcclxuICAgICAgICBpZiAoaW5wdXQuc2V0U2VsZWN0aW9uUmFuZ2UpIHtcclxuICAgICAgICAgICAgaW5wdXQuZm9jdXMoKTtcclxuICAgICAgICAgICAgaW5wdXQuc2V0U2VsZWN0aW9uUmFuZ2Uoc2VsZWN0aW9uU3RhcnQsIHNlbGVjdGlvbkVuZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGlucHV0LmNyZWF0ZVRleHRSYW5nZSkge1xyXG4gICAgICAgICAgICB2YXIgcmFuZ2UgPSBpbnB1dC5jcmVhdGVUZXh0UmFuZ2UoKTtcclxuICAgICAgICAgICAgcmFuZ2UuY29sbGFwc2UodHJ1ZSk7XHJcbiAgICAgICAgICAgIHJhbmdlLm1vdmVFbmQoJ2NoYXJhY3RlcicsIHNlbGVjdGlvbkVuZCk7XHJcbiAgICAgICAgICAgIHJhbmdlLm1vdmVTdGFydCgnY2hhcmFjdGVyJywgc2VsZWN0aW9uU3RhcnQpO1xyXG4gICAgICAgICAgICByYW5nZS5zZWxlY3QoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gc2V0Q2FyZXRUb1BvcyAoaW5wdXQsIHBvcykge1xyXG4gICAgICAgIHNldFNlbGVjdGlvblJhbmdlKGlucHV0LCBwb3MsIHBvcyk7XHJcbiAgICB9XHJcbiovXHJcblxyXG4gICAgJCgnLm5nLWNsb2FrJykucmVtb3ZlQ2xhc3MoJ25nLWNsb2FrJyk7XHJcblxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBbICckcm9vdFNjb3BlJywnJGMnLCBibG9nQ3RybCBdOyIsIlxyXG52YXIgY2FiaW5ldEN0cmwgPSBmdW5jdGlvbigkcm9vdFNjb3BlLCRjKSB7XHJcbiAgICB2YXIgbmVhcmJ5ID0gdGhpcyxcclxuICAgICAgICBwb3N0SWQ7XHJcblxyXG4gICAgdmFyIGJ1c2luZXNzRGVzY3JpcHRpb24gPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQuYnVzaW5lc3NlcnZpY2UuQnVzaW5lc3NEZXNjcmlwdGlvbjtcclxuICAgIGJ1c2luZXNzRGVzY3JpcHRpb24uc2hvcnROYW1lID0gXCLQnNC10LPQsCDQn9C40YbRhtCwXCI7XHJcbiAgICBidXNpbmVzc0Rlc2NyaXB0aW9uLmZ1bGx0TmFtZSA9IFwi0JzQtdCz0LAg0J/QuNGG0YbQsCDQutGA0YPRgtC+LdC60YDRg9GC0L5cIjtcclxuICAgIGJ1c2luZXNzRGVzY3JpcHRpb24uc2hvcnRJbmZvID0gXCLQnNC10LPQsCDQn9C40YbRhtCwINC60YDRg9GC0L4t0LrRgNGD0YLQviDQsdGL0YHRgtGA0L4t0LHRi9GB0YLRgNC+XCI7XHJcbiAgICBidXNpbmVzc0Rlc2NyaXB0aW9uLmZ1bGxJbmZvID0gXCLQnNC10LPQsCDQn9C40YbRhtCwINC60YDRg9GC0L4t0LrRgNGD0YLQviDQsdGL0YHRgtGA0L4t0LHRi9GB0YLRgNC+INC00LXRiNC10LLQvlwiO1xyXG4gICAgYnVzaW5lc3NEZXNjcmlwdGlvbi5sb25naXR1ZGUgPSAnMzAnO1xyXG4gICAgYnVzaW5lc3NEZXNjcmlwdGlvbi5sYXRpdHVkZSA9ICc2MCc7XHJcbiAgICBidXNpbmVzc0Rlc2NyaXB0aW9uLnJhZGl1cyA9IDUwMDtcclxuICAgIC8vYnVzaW5lc3NDbGllbnQuY3JlYXRlQnVzaW5lc3NEZXNjcmlwdGlvbihidXNpbmVzc0Rlc2NyaXB0aW9uLCd3JywndycpO1xyXG5cclxuICAgIC8vY29uc29sZS5sb2coJ2J1c2luZXNzIGNyZWF0ZWQnKTtcclxuXHJcbiAgICBuZWFyYnkuaW5mbyA9ICRjLmJ1c2luZXNzQ2xpZW50LmdldE15QnVzaW5lc3NJbmZvKCk7XHJcbiAgICBuZWFyYnkuaW5mby5mdWxsSW5mbyA9IG5lYXJieS5pbmZvLmZ1bGxJbmZvLnJlcGxhY2UoJ1xcbicsJzxicj4nKTtcclxuXHJcbiAgICAvKmlmICgkc3RhdGVQYXJhbXMubmVhcmJ5SWQgJiYgJHN0YXRlUGFyYW1zLm5lYXJieUlkICE9IDApe1xyXG4gICAgICAgIHBvc3RJZCA9ICRzdGF0ZVBhcmFtcy5uZWFyYnlJZDtcclxuICAgIH0qL1xyXG5cclxuICAgIG5lYXJieS5jYXJvdXNlbEludGVydmFsID0gNTAwMDtcclxuICAgIC8qbmVhcmJ5LmFkZFNsaWRlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIG5ld1dpZHRoID0gNjAwICsgc2xpZGVzLmxlbmd0aCArIDE7XHJcbiAgICAgICAgc2xpZGVzLnB1c2goe1xyXG4gICAgICAgICAgICBpbWFnZTogJ2h0dHA6Ly9wbGFjZWtpdHRlbi5jb20vJyArIG5ld1dpZHRoICsgJy8zMDAnLFxyXG4gICAgICAgICAgICB0ZXh0OiBbJ01vcmUnLCdFeHRyYScsJ0xvdHMgb2YnLCdTdXJwbHVzJ11bc2xpZGVzLmxlbmd0aCAlIDRdICsgJyAnICtcclxuICAgICAgICAgICAgICAgIFsnQ2F0cycsICdLaXR0eXMnLCAnRmVsaW5lcycsICdDdXRlcyddW3NsaWRlcy5sZW5ndGggJSA0XVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIGZvciAodmFyIGk9MDsgaTw0OyBpKyspIHtcclxuICAgICAgICBuZWFyYnkuYWRkU2xpZGUoKTtcclxuICAgIH0qL1xyXG5cclxuICAgICRyb290U2NvcGUuYmFzZS5pc0Zvb3RlckJvdHRvbSA9IHRydWU7XHJcblxyXG4gICAgbmVhcmJ5LnRvZ2dsZUlucHV0ID0gZnVuY3Rpb24oJGV2ZW50LHBvc3Qpe1xyXG4gICAgICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICBwb3N0LmlzSW5wdXRTaG93ID8gcG9zdC5pc0lucHV0U2hvdyA9IGZhbHNlIDogcG9zdC5pc0lucHV0U2hvdyA9IHRydWU7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdpbnB1dCcscG9zdC5pc0lucHV0U2hvdyk7XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICBuZWFyYnkud2FsbEl0ZW0gPSAkYy5idXNpbmVzc0NsaWVudC5nZXRXYWxsSXRlbShuZWFyYnkuaW5mby5pZCk7XHJcbiAgICBjb25zb2xlLmxvZygnMScsbmVhcmJ5LndhbGxJdGVtKTtcclxuXHJcbiAgICBuZWFyYnkuc2VuZENvbW0gPSBmdW5jdGlvbigkZXZlbnQscG9zdCl7XHJcbiAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQubWVzc2FnZXNlcnZpY2UuTWVzc2FnZSgpO1xyXG5cclxuICAgICAgICBtZXNzYWdlLmlkID0gMDtcclxuICAgICAgICBtZXNzYWdlLnRvcGljSWQgPSBuZWFyYnkuaW5mby5pZDsgLy9wb3N0LmlkO1xyXG4gICAgICAgIG1lc3NhZ2UudHlwZSA9IGNvbS52bWVzdGVvbmxpbmUuYmUudGhyaWZ0Lm1lc3NhZ2VzZXJ2aWNlLk1lc3NhZ2VUeXBlLldBTEw7Ly84O1xyXG4gICAgICAgIG1lc3NhZ2UuZ3JvdXBJZCA9IDA7XHJcbiAgICAgICAgbWVzc2FnZS5jb250ZW50ID0gcG9zdC5jb21tZW50aW5nO1xyXG4gICAgICAgIG1lc3NhZ2UudG9waWNJZCA9IG5lYXJieS53YWxsSXRlbS50b3BpYy5pZDtcclxuICAgICAgICBtZXNzYWdlLnBhcmVudElkID0gMDtcclxuICAgICAgICBtZXNzYWdlLmNyZWF0ZWQgPSBEYXRlLnBhcnNlKG5ldyBEYXRlKCkpLzEwMDA7XHJcbiAgICAgICAgcG9zdC5jb21tZW50aW5nID0gXCJcIjtcclxuXHJcbiAgICAgICAgaWYoIW5lYXJieS5pc0F1dGgpe1xyXG4gICAgICAgICAgICBtZXNzYWdlLmFub25OYW1lID0gcG9zdC5hbm9uTmFtZTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgbWVzc2FnZS5hbm9uTmFtZSA9IFwiXCI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coJ3Bvc3QnLG1lc3NhZ2UpO1xyXG4gICAgICAgIC8vdmFyIHJldHVybkNvbW1lbnQgPSBjLm1lc3NhZ2VDbGllbnQucG9zdEJ1c2luZXNzVG9waWNzKG1lc3NhZ2UpO1xyXG4gICAgICAgIHZhciByZXR1cm5Db21tZW50ID0gJGMubWVzc2FnZUNsaWVudC5wb3N0TWVzc2FnZShtZXNzYWdlKTtcclxuICAgICAgICBjb25zb2xlLmxvZygncG9zdDInLHJldHVybkNvbW1lbnQpO1xyXG5cclxuXHJcbiAgICAgICAgaWYobmVhcmJ5LndhbGxJdGVtLm1lc3NhZ2VzICYmIG5lYXJieS53YWxsSXRlbS5tZXNzYWdlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbmVhcmJ5LndhbGxJdGVtLm1lc3NhZ2VzLnB1c2gocmV0dXJuQ29tbWVudCk7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIG5lYXJieS53YWxsSXRlbS5tZXNzYWdlcyA9IFtdO1xyXG4gICAgICAgICAgICBuZWFyYnkud2FsbEl0ZW0ubWVzc2FnZXNbMF0gPSByZXR1cm5Db21tZW50O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9O1xyXG5cclxuICAgIG5lYXJieS5nZXRUaW1pbmcgPSBmdW5jdGlvbihtZXNzYWdlT2JqRGF0ZSl7XHJcbiAgICAgICAgdmFyIG1pbnV0ZSA9IDYwKjEwMDAsXHJcbiAgICAgICAgICAgIGhvdXIgPSBtaW51dGUqNjAsXHJcbiAgICAgICAgICAgIGRheSA9IGhvdXIqMjQsXHJcbiAgICAgICAgICAgIHRocmVlRGF5cyA9IGRheSogMyxcclxuICAgICAgICAgICAgbm93ID0gRGF0ZS5wYXJzZShuZXcgRGF0ZSgpKSxcclxuICAgICAgICAgICAgdGltaW5nID0gKG5vdyAtIG1lc3NhZ2VPYmpEYXRlKjEwMDApLFxyXG4gICAgICAgICAgICB0aW1lVGVtcDtcclxuXHJcbiAgICAgICAgaWYodGltaW5nIDwgbWludXRlKXtcclxuICAgICAgICAgICAgdGltaW5nID0gXCLRgtC+0LvRjNC60L4g0YfRgtC+XCI7XHJcbiAgICAgICAgfWVsc2UgaWYodGltaW5nIDwgaG91cil7XHJcbiAgICAgICAgICAgIHRpbWluZyA9IG5ldyBEYXRlKHRpbWluZyk7XHJcbiAgICAgICAgICAgIHRpbWluZyA9IHRpbWluZy5nZXRNaW51dGVzKCkrXCIg0LzQuNC9INC90LDQt9Cw0LRcIjtcclxuICAgICAgICB9ZWxzZSBpZih0aW1pbmcgPCBkYXkpe1xyXG4gICAgICAgICAgICB0aW1pbmcgPSBuZXcgRGF0ZSh0aW1pbmcpO1xyXG4gICAgICAgICAgICB0aW1lVGVtcCA9IHRpbWluZy5nZXRIb3VycygpO1xyXG4gICAgICAgICAgICBpZih0aW1lVGVtcCA9PSAxIHx8IHRpbWVUZW1wID09IDApe1xyXG4gICAgICAgICAgICAgICAgdGltaW5nID0gXCIxINGH0LDRgSDQvdCw0LfQsNC0XCI7XHJcbiAgICAgICAgICAgIH1lbHNlIGlmKHRpbWVUZW1wID4gMSAmJiB0aW1lVGVtcCA8IDUpe1xyXG4gICAgICAgICAgICAgICAgdGltaW5nID0gdGltZVRlbXAgKyBcIiDRh9Cw0YHQsCDQvdCw0LfQsNC0XCI7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdGltaW5nID0gdGltZVRlbXAgKyBcIiDRh9Cw0YHQvtCyINC90LDQt9Cw0LRcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1lbHNlIGlmKHRpbWluZyA8IHRocmVlRGF5cyl7XHJcbiAgICAgICAgICAgIHRpbWluZyA9IG5ldyBEYXRlKHRpbWluZyk7XHJcbiAgICAgICAgICAgIHRpbWVUZW1wID0gdGltaW5nLmdldERhdGUoKTtcclxuICAgICAgICAgICAgaWYodGltZVRlbXAgPT0gMSl7XHJcbiAgICAgICAgICAgICAgICB0aW1pbmcgPSB0aW1lVGVtcCtcIiDQtNC10L3RjCDQvdCw0LfQsNC0XCI7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdGltaW5nID0gdGltZVRlbXArXCIg0LTQvdC10Lkg0L3QsNC30LDQtFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHRpbWVUZW1wID0gbmV3IERhdGUobWVzc2FnZU9iakRhdGUqMTAwMCkudG9Mb2NhbGVEYXRlU3RyaW5nKCk7XHJcbiAgICAgICAgICAgIHZhciBhcnIgPSB0aW1lVGVtcC5zcGxpdCgnLicpO1xyXG4gICAgICAgICAgICBpZihhcnJbMF0ubGVuZ3RoID09IDEpIGFyclswXSA9IFwiMFwiK2FyclswXTtcclxuICAgICAgICAgICAgaWYoYXJyWzFdLmxlbmd0aCA9PSAxKSBhcnJbMV0gPSBcIjBcIithcnJbMV07XHJcbiAgICAgICAgICAgIHRpbWluZyA9IGFyclswXStcIi5cIithcnJbMV0rXCIuXCIrYXJyWzJdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRpbWluZztcclxuICAgIH07XHJcblxyXG5cclxuICAgICQoJy5uZy1jbG9haycpLnJlbW92ZUNsYXNzKCduZy1jbG9haycpO1xyXG5cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gWyAnJHJvb3RTY29wZScsJyRjJywgY2FiaW5ldEN0cmwgXTsiLCJcclxudmFyIGVkaXRDdHJsID0gZnVuY3Rpb24oJHJvb3RTY29wZSwkc2NvcGUsJGMsRmlsZVVwbG9hZGVyKSB7XHJcblxyXG4gICAgdmFyIGVkaXQgPSB0aGlzO1xyXG5cclxuICAgIHZhciBhdHRhY2ggPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQubWVzc2FnZXNlcnZpY2UuQXR0YWNoKCksXHJcbiAgICAgICAgaXNMb2dvVXBsb2FkZXIsIGlzSW1hZ2VzVXBsb2FkZXIsIGltYWdlc0NvdW50ZXIgPSAwLGltYWdlc0xlbmd0aDtcclxuXHJcbiAgICAkc2NvcGUuc2V0TG9hZEltYWdlID0gZnVuY3Rpb24oZmlsZUJhc2U2NCl7XHJcblxyXG4gICAgICAgIHZhciBzdmMgPSAkYy5maWxlQ2xpZW50LnNhdmVGaWxlQ29udGVudChmaWxlQmFzZTY0LCB0cnVlKTtcclxuICAgICAgICBjb25zb2xlLmxvZygnc2V0TG9hZEltYWdlJyxmaWxlQmFzZTY0KTtcclxuICAgICAgICBpZihpc0xvZ29VcGxvYWRlcil7XHJcbiAgICAgICAgICAgIGVkaXQuYnVzaW5lc3NEZXNjcmlwdGlvbi5sb2dvLlVSTCA9IGF0dGFjaC5VUkwgPSBlZGl0LmxvZ29VUkwgPSBzdmM7XHJcbiAgICAgICAgICAgIGlzTG9nb1VwbG9hZGVyID0gZmFsc2U7XHJcbiAgICAgICAgfWVsc2UgaWYoaXNJbWFnZXNVcGxvYWRlcil7XHJcbiAgICAgICAgICAgIGVkaXQuYnVzaW5lc3NEZXNjcmlwdGlvbi5pbWFnZXNbaW1hZ2VzQ291bnRlcl0uVVJMID0gc3ZjO1xyXG4gICAgICAgICAgICBpbWFnZXNDb3VudGVyKys7XHJcbiAgICAgICAgICAgIGlmKGltYWdlc0NvdW50ZXIgPT0gaW1hZ2VzTGVuZ3RoKSBpc0ltYWdlc1VwbG9hZGVyID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnaW1hZ2VzJyxpbWFnZXNDb3VudGVyLGVkaXQuYnVzaW5lc3NEZXNjcmlwdGlvbi5pbWFnZXMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9O1xyXG5cclxuICAgIC8vdmFyIHVwbG9hZGVyID0gJHNjb3BlLnVwbG9hZGVyTG9nbyA9IG5ldyBGaWxlVXBsb2FkZXIoKTtcclxuICAgICRzY29wZS51cGxvYWRlckxvZ28gPSBuZXcgRmlsZVVwbG9hZGVyKCk7XHJcbiAgICAkc2NvcGUudXBsb2FkZXJJbWFnZXMgPSBuZXcgRmlsZVVwbG9hZGVyKCk7XHJcblxyXG4gICAgLy8gRklMVEVSU1xyXG5cclxuICAgICRzY29wZS51cGxvYWRlckxvZ28uZmlsdGVycy5wdXNoKHtcclxuICAgICAgICBuYW1lOiAnaW1hZ2VGaWx0ZXInLFxyXG4gICAgICAgIGZuOiBmdW5jdGlvbihpdGVtIC8qe0ZpbGV8RmlsZUxpa2VPYmplY3R9Ki8sIG9wdGlvbnMpIHtcclxuICAgICAgICAgICAgdmFyIHR5cGUgPSAnfCcgKyBpdGVtLnR5cGUuc2xpY2UoaXRlbS50eXBlLmxhc3RJbmRleE9mKCcvJykgKyAxKSArICd8JztcclxuICAgICAgICAgICAgcmV0dXJuICd8anBnfHBuZ3xqcGVnfGJtcHxnaWZ8Jy5pbmRleE9mKHR5cGUpICE9PSAtMTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAvKnVwbG9hZGVyTG9nby5vbldoZW5BZGRpbmdGaWxlRmFpbGVkID0gZnVuY3Rpb24oaXRlbSAqLy8qe0ZpbGV8RmlsZUxpa2VPYmplY3R9Ki8vKiwgZmlsdGVyLCBvcHRpb25zKSB7XHJcbiAgICAgICAgY29uc29sZS5pbmZvKCdvbldoZW5BZGRpbmdGaWxlRmFpbGVkJywgaXRlbSwgZmlsdGVyLCBvcHRpb25zKTtcclxuICAgIH07Ki9cclxuICAgICRzY29wZS51cGxvYWRlckxvZ28ub25BZnRlckFkZGluZ0ZpbGUgPSBmdW5jdGlvbihmaWxlSXRlbSkge1xyXG4gICAgICAgIGNvbnNvbGUuaW5mbygnb25BZnRlckFkZGluZ0ZpbGUgMScsIGZpbGVJdGVtKTtcclxuICAgICAgICBpc0xvZ29VcGxvYWRlciA9IHRydWU7XHJcblxyXG4gICAgICAgIGF0dGFjaC5maWxlTmFtZSA9IGZpbGVJdGVtLl9maWxlLm5hbWU7XHJcbiAgICAgICAgYXR0YWNoLmNvbnRlbnRUeXBlID0gZmlsZUl0ZW0uX2ZpbGUudHlwZTtcclxuICAgIH07XHJcbiAgICAkc2NvcGUudXBsb2FkZXJJbWFnZXMub25BZnRlckFkZGluZ0ZpbGUgPSBmdW5jdGlvbihmaWxlSXRlbSkge1xyXG4gICAgICAgIGNvbnNvbGUuaW5mbygnb25BZnRlckFkZGluZ0ZpbGUgMicsIGZpbGVJdGVtKTtcclxuICAgIH07XHJcbiAgICAkc2NvcGUudXBsb2FkZXJJbWFnZXMub25BZnRlckFkZGluZ0FsbCA9IGZ1bmN0aW9uKGFkZGVkRmlsZUl0ZW1zKSB7XHJcbiAgICAgICAgY29uc29sZS5pbmZvKCdvbkFmdGVyQWRkaW5nQWxsJywgYWRkZWRGaWxlSXRlbXMpO1xyXG5cclxuICAgICAgICBpc0ltYWdlc1VwbG9hZGVyID0gdHJ1ZTtcclxuICAgICAgICAvL2ltYWdlc0NvdW50ZXIgPSAwO1xyXG5cclxuICAgICAgICBpbWFnZXNMZW5ndGggPSBhZGRlZEZpbGVJdGVtcy5sZW5ndGg7XHJcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGltYWdlc0xlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgZWRpdC5idXNpbmVzc0Rlc2NyaXB0aW9uLmltYWdlc1tpXSA9IG5ldyBjb20udm1lc3Rlb25saW5lLmJlLnRocmlmdC5tZXNzYWdlc2VydmljZS5BdHRhY2goKTtcclxuICAgICAgICAgICAgZWRpdC5idXNpbmVzc0Rlc2NyaXB0aW9uLmltYWdlc1tpXS5maWxlTmFtZSA9IGFkZGVkRmlsZUl0ZW1zW2ldLl9maWxlLm5hbWU7XHJcbiAgICAgICAgICAgIGVkaXQuYnVzaW5lc3NEZXNjcmlwdGlvbi5pbWFnZXNbaV0uY29udGVudFR5cGUgPSBhZGRlZEZpbGVJdGVtc1tpXS5fZmlsZS50eXBlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9O1xyXG4gICAgLyokc2NvcGUudXBsb2FkZXJMb2dvLm9uQmVmb3JlVXBsb2FkSXRlbSA9IGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICBjb25zb2xlLmluZm8oJ29uQmVmb3JlVXBsb2FkSXRlbScsIGl0ZW0pO1xyXG4gICAgfTtcclxuICAgICRzY29wZS51cGxvYWRlckxvZ28ub25Qcm9ncmVzc0l0ZW0gPSBmdW5jdGlvbihmaWxlSXRlbSwgcHJvZ3Jlc3MpIHtcclxuICAgICAgICBjb25zb2xlLmluZm8oJ29uUHJvZ3Jlc3NJdGVtJywgZmlsZUl0ZW0sIHByb2dyZXNzKTtcclxuICAgIH07XHJcbiAgICAkc2NvcGUudXBsb2FkZXJMb2dvLm9uUHJvZ3Jlc3NBbGwgPSBmdW5jdGlvbihwcm9ncmVzcykge1xyXG4gICAgICAgIGNvbnNvbGUuaW5mbygnb25Qcm9ncmVzc0FsbCcsIHByb2dyZXNzKTtcclxuICAgIH07XHJcbiAgICAkc2NvcGUudXBsb2FkZXJMb2dvLm9uU3VjY2Vzc0l0ZW0gPSBmdW5jdGlvbihmaWxlSXRlbSwgcmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycykge1xyXG4gICAgICAgIGNvbnNvbGUuaW5mbygnb25TdWNjZXNzSXRlbScsIGZpbGVJdGVtLCByZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzKTtcclxuICAgIH07XHJcbiAgICAkc2NvcGUudXBsb2FkZXJMb2dvLm9uRXJyb3JJdGVtID0gZnVuY3Rpb24oZmlsZUl0ZW0sIHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMpIHtcclxuICAgICAgICBjb25zb2xlLmluZm8oJ29uRXJyb3JJdGVtJywgZmlsZUl0ZW0sIHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMpO1xyXG4gICAgfTtcclxuICAgICRzY29wZS51cGxvYWRlckxvZ28ub25DYW5jZWxJdGVtID0gZnVuY3Rpb24oZmlsZUl0ZW0sIHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMpIHtcclxuICAgICAgICBjb25zb2xlLmluZm8oJ29uQ2FuY2VsSXRlbScsIGZpbGVJdGVtLCByZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzKTtcclxuICAgIH07XHJcbiAgICAkc2NvcGUudXBsb2FkZXJMb2dvLm9uQ29tcGxldGVJdGVtID0gZnVuY3Rpb24oZmlsZUl0ZW0sIHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMpIHtcclxuICAgICAgICBjb25zb2xlLmluZm8oJ29uQ29tcGxldGVJdGVtJywgZmlsZUl0ZW0sIHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMpO1xyXG4gICAgfTtcclxuICAgICRzY29wZS51cGxvYWRlckxvZ28ub25Db21wbGV0ZUFsbCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGNvbnNvbGUuaW5mbygnb25Db21wbGV0ZUFsbCcpO1xyXG4gICAgfTsqL1xyXG5cclxuXHJcbiAgICAkcm9vdFNjb3BlLmJ1c2luZXNzRGVzY3JpcHRpb24gPSBlZGl0LmJ1c2luZXNzRGVzY3JpcHRpb24gPSAkYy5idXNpbmVzc0NsaWVudC5nZXRNeUJ1c2luZXNzSW5mbygpO1xyXG5cclxuICAgIC8vZWRpdC5idXNpbmVzc0Rlc2NyaXB0aW9uID0gbmV3IGNvbS52bWVzdGVvbmxpbmUuYmUudGhyaWZ0LmJ1c2luZXNzZXJ2aWNlLkJ1c2luZXNzRGVzY3JpcHRpb247XHJcblxyXG4gICAgZWRpdC5zYXZlID0gZnVuY3Rpb24oKXtcclxuXHJcbiAgICAgICAgLy9lZGl0LmJ1c2luZXNzRGVzY3JpcHRpb24ubG9nby5VUkwgPSAkYy5maWxlQ2xpZW50LnNhdmVGaWxlQ29udGVudChiZywgdHJ1ZSk7XHJcbiAgICAgICAgLy8gYmcgLSBiaW5hcnkgZGF0YSBiYXNlNjRcclxuXHJcblxyXG4gICAgICAgIGVkaXQuYnVzaW5lc3NEZXNjcmlwdGlvbi5sb2dvID0gYXR0YWNoO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdzYXZlJyxlZGl0LmJ1c2luZXNzRGVzY3JpcHRpb24pO1xyXG4gICAgICAgIC8vZWRpdC5idXNpbmVzc0Rlc2NyaXB0aW9uLmxvZ28uZmlsZU5hbWUgPSAnMSc7XHJcbiAgICAgICAgLy9lZGl0LmJ1c2luZXNzRGVzY3JpcHRpb24ubG9nby5VUkwgPSAnL3N0YXRpYy9pbWFnZXMvYW5uYS5qcGcnO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAkYy5idXNpbmVzc0NsaWVudC51cGRhdGVCdXNpbmVzc0Rlc2NyaXB0aW9uKGVkaXQuYnVzaW5lc3NEZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgIGVkaXQuc3RhdHVzVGV4dCA9IFwi0KHQvtGF0YDQsNC90LXQvdC+XCI7XHJcbiAgICAgICAgICAgIGVkaXQuc3RhdHVzID0gMTtcclxuICAgICAgICB9Y2F0Y2goZSl7XHJcbiAgICAgICAgICAgIGVkaXQuc3RhdHVzVGV4dCA9IFwi0J/RgNC4INGB0L7RhdGA0LDQvdC10L3QuNC4INC/0YDQvtC40LfQvtGI0LvQsCDQvtGI0LjQsdC60LBcIjtcclxuICAgICAgICAgICAgZWRpdC5zdGF0dXMgPSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coJ2FmdGVyIHNhdmUnLGVkaXQuYnVzaW5lc3NEZXNjcmlwdGlvbik7XHJcblxyXG4gICAgfVxyXG5cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gWyAnJHJvb3RTY29wZScsJyRzY29wZScsJyRjJywnRmlsZVVwbG9hZGVyJywgZWRpdEN0cmwgXTsiLCJcclxudmFyIHN0YXRpc3RpY0N0cmwgPSBmdW5jdGlvbigkcm9vdFNjb3BlLCRjKSB7XHJcblxyXG4gICAgdmFyIG1hcHMgPSB0aGlzLFxyXG4gICAgICAgIGJ1c2luZXNzRGVzY3JpcHRpb247XHJcblxyXG4gICAgKCRyb290U2NvcGUuYnVzaW5lc3NEZXNjcmlwdGlvbikgP1xyXG4gICAgYnVzaW5lc3NEZXNjcmlwdGlvbiA9ICRyb290U2NvcGUuYnVzaW5lc3NEZXNjcmlwdGlvbiA6XHJcbiAgICBidXNpbmVzc0Rlc2NyaXB0aW9uID0gJGMuYnVzaW5lc3NDbGllbnQuZ2V0TXlCdXNpbmVzc0luZm8oKSA7XHJcblxyXG4gICAgdmFyIHlhTWFwO1xyXG4gICAgbWFwcy5hZnRlck1hcEluaXQ9ZnVuY3Rpb24obk1hcCl7XHJcbiAgICAgICAgeWFNYXAgPSBuTWFwO1xyXG4gICAgfTtcclxuXHJcbiAgICAvL3ZhciBsb2NhdGlvbiA9IHVzZXJDbGllbnQuZ2V0R3JvdXBWaWV3KGdyb3VwSWQpO1xyXG4gICAgbWFwcy5jZW50ZXIgPSBbYnVzaW5lc3NEZXNjcmlwdGlvbi5sb25naXR1ZGUsYnVzaW5lc3NEZXNjcmlwdGlvbi5sYXRpdHVkZV07XHJcbiAgICBtYXBzLnpvb20gPSAxNjtcclxuICAgIG1hcHMucmFkaXVzID0gYnVzaW5lc3NEZXNjcmlwdGlvbi5yYWRpdXM7XHJcbiAgICBtYXBzLmNvbG9yID0gJGMuTUFQX0NPTE9SO1xyXG5cclxuICAgIG1hcHMuYmFsb29uID0ge1xyXG4gICAgICAgIGdlb21ldHJ5OiB7XHJcbiAgICAgICAgICAgIHR5cGU6ICdQb2ludCcsXHJcbiAgICAgICAgICAgIGNvb3JkaW5hdGVzOiBtYXBzLmNlbnRlclxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgLy8g0KHQstC+0LnRgdGC0LLQsFxyXG4gICAgICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICAgICAgaGludENvbnRlbnQ6IFwi0K8g0LfQtNC10YHRjFwiXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFsgJyRyb290U2NvcGUnLCckYycsIHN0YXRpc3RpY0N0cmwgXTsiLCJcclxudmFyIGNoYW5nZUF2YXRhckN0cmwgPSBmdW5jdGlvbigkc3RhdGUsJHJvb3RTY29wZSwkYyl7XHJcblxyXG4gICAgICAgIHZhciBjaGFuZ2VBdmF0YXIgPSB0aGlzLCBuZXdTcmMsXHJcbiAgICAgICAgICAgIHgxID0gNTAsIHkxID0gNTAsIHgyID0gMjAwLCB5MiA9IDIwMCxcclxuICAgICAgICAgICAgaW1hZ2VXaWR0aCA9IDE1MCwgaW1hZ2VIZWlnaHQgPSAxNTA7XHJcblxyXG4gICAgICAgIGNoYW5nZUF2YXRhci5zYXZlID0gZnVuY3Rpb24oKXtcclxuXHJcbiAgICAgICAgICAgIHZhciBzYXZlU3JjID0gbmV3U3JjK1wiP3c9XCIrIGltYWdlV2lkdGggK1wiJmg9XCIrIGltYWdlSGVpZ2h0ICtcIiZzPVwiK3gxK1wiLFwiK3kxK1wiLFwiK3gyK1wiLFwiK3kyO1xyXG4gICAgICAgICAgICAkYy51c2VyQ2xpZW50LnVwZGF0ZVVzZXJBdmF0YXIoc2F2ZVNyYyk7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS51c2VyLmF2YXRhciA9ICRyb290U2NvcGUuYmFzZS5hdmF0YXJCdWZmZXIgPSBzYXZlU3JjO1xyXG5cclxuICAgICAgICAgICAgJChcIiNkaWFsb2ctbWVzc2FnZVwiKS5kaWFsb2coJ2Nsb3NlJyk7XHJcbiAgICAgICAgICAgICRzdGF0ZS5nbygncHJvZmlsZScpO1xyXG5cclxuICAgICAgICAgICAgJCgnLnByZXZpZXctY29udGFpbmVyJykuYWRkQ2xhc3MoJ2hpZGRlbicpO1xyXG5cclxuICAgICAgICAgICAgJCgnLnVpLWRpYWxvZycpLmVhY2goZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIGlmKCQodGhpcykuYXR0cignYXJpYS1kZXNjcmliZWRieScpID09ICdkaWFsb2ctbWVzc2FnZScpe1xyXG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuZGV0YWNoKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNoYW5nZUF2YXRhci5iYWNrID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgJCgnLmxvYWQtYXZhdGFyJykuZmluZCgnLmZpbGUtbGFiZWwnKS5odG1sKFwiXCIpLlxyXG4gICAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3MoXCJoaWRlLXBsYWNlaG9sZGVyIHNlbGVjdGVkXCIpLlxyXG4gICAgICAgICAgICAgICAgYXR0cihcImRhdGEtdGl0bGVcIixcItCX0LDQs9GA0YPQt9C40YLRjCDQsNCy0LDRgtCw0YBcIik7XHJcblxyXG4gICAgICAgICAgICAkKCcubG9hZEF2YXRhci1hcmVhJykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xyXG4gICAgICAgICAgICAkKCcuY3JvcC1hcmVhJykuYWRkQ2xhc3MoJ2hpZGRlbicpO1xyXG5cclxuICAgICAgICAgICAgJCgnLnByZXZpZXctY29udGFpbmVyJykuYWRkQ2xhc3MoJ2hpZGRlbicpO1xyXG4gICAgICAgICAgICAkKCcubG9hZGluZycpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcclxuXHJcbiAgICAgICAgICAgICQoJyNpbWFnZS1mb3ItY3JvcCcpLmRldGFjaCgpO1xyXG4gICAgICAgICAgICAkKCcuamNyb3AtaG9sZGVyJykuZGV0YWNoKCk7XHJcblxyXG4gICAgICAgICAgICAkKCcuYnRuLXNhdmUtYXZhdGFyJykuYmVmb3JlKCc8aW1nIHNyYz1cIiNcIiBpZD1cImltYWdlLWZvci1jcm9wXCIgYWx0PVwiI1wiIGNsYXNzPVwiaGlkZGVuXCIgLz4nKTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaW5pdE1vZGFsQW5kQ3JvcCgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpbml0TW9kYWxBbmRDcm9wKCkge1xyXG5cclxuICAgICAgICAgICAgJChcIiNkaWFsb2ctbWVzc2FnZVwiKS5yZW1vdmVDbGFzcygnaGlkZScpLmRpYWxvZyh7XHJcbiAgICAgICAgICAgICAgICBtb2RhbDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHdpZHRoOiA1MDQsXHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogWydjZW50ZXInLCAxMDBdLFxyXG4gICAgICAgICAgICAgICAgdGl0bGVfaHRtbDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBjbG9zZVRleHQ6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uIChldmVudCwgdWkpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJCgnLmxvYWQtYXZhdGFyIGlucHV0JykuYWNlX2ZpbGVfaW5wdXQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogJ3dlbGwnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBidG5fY2hvb3NlOiAn0JfQsNCz0YDRg9C30LjRgtGMINCw0LLQsNGC0LDRgCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ0bl9jaGFuZ2U6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vX2ljb246ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkcm9wcGFibGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbDogJ2xhcmdlJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbl9yZW1vdmU6IG51bGxcclxuICAgICAgICAgICAgICAgICAgICB9KS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW1hZ2VGb3JDcm9wID0gJCgnI2ltYWdlLWZvci1jcm9wJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcubG9hZEF2YXRhci1hcmVhLC5sb2FkLWF2YXRhci1lcnJvcicpLmFkZENsYXNzKCdoaWRkZW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmNyb3AtYXJlYScpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoc2F2ZU5ld0F2YSwgMTAwMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBzYXZlTmV3QXZhKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF2YUltZyA9ICQoJy5sb2FkLWF2YXRhcicpLmZpbmQoJy5maWxlLWxhYmVsIGltZycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYocGFyc2VJbnQoYXZhSW1nLmNzcygnd2lkdGgnKSkgPCAyMDAgfHwgcGFyc2VJbnQoYXZhSW1nLmNzcygnaGVpZ2h0JykpIDwgMjAwKXtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmxvYWRpbmcsLmJ0bi1zYXZlLWF2YXRhcicpLmFkZENsYXNzKCdoaWRkZW4nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmxvYWQtYXZhdGFyLWVycm9yJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQoJ9CY0LfQvtCx0YDQsNC20LXQvdC40LUg0LTQvtC70LbQvdC+INCx0YvRgtGMINC90LUg0LzQtdC90LXQtSAyMDBweCDQsiDRiNC40YDQuNC90YMg0Lgg0LLRi9GB0L7RgtGDLiDQn9C+0L/RgNC+0LHRg9C50YLQtSDQt9Cw0LPRgNGD0LfQuNGC0Ywg0LTRgNGD0LPQvtC1INC40LfQvtCx0YDQsNC20LXQvdC40LUuJykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcubG9hZGluZycpLmFkZENsYXNzKCdoaWRkZW4nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJnID0gYXZhSW1nLmNzcygnYmFja2dyb3VuZC1pbWFnZScpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmMgPSBhdmFJbWcuYXR0cignc3JjJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1NyYyA9ICRjLmZpbGVDbGllbnQuc2F2ZUZpbGVDb250ZW50KGJnLCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3ByZXZpZXcnKS5hdHRyKCdzcmMnLCBuZXdTcmMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWFnZUZvckNyb3AuYXR0cignc3JjJywgbmV3U3JjKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWFnZUZvckNyb3AuY3NzKHsnbWF4LXdpZHRoJzogJzUwMHB4JywgJ21heC1oZWlnaHQnOiAnNTAwcHgnfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlRm9yQ3JvcC5KY3JvcCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzcGVjdFJhdGlvOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRTZWxlY3Q6IFsgMjAwLCAyMDAsIDUwLCA1MCBdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogdXBkYXRlQ29vcmRzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblNlbGVjdDogdXBkYXRlQ29vcmRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcucHJldmlldy1jb250YWluZXIsLmJ0bi1zYXZlLWF2YXRhcicpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUNvb3JkcyhjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWFnZVdpZHRoID0gaW1hZ2VGb3JDcm9wLndpZHRoKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWFnZUhlaWdodCA9IGltYWdlRm9yQ3JvcC5oZWlnaHQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4MSA9IGMueDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkxID0gYy55O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeDIgPSBjLngyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeTIgPSBjLnkyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3gnKS52YWwoYy54KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjeScpLnZhbChjLnkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyN3JykudmFsKGMudyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2gnKS52YWwoYy5oKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3gyJykudmFsKGMueDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyN5MicpLnZhbChjLnkyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcnggPSAxNTAgLyBjLnc7IC8vIDE1MCAtINGA0LDQt9C80LXRgCDQvtC60L3QsCDQv9GA0LXQtNCy0LDRgNC40YLQtdC70YzQvdC+0LPQviDQv9GA0L7RgdC80L7RgtGA0LBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByeSA9IDE1MCAvIGMuaDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjcHJldmlldycpLmNzcyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IE1hdGgucm91bmQocnggKiBpbWFnZVdpZHRoKSArICdweCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLnJvdW5kKHJ5ICogaW1hZ2VIZWlnaHQpICsgJ3B4JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW5MZWZ0OiAnLScgKyBNYXRoLnJvdW5kKHJ4ICogYy54KSArICdweCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luVG9wOiAnLScgKyBNYXRoLnJvdW5kKHJ5ICogYy55KSArICdweCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gKGV2ZW50LCB1aSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygncHJvZmlsZScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkKCcucHJldmlldy1jb250YWluZXInKS5hZGRDbGFzcygnaGlkZGVuJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICQoJy51aS1kaWFsb2cnKS5lYWNoKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCQodGhpcykuYXR0cignYXJpYS1kZXNjcmliZWRieScpID09ICdkaWFsb2ctbWVzc2FnZScpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5kZXRhY2goKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBbICckc3RhdGUnLCckcm9vdFNjb3BlJywnJGMnLCBjaGFuZ2VBdmF0YXJDdHJsIF07IiwiXHJcbnZhciBjb250YWN0c0N0cmwgPSBmdW5jdGlvbigkcm9vdFNjb3BlLCRjKSB7XHJcbiAgICB2YXIgY3RybCA9IHRoaXM7XHJcblxyXG4gICAgJHJvb3RTY29wZS5iYXNlLmlzRm9vdGVyQm90dG9tID0gdHJ1ZTtcclxuXHJcbiAgICBjdHJsLmlzQXV0aCA9ICRjLmF1dGhDbGllbnQuY2hlY2tJZkF1dGhvcml6ZWQoKTtcclxuXHJcbiAgICBpZiAoY3RybC5pc0F1dGgpe1xyXG4gICAgICAgIGN0cmwudXNlciA9ICRjLnVzZXJDbGllbnQuZ2V0U2hvcnRVc2VySW5mbygpO1xyXG4gICAgICAgIGN0cmwudXNlcl9uYW1lID0gY3RybC51c2VyLmZpcnN0TmFtZStcIiBcIitjdHJsLnVzZXIubGFzdE5hbWU7XHJcbiAgICAgICAgY3RybC5jb250YWN0cyA9ICRjLnVzZXJDbGllbnQuZ2V0VXNlckNvbnRhY3RzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY3RybC5zZW5kID0gZnVuY3Rpb24oJGV2ZW50KXtcclxuICAgICAgICAkZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB2YXIgZW1haWwsbmFtZSxcclxuICAgICAgICAgICAgY29udGVudCA9IGN0cmwuY29udGVudDtcclxuXHJcbiAgICAgICAgaWYoY3RybC5pc0F1dGgpe1xyXG4gICAgICAgICAgICBlbWFpbCA9IGN0cmwuY29udGFjdHMuZW1haWw7XHJcbiAgICAgICAgICAgIG5hbWUgPSBjdHJsLnVzZXJfbmFtZTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgZW1haWwgPSBjdHJsLmVtYWlsO1xyXG4gICAgICAgICAgICBuYW1lID0gY3RybC5uYW1lO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGMubWVzc2FnZUNsaWVudC5zZW5kSW5mb0VtYWlsKGVtYWlsLG5hbWUsY29udGVudCk7XHJcbiAgICAgICAgY3RybC5pc1NlbmQgPSB0cnVlO1xyXG4gICAgICAgIGN0cmwuY29udGVudCA9IFwiXCI7XHJcbiAgICAgICAgLy9jb25zb2xlLmxvZyhlbWFpbCxuYW1lLGNvbnRlbnQpO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgb2xkVGV4dExlbmd0aCA9IDA7XHJcblxyXG4gICAgJCgnLmNvbnRlbnQnKS5rZXl1cChmdW5jdGlvbihldmVudCkge1xyXG5cclxuICAgICAgICB2YXIgZWwgPSBldmVudC50YXJnZXQsXHJcbiAgICAgICAgICAgIGNsaWVudEhlaWdodCA9IGVsLmNsaWVudEhlaWdodCxcclxuICAgICAgICAgICAgc2Nyb2xsSGVpZ2h0ID0gZWwuc2Nyb2xsSGVpZ2h0LFxyXG4gICAgICAgICAgICB0ZXh0TGVuZ3RoID0gZWwudGV4dExlbmd0aCxcclxuICAgICAgICAgICAgY2xpZW50V2lkdGggPSBlbC5jbGllbnRXaWR0aCxcclxuICAgICAgICAgICAgdGV4dExlbmd0aFBYLCBuZXdIZWlnaHQsIHJlbW92ZVJvd0NvdW50LFxyXG4gICAgICAgICAgICBkZWZhdWx0SGVpZ2h0LCBuZXdSb3dDb3VudDtcclxuXHJcbiAgICAgICAgZGVmYXVsdEhlaWdodCA9IDEwMDtcclxuXHJcbiAgICAgICAgLypcclxuICAgICAgICAg0JjRgdGF0L7QtNC90YvQtSDQtNCw0L3QvdGL0LU6XHJcbiAgICAgICAgINCd0LAg0L7QtNC40L0g0YHQuNC80LLQvtC7INC/0YDQuNGF0L7QtNC40YLRgdGPIH44cHgg0LIg0YjQuNGA0LjQvdGDXHJcbiAgICAgICAgINCS0YvRgdC+0YLQsCDRgdGC0YDQvtC60Lgg0YLQtdC60YHRgtCwIH4xNHB4XHJcblxyXG4gICAgICAgICAqINCX0LTQtdGB0Ywg0LLRi9C/0L7Qu9C90Y/QtdC8INGC0LDQutC40LUg0LTQtdC50YHRgtCy0LjRjyA6XHJcbiAgICAgICAgICogMSkg0KHRh9C40YLQsNC10Lwg0LTQu9C40L3RgyDRgtC10LrRgdGC0LAg0LIg0L/QuNC60YHQtdC70Y/RhVxyXG4gICAgICAgICAqIDIpINCe0L/RgNC10LTQtdC70Y/QtdC8INGG0LXQu9C+0LUg0LrQvtC70LjRh9C10YHRgtC+0LIg0YHRgtGA0L7Quiwg0LrQvtGC0L7RgNGL0LUg0YPQtNCw0LvQuNC70LhcclxuICAgICAgICAgKiAzKSDQntC/0YDQtdC00LXQu9GP0Lwg0L3QvtCy0YPRjiDQstGL0YHQvtGC0YMg0YEg0YPRh9C10YLQvtC8INCy0YvRgdC+0YLRiyDRg9C00LDQu9C10L3QvdC+0LPQviDRgtC10LrRgdGC0LBcclxuICAgICAgICAgKiAqL1xyXG5cclxuICAgICAgICBpZiAoc2Nyb2xsSGVpZ2h0ID4gY2xpZW50SGVpZ2h0KSB7XHJcblxyXG4gICAgICAgICAgICBlbC5zdHlsZS5oZWlnaHQgPSBzY3JvbGxIZWlnaHQgKyAncHgnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoc2Nyb2xsSGVpZ2h0ID4gZGVmYXVsdEhlaWdodCkge1xyXG4gICAgICAgICAgICB0ZXh0TGVuZ3RoUFggPSAocGFyc2VJbnQob2xkVGV4dExlbmd0aCkgLSB0ZXh0TGVuZ3RoKSAqIDg7IC8vIDFcclxuICAgICAgICAgICAgaWYgKHRleHRMZW5ndGhQWCA+IGNsaWVudFdpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICByZW1vdmVSb3dDb3VudCA9IE1hdGguZmxvb3IodGV4dExlbmd0aFBYIC8gY2xpZW50V2lkdGgpOyAvLyAyXHJcbiAgICAgICAgICAgICAgICBuZXdIZWlnaHQgPSBwYXJzZUludChldmVudC50YXJnZXQuc3R5bGUuaGVpZ2h0KSAtIHJlbW92ZVJvd0NvdW50ICogMTQ7IC8vIDNcclxuICAgICAgICAgICAgICAgIG5ld0hlaWdodCA+IGRlZmF1bHRIZWlnaHQgPyBldmVudC50YXJnZXQuc3R5bGUuaGVpZ2h0ID0gbmV3SGVpZ2h0ICsgXCJweFwiIDpcclxuICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQuc3R5bGUuaGVpZ2h0ID0gZGVmYXVsdEhlaWdodCArICdweCc7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZWwuc3R5bGUuaGVpZ2h0ID0gc2Nyb2xsSGVpZ2h0IC0gNiArICdweCc7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZWwuc3R5bGUuaGVpZ2h0ID0gZGVmYXVsdEhlaWdodCArICdweCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9sZFRleHRMZW5ndGggPSB0ZXh0TGVuZ3RoO1xyXG5cclxuXHJcbiAgICAgICAgJCgnLm5nLWNsb2FrJykucmVtb3ZlQ2xhc3MoJ25nLWNsb2FrJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBhbmd1bGFyLmVsZW1lbnQoJCgnLmNvbWluZy1zb29uJykpLmNzcyh7J21pbi1oZWlnaHQnOiAkKHdpbmRvdykuaGVpZ2h0KCktMTA1fSk7XHJcblxyXG4gICAgJCgnLm5nLWNsb2FrJykucmVtb3ZlQ2xhc3MoJ25nLWNsb2FrJyk7XHJcblxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBbICckcm9vdFNjb3BlJywnJGMnLCBjb250YWN0c0N0cmwgXTsiLCJcclxudmFyIGNvdW50ZXJzQ3RybCA9IGZ1bmN0aW9uKCRyb290U2NvcGUsJG1vZGFsLCRjb3VudGVycywkYykge1xyXG4gICAgICAgIHZhciBjb3VudGVycyA9IHRoaXM7XHJcbiAgICAgICAgLy9jb3VudGVycyA9ICRzY29wZTtcclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLm1haW5Db250ZW50VG9wSXNIaWRlID0gdHJ1ZTtcclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UucGFnZVRpdGxlID0gXCLQodGH0LXRgtGH0LjQutC4XCI7XHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLmlzRm9vdGVyQm90dG9tID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgY291bnRlcnMuY291bnRlcnMgPSAkY291bnRlcnMuZ2V0Q291bnRlcnM7XHJcbiAgICAgICAgY291bnRlcnMudHlwZXNBcnJheSA9IFtdO1xyXG4gICAgICAgIHZhciB0eXBlc0VudW1MZW5ndGggPSA2O1xyXG5cclxuICAgICAgICB2YXIgY291bnRlclNlcnZpY2UgPSAkYy51dGlsaXR5Q2xpZW50LmdldENvdW50ZXJTZXJ2aWNlKCk7XHJcblxyXG4gICAgICAgIHZhciBjdXJyZW50RGF0ZSA9IChuZXcgRGF0ZSgpKS5nZXREYXRlKCk7XHJcblxyXG4gICAgICAgIGNvdW50ZXJzLmVuZERhdGVPZk1vbnRoID0gY291bnRlclNlcnZpY2UuZW5kRGF0ZU9mTW9udGg7XHJcbiAgICAgICAgY291bnRlcnMuc3RhcnREYXRlT2ZNb250aCA9IGNvdW50ZXJTZXJ2aWNlLnN0YXJ0RGF0ZU9mTW9udGg7XHJcblxyXG4gICAgY29uc29sZS5sb2coY291bnRlclNlcnZpY2Uuc3RhcnREYXRlT2ZNb250aCtcIiBcIiArXHJcbiAgICAgICAgY291bnRlclNlcnZpY2UuZW5kRGF0ZU9mTW9udGgrXCIgXCIrXHJcbiAgICAgICAgY291bnRlclNlcnZpY2UuaW5mb1Byb3ZpZGVkKTtcclxuXHJcbiAgICB2YXIgaXNOb3c7XHJcbiAgICBpZihjb3VudGVyU2VydmljZS5lbmREYXRlT2ZNb250aCA+IGNvdW50ZXJTZXJ2aWNlLnN0YXJ0RGF0ZU9mTW9udGgpe1xyXG4gICAgICAgIGlzTm93ID0gKGN1cnJlbnREYXRlID49IGNvdW50ZXJTZXJ2aWNlLnN0YXJ0RGF0ZU9mTW9udGggJiZcclxuICAgICAgICAgICAgY3VycmVudERhdGUgPD0gY291bnRlclNlcnZpY2UuZW5kRGF0ZU9mTW9udGgpO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgaXNOb3cgPSAoY3VycmVudERhdGUgPD0gY291bnRlclNlcnZpY2UuZW5kRGF0ZU9mTW9udGggfHxcclxuICAgICAgICAgICAgY3VycmVudERhdGUgPj0gY291bnRlclNlcnZpY2Uuc3RhcnREYXRlT2ZNb250aCk7XHJcbiAgICB9XHJcblxyXG4gICAgICAgIGlmKGlzTm93ICl7XHJcblxyXG4gICAgICAgICAgICBpZihjb3VudGVyU2VydmljZS5pbmZvUHJvdmlkZWQpe1xyXG4gICAgICAgICAgICAgICAgLy8g0YEgMTQg0L/QviAyNCwg0L7RgtC/0YDQsNCy0LvQtdC90L5cclxuICAgICAgICAgICAgICAgIGNvdW50ZXJzLnN0YXRlID0gMjtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAvLyDRgSAxNCDQv9C+IDI0LCDQvdC1INC+0YLQv9GA0LDQstC70LXQvdC+XHJcbiAgICAgICAgICAgICAgICBjb3VudGVycy5zdGF0ZSA9IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgLy8g0LLRgNC10LzRjyDRgSAyNCDQv9C+IDE0INGH0LjRgdC70L5cclxuICAgICAgICAgICAgY291bnRlcnMuc3RhdGUgPSAwO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgLy9jb25zb2xlLmxvZygnc3RhdGUgJytjb3VudGVycy5zdGF0ZSk7XHJcblxyXG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB0eXBlc0VudW1MZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgIGNvdW50ZXJzLnR5cGVzQXJyYXlbaV0gPSB7fTtcclxuICAgICAgICAgICAgY291bnRlcnMudHlwZXNBcnJheVtpXS50eXBlID0gaTtcclxuICAgICAgICAgICAgY291bnRlcnMudHlwZXNBcnJheVtpXS50eXBlU3RyaW5nID0gJGNvdW50ZXJzLmdldFR5cGVTdHJpbmcoaSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgY291bnRlcnNMZW5ndGggPSBjb3VudGVycy5jb3VudGVycy5sZW5ndGg7XHJcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGNvdW50ZXJzTGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICBjb3VudGVycy5jb3VudGVyc1tpXS5jdXJyZW50VmFsdWUgPSBcIlwiO1xyXG4gICAgICAgICAgICBjb3VudGVycy5jb3VudGVyc1tpXS5pc0VkaXQgPSBmYWxzZTtcclxuICAgICAgICAgICAgY291bnRlcnMuY291bnRlcnNbaV0ud2FzRWRpdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBjb3VudGVycy5jb3VudGVyc1tpXS50eXBlU3RyaW5nID0gJGNvdW50ZXJzLmdldFR5cGVTdHJpbmcoY291bnRlcnMuY291bnRlcnNbaV0udHlwZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb3VudGVycy5zYXZlID0gZnVuY3Rpb24oKXtcclxuXHJcbiAgICAgICAgICAgIHZhciBjb3VudGVyc0xlbiA9IGNvdW50ZXJzLmNvdW50ZXJzLmxlbmd0aCxcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRWYWx1ZSxcclxuICAgICAgICAgICAgICAgIGRhdGUsIGlzQ2FuU2F2ZSA9IHRydWU7XHJcblxyXG5cclxuICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGNvdW50ZXJzTGVuOyBpKyspe1xyXG4gICAgICAgICAgICAgICAgaWYoIWNvdW50ZXJzLmNvdW50ZXJzW2ldLmN1cnJlbnRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlzQ2FuU2F2ZT0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmKGlzQ2FuU2F2ZSkge1xyXG4gICAgICAgICAgICAgICAgY291bnRlcnMuZXJyb3JUZXh0ID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb3VudGVyc0xlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50ZXJzLmNvdW50ZXJzW2ldLndhc0VkaXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSA9IERhdGUucGFyc2UobmV3IERhdGUoKSkgLyAxMDAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50VmFsdWUgPSBjb3VudGVycy5jb3VudGVyc1tpXS5jdXJyZW50VmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRWYWx1ZSkgY3VycmVudFZhbHVlID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGMudXRpbGl0eUNsaWVudC5zZXRDdXJyZW50Q291bnRlclZhbHVlKGNvdW50ZXJzLmNvdW50ZXJzW2ldLmlkLCBjdXJyZW50VmFsdWUsIGRhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudGVycy5jb3VudGVyc1tpXS5sYXN0VmFsdWUgPSBjdXJyZW50VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50ZXJzLmNvdW50ZXJzW2ldLmN1cnJlbnRWYWx1ZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50ZXJzLnN0YXRlID0gMjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgY291bnRlcnMuZXJyb3JUZXh0ID0gXCLQndC10L7QsdGF0L7QtNC40LzQviDRg9C60LDQt9Cw0YLRjCDQt9C90LDRh9C10L3QuNGPINCy0YHQtdGFINGB0YfRgtC10YfQuNC60L7QslwiO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNvdW50ZXJzLmFkZENvdW50ZXIgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB2YXIgY291bnRlciA9IG5ldyBjb20udm1lc3Rlb25saW5lLmJlLnRocmlmdC51dGlsaXR5c2VydmljZS5Db3VudGVyKCk7XHJcbiAgICAgICAgICAgIGNvdW50ZXIuaWQgPSAkYy51dGlsaXR5Q2xpZW50LnJlZ2lzdGVyQ291bnRlcihjb3VudGVyKTtcclxuICAgICAgICAgICAgY291bnRlci5pc0VkaXQgPSB0cnVlO1xyXG4gICAgICAgICAgICBjb3VudGVycy5jb3VudGVycy5wdXNoKGNvdW50ZXIpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY291bnRlcnMuZWRpdENvdW50ZXIgPSBmdW5jdGlvbihjb3VudGVyKXtcclxuICAgICAgICAgICAgY291bnRlci5pc0VkaXQgPSB0cnVlO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY291bnRlcnMuc2F2ZUVkaXRlZENvdW50ZXIgPSBmdW5jdGlvbihjb3VudGVyKXtcclxuICAgICAgICAgICAgLy9hbGVydChjb3VudGVyLmlkK1wiIFwiK2NvdW50ZXIubnVtYmVyK1wiIFwiK2NvdW50ZXIudHlwZStcIiBcIitjb3VudGVyLmxvY2F0aW9uKTtcclxuICAgICAgICAgICAgLypmb3IodmFyIHAgaW4gY291bnRlcil7XHJcbiAgICAgICAgICAgICAgICBhbGVydChjb3VudGVyW3BdK1wiIFwiK3ApO1xyXG4gICAgICAgICAgICB9Ki9cclxuXHJcbiAgICAgICAgICAgIHZhciBjb3JyZWN0Q291bnRlciA9IG5ldyBjb20udm1lc3Rlb25saW5lLmJlLnRocmlmdC51dGlsaXR5c2VydmljZS5Db3VudGVyKCk7XHJcbiAgICAgICAgICAgIGNvcnJlY3RDb3VudGVyLmlkID0gY291bnRlci5pZDtcclxuICAgICAgICAgICAgY29ycmVjdENvdW50ZXIubG9jYXRpb24gPSBjb3VudGVyLmxvY2F0aW9uO1xyXG4gICAgICAgICAgICBjb3JyZWN0Q291bnRlci50eXBlID0gY291bnRlci50eXBlO1xyXG4gICAgICAgICAgICBjb3JyZWN0Q291bnRlci5udW1iZXIgPSBjb3VudGVyLm51bWJlcjtcclxuICAgICAgICAgICAgY29ycmVjdENvdW50ZXIubGFzdFZhbHVlID0gY291bnRlci5sYXN0VmFsdWU7XHJcblxyXG4gICAgICAgICAgICAkYy51dGlsaXR5Q2xpZW50LnVwZGF0ZUNvdW50ZXIoY29ycmVjdENvdW50ZXIpO1xyXG4gICAgICAgICAgICBjb3VudGVyLmlzRWRpdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBjb3VudGVyLnR5cGVTdHJpbmcgPSAkY291bnRlcnMuZ2V0VHlwZVN0cmluZyhjb3VudGVyLnR5cGUpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY291bnRlcnMucmVtb3ZlQ291bnRlciA9IGZ1bmN0aW9uKGNvdW50ZXIpe1xyXG5cclxuICAgICAgICAgICAgdmFyIG1vZGFsID0gJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdteU1vZGFsQ29udGVudC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdNb2RhbEluc3RhbmNlQ3RybCcsXHJcbiAgICAgICAgICAgICAgICB3aW5kb3dDbGFzczogJ21vZGFsLXJlbW92ZS1jb3VudGVyJyxcclxuICAgICAgICAgICAgICAgIHNpemU6ICdzbSdcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBtb2RhbC5yZXN1bHQudGhlbihmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgJGMudXRpbGl0eUNsaWVudC5yZW1vdmVDb3VudGVyKGNvdW50ZXIuaWQpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvdW50ZXJzTGVuZ3RoID0gY291bnRlcnMuY291bnRlcnMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaTwgY291bnRlcnNMZW5ndGg7IGkrKyl7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGNvdW50ZXIuaWQgPT0gY291bnRlcnMuY291bnRlcnNbaV0uaWQpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudGVycy5jb3VudGVycy5zcGxpY2UoaSwxKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNvdW50ZXJzLmNvdW50ZXJzQ29uZmlybSA9IGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgICAgICAgICB2YXIgbmV3U2VydmljZXNTdGF0dXNlcyA9IFtdO1xyXG4gICAgICAgICAgICBuZXdTZXJ2aWNlc1N0YXR1c2VzWycxMSddID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICRjLnVzZXJDbGllbnQudXBkYXRlVXNlclNlcnZpY2VzKG5ld1NlcnZpY2VzU3RhdHVzZXMpO1xyXG5cclxuICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLm1lLmNvdW50ZXJzQ29uZmlybWVkID0gdHJ1ZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb3VudGVycy5jYW5jZWwgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBjb3VudGVycy5zdGF0ZSA9IDE7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY291bnRlcnMudG9nZ2xlTm90aWZpY2F0aW9uID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICB2YXIgbmV3U2VydmljZXNTdGF0dXNlcyA9IFtdO1xyXG5cclxuICAgICAgICAgIGlmICgkcm9vdFNjb3BlLmJhc2UubWUuY291bnRlcnNOb3RpZmljYXRpb24gKXtcclxuICAgICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UubWUuY291bnRlcnNOb3RpZmljYXRpb24gPSBuZXdTZXJ2aWNlc1N0YXR1c2VzWycxMiddID0gZmFsc2U7XHJcbiAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UubWUuY291bnRlcnNOb3RpZmljYXRpb24gPSBuZXdTZXJ2aWNlc1N0YXR1c2VzWycxMiddID0gdHJ1ZTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRjLnVzZXJDbGllbnQudXBkYXRlVXNlclNlcnZpY2VzKG5ld1NlcnZpY2VzU3RhdHVzZXMpO1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgIGNvdW50ZXJzLmlucHV0Q291bnRlciA9IGZ1bmN0aW9uKGNvdW50ZXIpe1xyXG4gICAgICAgIGNvdW50ZXIud2FzRWRpdCA9IHRydWU7XHJcbiAgICAgICAgY291bnRlci5jdXJyZW50VmFsdWUgPSBwYXJzZUludChjb3VudGVyLmN1cnJlbnRWYWx1ZSk7XHJcbiAgICAgfTtcclxuXHJcbiAgICAgICAgYW5ndWxhci5lbGVtZW50KCQoJy5jb3VudGVycycpKS5jc3MoeydtaW4taGVpZ2h0JzogJCh3aW5kb3cpLmhlaWdodCgpLTEwNX0pO1xyXG5cclxuICAgIH07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFsgJyRyb290U2NvcGUnLCckbW9kYWwnLCckY291bnRlcnMnLCckYycsIGNvdW50ZXJzQ3RybCBdOyIsIlxyXG52YXIgY291bnRlcnNIaXN0b3J5Q3RybCA9IGZ1bmN0aW9uKCRzY29wZSwkc3RhdGVQYXJhbXMsJHJvb3RTY29wZSwkY291bnRlcnMsJGMpIHtcclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLm1haW5Db250ZW50VG9wSXNIaWRlID0gdHJ1ZTtcclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UucGFnZVRpdGxlID0gXCLQmNGB0YLQvtGA0LjRjyDQv9C+0LrQsNC30LDQvdC40Lkg0YHRh9C10YLRh9C40LrQsFwiO1xyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5pc0Zvb3RlckJvdHRvbSA9IHRydWU7XHJcblxyXG4gICAgICAgIHZhciBjb3VudGVycyA9ICRjb3VudGVycy5nZXRDb3VudGVycyxcclxuICAgICAgICAgICAgY291bnRlcnNMZW4gPSBjb3VudGVycy5sZW5ndGg7XHJcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGNvdW50ZXJzTGVuOyBpKyspe1xyXG4gICAgICAgICAgICBpZihjb3VudGVyc1tpXS5pZCA9PSAkc3RhdGVQYXJhbXMuY291bnRlcklkKXtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jdXJyZW50Q291bnRlciA9IGNvdW50ZXJzW2ldO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRDb3VudGVyLnR5cGVTdHJpbmcgPSAkY291bnRlcnMuZ2V0VHlwZVN0cmluZyhjb3VudGVyc1tpXS50eXBlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIG5vdyA9IERhdGUucGFyc2UobmV3IERhdGUoKSkvMTAwMCxcclxuICAgICAgICAgICAgaGlzdG9yeSA9ICRjLnV0aWxpdHlDbGllbnQuZ2V0Q291bnRlckhpc3RvcnkoJHN0YXRlUGFyYW1zLmNvdW50ZXJJZCwwLG5vdyksXHJcbiAgICAgICAgICAgIGNvdW50ZXIgPSAwO1xyXG5cclxuICAgICAgICAkc2NvcGUuaGlzdG9yeSA9IFtdO1xyXG4gICAgICAgICRzY29wZS5jb3VudGVyTmFtZSA9ICRzdGF0ZVBhcmFtcy5jb3VudGVyTmFtZTtcclxuXHJcbiAgICAgICAgZm9yKHZhciBwIGluIGhpc3Rvcnkpe1xyXG4gICAgICAgICAgICAkc2NvcGUuaGlzdG9yeVtjb3VudGVyXSA9IHt9O1xyXG4gICAgICAgICAgICAkc2NvcGUuaGlzdG9yeVtjb3VudGVyXS5kYXRlID0gcDtcclxuICAgICAgICAgICAgJHNjb3BlLmhpc3RvcnlbY291bnRlcl0udmFsID0gaGlzdG9yeVtwXTtcclxuICAgICAgICAgICAgY291bnRlcisrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYW5ndWxhci5lbGVtZW50KCQoJy5jb3VudGVycycpKS5jc3MoeydtaW4taGVpZ2h0JzogJCh3aW5kb3cpLmhlaWdodCgpLTEwNX0pO1xyXG5cclxuICAgIH07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFsgJyRzdGF0ZScsJyRzdGF0ZVBhcmFtcycsJyRyb290U2NvcGUnLCckY291bnRlcnMnLCckYycsIGNvdW50ZXJzSGlzdG9yeUN0cmwgXTsiLCJcclxudmFyIGRpYWxvZ0N0cmwgPSBmdW5jdGlvbigkcm9vdFNjb3BlLCRzdGF0ZVBhcmFtcywkc3RhdGUsJGMpIHtcclxuXHJcbiAgICAgICAgJGMuaW5pdEZhbmN5Qm94KCQoJy5kaWFsb2cnKSk7XHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLm1haW5Db250ZW50VG9wSXNIaWRlID0gdHJ1ZTtcclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UuaXNGb290ZXJCb3R0b20gPSBmYWxzZTtcclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UubGFzdExvYWRlZElkID0gMDtcclxuICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRQYWdlID0gJ2RpYWxvZy1zaW5nbGUnO1xyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5jdXJyZW50RGlhbG9nSWQgPSAkc3RhdGVQYXJhbXMuZGlhbG9nSWQ7XHJcbiAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50UnVicmljID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIGRpYWxvZyA9IHRoaXMsXHJcbiAgICAgICAgICAgIGxhc3RMb2FkZWRJZCA9IDAsXHJcbiAgICAgICAgICAgIGxvYWRlZExlbmd0aCA9IDIwO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB2YXIgY3VycmVudERpYWxvZyA9ICRjLmRpYWxvZ0NsaWVudC5nZXREaWFsb2dCeUlkKCRzdGF0ZVBhcmFtcy5kaWFsb2dJZCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgY3VycmVudERpYWxvZ0xlbmd0aCA9IGN1cnJlbnREaWFsb2cubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgZGlhbG9nLmlzRGlhbG9nID0gdHJ1ZTtcclxuICAgICAgICAgICAgZGlhbG9nLmF0dGFjaElkID0gJzAwMCc7XHJcbiAgICAgICAgICAgIGRpYWxvZy5kaWFsb2dJZCA9ICRzdGF0ZVBhcmFtcy5kaWFsb2dJZDtcclxuXHJcbiAgICAgICAgICAgIGRpYWxvZy51c2VycyA9IGN1cnJlbnREaWFsb2cudXNlcnM7XHJcbiAgICAgICAgICAgIHZhciBkaWFsb2dVc2Vyc0xlbmd0aCA9IGRpYWxvZy51c2Vycy5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGlhbG9nVXNlcnNMZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhkaWFsb2cudXNlcnNbaV0uaWQrXCIgXCIrJHJvb3RTY29wZS5iYXNlLm1lLmlkKTtcclxuICAgICAgICAgICAgICAgIGlmIChkaWFsb2cudXNlcnNbaV0gJiYgKGRpYWxvZy51c2Vyc1tpXS5pZCA9PSAkcm9vdFNjb3BlLmJhc2UubWUuaWQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nLnVzZXJzLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCRzdGF0ZVBhcmFtcy5kaWFsb2dJZCkge1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLnNldFByaXZhdGVNZXNzYWdlcyhkaWFsb2cuZGlhbG9nSWQsbG9hZGVkTGVuZ3RoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBkaWFsb2cucHJpdmF0ZU1lc3NhZ2VzID0gJHJvb3RTY29wZS5iYXNlLnByaXZhdGVNZXNzYWdlcztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy9kaWFsb2cubWVzc2FnZVRleHQgPSAkYy5URVhUX0RFRkFVTFRfMTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmluaXRTdGFydFBhcmFtc0ZvckNyZWF0ZU1lc3NhZ2UoZGlhbG9nKTtcclxuXHJcbiAgICAgICAgfWNhdGNoKGUpe1xyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2RpYWxvZ3MnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBsYXN0TG9hZGVkSWRGRjtcclxuICAgICAgICBkaWFsb2cuYWRkTW9yZUl0ZW1zID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdmFyIGJ1ZmYgPSAkYy5kaWFsb2dDbGllbnQuZ2V0RGlhbG9nTWVzc2FnZXMoJHN0YXRlUGFyYW1zLmRpYWxvZ0lkLDAsbG9hZGVkTGVuZ3RoLCRyb290U2NvcGUuYmFzZS5sYXN0TG9hZGVkSWQpO1xyXG4gICAgICAgICAgICBpZihidWZmKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYnVmZkxlbmd0aCA9IGJ1ZmYubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKGJ1ZmZMZW5ndGggIT0gMCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UubGFzdExvYWRlZElkID0gYnVmZltidWZmTGVuZ3RoIC0gMV0uaWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGxhc3RMb2FkZWRJZEZGICE9ICRyb290U2NvcGUuYmFzZS5sYXN0TG9hZGVkSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBidWZmTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZbaV0uYXV0aG9yUHJvZmlsZSA9ICRjLnVzZXJDbGllbnQuZ2V0VXNlclByb2ZpbGUoYnVmZltpXS5hdXRob3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZy5wcml2YXRlTWVzc2FnZXMgPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLnByaXZhdGVNZXNzYWdlcyA9ICRyb290U2NvcGUuYmFzZS5wcml2YXRlTWVzc2FnZXMuY29uY2F0KGJ1ZmYpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbGFzdExvYWRlZElkRkYgPSAkcm9vdFNjb3BlLmJhc2UubGFzdExvYWRlZElkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICQoJy5uZy1jbG9haycpLnJlbW92ZUNsYXNzKCduZy1jbG9haycpO1xyXG5cclxuICAgIH07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFsgJyRyb290U2NvcGUnLCckc3RhdGVQYXJhbXMnLCckc3RhdGUnLCckYycsIGRpYWxvZ0N0cmwgXTsiLCJcclxudmFyIGRpYWxvZ3NDdHJsID0gIGZ1bmN0aW9uKCRyb290U2NvcGUsJHN0YXRlLCRjKXtcclxuICAgICAgICAkcm9vdFNjb3BlLmlzVG9wU2VhcmNoU2hvdyA9IGZhbHNlO1xyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5tYWluQ29udGVudFRvcElzSGlkZSA9IHRydWU7XHJcbiAgICAgICAgJHJvb3RTY29wZS5sZWZ0YmFyLnRhYiA9IDA7XHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLmlzRm9vdGVyQm90dG9tID0gZmFsc2U7XHJcbiAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50UGFnZSA9IFwiZGlhbG9nc1wiO1xyXG4gICAgICAgICRyb290U2NvcGUuY3VycmVudFJ1YnJpYyA9IG51bGw7XHJcblxyXG4gICAgICAgICRjLnJlc2V0UGFnZXMoJHJvb3RTY29wZS5iYXNlKTtcclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UucHJpdmF0ZU1lc3NhZ2VzSXNBY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5wYWdlVGl0bGUgPSBcItCb0LjRh9C90YvQtSDRgdC+0L7QsdGJ0LXQvdC40Y9cIjtcclxuXHJcbiAgICAgICAgJGMucmVzZXRBY2VOYXZCdG5zKCRyb290U2NvcGUubmF2YmFyKTtcclxuICAgICAgICAkcm9vdFNjb3BlLm5hdmJhci5wcml2YXRlTWVzc2FnZXNCdG5TdGF0dXMgPSBcImFjdGl2ZVwiO1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UucHJpdmF0ZU1lc3NhZ2VzTG9hZFN0YXR1cyA9IFwiaXNMb2FkZWRcIjtcclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS5pc05ld1ByaXZhdGVNZXNzYWdlQWRkZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgdmFyIGRpYWxvZ3MgPSB0aGlzO1xyXG5cclxuICAgICAgICBkaWFsb2dzLmRpYWxvZ3NMaXN0ID0gJGMuZGlhbG9nQ2xpZW50LmdldERpYWxvZ3MoMCk7XHJcbiAgICAgICAgdmFyIGRpYWxvZ3NMaXN0TGVuZ3RoID0gZGlhbG9ncy5kaWFsb2dzTGlzdC5sZW5ndGg7XHJcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGRpYWxvZ3NMaXN0TGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICAoZGlhbG9ncy5kaWFsb2dzTGlzdFtpXS51c2Vyc1swXS5pZCAhPSAkcm9vdFNjb3BlLmJhc2UubWUuaWQpID9cclxuICAgICAgICAgICAgICAgIGRpYWxvZ3MuZGlhbG9nc0xpc3RbaV0uYW5vdGhlclVzZXIgPSBkaWFsb2dzLmRpYWxvZ3NMaXN0W2ldLnVzZXJzWzBdIDpcclxuICAgICAgICAgICAgICAgIGRpYWxvZ3MuZGlhbG9nc0xpc3RbaV0uYW5vdGhlclVzZXIgPSBkaWFsb2dzLmRpYWxvZ3NMaXN0W2ldLnVzZXJzWzFdO1xyXG5cclxuICAgICAgICAgICAgZGlhbG9ncy5kaWFsb2dzTGlzdFtpXS5uZXdNZXNzYWdlc0NvdW50ID0gMDtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJkaWFsb2cgXCIrJHJvb3RTY29wZS5uZXdNZXNzYWdlcy5sZW5ndGgpO1xyXG4gICAgICAgICAgICBpZigkcm9vdFNjb3BlLm5ld01lc3NhZ2VzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHZhciBuZXdNZXNzYWdlc0xlbmd0aCA9ICRyb290U2NvcGUubmV3TWVzc2FnZXMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBqID0gMDsgaiA8IG5ld01lc3NhZ2VzTGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGlhbG9ncy5kaWFsb2dzTGlzdFtpXS5pZCA9PSAkcm9vdFNjb3BlLm5ld01lc3NhZ2VzW2pdLmRpYWxvZ0lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZ3MuZGlhbG9nc0xpc3RbaV0ubmV3TWVzc2FnZXNDb3VudCA9ICRyb290U2NvcGUubmV3TWVzc2FnZXNbal0uY291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBkaWFsb2dzLmdvVG9TaW5nbGVEaWFsb2cgPSBmdW5jdGlvbihkaWFsb2dJZCl7XHJcbiAgICAgICAgICAgIHZhciB1c2Vyc0luZm9BcnJheSA9IFtdLFxyXG4gICAgICAgICAgICAgICAgdXNlcnNJbmZvTGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgdXNlcnNJZCA9IFtdO1xyXG4gICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgZGlhbG9nc0xpc3RMZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICBpZihkaWFsb2dzLmRpYWxvZ3NMaXN0W2ldLmlkID09IGRpYWxvZ0lkKXtcclxuICAgICAgICAgICAgICAgICAgICB1c2Vyc0luZm9BcnJheSA9IGRpYWxvZ3MuZGlhbG9nc0xpc3RbaV0udXNlcnM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYodXNlcnNJbmZvQXJyYXkpe1xyXG4gICAgICAgICAgICAgICAgdXNlcnNJbmZvTGVuZ3RoID0gdXNlcnNJbmZvQXJyYXkubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHVzZXJzSW5mb0xlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgICAgICAgICB1c2Vyc0lkW2ldID0gdXNlcnNJbmZvQXJyYXlbaV0uaWRcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyRyb290U2NvcGUuY3VycmVudERpYWxvZyA9ICRjLmRpYWxvZ0NsaWVudC5nZXREaWFsb2codXNlcnNJZCk7XHJcbiAgICAgICAgICAgICRzdGF0ZS5nbygnZGlhbG9nLXNpbmdsZScseyBkaWFsb2dJZCA6IGRpYWxvZ0lkfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJCgnLm5nLWNsb2FrJykucmVtb3ZlQ2xhc3MoJ25nLWNsb2FrJyk7XHJcblxyXG4gICAgfTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gWyAnJHJvb3RTY29wZScsJyRzdGF0ZScsJyRjJywgZGlhbG9nc0N0cmwgXTsiLCJcclxudmFyIGltcG9ydGFudEN0cmwgPSBmdW5jdGlvbigkcm9vdFNjb3BlLCRjKSB7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuc2V0VGFiKDQpO1xyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5zaG93QWxsR3JvdXBzKCk7XHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLmlzRm9vdGVyQm90dG9tID0gZmFsc2U7XHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLnBhZ2VUaXRsZSA9IFwi0JLQsNC20L3QvlwiO1xyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5tYWluQ29udGVudFRvcElzSGlkZSA9IHRydWU7XHJcbiAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50UnVicmljID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIGltcG9ydGFudCA9IHRoaXMsXHJcbiAgICAgICAgICAgIGxhc3RMb2FkZWRJZCA9IDAsXHJcbiAgICAgICAgICAgIGxvYWRlZExlbmd0aCA9IDEwO1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLkNPTU1FTlRTX0RFRkFVTFRfQ09VTlQgPSA0O1xyXG4gICAgICAgIGltcG9ydGFudC5zZWxlY3RlZEdyb3VwSW5Ub3AgPSAkcm9vdFNjb3BlLmN1cnJlbnRHcm91cDtcclxuXHJcbiAgICAgICAgLyppZighJHJvb3RTY29wZS5pbXBvcnRhbnRJc0xvYWRlZEZyb21Ub3ApXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuaW1wb3J0YW50VG9waWNzID0gYy5tZXNzYWdlQ2xpZW50LmdldEltcG9ydGFudFRvcGljcygkcm9vdFNjb3BlLmN1cnJlbnRHcm91cC5pZCk7XHJcbiAgICAgICAgJHJvb3RTY29wZS5pbXBvcnRhbnRJc0xvYWRlZEZyb21Ub3AgPSBmYWxzZTsqL1xyXG5cclxuICAgICAgICAvL2ltcG9ydGFudC50b3BpY3MgPSBjLm1lc3NhZ2VDbGllbnQuZ2V0SW1wb3J0YW50VG9waWNzKCRyb290U2NvcGUuY3VycmVudEdyb3VwLmlkKTtcclxuICAgICAgICBpbXBvcnRhbnQud2FsbEl0ZW1zID0gJGMubWVzc2FnZUNsaWVudC5nZXRJbXBvcnRhbnROZXdzKCRyb290U2NvcGUuY3VycmVudEdyb3VwLmlkLDAsMCwwKTtcclxuXHJcbiAgICAgICAgaW1wb3J0YW50LmF0dGFjaElkID0gXCIwXCI7XHJcbiAgICAgICAgLy8kcm9vdFNjb3BlLmJhc2UuaW5pdFN0YXJ0UGFyYW1zRm9yQ3JlYXRlVG9waWMoaW1wb3J0YW50KTtcclxuXHJcbiAgICAgICAgaW1wb3J0YW50Lm1lc3NhZ2UgPSB7fTtcclxuXHJcbiAgICAgICAgaW1wb3J0YW50Lm1lc3NhZ2UuY29udGVudCA9IGltcG9ydGFudC5tZXNzYWdlLmRlZmF1bHQgPSAkYy5URVhUX0RFRkFVTFRfMTtcclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS5pbXBvcnRhbnRDaGFuZ2VHcm91cCA9IGZ1bmN0aW9uKGdyb3VwSWQpe1xyXG5cclxuICAgICAgICAgICAgaW1wb3J0YW50LndhbGxJdGVtcyA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0SW1wb3J0YW50TmV3cyhncm91cElkLCAwLCBsb2FkZWRMZW5ndGgpO1xyXG5cclxuICAgICAgICAgICAgaWYoaW1wb3J0YW50LndhbGxJdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGluaXRXYWxsSXRlbShpbXBvcnRhbnQud2FsbEl0ZW1zKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2xhc3RMb2FkZWRJZCA9IGxlbnRhLndhbGxJdGVtc1tpbXBvcnRhbnQud2FsbEl0ZW1zLmxlbmd0aC0xXS50b3BpYy5pZDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgd2FsbEl0ZW1zTGVuZ3RoO1xyXG4gICAgICAgIGltcG9ydGFudC53YWxsSXRlbXMgPyB3YWxsSXRlbXNMZW5ndGggPSBpbXBvcnRhbnQud2FsbEl0ZW1zLmxlbmd0aCA6XHJcbiAgICAgICAgICAgIHdhbGxJdGVtc0xlbmd0aCA9IDA7XHJcblxyXG4gICAgICAgIGlmKHdhbGxJdGVtc0xlbmd0aCA9PSAwKSAkcm9vdFNjb3BlLmJhc2UubWFpbkNvbnRlbnRUb3BJc0hpZGUgPSB0cnVlO1xyXG5cclxuICAgICAgICBpZih3YWxsSXRlbXNMZW5ndGggIT0gMCkgbGFzdExvYWRlZElkID0gaW1wb3J0YW50LndhbGxJdGVtc1t3YWxsSXRlbXNMZW5ndGgtMV0udG9waWMuaWQ7XHJcblxyXG4gICAgICAgIGluaXRXYWxsSXRlbShpbXBvcnRhbnQud2FsbEl0ZW1zKTtcclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS5zZWxlY3RHcm91cEluRHJvcGRvd25faW1wb3J0YW50ID0gZnVuY3Rpb24oZ3JvdXBJZCl7XHJcbiAgICAgICAgICAgIGltcG9ydGFudC5zZWxlY3RlZEdyb3VwID0gJHJvb3RTY29wZS5iYXNlLmJ1ZmZlclNlbGVjdGVkR3JvdXAgPSAkYy5zZWxlY3RHcm91cEluRHJvcGRvd24oZ3JvdXBJZCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaW1wb3J0YW50LmdvVG9BbnN3ZXJJbnB1dCA9IGZ1bmN0aW9uKGV2ZW50KXtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaW5pdEZsYWdzQXJyYXkgPSBbXTtcclxuICAgICAgICBpbXBvcnRhbnQuc2hvd0Fuc3dlcklucHV0ID0gZnVuY3Rpb24oZXZlbnQsd2FsbEl0ZW0sd2FsbE1lc3NhZ2Upe1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgLyp3YWxsSXRlbS5hbnN3ZXJTaG93ID9cclxuICAgICAgICAgICAgIHdhbGxJdGVtLmFuc3dlclNob3cgPSBmYWxzZSA6Ki9cclxuICAgICAgICAgICAgd2FsbEl0ZW0uYW5zd2VyU2hvdyA9IHRydWUgO1xyXG4gICAgICAgICAgICB3YWxsSXRlbS5pc0ZvY3VzID0gdHJ1ZSA7XHJcblxyXG4gICAgICAgICAgICBpZih3YWxsTWVzc2FnZSl7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXV0aG9yTmFtZTtcclxuICAgICAgICAgICAgICAgIHdhbGxNZXNzYWdlLnVzZXJJbmZvID9cclxuICAgICAgICAgICAgICAgICAgICBhdXRob3JOYW1lID0gd2FsbE1lc3NhZ2UudXNlckluZm8uZmlyc3ROYW1lIDpcclxuICAgICAgICAgICAgICAgICAgICBhdXRob3JOYW1lID0gd2FsbE1lc3NhZ2UuYXV0aG9yTmFtZS5zcGxpdCgnICcpWzBdO1xyXG4gICAgICAgICAgICAgICAgd2FsbEl0ZW0uY29tbWVudFRleHQgPSBhdXRob3JOYW1lK1wiLCBcIjtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICB3YWxsSXRlbS5jb21tZW50VGV4dCA9IFwiXCI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmKCFpbml0RmxhZ3NBcnJheVt3YWxsSXRlbS50b3BpYy5pZF0pIHtcclxuICAgICAgICAgICAgICAgIC8vINC40L3QuNGE0LjRhtCw0LvQuNC30LDRhtC80Y4gQXR0YWNoSW1hZ2Ug0L3Rg9C20L3QviDQtNC10LvQsNGC0Ywg0YLQvtC70YzQutC+INC+0LTQuNC9INGA0LDQtyDQtNC70Y8g0LrQsNC20LTQvtCz0L4g0YHQvtC+0LHRidC10L3QuNGPXHJcbiAgICAgICAgICAgICAgICBpbml0RmxhZ3NBcnJheVt3YWxsSXRlbS50b3BpYy5pZF0gPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRyb290U2NvcGUud2FsbENoYW5nZUdyb3VwID0gZnVuY3Rpb24oZ3JvdXBJZCl7XHJcblxyXG4gICAgICAgICAgICBpbXBvcnRhbnQud2FsbEl0ZW1zID0gJGMubWVzc2FnZUNsaWVudC5nZXRXYWxsSXRlbXMoZ3JvdXBJZCwgMCwgbG9hZGVkTGVuZ3RoKTtcclxuXHJcbiAgICAgICAgICAgIGlmKGltcG9ydGFudC53YWxsSXRlbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBpbml0V2FsbEl0ZW0oaW1wb3J0YW50LndhbGxJdGVtcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGFzdExvYWRlZElkID0gaW1wb3J0YW50LndhbGxJdGVtc1tpbXBvcnRhbnQud2FsbEl0ZW1zLmxlbmd0aC0xXS50b3BpYy5pZDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpbml0V2FsbEl0ZW0od2FsbEl0ZW1zKXtcclxuICAgICAgICAgICAgd2FsbEl0ZW1zTGVuZ3RoID0gd2FsbEl0ZW1zLmxlbmd0aDtcclxuICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHdhbGxJdGVtc0xlbmd0aDsgaSsrKXtcclxuXHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UuaW5pdFN0YXJ0UGFyYW1zRm9yQ3JlYXRlTWVzc2FnZSh3YWxsSXRlbXNbaV0pO1xyXG5cclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5pbml0U3RhcnRQYXJhbXNGb3JDcmVhdGVUb3BpYyh3YWxsSXRlbXNbaV0udG9waWMpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vICB3YWxsSXRlbXNbaV0udG9waWMubWVzc2FnZS5ncm91cElkINGB0LXQudGH0LDRgSDQvdC1INC30LDQtNCw0L3QsCDQv9C+0YfQtdC80YMt0YLQvlxyXG4gICAgICAgICAgICAgICAgd2FsbEl0ZW1zW2ldLmxhYmVsID0gJGMuZ2V0TGFiZWwoJHJvb3RTY29wZS5iYXNlLmdyb3Vwcyx3YWxsSXRlbXNbaV0udG9waWMuZ3JvdXBUeXBlKTtcclxuXHJcbiAgICAgICAgICAgICAgICB3YWxsSXRlbXNbaV0udGFnQ29sb3IgPSAkYy5nZXRUYWdDb2xvcih3YWxsSXRlbXNbaV0ubGFiZWwpO1xyXG5cclxuICAgICAgICAgICAgICAgIHdhbGxJdGVtc1tpXS5pc09wZW4gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZih3YWxsSXRlbXNbaV0udG9waWMubWVzc2FnZS5pbXBvcnRhbnQgPT0gMSl7XHJcbiAgICAgICAgICAgICAgICAgICAgd2FsbEl0ZW1zW2ldLnRvcGljLm1lc3NhZ2UuaW1wb3J0YW50VGV4dCA9ICfQodC90Y/RgtGMINC80LXRgtC60YMgXCLQktCw0LbQvdC+0LVcIic7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICB3YWxsSXRlbXNbaV0udG9waWMubWVzc2FnZS5pbXBvcnRhbnRUZXh0ID0gJ9Cf0L7QvNC10YLQuNGC0Ywg0LrQsNC6IFwi0JLQsNC20L3QvtC1XCInO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmKHdhbGxJdGVtc1tpXS50b3BpYy5tZXNzYWdlLnR5cGUgPT0gMSl7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHdhbGxJdGVtc1tpXS50b3BpYy5sYXN0VXBkYXRlRWRpdCA9ICRjLmdldFRpbWluZyh3YWxsSXRlbXNbaV0udG9waWMubGFzdFVwZGF0ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgfWVsc2UgaWYod2FsbEl0ZW1zW2ldLnRvcGljLm1lc3NhZ2UudHlwZSA9PSA1KXtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgd2FsbEl0ZW1zW2ldLnRvcGljLm1lc3NhZ2UuY3JlYXRlZEVkaXQgPSAkYy5nZXRUaW1pbmcod2FsbEl0ZW1zW2ldLnRvcGljLm1lc3NhZ2UuY3JlYXRlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgd2FsbEl0ZW1zW2ldLnRvcGljLmF1dGhvck5hbWUgPSAkYy5nZXRBdXRob3JOYW1lKHdhbGxJdGVtc1tpXS50b3BpYy51c2VySW5mbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgd2FsbEl0ZW1zW2ldLnRvcGljLm1ldGFUeXBlID0gXCJtZXNzYWdlXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtZXNMZW47XHJcbiAgICAgICAgICAgICAgICAgICAgd2FsbEl0ZW1zW2ldLm1lc3NhZ2VzID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzTGVuID0gd2FsbEl0ZW1zW2ldLm1lc3NhZ2VzLmxlbmd0aDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzTGVuID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBqID0gMDsgaiA8IG1lc0xlbjsgaisrKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2FsbEl0ZW1zW2ldLm1lc3NhZ2VzW2pdLmNyZWF0ZWRFZGl0ID0gJGMuZ2V0VGltaW5nKHdhbGxJdGVtc1tpXS5tZXNzYWdlc1tqXS5jcmVhdGVkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2FsbEl0ZW1zW2ldLm1lc3NhZ2VzW2pdLmF1dGhvck5hbWUgPSAkYy5nZXRBdXRob3JOYW1lKHdhbGxJdGVtc1tpXS5tZXNzYWdlc1tqXS51c2VySW5mbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhbGxJdGVtc1tpXS5tZXNzYWdlc1tqXS5pc0VkaXQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5pbml0U3RhcnRQYXJhbXNGb3JDcmVhdGVNZXNzYWdlKHdhbGxJdGVtc1tpXS5tZXNzYWdlc1tqXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAobWVzTGVuID49ICRyb290U2NvcGUuQ09NTUVOVFNfREVGQVVMVF9DT1VOVCkgP1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3YWxsSXRlbXNbaV0uYnVmZmVyTWVzc2FnZXMgPSB3YWxsSXRlbXNbaV0ubWVzc2FnZXMuc2xpY2UobWVzTGVuLSRyb290U2NvcGUuQ09NTUVOVFNfREVGQVVMVF9DT1VOVCk6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhbGxJdGVtc1tpXS5idWZmZXJNZXNzYWdlcyA9IHdhbGxJdGVtc1tpXS5tZXNzYWdlcztcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZih3YWxsSXRlbXNbaV0udG9waWMucG9sbCAhPSBudWxsKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy/Qt9C90LDRh9C40YIg0Y3RgtC+INC+0L/RgNC+0YFcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGMuc2V0UG9sbEVkaXROYW1lcyh3YWxsSXRlbXNbaV0udG9waWMucG9sbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3YWxsSXRlbXNbaV0udG9waWMubWV0YVR5cGUgPSBcInBvbGxcIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGltcG9ydGFudC50b2dnbGVDb21tZW50cyA9IGZ1bmN0aW9uKGV2ZW50LHdhbGxJdGVtKXtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBtZXNMZW4gPSB3YWxsSXRlbS5tZXNzYWdlcy5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICBpZih3YWxsSXRlbS5pc09wZW4pe1xyXG4gICAgICAgICAgICAgICAgd2FsbEl0ZW0uaXNPcGVuID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgKG1lc0xlbiA+PSAkcm9vdFNjb3BlLkNPTU1FTlRTX0RFRkFVTFRfQ09VTlQpID9cclxuICAgICAgICAgICAgICAgICAgICB3YWxsSXRlbS5idWZmZXJNZXNzYWdlcyA9IHdhbGxJdGVtLm1lc3NhZ2VzLnNsaWNlKG1lc0xlbi0kcm9vdFNjb3BlLkNPTU1FTlRTX0RFRkFVTFRfQ09VTlQpOlxyXG4gICAgICAgICAgICAgICAgICAgIHdhbGxJdGVtLmJ1ZmZlck1lc3NhZ2VzID0gd2FsbEl0ZW0ubWVzc2FnZXM7XHJcblxyXG4gICAgICAgICAgICAgICAgLy93YWxsSXRlbS5idWZmZXJNZXNzYWdlcyA9IHdhbGxJdGVtLm1lc3NhZ2VzLnNsaWNlKG1lc0xlbi1pbXBvcnRhbnQuQ09NTUVOVFNfREVGQVVMVF9DT1VOVCk7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgd2FsbEl0ZW0uaXNPcGVuID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHdhbGxJdGVtLmJ1ZmZlck1lc3NhZ2VzID0gd2FsbEl0ZW0ubWVzc2FnZXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkYy5pbml0RmFuY3lCb3goJCgnLmZvcnVtJykpO1xyXG5cclxuICAgICAgICAkKCcubmctY2xvYWsnKS5yZW1vdmVDbGFzcygnbmctY2xvYWsnKTtcclxuXHJcbiAgICB9O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBbICckcm9vdFNjb3BlJywnJGMnLCBpbXBvcnRhbnRDdHJsIF07IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBhbmd1bGFyLm1vZHVsZSgnVk9Db250cm9sbGVycycsIFsndWkuc2VsZWN0MicsJ2luZmluaXRlLXNjcm9sbCcsJ25nU2FuaXRpemUnLCd5YU1hcCcsJ3VpLmJvb3RzdHJhcCcsJ2FuZ3VsYXJGaWxlVXBsb2FkJ10pXHJcblxyXG4gICAgLmNvbnRyb2xsZXIoJ2Jhc2VDdHJsJywgcmVxdWlyZSgnLi9iYXNlLmpzJykpXHJcblxyXG4gICAgLmNvbnRyb2xsZXIoJ2Fib3V0Q3RybCcsIHJlcXVpcmUoJy4vYWJvdXQuanMnKSlcclxuICAgIC5jb250cm9sbGVyKCdhZHZlcnRzQ3RybCcsIHJlcXVpcmUoJy4vYWR2ZXJ0cy5qcycpKVxyXG4gICAgLmNvbnRyb2xsZXIoJ2FkdmVydHNTaW5nbGVDdHJsJywgcmVxdWlyZSgnLi9hZHZlcnRzU2luZ2xlLmpzJykpXHJcbiAgICAuY29udHJvbGxlcignYmxvZ0N0cmwnLCByZXF1aXJlKCcuL2Jsb2cuanMnKSlcclxuICAgIC5jb250cm9sbGVyKCdjaGFuZ2VBdmF0YXJDdHJsJywgcmVxdWlyZSgnLi9jaGFuZ2VBdmF0YXIuanMnKSlcclxuICAgIC5jb250cm9sbGVyKCdjb250YWN0c0N0cmwnLCByZXF1aXJlKCcuL2NvbnRhY3RzLmpzJykpXHJcbiAgICAuY29udHJvbGxlcignY291bnRlcnNDdHJsJywgcmVxdWlyZSgnLi9jb3VudGVycy5qcycpKVxyXG4gICAgLmNvbnRyb2xsZXIoJ2NvdW50ZXJzSGlzdG9yeUN0cmwnLCByZXF1aXJlKCcuL2NvdW50ZXJzSGlzdG9yeS5qcycpKVxyXG4gICAgLmNvbnRyb2xsZXIoJ2RpYWxvZ0N0cmwnLCByZXF1aXJlKCcuL2RpYWxvZy5qcycpKVxyXG4gICAgLmNvbnRyb2xsZXIoJ2RpYWxvZ3NDdHJsJywgcmVxdWlyZSgnLi9kaWFsb2dzLmpzJykpXHJcbiAgICAuY29udHJvbGxlcignaW1wb3J0YW50Q3RybCcsIHJlcXVpcmUoJy4vaW1wb3J0YW50LmpzJykpXHJcbiAgICAuY29udHJvbGxlcignbGVmdEJhckN0cmwnLCByZXF1aXJlKCcuL2xlZnRCYXIuanMnKSlcclxuICAgIC5jb250cm9sbGVyKCd3YWxsQ3RybCcsIHJlcXVpcmUoJy4vd2FsbC5qcycpKVxyXG4gICAgLmNvbnRyb2xsZXIoJ21haW5Db250ZW50VG9wQ3RybCcsIHJlcXVpcmUoJy4vbWFpbkNvbnRlbnRUb3AuanMnKSlcclxuICAgIC5jb250cm9sbGVyKCdtYXBzQ3RybCcsIHJlcXVpcmUoJy4vbWFwcy5qcycpKVxyXG4gICAgLmNvbnRyb2xsZXIoJ21vZGFsSW5zdGFuY2VDdHJsJywgcmVxdWlyZSgnLi9tb2RhbEluc3RhbmNlLmpzJykpXHJcbiAgICAuY29udHJvbGxlcignbmF2YmFyQ3RybCcsIHJlcXVpcmUoJy4vbmF2YmFyLmpzJykpXHJcbiAgICAuY29udHJvbGxlcignbmVhcmJ5Q3RybCcsIHJlcXVpcmUoJy4vbmVhcmJ5LmpzJykpXHJcbiAgICAuY29udHJvbGxlcignbmVhcmJ5U2luZ2xlQ3RybCcsIHJlcXVpcmUoJy4vbmVhcmJ5U2luZ2xlLmpzJykpXHJcbiAgICAuY29udHJvbGxlcignbmVpZ2hib3Vyc0N0cmwnLCByZXF1aXJlKCcuL25laWdoYm91cnMuanMnKSlcclxuICAgIC5jb250cm9sbGVyKCdwcm9maWxlQ3RybCcsIHJlcXVpcmUoJy4vcHJvZmlsZS5qcycpKVxyXG4gICAgLmNvbnRyb2xsZXIoJ3J1YnJpY3NDdHJsJywgcmVxdWlyZSgnLi9ydWJyaWNzLmpzJykpXHJcbiAgICAuY29udHJvbGxlcigncnVicmljc1NpbmdsZUN0cmwnLCByZXF1aXJlKCcuL3J1YnJpY3NTaW5nbGUuanMnKSlcclxuICAgIC5jb250cm9sbGVyKCdzZXRJbmZvQ3RybCcsIHJlcXVpcmUoJy4vc2V0SW5mby5qcycpKVxyXG4gICAgLmNvbnRyb2xsZXIoJ3NldHRpbmdzQ3RybCcsIHJlcXVpcmUoJy4vc2V0dGluZ3MuanMnKSlcclxuICAgIC5jb250cm9sbGVyKCd0YWxrc0N0cmwnLCByZXF1aXJlKCcuL3RhbGtzLmpzJykpXHJcbiAgICAuY29udHJvbGxlcigndGFsa3NTaW5nbGVDdHJsJywgcmVxdWlyZSgnLi90YWxrc1NpbmdsZS5qcycpKVxyXG4gICAgLmNvbnRyb2xsZXIoJ3VuY29uZmlybWVkQ3RybCcsIHJlcXVpcmUoJy4vdW5jb25maXJtZWQuanMnKSlcclxuICAgIC5jb250cm9sbGVyKCd3YWxsU2luZ2xlQ3RybCcsIHJlcXVpcmUoJy4vd2FsbFNpbmdsZS5qcycpKVxyXG5cclxuICAgIC8vIGJ1c2luZXNzXHJcbiAgICAuY29udHJvbGxlcignY2FiaW5ldEN0cmwnLCByZXF1aXJlKCcuL2J1c2luZXNzL2NhYmluZXQuanMnKSlcclxuICAgIC5jb250cm9sbGVyKCdlZGl0Q3RybCcsIHJlcXVpcmUoJy4vYnVzaW5lc3MvZWRpdC5qcycpKVxyXG4gICAgLmNvbnRyb2xsZXIoJ3N0YXRpc3RpY0N0cmwnLCByZXF1aXJlKCcuL2J1c2luZXNzL3N0YXRpc3RpYy5qcycpKVxyXG47IiwiXHJcbnZhciBsZWZ0QmFyQ3RybCA9IGZ1bmN0aW9uKCRyb290U2NvcGUsJHN0YXRlLCRjKSB7XHJcblxyXG4gICAgJHJvb3RTY29wZS5zZXRUYWIgPSBmdW5jdGlvbihuZXdWYWx1ZSl7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUubGVmdGJhci50YWIgPSBuZXdWYWx1ZTtcclxuICAgICAgICAkcm9vdFNjb3BlLmlzVG9wU2VhcmNoU2hvdyA9IHRydWU7XHJcbiAgICAgICAgJGMucmVzZXRQYWdlcygkcm9vdFNjb3BlLmJhc2UpO1xyXG4gICAgICAgICRjLnJlc2V0QWNlTmF2QnRucygkcm9vdFNjb3BlLm5hdmJhcik7XHJcblxyXG4gICAgICAgIHN3aXRjaChuZXdWYWx1ZSl7XHJcbiAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5tYWluQ29udGVudFRvcElzSGlkZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmxlbnRhSXNBY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50UGFnZSA9ICdsZW50YSc7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UucGFnZVRpdGxlID0gXCLQndC+0LLQvtGB0YLQuFwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5tYWluQ29udGVudFRvcElzSGlkZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmlzVGFsa1RpdGxlcyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UudGFsa3NJc0FjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRQYWdlID0gJ3RhbGtzJztcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5wYWdlVGl0bGUgPSBcItCe0LHRgdGD0LbQtNC10L3QuNGPXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLm1haW5Db250ZW50VG9wSXNIaWRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UuaXNBZHZlcnRzVGl0bGVzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5hZHZlcnRzSXNBY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50UGFnZSA9ICdhZHZlcnRzJztcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5wYWdlVGl0bGUgPSBcItCe0LHRitGP0LLQu9C10L3QuNGPXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSA0OlxyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLm1haW5Db250ZW50VG9wSXNIaWRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UuaW1wb3J0YW50SXNBY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50UGFnZSA9ICdpbXBvcnRhbnQnO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLnBhZ2VUaXRsZSA9IFwi0JLQsNC20L3Ri9C1INGB0L7QvtCx0YnQtdC90LjRj1wiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgNTpcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5tYWluQ29udGVudFRvcElzSGlkZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmltcG9ydGFudElzQWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFBhZ2UgPSAnbmVhcmJ5JztcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5wYWdlVGl0bGUgPSBcItCg0Y/QtNC+0LxcIjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0IDpcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9O1xyXG5cclxuICAgICRyb290U2NvcGUuaXNTZXQgPSBmdW5jdGlvbihudW1iZXIpe1xyXG4gICAgICAgIHJldHVybiAkcm9vdFNjb3BlLmxlZnRiYXIudGFiID09PSBudW1iZXI7XHJcbiAgICB9O1xyXG5cclxuICAgICRyb290U2NvcGUuc2V0UnVicmljID0gZnVuY3Rpb24ocnVicmljKXtcclxuXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFJ1YnJpYyA9IHJ1YnJpYztcclxuICAgICAgICAgICAgJHJvb3RTY29wZS5zZWxSdWJyaWNOYW1lID0gJHJvb3RTY29wZS5jdXJyZW50UnVicmljLnZpc2libGVOYW1lO1xyXG4gICAgICAgIGlmKCFydWJyaWMpIHtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50UnVicmljID0ge307XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuc2VsUnVicmljTmFtZSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZigkc3RhdGUuY3VycmVudC5uYW1lICE9ICdtYWluJykge1xyXG4gICAgICAgICAgICB2YXIgc3QgPSAkc3RhdGUuZ2V0KCdtYWluJyk7XHJcbiAgICAgICAgICAgIHN0LnJ1YnJpY0lkID0gcnVicmljLmlkO1xyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ21haW4nKTtcclxuICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUud2FsbENoYW5nZVJ1YnJpYygkcm9vdFNjb3BlLmN1cnJlbnRSdWJyaWMuaWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gWyAnJHJvb3RTY29wZScsJyRzdGF0ZScsJyRjJywgbGVmdEJhckN0cmwgXTsiLCJcclxudmFyIG1haW5Db250ZW50VG9wQ3RybCA9IGZ1bmN0aW9uKCRyb290U2NvcGUsICRzdGF0ZSwkYykge1xyXG5cclxuICAgICAgICB2YXIgdG9wQ3RybCA9IHRoaXM7XHJcblxyXG4gICAgICAgIHRvcEN0cmwuZ3JvdXBzID0gJGMudXNlckNsaWVudEdyb3VwczsvLyA/IHVzZXJDbGllbnRHcm91cHMucmV2ZXJzZSgpIDogdXNlckNsaWVudC5nZXRVc2VyR3JvdXBzKCkucmV2ZXJzZSgpO1xyXG4gICAgICAgIHZhciBncm91cHMgPSAkcm9vdFNjb3BlLmdyb3VwcyA9IHRvcEN0cmwuZ3JvdXBzLFxyXG4gICAgICAgICAgICBncm91cHNMZW5ndGggPSBncm91cHMubGVuZ3RoO1xyXG5cclxuICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgZ3JvdXBzTGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICBncm91cHNbaV0uaXNTaG93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYoZ3JvdXBzW2ldLmlkID09ICRyb290U2NvcGUuY3VycmVudEdyb3VwLmlkKSBncm91cHNbaV0uc2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdG9wQ3RybC5pc1NldCA9IGZ1bmN0aW9uKGdyb3VwSWQpe1xyXG4gICAgICAgICAgICAvL3JldHVybiBncm91cElkID09PVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuc2VsZWN0R3JvdXAgPSBmdW5jdGlvbihncm91cCl7XHJcbiAgICAgICAgICAgIC8vdmFyIGdyb3VwSWQgPSBncm91cC5pZDtcclxuXHJcbiAgICAgICAgICAgIGlmKGdyb3VwLmlkID09IDApe1xyXG5cclxuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnc2V0LWluZm8nKTtcclxuXHJcbiAgICAgICAgICAgIH1lbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmKCRzdGF0ZS5jdXJyZW50Lm5hbWUgPT0gJ3NldC1pbmZvJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdWT19zZXRJbmZvX2dyb3VwSWQnLGdyb3VwLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ21haW4nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdyb3Vwc0xlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBzW2ldLnNlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZ3JvdXAuc2VsZWN0ZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudEdyb3VwID0gZ3JvdXA7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UuYnVmZmVyU2VsZWN0ZWRHcm91cCA9ICRjLnNlbGVjdEdyb3VwSW5Ecm9wZG93bihncm91cC5pZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8kcm9vdFNjb3BlLmltcG9ydGFudFRvcGljcyA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0SW1wb3J0YW50TmV3cyhncm91cC5pZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCRyb290U2NvcGUuY3VycmVudFBhZ2UgPT0gJ2xlbnRhJykge1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUud2FsbENoYW5nZUdyb3VwKGdyb3VwLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnNlbGVjdEdyb3VwSW5Ecm9wZG93bl9sZW50YShncm91cC5pZCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCRyb290U2NvcGUuY3VycmVudFBhZ2UgPT0gJ3RhbGtzJykge1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUudGFsa3NDaGFuZ2VHcm91cChncm91cC5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5zZWxlY3RHcm91cEluRHJvcGRvd25fdGFsa3MoZ3JvdXAuaWQpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICgkcm9vdFNjb3BlLmN1cnJlbnRQYWdlID09ICdhZHZlcnRzJykge1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuYWR2ZXJ0c0NoYW5nZUdyb3VwKGdyb3VwLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnNlbGVjdEdyb3VwSW5Ecm9wZG93bl9hZHZlcnRzKGdyb3VwLmlkKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJHJvb3RTY29wZS5jdXJyZW50UGFnZSA9PSAnbmVpZ2hib3VycycpIHtcclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLm5laWdoYm91cnNDaGFuZ2VHcm91cChncm91cC5pZCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCRyb290U2NvcGUuY3VycmVudFBhZ2UgPT0gJ21hcHMnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5tYXBzQ2hhbmdlR3JvdXAoZ3JvdXAuaWQpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICgkcm9vdFNjb3BlLmN1cnJlbnRQYWdlID09ICdpbXBvcnRhbnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5pbXBvcnRhbnRDaGFuZ2VHcm91cChncm91cC5pZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2dyb3VwSWQnLCBncm91cC5pZCk7XHJcbiAgICAgICAgICAgICAgICAvLyRyb290U2NvcGUuY3VycmVudEdyb3VwID0gJHJvb3RTY29wZS5iYXNlLnNlbGVjdEdyb3VwSW5Ecm9wZG93bihncm91cC5pZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLnNob3dDcmVhdGVUb3BpYyA9IGZ1bmN0aW9uKGV2ZW50KXtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5jcmVhdGVUb3BpY0lzSGlkZSA/ICRyb290U2NvcGUuYmFzZS5jcmVhdGVUb3BpY0lzSGlkZSA9IGZhbHNlIDogJHJvb3RTY29wZS5iYXNlLmNyZWF0ZVRvcGljSXNIaWRlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJCgnLm5nLWNsb2FrJykucmVtb3ZlQ2xhc3MoJ25nLWNsb2FrJyk7XHJcbiAgICB9O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBbICckcm9vdFNjb3BlJywnJHN0YXRlJywnJGMnLCBtYWluQ29udGVudFRvcEN0cmwgXTsiLCJcclxudmFyIG1hcHNDdHJsID0gZnVuY3Rpb24oJHJvb3RTY29wZSwkYykge1xyXG4gICAgICAgIHZhciBtYXBzID0gdGhpcztcclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50UGFnZSA9IFwibWFwc1wiO1xyXG4gICAgICAgICRyb290U2NvcGUuaXNUb3BTZWFyY2hTaG93ID0gZmFsc2U7XHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLm1haW5Db250ZW50VG9wSXNIaWRlID0gZmFsc2U7XHJcbiAgICAgICAgJHJvb3RTY29wZS5sZWZ0YmFyLnRhYiA9IDA7XHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLnBhZ2VUaXRsZSA9IFwi0JrQsNGA0YLRi1wiO1xyXG5cclxuICAgICAgICAkYy5yZXNldFBhZ2VzKCRyb290U2NvcGUuYmFzZSk7XHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLm1hcHNJc0FjdGl2ZSA9IHRydWU7XHJcblxyXG4gICAgICAgICRjLnJlc2V0QWNlTmF2QnRucygkcm9vdFNjb3BlLm5hdmJhcik7XHJcbiAgICAgICAgJHJvb3RTY29wZS5uYXZiYXIubWFwc0J0blN0YXR1cyA9IFwiYWN0aXZlXCI7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5tYXBzTG9hZFN0YXR1cyA9IFwiaXNMb2FkZWRcIjtcclxuXHJcbiAgICAgICAgJGMuc2hvd0dyb3VwT3ZlckJ1aWxkaW5nKCRyb290U2NvcGUuZ3JvdXBzKTtcclxuICAgICAgICAvLyRyb290U2NvcGUuZ3JvdXBzWzBdLmlzU2hvdyA9IGZhbHNlO1xyXG4gICAgICAgIC8vJHJvb3RTY29wZS5ncm91cHNbMV0uc2VsZWN0ZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAvKmlmKCRyb290U2NvcGUuY3VycmVudEdyb3VwLmlkID09ICRyb290U2NvcGUuZ3JvdXBzWzBdLmlkKXtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50R3JvdXAgPSAkcm9vdFNjb3BlLmdyb3Vwc1sxXTtcclxuICAgICAgICB9Ki9cclxuICAgICRyb290U2NvcGUuY3VycmVudEdyb3VwID0gJGMudXNlckNsaWVudEdyb3Vwc1szXTtcclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLmlzRm9vdGVyQm90dG9tID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgdmFyIHlhTWFwO1xyXG4gICAgICAgIG1hcHMuYWZ0ZXJNYXBJbml0PWZ1bmN0aW9uKG5NYXApe1xyXG4gICAgICAgICAgICB5YU1hcCA9IG5NYXA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgbWFwcy5jb2xvciA9ICRjLk1BUF9DT0xPUjtcclxuXHJcbiAgICAgICAgLy9tYXBzLnVybCA9ICRjLnVzZXJDbGllbnQuZ2V0R3JvdXBNYXAoJHJvb3RTY29wZS5jdXJyZW50R3JvdXAuaWQsTUFQX0NPTE9SKTtcclxuXHJcbiAgICAgICAgdmFyIGxvY2F0aW9uID0gJGMudXNlckNsaWVudC5nZXRHcm91cFZpZXcoJHJvb3RTY29wZS5jdXJyZW50R3JvdXAuaWQpO1xyXG5cclxuICAgICAgICB2YXIgc2V0TWFwID0gZnVuY3Rpb24obG9jYXRpb24pe1xyXG5cclxuICAgICAgICAgICAgbWFwcy5jZW50ZXIgPSBbbG9jYXRpb24ubG9uZ2l0dWRlLGxvY2F0aW9uLmxhdGl0dWRlXTtcclxuXHJcbiAgICAgICAgICAgIGlmICh5YU1hcCkge1xyXG4gICAgICAgICAgICAgICAgKCRyb290U2NvcGUuY3VycmVudEdyb3VwLnR5cGUgPT0gNCkgPyB5YU1hcC5zZXRab29tKDE3KSA6IHlhTWFwLnNldFpvb20oMTYpOyA7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgKCRyb290U2NvcGUuY3VycmVudEdyb3VwLnR5cGUgPT0gNCkgPyBtYXBzLnpvb20gPSAxNyA6IG1hcHMuem9vbSA9IDE2IDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbWFwcy5iYWxvb24gPSB7XHJcbiAgICAgICAgICAgICAgICAvLyDQk9C10L7QvNC10YLRgNC40Y8gPSDRgtC40L8g0L7QsdGK0LXQutGC0LAgKyDQs9C10L7Qs9GA0LDRhNC40YfQtdGB0LrQuNC1INC60L7QvtGA0LTQuNC90LDRgtGLINC+0LHRitC10LrRgtCwXHJcbiAgICAgICAgICAgICAgICBnZW9tZXRyeToge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vINCi0LjQvyDQs9C10L7QvNC10YLRgNC40LggLSDRgtC+0YfQutCwXHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1BvaW50JyxcclxuICAgICAgICAgICAgICAgICAgICAvLyDQmtC+0L7RgNC00LjQvdCw0YLRiyDRgtC+0YfQutC4LlxyXG4gICAgICAgICAgICAgICAgICAgIGNvb3JkaW5hdGVzOiBtYXBzLmNlbnRlclxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIC8vINCh0LLQvtC50YHRgtCy0LBcclxuICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICAgICAgICAgICAgICBoaW50Q29udGVudDogXCLQryDQt9C00LXRgdGMXCJcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIG1hcHMucmFkaXVzID0ge1xyXG4gICAgICAgICAgICAgICAgZ2VvbWV0cnk6IHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQ2lyY2xlJyxcclxuICAgICAgICAgICAgICAgICAgICBjb29yZGluYXRlczogbWFwcy5jZW50ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgcmFkaXVzOiBsb2NhdGlvbi5yYWRpdXNcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHNldE1hcChsb2NhdGlvbik7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUubWFwc0NoYW5nZUdyb3VwID0gZnVuY3Rpb24oZ3JvdXBJZCl7XHJcbiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9ICRjLnVzZXJDbGllbnQuZ2V0R3JvdXBWaWV3KGdyb3VwSWQpO1xyXG5cclxuICAgICAgICAgICAgc2V0TWFwKGxvY2F0aW9uKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8vJHJvb3RTY29wZS5zZWxlY3RHcm91cCgkYy5nZXRCdWlsZGluZ0dyb3VwKCRyb290U2NvcGUuY3VycmVudEdyb3VwKSk7XHJcblxyXG4gICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkKCcubWFwcy5wYWdlJykpLmNzcyh7J21pbi1oZWlnaHQnOiAkKHdpbmRvdykuaGVpZ2h0KCktMTc1fSk7IFxyXG5cclxuICAgIH07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFsgJyRyb290U2NvcGUnLCckYycsIG1hcHNDdHJsIF07IiwiXHJcbnZhciBtb2RhbEluc3RhbmNlQ3RybCA9IGZ1bmN0aW9uKCRzY29wZSwgJG1vZGFsSW5zdGFuY2UpIHtcclxuICAgICAgICAkc2NvcGUub2sgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRtb2RhbEluc3RhbmNlLmNsb3NlKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJG1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFsgJyRzY29wZScsJyQkbW9kYWxJbnN0YW5jZScsIG1vZGFsSW5zdGFuY2VDdHJsIF07IiwiXHJcbnZhciBuYXZiYXJDdHJsID0gZnVuY3Rpb24oJHJvb3RTY29wZSwkYykge1xyXG5cclxuICAgICAgICB0aGlzLnByaXZhdGVNZXNzYWdlc0J0blN0YXR1cyA9IFwiXCI7XHJcbiAgICAgICAgJHJvb3RTY29wZS5uYXZiYXIgPSB0aGlzO1xyXG5cclxuICAgICAgICB0aGlzLmxvZ291dCA9IGZ1bmN0aW9uKGV2ZW50KXtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdncm91cElkJyk7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdWT19pc19idXNpbmVzcycpO1xyXG4gICAgICAgICAgICAkYy5hdXRoQ2xpZW50LmxvZ291dCgpO1xyXG5cclxuICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24ucmVwbGFjZShcIi9sb2dpblwiKTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8kKCcubmctY2xvYWsnKS5yZW1vdmVDbGFzcygnbmctY2xvYWsnKTtcclxuXHJcbiAgfTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gWyAnJHJvb3RTY29wZScsJyRjJywgbmF2YmFyQ3RybCBdOyIsIlxyXG52YXIgbmVhcmJ5Q3RybCA9IGZ1bmN0aW9uKCRyb290U2NvcGUsJGMpIHtcclxuICAgIHZhciBuZWFyYnkgPSB0aGlzO1xyXG5cclxuICAgIHZhciBncm91cFR5cGUgPSBjb20udm1lc3Rlb25saW5lLmJlLnRocmlmdC5Hcm91cFR5cGUuTkVJR0hCT1JTO1xyXG4gICAgbmVhcmJ5LmJ1c2luZXNzTGlzdCA9ICRjLmJ1c2luZXNzQ2xpZW50LmdldEJ1c2luZXNzTGlzdChncm91cFR5cGUsMCk7XHJcblxyXG4gICAgJHJvb3RTY29wZS5iYXNlLmlzRm9vdGVyQm90dG9tID0gdHJ1ZTtcclxuICAgICRyb290U2NvcGUuYmFzZS5wYWdlVGl0bGUgPSBcItCg0Y/QtNC+0LxcIjtcclxuICAgICRyb290U2NvcGUuYmFzZS50YWxrc0lzQWN0aXZlID0gJHJvb3RTY29wZS5iYXNlLmFkdmVydHNJc0FjdGl2ZSA9IGZhbHNlO1xyXG4gICAgJGMuc2hvd0dyb3VwT3ZlckJ1aWxkaW5nKCRyb290U2NvcGUuZ3JvdXBzKTtcclxuICAgICRyb290U2NvcGUuY3VycmVudFJ1YnJpYyA9IG51bGw7XHJcblxyXG4gICAgbmVhcmJ5LmlzQXV0aCA9ICRjLmF1dGhDbGllbnQuY2hlY2tJZkF1dGhvcml6ZWQoKTtcclxuXHJcbiAgICBpZihuZWFyYnkuaXNBdXRoKXtcclxuICAgICAgICAvL21lID0gJGMudXNlckNsaWVudC5nZXRVc2VyUHJvZmlsZSgpO1xyXG4gICAgICAgIC8vJCgnLmFub25OYW1lJykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xyXG4gICAgfVxyXG5cclxuICAgIG5lYXJieS5wb3N0cyA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0QnVzaW5lc3NUb3BpY3MoMCwxMDAwKTtcclxuXHJcbiAgICBpZihuZWFyYnkucG9zdHMudG9waWNzKSB7XHJcbiAgICAgICAgdmFyIGxlbiA9IG5lYXJieS5wb3N0cy50b3BpY3MubGVuZ3RoO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgbmVhcmJ5LnBvc3RzLnRvcGljc1tpXS5pc0NvbW1lbnRTaG93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIG5lYXJieS5wb3N0cy50b3BpY3NbaV0uaXNJbnB1dFNob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgbmVhcmJ5LnBvc3RzLnRvcGljc1tpXS5zaG9ydCA9IG5lYXJieS5wb3N0cy50b3BpY3NbaV0ubWVzc2FnZS5jb250ZW50LnNwbGl0KCc7JylbMF07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFuZ3VsYXIuZWxlbWVudCgkKCcubmVhcmJ5JykpLmNzcyh7J21pbi1oZWlnaHQnOiAkKHdpbmRvdykuaGVpZ2h0KCktMTEwfSk7XHJcblxyXG4gICAgJCgnLm5nLWNsb2FrJykucmVtb3ZlQ2xhc3MoJ25nLWNsb2FrJyk7XHJcblxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBbICckcm9vdFNjb3BlJywnJGMnLCBuZWFyYnlDdHJsIF07IiwiXHJcbnZhciBuZWFyYnlTaW5nbGVDdHJsID0gIGZ1bmN0aW9uKCRyb290U2NvcGUsJHN0YXRlUGFyYW1zLCRjKSB7XHJcbiAgICB2YXIgbmVhcmJ5ID0gdGhpcyxcclxuICAgICAgICBidXNpbmVzc0lkO1xyXG5cclxuICAgIGlmICgkc3RhdGVQYXJhbXMubmVhcmJ5SWQgJiYgJHN0YXRlUGFyYW1zLm5lYXJieUlkICE9IDApe1xyXG4gICAgICAgIGJ1c2luZXNzSWQgPSAkc3RhdGVQYXJhbXMubmVhcmJ5SWQ7XHJcbiAgICB9XHJcblxyXG4gICAgbmVhcmJ5LmluZm8gPSAkYy5idXNpbmVzc0NsaWVudC5nZXRCdXNpbmVzc0Rlc2NyaXB0aW9uKGJ1c2luZXNzSWQpO1xyXG4gICAgbmVhcmJ5LmluZm8uZnVsbEluZm8gPSBuZWFyYnkuaW5mby5mdWxsSW5mby5yZXBsYWNlKCdcXG4nLCc8YnI+Jyk7XHJcbiAgICBuZWFyYnkud2FsbEl0ZW0gPSAkYy5idXNpbmVzc0NsaWVudC5nZXRXYWxsSXRlbShuZWFyYnkuaW5mby5pZCk7XHJcblxyXG4gICAgJHJvb3RTY29wZS5iYXNlLmlzRm9vdGVyQm90dG9tID0gdHJ1ZTtcclxuICAgICRyb290U2NvcGUuYmFzZS5wYWdlVGl0bGUgPSBcItCg0Y/QtNC+0LxcIjtcclxuXHJcbiAgICBuZWFyYnkuaXNBdXRoID0gJGMuYXV0aENsaWVudC5jaGVja0lmQXV0aG9yaXplZCgpO1xyXG5cclxuICAgIGlmKG5lYXJieS5pc0F1dGgpe1xyXG4gICAgICAgIC8vbWUgPSBjLnVzZXJDbGllbnQuZ2V0VXNlclByb2ZpbGUoKTtcclxuICAgICAgICAvLyQoJy5hbm9uTmFtZScpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcclxuICAgIH1cclxuXHJcbiAgICBuZWFyYnkucG9zdHMgPSAkYy5tZXNzYWdlQ2xpZW50LmdldEJ1c2luZXNzVG9waWNzKDAsMTAwMCk7XHJcblxyXG4gICAgaWYobmVhcmJ5LnBvc3RzLnRvcGljcykge1xyXG4gICAgICAgIHZhciBsZW4gPSBuZWFyYnkucG9zdHMudG9waWNzLmxlbmd0aDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKG5lYXJieS5wb3N0cy50b3BpY3NbaV0uaWQscGFyc2VJbnQoYnVzaW5lc3NJZCkpO1xyXG4gICAgICAgICAgICBpZihuZWFyYnkucG9zdHMudG9waWNzW2ldLmlkID09IHBhcnNlSW50KGJ1c2luZXNzSWQpKXtcclxuICAgICAgICAgICAgICAgIG5lYXJieS5wb3N0cy50b3BpY3NbaV0uaXNDb21tZW50U2hvdyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBuZWFyYnkucG9zdHMudG9waWNzW2ldLmlzSW5wdXRTaG93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIG5lYXJieS5wb3N0cy50b3BpY3NbaV0uZnVsbCA9IG5lYXJieS5wb3N0cy50b3BpY3NbaV0ubWVzc2FnZS5jb250ZW50LnNwbGl0KCc7JylbMV07XHJcblxyXG4gICAgICAgICAgICAgICAgbmVhcmJ5LnBvc3QgPSBuZWFyYnkucG9zdHMudG9waWNzW2ldO1xyXG4gICAgICAgICAgICAgICAgbmVhcmJ5LnBvc3QuZnVsbExpbmsgPSAnLycrbmVhcmJ5LnBvc3RzLnRvcGljc1tpXS5mdWxsO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cobmVhcmJ5LnBvc3QpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5lYXJieS50b2dnbGVDb21tID0gZnVuY3Rpb24oJGV2ZW50LHBvc3Qpe1xyXG4gICAgICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICBpZiAocG9zdC5pc0NvbW1lbnRTaG93KXtcclxuICAgICAgICAgICAgcG9zdC5pc0NvbW1lbnRTaG93ID0gZmFsc2U7XHJcblxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBwb3N0LmlzQ29tbWVudFNob3cgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgaWYoIXBvc3QuY29tbWVudHMpIHtcclxuICAgICAgICAgICAgICAgIHBvc3QuY29tbWVudHMgPSAkYy5tZXNzYWdlQ2xpZW50LmdldE1lc3NhZ2VzQXNMaXN0KHBvc3QuaWQsIDgsIDAsIGZhbHNlLCAxMDAwKS5tZXNzYWdlcztcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdmaW5pc2gnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9O1xyXG5cclxuICAgIG5lYXJieS50b2dnbGVJbnB1dCA9IGZ1bmN0aW9uKCRldmVudCxwb3N0KXtcclxuICAgICAgICAkZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgcG9zdC5pc0lucHV0U2hvdyA/IHBvc3QuaXNJbnB1dFNob3cgPSBmYWxzZSA6IHBvc3QuaXNJbnB1dFNob3cgPSB0cnVlO1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZygnaW5wdXQnLHBvc3QuaXNJbnB1dFNob3cpO1xyXG5cclxuICAgIH07XHJcblxyXG4gICAgbmVhcmJ5LnNlbmRDb21tID0gZnVuY3Rpb24oJGV2ZW50LHBvc3Qpe1xyXG4gICAgICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIHZhciBtZXNzYWdlID0gbmV3IGNvbS52bWVzdGVvbmxpbmUuYmUudGhyaWZ0Lm1lc3NhZ2VzZXJ2aWNlLk1lc3NhZ2UoKTtcclxuXHJcbiAgICAgICAgbWVzc2FnZS5pZCA9IDA7XHJcbiAgICAgICAgbWVzc2FnZS50b3BpY0lkID0gbmVhcmJ5LmluZm8uaWQ7IC8vcG9zdC5pZDtcclxuICAgICAgICBtZXNzYWdlLnR5cGUgPSBjb20udm1lc3Rlb25saW5lLmJlLnRocmlmdC5tZXNzYWdlc2VydmljZS5NZXNzYWdlVHlwZS5XQUxMOy8vODtcclxuICAgICAgICBtZXNzYWdlLmdyb3VwSWQgPSAwO1xyXG4gICAgICAgIG1lc3NhZ2UuY29udGVudCA9IHBvc3QuY29tbWVudGluZztcclxuICAgICAgICBtZXNzYWdlLnRvcGljSWQgPSBuZWFyYnkud2FsbEl0ZW0udG9waWMuaWQ7XHJcbiAgICAgICAgbWVzc2FnZS5wYXJlbnRJZCA9IDA7XHJcbiAgICAgICAgbWVzc2FnZS5jcmVhdGVkID0gRGF0ZS5wYXJzZShuZXcgRGF0ZSgpKS8xMDAwO1xyXG4gICAgICAgIHBvc3QuY29tbWVudGluZyA9IFwiXCI7XHJcblxyXG4gICAgICAgIGlmKCFuZWFyYnkuaXNBdXRoKXtcclxuICAgICAgICAgICAgbWVzc2FnZS5hbm9uTmFtZSA9IHBvc3QuYW5vbk5hbWU7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIG1lc3NhZ2UuYW5vbk5hbWUgPSBcIlwiO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdwb3N0JyxtZXNzYWdlKTtcclxuICAgICAgICAvL3ZhciByZXR1cm5Db21tZW50ID0gYy5tZXNzYWdlQ2xpZW50LnBvc3RCdXNpbmVzc1RvcGljcyhtZXNzYWdlKTtcclxuICAgICAgICB2YXIgcmV0dXJuQ29tbWVudCA9ICRjLm1lc3NhZ2VDbGllbnQucG9zdE1lc3NhZ2UobWVzc2FnZSk7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ3Bvc3QyJyxyZXR1cm5Db21tZW50KTtcclxuXHJcblxyXG4gICAgICAgIGlmKG5lYXJieS53YWxsSXRlbS5tZXNzYWdlcyAmJiBuZWFyYnkud2FsbEl0ZW0ubWVzc2FnZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIG5lYXJieS53YWxsSXRlbS5tZXNzYWdlcy5wdXNoKHJldHVybkNvbW1lbnQpO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBuZWFyYnkud2FsbEl0ZW0ubWVzc2FnZXMgPSBbXTtcclxuICAgICAgICAgICAgbmVhcmJ5LndhbGxJdGVtLm1lc3NhZ2VzWzBdID0gcmV0dXJuQ29tbWVudDtcclxuICAgICAgICB9XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICBuZWFyYnkuZ2V0VGltaW5nID0gZnVuY3Rpb24obWVzc2FnZU9iakRhdGUpe1xyXG4gICAgICAgIHZhciBtaW51dGUgPSA2MCoxMDAwLFxyXG4gICAgICAgICAgICBob3VyID0gbWludXRlKjYwLFxyXG4gICAgICAgICAgICBkYXkgPSBob3VyKjI0LFxyXG4gICAgICAgICAgICB0aHJlZURheXMgPSBkYXkqIDMsXHJcbiAgICAgICAgICAgIG5vdyA9IERhdGUucGFyc2UobmV3IERhdGUoKSksXHJcbiAgICAgICAgICAgIHRpbWluZyA9IChub3cgLSBtZXNzYWdlT2JqRGF0ZSoxMDAwKSxcclxuICAgICAgICAgICAgdGltZVRlbXA7XHJcblxyXG4gICAgICAgIGlmKHRpbWluZyA8IG1pbnV0ZSl7XHJcbiAgICAgICAgICAgIHRpbWluZyA9IFwi0YLQvtC70YzQutC+INGH0YLQvlwiO1xyXG4gICAgICAgIH1lbHNlIGlmKHRpbWluZyA8IGhvdXIpe1xyXG4gICAgICAgICAgICB0aW1pbmcgPSBuZXcgRGF0ZSh0aW1pbmcpO1xyXG4gICAgICAgICAgICB0aW1pbmcgPSB0aW1pbmcuZ2V0TWludXRlcygpK1wiINC80LjQvSDQvdCw0LfQsNC0XCI7XHJcbiAgICAgICAgfWVsc2UgaWYodGltaW5nIDwgZGF5KXtcclxuICAgICAgICAgICAgdGltaW5nID0gbmV3IERhdGUodGltaW5nKTtcclxuICAgICAgICAgICAgdGltZVRlbXAgPSB0aW1pbmcuZ2V0SG91cnMoKTtcclxuICAgICAgICAgICAgaWYodGltZVRlbXAgPT0gMSB8fCB0aW1lVGVtcCA9PSAwKXtcclxuICAgICAgICAgICAgICAgIHRpbWluZyA9IFwiMSDRh9Cw0YEg0L3QsNC30LDQtFwiO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZih0aW1lVGVtcCA+IDEgJiYgdGltZVRlbXAgPCA1KXtcclxuICAgICAgICAgICAgICAgIHRpbWluZyA9IHRpbWVUZW1wICsgXCIg0YfQsNGB0LAg0L3QsNC30LDQtFwiO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHRpbWluZyA9IHRpbWVUZW1wICsgXCIg0YfQsNGB0L7QsiDQvdCw0LfQsNC0XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9ZWxzZSBpZih0aW1pbmcgPCB0aHJlZURheXMpe1xyXG4gICAgICAgICAgICB0aW1pbmcgPSBuZXcgRGF0ZSh0aW1pbmcpO1xyXG4gICAgICAgICAgICB0aW1lVGVtcCA9IHRpbWluZy5nZXREYXRlKCk7XHJcbiAgICAgICAgICAgIGlmKHRpbWVUZW1wID09IDEpe1xyXG4gICAgICAgICAgICAgICAgdGltaW5nID0gdGltZVRlbXArXCIg0LTQtdC90Ywg0L3QsNC30LDQtFwiO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHRpbWluZyA9IHRpbWVUZW1wK1wiINC00L3QtdC5INC90LDQt9Cw0LRcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICB0aW1lVGVtcCA9IG5ldyBEYXRlKG1lc3NhZ2VPYmpEYXRlKjEwMDApLnRvTG9jYWxlRGF0ZVN0cmluZygpO1xyXG4gICAgICAgICAgICB2YXIgYXJyID0gdGltZVRlbXAuc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgaWYoYXJyWzBdLmxlbmd0aCA9PSAxKSBhcnJbMF0gPSBcIjBcIithcnJbMF07XHJcbiAgICAgICAgICAgIGlmKGFyclsxXS5sZW5ndGggPT0gMSkgYXJyWzFdID0gXCIwXCIrYXJyWzFdO1xyXG4gICAgICAgICAgICB0aW1pbmcgPSBhcnJbMF0rXCIuXCIrYXJyWzFdK1wiLlwiK2FyclsyXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aW1pbmc7XHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICAkKCcubmctY2xvYWsnKS5yZW1vdmVDbGFzcygnbmctY2xvYWsnKTtcclxuXHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFsgJyRyb290U2NvcGUnLCckc3RhdGVQYXJhbXMnLCckYycsIG5lYXJieVNpbmdsZUN0cmwgXTsiLCJcclxudmFyIG5laWdoYm91cnNDdHJsID0gZnVuY3Rpb24oJHJvb3RTY29wZSwkc3RhdGUsJGMpIHtcclxuICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRQYWdlID0gXCJuZWlnaGJvdXJzXCI7XHJcbiAgICAgICAgJHJvb3RTY29wZS5pc1RvcFNlYXJjaFNob3cgPSBmYWxzZTtcclxuICAgICAgICAkcm9vdFNjb3BlLmxlZnRiYXIudGFiID0gMDtcclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2Uuc2hvd0FsbEdyb3VwcygpO1xyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5pc0Zvb3RlckJvdHRvbSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAkYy5yZXNldFBhZ2VzKCRyb290U2NvcGUuYmFzZSk7XHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLm1haW5Db250ZW50VG9wSXNIaWRlID0gZmFsc2U7XHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLm5laWdoYm91cnNJc0FjdGl2ZSA9IHRydWU7XHJcblxyXG4gICAgICAgICRjLnJlc2V0QWNlTmF2QnRucygkcm9vdFNjb3BlLm5hdmJhcik7XHJcbiAgICAgICAgJHJvb3RTY29wZS5uYXZiYXIubmVpZ2hib3Vyc0J0blN0YXR1cyA9IFwiYWN0aXZlXCI7XHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLnBhZ2VUaXRsZSA9IFwiXCI7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuY3VycmVudEdyb3VwID0gJGMudXNlckNsaWVudEdyb3Vwc1szXTtcclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLm5laWdoYm91cnNMb2FkU3RhdHVzID0gXCJpc0xvYWRlZFwiO1xyXG5cclxuICAgICAgICB2YXIgbmVpZ2hib3VycyA9IHRoaXM7XHJcbiAgICAgICAgbmVpZ2hib3Vycy5uZWlnaGJvb3JzID0gJGMudXNlckNsaWVudC5nZXROZWlnaGJvdXJzQnlHcm91cCgkcm9vdFNjb3BlLmN1cnJlbnRHcm91cC5pZCk7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUubmVpZ2hib3Vyc0NoYW5nZUdyb3VwID0gZnVuY3Rpb24oZ3JvdXBJZCl7XHJcbiAgICAgICAgICAgIG5laWdoYm91cnMubmVpZ2hib29ycyA9ICRjLnVzZXJDbGllbnQuZ2V0TmVpZ2hib3Vyc0J5R3JvdXAoZ3JvdXBJZCk7XHJcbiAgICAgICAgICAgIGluaXRBdXRvRmlsbCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIG5laWdoYm91cnMubmVpZ2hib29yc1NpemUgPSBuZWlnaGJvdXJzLm5laWdoYm9vcnMubGVuZ3RoO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpbml0QXV0b0ZpbGwoKXtcclxuICAgICAgICAgICAgdmFyIGRhdGEgPSBbXSxcclxuICAgICAgICAgICAgICAgIG5laWdoYm91cnNMZW5ndGggPSBuZWlnaGJvdXJzLm5laWdoYm9vcnMubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgbmVpZ2hib3Vyc0xlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgICAgIGRhdGFbaV0gPSB7fTtcclxuICAgICAgICAgICAgICAgIGRhdGFbaV0ubGFiZWwgPSBuZWlnaGJvdXJzLm5laWdoYm9vcnNbaV0uZmlyc3ROYW1lK1wiIFwiK25laWdoYm91cnMubmVpZ2hib29yc1tpXS5sYXN0TmFtZTtcclxuICAgICAgICAgICAgICAgIGRhdGFbaV0udmFsdWUgPSBuZWlnaGJvdXJzLm5laWdoYm9vcnNbaV0uaWQ7XHJcbiAgICAgICAgICAgICAgICBkYXRhW2ldLmNhdGVnb3J5ID0gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkKFwiI3NlYXJjaC1uZWlnaGJvdXJzXCIgKS5jYXRjb21wbGV0ZSh7XHJcbiAgICAgICAgICAgICAgICBkZWxheTogMCxcclxuICAgICAgICAgICAgICAgIHNvdXJjZTogZGF0YSxcclxuICAgICAgICAgICAgICAgIHNlbGVjdDogZnVuY3Rpb24oZXZlbnQsdWkpe1xyXG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygncHJvZmlsZScseyAndXNlcklkJyA6IHVpLml0ZW0udmFsdWV9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpbml0QXV0b0ZpbGwoKTtcclxuXHJcbiAgICAgICAgJCgnLm5nLWNsb2FrJykucmVtb3ZlQ2xhc3MoJ25nLWNsb2FrJyk7XHJcblxyXG4gICAgfTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gWyAnJHJvb3RTY29wZScsJyRzdGF0ZScsJyRjJywgbmVpZ2hib3Vyc0N0cmwgXTsiLCJcclxudmFyIHByb2ZpbGVDdHJsID0gZnVuY3Rpb24oJHJvb3RTY29wZSwgJHN0YXRlUGFyYW1zLCRjKSB7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuaXNUb3BTZWFyY2hTaG93ID0gZmFsc2U7XHJcbiAgICAgICAgJHJvb3RTY29wZS5sZWZ0YmFyLnRhYiA9IDA7XHJcblxyXG4gICAgICAgICRjLnJlc2V0UGFnZXMoJHJvb3RTY29wZS5iYXNlKTtcclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UucHJvZmlsZUlzQWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UuaXNGb290ZXJCb3R0b20gPSB0cnVlO1xyXG5cclxuICAgICAgICAkYy5yZXNldEFjZU5hdkJ0bnMoJHJvb3RTY29wZS5uYXZiYXIpO1xyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5tYWluQ29udGVudFRvcElzSGlkZSA9IHRydWU7XHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLnByb2ZpbGVMb2FkU3RhdHVzID0gXCJpc0xvYWRlZFwiO1xyXG5cclxuICAgICAgICB2YXIgcHJvZmlsZSA9IHRoaXMsIHVzZXJJZDtcclxuICAgICAgICBwcm9maWxlLmlzTWF5RWRpdCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAkKFwiI2RpYWxvZy1tZXNzYWdlXCIpLmFkZENsYXNzKCdoaWRlJyk7XHJcblxyXG4gICAgICAgIGlmICgkc3RhdGVQYXJhbXMudXNlcklkICYmICRzdGF0ZVBhcmFtcy51c2VySWQgIT0gMCAmJiAkc3RhdGVQYXJhbXMudXNlcklkICE9ICRjLnNob3J0VXNlckluZm8uaWQpe1xyXG4gICAgICAgICAgICB1c2VySWQgPSAkc3RhdGVQYXJhbXMudXNlcklkO1xyXG4gICAgICAgICAgICAvL3Byb2ZpbGUudXNlckNvbnRhY3RzID0gJGMudXNlckNsaWVudC5nZXRVc2VyQ29udGFjdHNFeHQodXNlcklkKTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgdXNlcklkID0gMDtcclxuICAgICAgICAgICAgcHJvZmlsZS5pc01heUVkaXQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9ICRjLnVzZXJDbGllbnQuZ2V0R3JvdXBWaWV3KCRyb290U2NvcGUuZ3JvdXBzWzBdLmlkKTtcclxuXHJcbiAgICAgICAgICAgICAgICBwcm9maWxlLm1hcCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgcHJvZmlsZS5tYXAuem9vbSA9IDE3O1xyXG4gICAgICAgICAgICAgICAgcHJvZmlsZS5tYXAuY2VudGVyID0gW2xvY2F0aW9uLmxvbmdpdHVkZSwgbG9jYXRpb24ubGF0aXR1ZGVdO1xyXG5cclxuICAgICAgICAgICAgICAgIHByb2ZpbGUubWFwLmJhbG9vbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDQk9C10L7QvNC10YLRgNC40Y8gPSDRgtC40L8g0L7QsdGK0LXQutGC0LAgKyDQs9C10L7Qs9GA0LDRhNC40YfQtdGB0LrQuNC1INC60L7QvtGA0LTQuNC90LDRgtGLINC+0LHRitC10LrRgtCwXHJcbiAgICAgICAgICAgICAgICAgICAgZ2VvbWV0cnk6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g0KLQuNC/INCz0LXQvtC80LXRgtGA0LjQuCAtINGC0L7Rh9C60LBcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1BvaW50JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g0JrQvtC+0YDQtNC40L3QsNGC0Ysg0YLQvtGH0LrQuC5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29vcmRpbmF0ZXM6IHByb2ZpbGUubWFwLmNlbnRlclxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g0KHQstC+0LnRgdGC0LLQsFxyXG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGludENvbnRlbnQ6IFwi0K8g0LfQtNC10YHRjFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfWNhdGNoKGVycil7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9wcm9maWxlLnVzZXJDb250YWN0cyA9ICRjLnVzZXJDbGllbnQuZ2V0VXNlckNvbnRhY3RzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcm9maWxlLnVzZXJQcm9maWxlID0gJGMudXNlckNsaWVudC5nZXRVc2VyUHJvZmlsZSh1c2VySWQpO1xyXG5cclxuICAgICAgICB2YXIgaXNFbXB0eUNvbnRhY3RzID0gZmFsc2UsXHJcbiAgICAgICAgICAgIGlzRW1wdHlGYW1pbHkgPSBmYWxzZSxcclxuICAgICAgICAgICAgaXNFbXB0eUludGVyZXN0cyA9IGZhbHNlLFxyXG4gICAgICAgICAgICBpc0VtcHR5Tm90aWZpY2F0aW9ucyA9IGZhbHNlLFxyXG4gICAgICAgICAgICBpc0VtcHR5VXNlckluZm8gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgaWYoIXByb2ZpbGUudXNlclByb2ZpbGUudXNlckluZm8gfHwgIXByb2ZpbGUudXNlclByb2ZpbGUudXNlckluZm8uYmlydGhkYXkpIGlzRW1wdHlVc2VySW5mbyA9IHRydWU7XHJcblxyXG4gICAgICAgIGlmKCFwcm9maWxlLnVzZXJQcm9maWxlLmNvbnRhY3RzIHx8ICghcHJvZmlsZS51c2VyUHJvZmlsZS5jb250YWN0cy5ob21lQWRkcmVzcyAmJiAhcHJvZmlsZS51c2VyUHJvZmlsZS5jb250YWN0cy5tb2JpbGVQaG9uZSAmJlxyXG4gICAgICAgICAgICAhcHJvZmlsZS51c2VyUHJvZmlsZS5jb250YWN0cy5lbWFpbCkpIGlzRW1wdHlDb250YWN0cyA9IHRydWU7XHJcblxyXG4gICAgICAgIGlmKCFwcm9maWxlLnVzZXJQcm9maWxlLmZhbWlseSB8fCAoIXByb2ZpbGUudXNlclByb2ZpbGUuZmFtaWx5LnJlbGF0aW9uc1xyXG4gICAgICAgICAgICAmJiAhcHJvZmlsZS51c2VyUHJvZmlsZS5mYW1pbHkuY2hpbGRzICYmICFwcm9maWxlLnVzZXJQcm9maWxlLmZhbWlseS5wZXRzKSkgaXNFbXB0eUZhbWlseSA9IHRydWU7XHJcblxyXG4gICAgICAgIGlmKCFwcm9maWxlLnVzZXJQcm9maWxlLmludGVyZXN0cyB8fCAoIXByb2ZpbGUudXNlclByb2ZpbGUuaW50ZXJlc3RzLnVzZXJJbnRlcmVzdHMgJiYgIXByb2ZpbGUudXNlclByb2ZpbGUuaW50ZXJlc3RzLmpvYikpIGlzRW1wdHlJbnRlcmVzdHMgPSB0cnVlO1xyXG5cclxuICAgICAgICBpZighcHJvZmlsZS51c2VyUHJvZmlsZS5ub3RpZmljYXRpb25zKSBpc0VtcHR5Tm90aWZpY2F0aW9ucyA9IHRydWU7XHJcblxyXG4gICAgICAgIC8vYWxlcnQoaXNFbXB0eVVzZXJJbmZvK1wiIFwiK2lzRW1wdHlDb250YWN0cytcIiBcIitpc0VtcHR5RmFtaWx5K1wiIFwiK2lzRW1wdHlJbnRlcmVzdHMrXCIgXCIraXNFbXB0eU5vdGlmaWNhdGlvbnMpO1xyXG4gICAgICAgIGlmKGlzRW1wdHlVc2VySW5mbyAmJiBpc0VtcHR5Q29udGFjdHMgJiYgaXNFbXB0eUZhbWlseSAmJiBpc0VtcHR5SW50ZXJlc3RzICYmIGlzRW1wdHlOb3RpZmljYXRpb25zKVxyXG4gICAgICAgICAgICBwcm9maWxlLmlzRW1wdHlQcm9maWxlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgaWYocHJvZmlsZS51c2VyUHJvZmlsZS51c2VySW5mbyl7XHJcbiAgICAgICAgICAgIGlmIChwcm9maWxlLnVzZXJQcm9maWxlLnVzZXJJbmZvLmdlbmRlciA9PSAxKXtcclxuICAgICAgICAgICAgICAgIHByb2ZpbGUudXNlclByb2ZpbGUudXNlckluZm8uZ2VuZGVyTWV0YSA9IFwi0JbQtdC90YHQutC40LlcIjtcclxuICAgICAgICAgICAgfWVsc2UgaWYocHJvZmlsZS51c2VyUHJvZmlsZS51c2VySW5mby5nZW5kZXIgPT0gMil7XHJcbiAgICAgICAgICAgICAgICBwcm9maWxlLnVzZXJQcm9maWxlLnVzZXJJbmZvLmdlbmRlck1ldGEgPSBcItCc0YPQttGB0LrQvtC5XCI7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgcHJvZmlsZS51c2VyUHJvZmlsZS51c2VySW5mby5nZW5kZXJNZXRhID0gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLmF2YXRhckJ1ZmZlciA9IHByb2ZpbGUudXNlclByb2ZpbGUudXNlckluZm8uYXZhdGFyO1xyXG5cclxuICAgICAgICBpZihwcm9maWxlLnVzZXJQcm9maWxlLmZhbWlseSAmJiBwcm9maWxlLnVzZXJQcm9maWxlLmZhbWlseS5yZWxhdGlvbnMgPT0gMCl7XHJcblxyXG4gICAgICAgICAgICBpZihwcm9maWxlLnVzZXJQcm9maWxlLnVzZXJJbmZvLmdlbmRlciA9PSAxKXtcclxuICAgICAgICAgICAgICAgIHByb2ZpbGUudXNlclByb2ZpbGUuZmFtaWx5LnJlbGF0aW9uc01ldGEgPSBcItCX0LDQvNGD0LbQtdC8XCI7XHJcbiAgICAgICAgICAgIH1lbHNlIGlmKHByb2ZpbGUudXNlclByb2ZpbGUudXNlckluZm8uZ2VuZGVyID09IDIpe1xyXG4gICAgICAgICAgICAgICAgcHJvZmlsZS51c2VyUHJvZmlsZS5mYW1pbHkucmVsYXRpb25zTWV0YSA9IFwi0JbQtdC90LDRglwiO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1lbHNlIGlmKHByb2ZpbGUudXNlclByb2ZpbGUuZmFtaWx5ICYmIHByb2ZpbGUudXNlclByb2ZpbGUuZmFtaWx5LnJlbGF0aW9ucyA9PSAxKXtcclxuICAgICAgICAgICAgaWYocHJvZmlsZS51c2VyUHJvZmlsZS51c2VySW5mby5nZW5kZXIgPT0gMSl7XHJcbiAgICAgICAgICAgICAgICBwcm9maWxlLnVzZXJQcm9maWxlLmZhbWlseS5yZWxhdGlvbnNNZXRhID0gXCLQndC1INC30LDQvNGD0LbQtdC8XCI7XHJcbiAgICAgICAgICAgIH1lbHNlIGlmKHByb2ZpbGUudXNlclByb2ZpbGUudXNlckluZm8uZ2VuZGVyID09IDIpe1xyXG4gICAgICAgICAgICAgICAgcHJvZmlsZS51c2VyUHJvZmlsZS5mYW1pbHkucmVsYXRpb25zTWV0YSA9IFwi0KXQvtC70L7RgdGCXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHByb2ZpbGUudXNlclByb2ZpbGUuZmFtaWx5ICYmIHByb2ZpbGUudXNlclByb2ZpbGUuZmFtaWx5LnBldHMgJiYgcHJvZmlsZS51c2VyUHJvZmlsZS5mYW1pbHkucGV0cy5sZW5ndGggIT0gMCl7XHJcbiAgICAgICAgICAgdmFyIHBldHNMZW5ndGggPSBwcm9maWxlLnVzZXJQcm9maWxlLmZhbWlseS5wZXRzLmxlbmd0aDtcclxuICAgICAgICAgICAgdmFyIHBldHMgPSBwcm9maWxlLnVzZXJQcm9maWxlLmZhbWlseS5wZXRzO1xyXG4gICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgcGV0c0xlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgICAgIHN3aXRjaChwcm9maWxlLnVzZXJQcm9maWxlLmZhbWlseS5wZXRzW2ldLnR5cGUpe1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZmlsZS51c2VyUHJvZmlsZS5mYW1pbHkucGV0c1tpXS50eXBlTWV0YSA9IFwi0JrQvtGI0LrQsFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2ZpbGUudXNlclByb2ZpbGUuZmFtaWx5LnBldHNbaV0udHlwZU1ldGEgPSBcItCh0L7QsdCw0LrQsFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2ZpbGUudXNlclByb2ZpbGUuZmFtaWx5LnBldHNbaV0udHlwZU1ldGEgPSBcItCf0YLQuNGH0LrQsFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vJHJvb3RTY29wZS5jaGFnZUluZGV4ID0gMDtcclxuXHJcbiAgICAgICAgYW5ndWxhci5lbGVtZW50KCQoJy5wcm9maWxlJykpLmNzcyh7J21pbi1oZWlnaHQnOiAkKHdpbmRvdykuaGVpZ2h0KCktMTM1fSk7XHJcblxyXG4gICAgICAgICQoJy5uZy1jbG9haycpLnJlbW92ZUNsYXNzKCduZy1jbG9haycpO1xyXG5cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gWyAnJHJvb3RTY29wZScsJyRzdGF0ZVBhcmFtcycsJyRjJywgcHJvZmlsZUN0cmwgXTsiLCJcclxudmFyIHJ1YnJpY3NDdHJsID0gZnVuY3Rpb24oJHJvb3RTY29wZSwkc3RhdGVQYXJhbXMsJGMpIHtcclxuICAgICAgICAvKlxyXG4gICAgICAgICog0L/RgNC4INGA0LDQsdC+0YLQtSDRgSDQvtCx0YHQttC00LXQvdC40Y/QvNC4INC90YPQttC90L4g0YPRh9C10YHRgtGMINGB0LvQtdC00YPRjtGJ0LXQtTpcclxuICAgICAgICAqINC10YHRgtGMINGC0YDQuCDRgtC40L/QsCDRgdC+0L7QsdGJ0LXQvdC40Y8gOlxyXG4gICAgICAgICogMSkg0YLQvtC/0LjQui4g0J3QsCDRgdGC0YDQsNC90LjRhtC1INC+0LHRgdGD0LbQtNC10L3QuNGPINC80L7QttC10YIg0LHRi9GC0Ywg0YLQvtC70YzQutC+INC+0LTQuNC9LiDQldCz0L4g0LTQtdGC0LhcclxuICAgICAgICAqINGN0YLQviDRgdC+0L7QsdGJ0LXQvdC40Y8g0L/QtdGA0LLQvtCz0L4g0YPRgNC+0LLQvdGPLiDQldCz0L4g0LTQtdGC0Lgg0LLRgdC10LPQtNCwINC+0YLQutGA0YvRgtGLLCDQv9C+0Y3RgtC+0LzRgyDRgyDQvdC10LPQvlxyXG4gICAgICAgICog0L3QtdGCINC60L7QvdGC0YDQvtC70LAg0L/Qu9GO0YEt0LzQuNC90YPRgS4g0KHRgtGA0LDQvdC40YbQsCDRgtC+0L/QuNC60LAg0LfQsNCz0YDRg9C20LDQtdGC0YHRjyDQsiDQvNC10YLQvtC00LUgc2hvd0Z1bGxUYWxrXHJcbiAgICAgICAgKiDRh9C10YDQtdC3IHRvcGljSWQg0LrQvtGC0L7RgNGL0Lkg0L/QtdGA0LXQtNCw0LXRgtGB0Y8g0LIg0YTRg9C90LrRhtC40Y4g0L/RgNC4INCy0YvQt9C+0LLQtVxyXG4gICAgICAgICog0KXRgNCw0L3QuNGC0YHRjyDQsiDQvtCx0YrQtdC60YLQtSB0YWxrLmZ1bGxUYWxrVG9waWMuXHJcbiAgICAgICAgKlxyXG4gICAgICAgICogMikg0KHQvtC+0LHRidC10L3QuNC1INC/0LXRgNCy0L7Qs9C+INGD0YDQvtCy0L3Rjy4g0JHQtdGA0YPRgtGB0Y8g0YfQtdGA0LXQtyBnZXRGaXJzdExldmVsTWVzc2FnZXMuINCY0LfQvdCw0YfQsNC70YzQvdC+XHJcbiAgICAgICAgKiDQstGB0LUg0L/QvtGC0L7QvNC60Lgg0YHQutGA0YvRgtGLINC4INC90LUg0L/QvtC00LPRgNGD0LbQtdC90YsuINCf0YDQuCDQv9C10YDQstC+0Lwg0L3QsNC20LDRgtC40Lgg0L3QsCDQutC+0L3RgtGA0L7QuyDQv9C70Y7RgS3QvNC40L3Rg9GBXHJcbiAgICAgICAgKiDQv9C+0LTQs9GA0YPQttCw0Y7RgtGB0Y8sINC/0L7RgtC+0Lwg0L/RgNC+0YHRgtC+INC/0LXRgNC10LrQu9GO0YfQsNC10YLRgdGPIHNob3ctaGlkZS4gUGFyZW50SWQg0YMg0YLQsNC60LjRhSDRgdC+0L7QsdGJ0LXQvdC40LlcclxuICAgICAgICAqINGA0LDQstC10L0gMC4g0JLQvdC40LzQsNC90LjQtSEgOiBQYXJlbnRJZCDQv9C10YDQtdC00LDQtdGC0YHRjyDQsiBnZXRGaXJzdExldmVsTWVzc2FnZXMg0YfQtdGA0LXQtyBsYXN0TG9hZGVkSWQuICAgICAgICAqXHJcbiAgICAgICAgKiDQoyDQutCw0LbQtNC+0LPQviDRgdC+0L7QsdGJ0LXQvdC40Y8g0L/QtdGA0LLQvtCz0L4g0YPRgNC+0LLQvdGPINC10YHRgtGMINGB0LLQvtC5INC80LDRgdGB0LjQsiDRgdC+0L7QsdGJ0LXQvdC40LkgM9Cz0L4g0YLQuNC/0LAuXHJcbiAgICAgICAgKiDQpdGA0LDQvdGP0YLRgdGPINCyINC80LDRgdGB0LjQstC1IHRhbGsuZnVsbFRhbGtGaXJzdE1lc3NhZ2VzLlxyXG4gICAgICAgICpcclxuICAgICAgICAqIDMpINCf0YDQvtGB0YLQviDRgdC+0L7QsdGJ0LXQvdC40LUuINCR0LXRgNC10YPRgtGB0Y8g0YfQtdGA0LXQtyBnZXRNZXNzYWdlcygpLiDQp9C10YDQtdC3INC/0LDRgNCw0LzQtdGC0YAgbGFzdExvYWRlZElkINC/0LXRgNC10LTQsNC10YLRgdGPXHJcbiAgICAgICAgKiBpZCDQv9C+0YHQu9C10LTQvdC10LPQviDQt9Cw0LPRgNGD0LbQtdC90L3QvtCz0L4g0L/RgNC+0YHRgtC+0LPQviDRgdC+0L7QsdGJ0LXQvdC40Y8sINC00LvRjyDQv9C+0LTQs9GA0YPQt9C60LguINCjINC60LDQttC00L7Qs9C+INC/0YDQvtGB0YLQvtCz0L4g0YHQvtC+0LHRidC10L3QuNGPXHJcbiAgICAgICAgKiDQtdGB0YLRjCBvZmZzZXQsINC60L7RgtC+0YDRi9C5INC30LDQtNCw0LXRgtGB0Y8g0L3QsCDQkdCVLiBvZmZzZXQn0Ysg0L7Qv9GA0LXQtNC10LvRj9GO0YIg0LLQu9C+0LbQtdC90L3QvtGB0YLRjCDRgdC+0L7QsdGJ0LXQvdC40Lkg0Lgg0LfQsCDRgdGH0LXRgiDQvdC40YVcclxuICAgICAgICAqINGB0L7Qt9C00LDQtdGC0YHRjyDQtNGA0LXQstC+0LLQuNC00L3QsNGPINGB0YLRgNGD0LrRgtGD0YDQsCDRhNC+0YDRg9C80LAuXHJcbiAgICAgICAgKiDQpdGA0LDQvdGP0YLRgdGPINCyINC00LLRg9C80LXRgNC90L7QvCDQvNCw0YHRgdC40LLQtSB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXVtdXHJcbiAgICAgICAgKlxyXG4gICAgICAgICpcclxuICAgICAgICAqINCV0YHRgtGMINGB0LvQtdC00YPRjtGJ0LjQtSDRgtC40L/RiyDQutC+0L3RgtGA0L7Qu9C+0LIsINGA0LXQsNC70LjQt9C+0LLQsNC90L3Ri9C1INC00LvRjyDRgNCw0LfQvdGL0YUg0YLQuNC/0L7QsiDRgdC+0L7QsdGJ0LXQvdC40Lk6XHJcbiAgICAgICAgKiAxKSBzaG93QW5zd2VySW5wdXQgOiDRgNC10LDQu9C40LfRg9C10YIg0LrQu9C40Log0L3QsCBcItCe0YLQstC10YLQuNGC0YxcIiwg0L/QvtC60LDQt9Cy0LDQtdGCINC/0L7Qu9C1INC00LvRjyDQvtGC0L/RgNCw0LLQutC4XHJcbiAgICAgICAgKiDRgdC+0L7QsdGJ0LXQvdC40Y8uXHJcbiAgICAgICAgKiAyKSBhZGRNZXNzYWdlOiDQutC70LjQuiDQvdCwIFwi0J7RgtC/0YDQsNCy0LjRgtGMXCIsINGB0L7Qt9C00LDQtdGCINC4INC+0YLQvtCx0YDQsNC20LDQtdGCINC90L7QstC+0LUg0YHQvtC+0LHRidC10L3QuNC1XHJcbiAgICAgICAgKiAzKSB0b2dnbGVUcmVlOiDQutC+0L3RgtGA0L7QuyBcItC/0LvRjtGBLdC80LjQvdGD0YFcIiwg0YHQutGA0LLQsNC10YIt0L/QvtC60LDQt9Cy0LDQtdGCINCy0L3Rg9GC0YDQtdC90L3QuNC1INGB0L7QvtCx0YnQtdC90LjRjyDRjdGC0L7Qs9C+XHJcbiAgICAgICAgKiDRgdC+0L7QsdGJ0LXQvdC40Y8uXHJcbiAgICAgICAgKiAqL1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLnNldFRhYigyKTtcclxuICAgICAgICAgICAgdmFyIHRhbGsgPSB0aGlzO1xyXG5cclxuICAgICAgICAgICAgdGFsay5hdHRhY2hJZCA9IFwiMDBcIjtcclxuICAgICAgICAgICAgJGMuaW5pdEZhbmN5Qm94KCQoJy50YWxrcycpKTtcclxuXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5zaG93QWxsR3JvdXBzKCk7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5pc0Zvb3RlckJvdHRvbSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmNyZWF0ZVRvcGljSXNIaWRlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIHRhbGsuaXNUYWxrc0xvYWRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0YWxrLmdyb3VwcyA9ICRjLnVzZXJDbGllbnRHcm91cHM7XHJcblxyXG4gICAgICAgICAgICB0YWxrLm1lc3NhZ2UgPSB7fTtcclxuICAgICAgICAgICAgdGFsay5tZXNzYWdlLmNvbnRlbnQgPSB0YWxrLm1lc3NhZ2UuZGVmYXVsdCA9ICRjLlRFWFRfREVGQVVMVF8zO1xyXG4gICAgICAgICAgICB0YWxrLnN1YmplY3QgPSAkYy5URVhUX0RFRkFVTFRfNDtcclxuXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5idWZmZXJTZWxlY3RlZEdyb3VwID0gdGFsay5zZWxlY3RlZEdyb3VwID1cclxuICAgICAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50R3JvdXAgPSAkYy51c2VyQ2xpZW50R3JvdXBzWzNdO1xyXG5cclxuICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmluaXRTdGFydFBhcmFtc0ZvckNyZWF0ZVRvcGljKHRhbGspO1xyXG5cclxuICAgICAgICAgICAgdGFsay5pc1RhbGsgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgdGFsay5mdWxsVGFsa1RvcGljID0ge307XHJcbiAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtUb3BpYy5hbnN3ZXJJbnB1dElzU2hvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0YWxrLmZ1bGxUYWxrTWVzc2FnZXMgPSBbXTtcclxuICAgICAgICAgICAgdGFsay5mdWxsVGFsa0ZpcnN0TWVzc2FnZXMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIHRhbGsuY29tbWVudFRleHQgPSAkYy5URVhUX0RFRkFVTFRfMjtcclxuICAgICAgICAgICAgdmFyIGZ1bGxUYWxrRmlyc3RNZXNzYWdlc0xlbmd0aCxcclxuICAgICAgICAgICAgICAgIHRhbGtJZDtcclxuXHJcbiAgICAgICAgICAgIC8qaWYoISRyb290U2NvcGUuaW1wb3J0YW50SXNMb2FkZWRGcm9tVG9wKVxyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmltcG9ydGFudFRvcGljcyA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0SW1wb3J0YW50TmV3cygkcm9vdFNjb3BlLmN1cnJlbnRHcm91cC5pZCk7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuaW1wb3J0YW50SXNMb2FkZWRGcm9tVG9wID0gZmFsc2U7Ki9cclxuXHJcbiAgICAgICAgICAgIHRhbGsudG9waWNzID0gJGMubWVzc2FnZUNsaWVudC5nZXRUb3BpY3ModGFsay5zZWxlY3RlZEdyb3VwLmlkLCAkc3RhdGVQYXJhbXMucnVicmljSWQsIDAsIDAsIDEwMDApLnRvcGljcztcclxuXHJcbiAgICAgICAgICAgIGluaXRUYWxrcygpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCF0YWxrLnRvcGljcykgdGFsay50b3BpY3MgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuc2VsZWN0R3JvdXBJbkRyb3Bkb3duX3RhbGtzID0gZnVuY3Rpb24oZ3JvdXBJZCl7XHJcbiAgICAgICAgICAgICAgICB0YWxrLnNlbGVjdGVkR3JvdXAgPSAkcm9vdFNjb3BlLmJhc2UuYnVmZmVyU2VsZWN0ZWRHcm91cCA9ICRjLnNlbGVjdEdyb3VwSW5Ecm9wZG93bihncm91cElkKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaW5pdFRhbGtzKCl7XHJcbiAgICAgICAgICAgIHZhciB0b3BpY0xlbmd0aDtcclxuICAgICAgICAgICAgdGFsay50b3BpY3MgPyB0b3BpY0xlbmd0aCA9IHRhbGsudG9waWNzLmxlbmd0aCA6IHRvcGljTGVuZ3RoID0gMDtcclxuXHJcbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB0b3BpY0xlbmd0aDtpKyspe1xyXG4gICAgICAgICAgICAgICAgdGFsay50b3BpY3NbaV0ubGFzdFVwZGF0ZUVkaXQgPSAkYy5nZXRUaW1pbmcodGFsay50b3BpY3NbaV0ubGFzdFVwZGF0ZSk7XHJcbiAgICAgICAgICAgICAgICB0YWxrLnRvcGljc1tpXS5sYWJlbCA9ICRjLmdldExhYmVsKHRhbGsuZ3JvdXBzLHRhbGsudG9waWNzW2ldLmdyb3VwVHlwZSk7XHJcbiAgICAgICAgICAgICAgICB0YWxrLnRvcGljc1tpXS50YWdDb2xvciA9ICRjLmdldFRhZ0NvbG9yKHRhbGsudG9waWNzW2ldLmxhYmVsKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZih0YWxrLnRvcGljc1tpXS5tZXNzYWdlLmltcG9ydGFudCA9PSAxKXtcclxuICAgICAgICAgICAgICAgICAgICB0YWxrLnRvcGljc1tpXS5tZXNzYWdlLmltcG9ydGFudFRleHQgPSAn0KHQvdGP0YLRjCDQvNC10YLQutGDIFwi0JLQsNC20L3QvtC1XCInO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFsay50b3BpY3NbaV0ubWVzc2FnZS5pbXBvcnRhbnRUZXh0ID0gJ9Cf0L7QvNC10YLQuNGC0Ywg0LrQsNC6IFwi0JLQsNC20L3QvtC1XCInO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLnRhbGtzQ2hhbmdlR3JvdXAgPSBmdW5jdGlvbihncm91cElkKXtcclxuXHJcbiAgICAgICAgICAgIHRhbGsudG9waWNzID0gJGMubWVzc2FnZUNsaWVudC5nZXRUb3BpY3MoZ3JvdXBJZCwwLDAsMCwxMDAwKS50b3BpY3M7XHJcblxyXG4gICAgICAgICAgICBpZih0YWxrLnRvcGljcykge1xyXG4gICAgICAgICAgICAgICAgaW5pdFRhbGtzKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJCgnLm5nLWNsb2FrJykucmVtb3ZlQ2xhc3MoJ25nLWNsb2FrJyk7XHJcblxyXG4gICAgfTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gWyAnJHJvb3RTY29wZScsJyRzdGF0ZVBhcmFtcycsJyRjJywgcnVicmljc0N0cmwgXTsiLCJcclxudmFyIHJ1YnJpY3NTaW5nbGVDdHJsID0gZnVuY3Rpb24oJHJvb3RTY29wZSwkc3RhdGVQYXJhbXMsJGMpe1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UuaXNGb290ZXJCb3R0b20gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgdmFyIHRhbGsgPSB0aGlzLFxyXG4gICAgICAgICAgICBmdWxsVGFsa01lc3NhZ2VzTGVuZ3RoLFxyXG4gICAgICAgICAgICB0YWxrSWQgPSAkc3RhdGVQYXJhbXMudGFsa0lkO1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UubGFzdExvYWRlZElkID0gMDtcclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UuaXNFYXJsaWVzdE1lc3NhZ2VzID0gZmFsc2U7XHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLmVuZE9mTG9hZGVkID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHRhbGsuYXR0YWNoSWQgPSBcIjAwXCI7XHJcbiAgICAgICAgdGFsay5zZWxlY3RlZEdyb3VwID0gJHJvb3RTY29wZS5jdXJyZW50R3JvdXA7XHJcblxyXG4gICAgICAgIC8qaWYoISRyb290U2NvcGUuaW1wb3J0YW50SXNMb2FkZWRGcm9tVG9wKVxyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmltcG9ydGFudFRvcGljcyA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0SW1wb3J0YW50TmV3cygkcm9vdFNjb3BlLmN1cnJlbnRHcm91cC5pZCk7XHJcbiAgICAgICAgJHJvb3RTY29wZS5pbXBvcnRhbnRJc0xvYWRlZEZyb21Ub3AgPSBmYWxzZTsqL1xyXG5cclxuICAgICAgICB0YWxrLnRvcGljcyA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0VG9waWNzKHRhbGsuc2VsZWN0ZWRHcm91cC5pZCwgMCwgMCwgMCwgMTAwMCkudG9waWNzO1xyXG4gICAgICAgIHRhbGsuZnVsbFRhbGtUb3BpYyA9IHt9O1xyXG4gICAgICAgIHRhbGsuZnVsbFRhbGtNZXNzYWdlcyA9IHt9O1xyXG4gICAgICAgIHRhbGsuZnVsbFRhbGtGaXJzdE1lc3NhZ2VzID0gW107XHJcbiAgICAgICAgdGFsay5ncm91cHMgPSAkYy51c2VyQ2xpZW50R3JvdXBzO1xyXG5cclxuICAgICAgICB0YWxrLmlzVGFsayA9IHRydWU7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5pbml0U3RhcnRQYXJhbXNGb3JDcmVhdGVNZXNzYWdlKHRhbGspO1xyXG5cclxuICAgICAgICB2YXIgc2hvd0Z1bGxUYWxrID0gZnVuY3Rpb24odGFsayx0YWxrT3V0c2lkZUlkKXtcclxuXHJcbiAgICAgICAgICAgICRjLmluaXRGYW5jeUJveCgkKCcudGFsa3Mtc2luZ2xlJykpO1xyXG4gICAgICAgICAgICB2YXIgdG9waWNMZW5ndGg7XHJcbiAgICAgICAgICAgIHRhbGsudG9waWNzID8gdG9waWNMZW5ndGggPSB0YWxrLnRvcGljcy5sZW5ndGggOiB0b3BpY0xlbmd0aCA9IDA7XHJcblxyXG4gICAgICAgICAgICB2YXIgdGFsa0lkID0gdGFsa091dHNpZGVJZDtcclxuICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHRvcGljTGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICAgICAgaWYodGFsa0lkID09IHRhbGsudG9waWNzW2ldLmlkKXtcclxuICAgICAgICAgICAgICAgICAgICB0YWxrLmZ1bGxUYWxrVG9waWMgPSB0YWxrLnRvcGljc1tpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmluaXRTdGFydFBhcmFtc0ZvckNyZWF0ZVRvcGljKHRhbGsuZnVsbFRhbGtUb3BpYyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtUb3BpYy5pc1RhbGsgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtUb3BpYy5tZXNzYWdlLmNyZWF0ZWRFZGl0ID0gJGMuZ2V0VGltaW5nKHRhbGsuZnVsbFRhbGtUb3BpYy5tZXNzYWdlLmNyZWF0ZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtUb3BpYy5sYWJlbCA9ICRjLmdldExhYmVsKHRhbGsuZ3JvdXBzLHRhbGsuZnVsbFRhbGtUb3BpYy5ncm91cFR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtUb3BpYy50YWdDb2xvciA9ICRjLmdldFRhZ0NvbG9yKHRhbGsuZnVsbFRhbGtUb3BpYy5sYWJlbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKHRhbGsuZnVsbFRhbGtUb3BpYy5tZXNzYWdlLmltcG9ydGFudCA9PSAxKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa1RvcGljLm1lc3NhZ2UuaW1wb3J0YW50VGV4dCA9ICfQodC90Y/RgtGMINC80LXRgtC60YMgXCLQktCw0LbQvdC+0LVcIic7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtUb3BpYy5tZXNzYWdlLmltcG9ydGFudFRleHQgPSAn0J/QvtC80LXRgtC40YLRjCDQutCw0LogXCLQktCw0LbQvdC+0LVcIic7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGFsay5mdWxsVGFsa1RvcGljLnBvbGwgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgJGMuc2V0UG9sbEVkaXROYW1lcyh0YWxrLmZ1bGxUYWxrVG9waWMucG9sbCk7XHJcbiAgICAgICAgICAgICAgICB0YWxrLmZ1bGxUYWxrVG9waWMubWV0YVR5cGUgPSBcInBvbGxcIjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtUb3BpYy5tZXRhVHlwZSA9IFwibWVzc2FnZVwiO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0YWxrLmZ1bGxUYWxrRmlyc3RNZXNzYWdlcyA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0Rmlyc3RMZXZlbE1lc3NhZ2VzKHRhbGtJZCwgdGFsay5zZWxlY3RlZEdyb3VwLmlkLCAxLCAkcm9vdFNjb3BlLmJhc2UubGFzdExvYWRlZElkLCAwLCAxMCkubWVzc2FnZXM7XHJcblxyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UubGFzdExvYWRlZElkID0gJHJvb3RTY29wZS5iYXNlLmluaXRGaXJzdE1lc3NhZ2VzKHRhbGsuZnVsbFRhbGtGaXJzdE1lc3NhZ2VzKTtcclxuXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5pc1RhbGtUaXRsZXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLm1haW5Db250ZW50VG9wSXNIaWRlID0gdHJ1ZTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmNyZWF0ZVRvcGljSXNIaWRlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgc2hvd0Z1bGxUYWxrKHRhbGssdGFsa0lkKTtcclxuXHJcbiAgICAgICAgdmFyIGluaXRGbGFnc1RvcGljID0gW107XHJcbiAgICAgICAgdGFsay5zaG93VG9waWNBbnN3ZXJJbnB1dCA9IGZ1bmN0aW9uKGV2ZW50LGZ1bGxUYWxrVG9waWMpe1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgdGFsay5hbnN3ZXJTaG93ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIGlmKCFpbml0RmxhZ3NUb3BpY1tmdWxsVGFsa1RvcGljLmlkXSkge1xyXG4gICAgICAgICAgICAgICAgaW5pdEZsYWdzVG9waWNbZnVsbFRhbGtUb3BpYy5pZF0gPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0YWxrLmZ1bGxUYWxrVG9waWMuYW5zd2VySW5wdXRJc1Nob3cgP1xyXG4gICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa1RvcGljLmFuc3dlcklucHV0SXNTaG93ID0gZmFsc2UgOlxyXG4gICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa1RvcGljLmFuc3dlcklucHV0SXNTaG93ID0gdHJ1ZSA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGluaXRGbGFnc01lc3NhZ2UgPSBbXTtcclxuICAgICAgICB0YWxrLnNob3dNZXNzYWdlQW5zd2VySW5wdXQgPSBmdW5jdGlvbihldmVudCxmdWxsVGFsa1RvcGljLGZpcnN0TWVzc2FnZSxtZXNzYWdlKXtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgdmFyIGF0dGFjaElkO1xyXG5cclxuICAgICAgICAgICAgaWYoIW1lc3NhZ2Upe1xyXG4gICAgICAgICAgICAgICAgLy8g0LXRgdC70Lgg0Y3RgtC+INGB0L7QvtCx0YnQtdC90LjQtSDQv9C10YDQstC+0LPQviDRg9GA0L7QstC90Y9cclxuICAgICAgICAgICAgICAgIGZpcnN0TWVzc2FnZS5pc1RhbGsgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy9maXJzdE1lc3NhZ2UuaXNFZGl0ID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgYXR0YWNoSWQgPSBmdWxsVGFsa1RvcGljLmlkKyctJytmaXJzdE1lc3NhZ2UuaWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYoIXRhbGsuZnVsbFRhbGtGaXJzdE1lc3NhZ2VzKSB0YWxrLmZ1bGxUYWxrRmlyc3RNZXNzYWdlcyA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0Rmlyc3RMZXZlbE1lc3NhZ2VzKHRhbGtJZCx0YWxrLnNlbGVjdGVkR3JvdXAuaWQsMSwwLDAsMTAwMCkubWVzc2FnZXM7XHJcbiAgICAgICAgICAgICAgICB2YXIgZnVsbFRhbGtGaXJzdE1lc3NhZ2VzTGVuZ3RoID0gdGFsay5mdWxsVGFsa0ZpcnN0TWVzc2FnZXMubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5pbml0U3RhcnRQYXJhbXNGb3JDcmVhdGVNZXNzYWdlKGZpcnN0TWVzc2FnZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZmlyc3RNZXNzYWdlLmFuc3dlcklucHV0SXNTaG93ID9cclxuICAgICAgICAgICAgICAgICAgICBmaXJzdE1lc3NhZ2UuYW5zd2VySW5wdXRJc1Nob3cgPSBmYWxzZSA6XHJcbiAgICAgICAgICAgICAgICAgICAgZmlyc3RNZXNzYWdlLmFuc3dlcklucHV0SXNTaG93ID0gdHJ1ZTtcclxuXHJcblxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIC8vINC10YHQu9C4INC/0YDQvtGB0YLQvtC1INGB0L7QvtCx0YnQtdC90LjQtVxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZS5pc1RhbGsgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy9tZXNzYWdlLmlzRWRpdCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIGF0dGFjaElkID0gZnVsbFRhbGtUb3BpYy5pZCsnLScrbWVzc2FnZS5pZDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZighdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF0pIHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdID0gJGMubWVzc2FnZUNsaWVudC5nZXRNZXNzYWdlcyh0YWxrSWQsdGFsay5zZWxlY3RlZEdyb3VwLmlkLDEsZmlyc3RNZXNzYWdlLmlkLDAsMTAwMCkubWVzc2FnZXM7XHJcbiAgICAgICAgICAgICAgICB2YXIgIGZ1bGxUYWxrTWVzc2FnZXNMZW5ndGggPSB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXS5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmluaXRTdGFydFBhcmFtc0ZvckNyZWF0ZU1lc3NhZ2UobWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLmFuc3dlcklucHV0SXNTaG93ID9cclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmFuc3dlcklucHV0SXNTaG93ID0gZmFsc2UgOlxyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuYW5zd2VySW5wdXRJc1Nob3cgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYoIWluaXRGbGFnc01lc3NhZ2VbYXR0YWNoSWRdKSB7XHJcbiAgICAgICAgICAgICAgICAvL2luaXRBdHRhY2hJbWFnZSgkKCcjYXR0YWNoSW1hZ2UtJyArIGF0dGFjaElkKSwgJCgnI2F0dGFjaC1hcmVhLScgKyBhdHRhY2hJZCkpO1xyXG4gICAgICAgICAgICAgICAgLy9pbml0QXR0YWNoRG9jKCQoJyNhdHRhY2hEb2MtJyArIGF0dGFjaElkKSwgJCgnI2F0dGFjaC1kb2MtYXJlYS0nICsgYXR0YWNoSWQpKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpbml0RmxhZ3NNZXNzYWdlW2F0dGFjaElkXSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0YWxrLnRvZ2dsZVRyZWVGaXJzdE1lc3NhZ2UgPSBmdW5jdGlvbihldmVudCxmaXJzdE1lc3NhZ2Upe1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgZmlyc3RNZXNzYWdlLmlzVHJlZU9wZW4gP1xyXG4gICAgICAgICAgICAgICAgZmlyc3RNZXNzYWdlLmlzVHJlZU9wZW4gPSBmYWxzZSA6XHJcbiAgICAgICAgICAgICAgICBmaXJzdE1lc3NhZ2UuaXNUcmVlT3BlbiA9IHRydWUgO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vIC0tLS0tLS0tXHJcblxyXG4gICAgICAgICAgICB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXSA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0TWVzc2FnZXModGFsa0lkLHRhbGsuc2VsZWN0ZWRHcm91cC5pZCwxLGZpcnN0TWVzc2FnZS5pZCwwLDEwMDApLm1lc3NhZ2VzO1xyXG4gICAgICAgICAgICB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXSA/XHJcbiAgICAgICAgICAgICAgICBmdWxsVGFsa01lc3NhZ2VzTGVuZ3RoID0gdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF0ubGVuZ3RoOlxyXG4gICAgICAgICAgICAgICAgZnVsbFRhbGtNZXNzYWdlc0xlbmd0aCA9IDA7XHJcbiAgICAgICAgICAgIGlmKHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdID09PSBudWxsKSB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGZ1bGxUYWxrTWVzc2FnZXNMZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXVtpXS5hbnN3ZXJJbnB1dElzU2hvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uaXNUcmVlT3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXVtpXS5pc09wZW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uaXNQYXJlbnRPcGVuID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmNyZWF0ZWRFZGl0ID0gJGMuZ2V0VGltaW5nKHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmNyZWF0ZWQpO1xyXG4gICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uY29tbWVudFRleHQgPSAkYy5URVhUX0RFRkFVTFRfMjtcclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGFsay50b2dnbGVUcmVlID0gZnVuY3Rpb24oZXZlbnQsbWVzc2FnZSxmaXJzdE1lc3NhZ2Upe1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgaWYoIXRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdKSB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXSA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0TWVzc2FnZXModGFsa0lkLHRhbGsuc2VsZWN0ZWRHcm91cC5pZCwxLGZpcnN0TWVzc2FnZS5pZCwwLDEwMDApLm1lc3NhZ2VzO1xyXG4gICAgICAgICAgICB2YXIgZnVsbFRhbGtNZXNzYWdlc0xlbmd0aCA9IHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIG1lc3NhZ2UuaXNUcmVlT3BlbiA/XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLmlzVHJlZU9wZW4gPSBmYWxzZSA6XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLmlzVHJlZU9wZW4gPSB0cnVlIDtcclxuXHJcbiAgICAgICAgICAgIHZhciBhZnRlckN1cnJlbnRJbmRleCA9IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbmV4dE1lc3NhZ2VPbkN1cnJlbnRMZXZlbCA9IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbG9vcE1lc3NhZ2VPZmZzZXQsXHJcbiAgICAgICAgICAgICAgICBwYXJlbnRPcGVuU3RhdHVzLFxyXG4gICAgICAgICAgICAgICAgYXJlQWxsTXlQYXJlbnRzVHJlZU9wZW4gPSBbXSxcclxuICAgICAgICAgICAgICAgIGNoZWNrQXJlQWxsTXlQYXJlbnRzVHJlZU9wZW4gPSB0cnVlLFxyXG4gICAgICAgICAgICAgICAgYmVnaW5PZmZzZXQgPSBtZXNzYWdlLm9mZnNldCxcclxuICAgICAgICAgICAgICAgIHBhcmVudE9wZW5TdGF0dXNBcnJheSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGZ1bGxUYWxrTWVzc2FnZXNMZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICBsb29wTWVzc2FnZU9mZnNldCA9IHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLm9mZnNldDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZihhZnRlckN1cnJlbnRJbmRleCAmJiAhbmV4dE1lc3NhZ2VPbkN1cnJlbnRMZXZlbFxyXG4gICAgICAgICAgICAgICAgICAgICYmIG1lc3NhZ2Uub2Zmc2V0IDwgbG9vcE1lc3NhZ2VPZmZzZXQpe1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBhcmVBbGxNeVBhcmVudHNUcmVlT3Blbltsb29wTWVzc2FnZU9mZnNldF0gPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZihsb29wTWVzc2FnZU9mZnNldCAtIG1lc3NhZ2Uub2Zmc2V0ID09IDEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL9C10YHQu9C4INGN0YLQviDQvdC10L/QvtGB0YDQtdC00YHRgtCy0LXQvdC90YvQuSDQv9C+0YLQvtC80L7QulxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uaXNPcGVuID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmlzT3BlbiA9IGZhbHNlIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmlzT3BlbiA9IHRydWUgO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50T3BlblN0YXR1c0FycmF5W2xvb3BNZXNzYWdlT2Zmc2V0XSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudE9wZW5TdGF0dXMgPSB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXVtpXS5pc09wZW47XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmlzVHJlZU9wZW4pe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJlQWxsTXlQYXJlbnRzVHJlZU9wZW5bbG9vcE1lc3NhZ2VPZmZzZXRdID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g0LXRgdC70Lgg0Y3RgtC+INC/0YLQvtC80LrQuCDQv9C+0YLQvtC80LrQsFxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tBcmVBbGxNeVBhcmVudHNUcmVlT3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaiA9IGJlZ2luT2Zmc2V0OyBqIDwgbG9vcE1lc3NhZ2VPZmZzZXQ7IGorKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQv9GA0L7QstC10YDRj9C10Lwg0L3QtdGCINC70Lgg0YMg0LrQvtCz0L4g0LIg0L/RgNC10LTQutCw0YUgaXNUcmVlT3BlbiA9IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhcmVBbGxNeVBhcmVudHNUcmVlT3BlbltqXSA9PSBmYWxzZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tBcmVBbGxNeVBhcmVudHNUcmVlT3BlbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudE9wZW5TdGF0dXMgJiYgY2hlY2tBcmVBbGxNeVBhcmVudHNUcmVlT3BlbiA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXVtpXS5pc09wZW4gPSB0cnVlIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmlzT3BlbiA9IGZhbHNlIDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uaXNUcmVlT3Blbil7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQtdGB0LvQuCDRgyDQutC+0LPQvi3RgtC+INC40Lcg0L/RgNC10LTQutC+0LIg0L3QtSDQvtGC0LrRgNGL0YLQviDQtNC10YDQtdCy0L5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZUFsbE15UGFyZW50c1RyZWVPcGVuW2xvb3BNZXNzYWdlT2Zmc2V0XSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRPcGVuU3RhdHVzQXJyYXlbbG9vcE1lc3NhZ2VPZmZzZXRdID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGFmdGVyQ3VycmVudEluZGV4ICYmIGxvb3BNZXNzYWdlT2Zmc2V0ID09IG1lc3NhZ2Uub2Zmc2V0KXtcclxuICAgICAgICAgICAgICAgICAgICBuZXh0TWVzc2FnZU9uQ3VycmVudExldmVsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKG1lc3NhZ2UuaWQgPT0gdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uaWQpe1xyXG4gICAgICAgICAgICAgICAgICAgIGFmdGVyQ3VycmVudEluZGV4ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBidWZmLFxyXG4gICAgICAgICAgICBsYXN0TG9hZGVkSWRGRjtcclxuICAgICAgICB0YWxrLmFkZE1vcmVJdGVtcyA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHZhciB0ZW1wID0gJGMubWVzc2FnZUNsaWVudC5nZXRGaXJzdExldmVsTWVzc2FnZXModGFsa0lkLHRhbGsuc2VsZWN0ZWRHcm91cC5pZCwxLCRyb290U2NvcGUuYmFzZS5sYXN0TG9hZGVkSWQsMCwxMCksXHJcbiAgICAgICAgICAgICAgICBidWZmID0gdGVtcC5tZXNzYWdlcztcclxuICAgICAgICAgICAgaWYoYnVmZikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJ1ZmZMZW5ndGggPSBidWZmLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZihidWZmTGVuZ3RoICE9IDApIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmxhc3RMb2FkZWRJZCA9IGJ1ZmZbYnVmZkxlbmd0aCAtIDFdLmlkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZihsYXN0TG9hZGVkSWRGRiAhPSAkcm9vdFNjb3BlLmJhc2UubGFzdExvYWRlZElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5pbml0Rmlyc3RNZXNzYWdlcyhidWZmKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa0ZpcnN0TWVzc2FnZXMgPSB0YWxrLmZ1bGxUYWxrRmlyc3RNZXNzYWdlcy5jb25jYXQoYnVmZik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBsYXN0TG9hZGVkSWRGRiA9ICRyb290U2NvcGUuYmFzZS5sYXN0TG9hZGVkSWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5lbmRPZkxvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJCgnLm5nLWNsb2FrJykucmVtb3ZlQ2xhc3MoJ25nLWNsb2FrJyk7XHJcblxyXG4gICAgfTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gWyAnJHJvb3RTY29wZScsJyRzdGF0ZVBhcmFtcycsJyRjJywgcnVicmljc1NpbmdsZUN0cmwgXTsiLCJcclxudmFyIHNldEluZm9DdHJsID0gZnVuY3Rpb24oJGMpIHtcclxuICAgICAgICB2YXIgc2V0SW5mbyA9IHRoaXM7XHJcblxyXG4gICAgICAgIHNldEluZm8uaXNTYXZlUmVzdWx0ID0gZmFsc2U7XHJcbiAgICAgICAgc2V0SW5mby5pc0Vycm9yID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHNldEluZm8uc2F2ZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHZhciBzdGFpcmNhc2UsIGZsb29yLGZsYXQ7XHJcblxyXG4gICAgICAgICAgICAoIXNldEluZm8uc3RhaXJjYXNlKSA/IHN0YWlyY2FzZSA9IDAgOiBzdGFpcmNhc2UgPSBzZXRJbmZvLnN0YWlyY2FzZTtcclxuICAgICAgICAgICAgKCFzZXRJbmZvLmZsb29yKSA/IGZsb29yID0gMCA6IGZsb29yID0gc2V0SW5mby5mbG9vcjtcclxuICAgICAgICAgICAgKCFzZXRJbmZvLmZsYXQpID8gZmxhdCA9IDAgOiBmbGF0ID0gc2V0SW5mby5mbGF0O1xyXG5cclxuICAgICAgICAgICAgc2V0SW5mby5pc1NhdmVSZXN1bHQgPSB0cnVlO1xyXG4gICAgICAgICAgICAvL3RyeSB7XHJcbiAgICAgICAgICAgICAgICAkYy51c2VyQ2xpZW50LnVwZGF0ZVVzZXJBZGRyZXNzKHN0YWlyY2FzZSwgZmxvb3IsIGZsYXQpO1xyXG4gICAgICAgICAgICAgICAgc2V0SW5mby5pbmZvID0gXCLQodC+0YXRgNCw0L3QtdC90L5cIjtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKCcvJyk7XHJcbiAgICAgICAgICAgICAgICAvLyRyb290U2NvcGUuJGFwcGx5KCk7XHJcbiAgICAgICAgICAgIC8qfWNhdGNoKGUpe1xyXG4gICAgICAgICAgICAgICAgc2V0SW5mby5pbmZvID0gXCLQn9GA0L7QuNC30L7RiNC70LAg0L7RiNC40LHQutCwXCI7XHJcbiAgICAgICAgICAgICAgICBzZXRJbmZvLmlzRXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICB9O1xyXG5cclxuICAgIH07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFsgJyRjJywgc2V0SW5mb0N0cmwgXTsiLCJcclxudmFyIHNldHRpbmdzQ3RybD0gZnVuY3Rpb24oJHJvb3RTY29wZSwkc2NvcGUsJGMpIHtcclxuICAgICAgICAkcm9vdFNjb3BlLmlzVG9wU2VhcmNoU2hvdyA9IGZhbHNlO1xyXG4gICAgICAgICRyb290U2NvcGUubGVmdGJhci50YWIgPSAwO1xyXG5cclxuICAgICAgICAkYy5yZXNldFBhZ2VzKCRyb290U2NvcGUuYmFzZSk7XHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLnNldHRpbmdzSXNBY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5pc0Zvb3RlckJvdHRvbSA9IHRydWU7XHJcblxyXG4gICAgICAgICRjLnJlc2V0QWNlTmF2QnRucygkcm9vdFNjb3BlLm5hdmJhcik7XHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLm1haW5Db250ZW50VG9wSXNIaWRlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLnNldHRpbmdzTG9hZFN0YXR1cyA9IFwiaXNMb2FkZWRcIjtcclxuXHJcbiAgICAgICAgdmFyIHNldHRpbmdzID0gdGhpcyxcclxuICAgICAgICAgICAgdXNlclByb2ZpbGVNZXRhID0gJGMudXNlckNsaWVudC5nZXRVc2VyUHJvZmlsZSgpLFxyXG4gICAgICAgICAgICB1c2VyQ29udGF0Y3NNZXRhID0gdXNlclByb2ZpbGVNZXRhLmNvbnRhY3RzLFxyXG4gICAgICAgICAgICB1c2VySW5mb01ldGEgPSB1c2VyUHJvZmlsZU1ldGEudXNlckluZm8sXHJcbiAgICAgICAgICAgIHVzZXJQcml2YWN5TWV0YSA9IHVzZXJQcm9maWxlTWV0YS5wcml2YWN5LFxyXG4gICAgICAgICAgICB1c2VyTm90aWZpY2F0aW9uc01ldGEgPSB1c2VyUHJvZmlsZU1ldGEubm90aWZpY2F0aW9ucyxcclxuICAgICAgICAgICAgdXNlckZhbWlseU1ldGEgPSB1c2VyUHJvZmlsZU1ldGEuZmFtaWx5LFxyXG4gICAgICAgICAgICB1c2VySW50ZXJlc3RzTWV0YSA9IHVzZXJQcm9maWxlTWV0YS5pbnRlcmVzdHM7XHJcblxyXG4gICAgICAgIGlmKHVzZXJGYW1pbHlNZXRhID09PSBudWxsKXtcclxuICAgICAgICAgICAgdXNlckZhbWlseU1ldGEgPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQuVXNlckZhbWlseSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2V0dGluZ3MudXNlckNvbnRhY3RzID0gJGMuY2xvbmUodXNlckNvbnRhdGNzTWV0YSk7XHJcbiAgICAgICAgc2V0dGluZ3MudXNlckluZm8gPSAkYy5jbG9uZSh1c2VySW5mb01ldGEpO1xyXG4gICAgICAgIHNldHRpbmdzLnVzZXJQcml2YWN5ID0gJGMuY2xvbmUodXNlclByaXZhY3lNZXRhKTtcclxuICAgICAgICBzZXR0aW5ncy51c2VyTm90aWZpY2F0aW9ucyA9ICRjLmNsb25lKHVzZXJOb3RpZmljYXRpb25zTWV0YSk7XHJcbiAgICAgICAgaWYoIXNldHRpbmdzLnVzZXJOb3RpZmljYXRpb25zKXtcclxuICAgICAgICAgICAgc2V0dGluZ3MudXNlck5vdGlmaWNhdGlvbnMgPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQuTm90aWZpY2F0aW9ucygpO1xyXG4gICAgICAgICAgICBzZXR0aW5ncy51c2VyTm90aWZpY2F0aW9ucy5mcmVxID0gNDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNldHRpbmdzLmZhbWlseSA9ICRjLmNsb25lKHVzZXJGYW1pbHlNZXRhKTtcclxuICAgICAgICBzZXR0aW5ncy5pbnRlcmVzdHMgPSAkYy5jbG9uZSh1c2VySW50ZXJlc3RzTWV0YSk7XHJcblxyXG4gICAgICAgIGlmIChzZXR0aW5ncy51c2VySW5mby5nZW5kZXIgPT0gMSkge1xyXG4gICAgICAgICAgICBzZXR0aW5ncy5tYXJyaWVkID0gXCLQl9Cw0LzRg9C20LXQvFwiO1xyXG4gICAgICAgICAgICBzZXR0aW5ncy5ub3RNYXJyaWVkID0gXCLQndC1INC30LDQvNGD0LbQtdC8XCI7XHJcbiAgICAgICAgfWVsc2UgaWYoc2V0dGluZ3MudXNlckluZm8uZ2VuZGVyID09IDIpe1xyXG4gICAgICAgICAgICBzZXR0aW5ncy5tYXJyaWVkID0gXCLQltC10L3QsNGCXCI7XHJcbiAgICAgICAgICAgIHNldHRpbmdzLm5vdE1hcnJpZWQgPSBcItCd0LUg0LbQtdC90LDRglwiO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBzZXR0aW5ncy5tYXJyaWVkID0gXCLQkiDQsdGA0LDQutC1XCI7XHJcbiAgICAgICAgICAgIHNldHRpbmdzLm5vdE1hcnJpZWQgPSBcItCd0LUg0YHQvtGB0YLQvtGOINCyINCx0YDQsNC60LVcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNldHRpbmdzLnllYXJzPSBbXTtcclxuICAgICAgICB2YXIgaW5kID0gMDtcclxuICAgICAgICBmb3IodmFyIGkgPSAyMDE0OyBpID4gMTk0MDsgaS0tKXtcclxuICAgICAgICAgICAgc2V0dGluZ3MueWVhcnNbaW5kKytdID0gaTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNldHRpbmdzLnVzZXJJbmZvLmJpcnRoZGF5ID9cclxuICAgICAgICBzZXR0aW5ncy51c2VySW5mby5iaXJ0aGRheU1ldGEgPSBuZXcgRGF0ZShzZXR0aW5ncy51c2VySW5mby5iaXJ0aGRheSoxMDAwKSA6XHJcbiAgICAgICAgc2V0dGluZ3MudXNlckluZm8uYmlydGhkYXlNZXRhID0gXCJcIjtcclxuXHJcbiAgICAgICAgaWYoc2V0dGluZ3MudXNlckluZm8uYmlydGhkYXlNZXRhKXtcclxuICAgICAgICAgICAgdmFyIG1vbnRoID0gc2V0dGluZ3MudXNlckluZm8uYmlydGhkYXlNZXRhLmdldE1vbnRoKCkrMStcIlwiO1xyXG4gICAgICAgICAgICBpZihtb250aC5sZW5ndGggPT0gMSkgbW9udGggPSBcIjBcIittb250aDtcclxuXHJcbiAgICAgICAgICAgIHZhciBkYXkgPSBcIlwiK3NldHRpbmdzLnVzZXJJbmZvLmJpcnRoZGF5TWV0YS5nZXREYXRlKCk7XHJcbiAgICAgICAgICAgIGlmKGRheS5sZW5ndGggPT0gMSkgZGF5ID0gXCIwXCIrZGF5O1xyXG5cclxuICAgICAgICAgICAgdmFyIHllYXIgPSBzZXR0aW5ncy51c2VySW5mby5iaXJ0aGRheU1ldGEuZ2V0RnVsbFllYXIoKTtcclxuXHJcbiAgICAgICAgICAgIHNldHRpbmdzLnVzZXJJbmZvLmJpcnRoZGF5TWV0YSA9IGRheStcIi5cIittb250aCtcIi5cIit5ZWFyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYoc2V0dGluZ3MuZmFtaWx5LmNoaWxkcyA9PT0gbnVsbCB8fCBzZXR0aW5ncy5mYW1pbHkuY2hpbGRzLmxlbmd0aCA9PSAwKXtcclxuICAgICAgICAgICAgc2V0dGluZ3MuZmFtaWx5LmNoaWxkcyA9IFtdO1xyXG4gICAgICAgICAgICBzZXR0aW5ncy5mYW1pbHkuY2hpbGRzWzBdID0gbmV3IGNvbS52bWVzdGVvbmxpbmUuYmUudGhyaWZ0LkNoaWxkcmVuKCk7XHJcbiAgICAgICAgICAgIHNldHRpbmdzLmZhbWlseS5jaGlsZHNbMF0ubmFtZSA9IFwiXCI7XHJcbiAgICAgICAgICAgIHZhciBub3dZZWFyID0gbmV3IERhdGUoKTtcclxuICAgICAgICAgICAgbm93WWVhciA9IG5vd1llYXIuZ2V0RnVsbFllYXIoKTtcclxuICAgICAgICAgICAgLy9zZXR0aW5ncy5mYW1pbHkuY2hpbGRzWzBdLmJpcnRoZGF5ID0gRGF0ZS5wYXJzZSgnMDEuMTUuJytub3dZZWFyKTtcclxuICAgICAgICAgICAgc2V0dGluZ3MuZmFtaWx5LmNoaWxkc1swXS5iaXJ0aGRheSA9IG51bGw7XHJcbiAgICAgICAgICAgIHNldHRpbmdzLmZhbWlseS5jaGlsZHNbMF0uaXNOb3RSZW1vdmUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgY2hpbGRzTGVuZ3RoID0gc2V0dGluZ3MuZmFtaWx5LmNoaWxkcy5sZW5ndGg7XHJcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGNoaWxkc0xlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgaWYoc2V0dGluZ3MuZmFtaWx5LmNoaWxkc1tpXS5iaXJ0aGRheSkge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBiaXJ0aERhdGUgPSBuZXcgRGF0ZShzZXR0aW5ncy5mYW1pbHkuY2hpbGRzW2ldLmJpcnRoZGF5KjEwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLmZhbWlseS5jaGlsZHNbaV0ubW9udGggPSBcIlwiK2JpcnRoRGF0ZS5nZXRNb250aCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKHNldHRpbmdzLmZhbWlseS5jaGlsZHNbaV0ubW9udGgubGVuZ3RoID09IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuZmFtaWx5LmNoaWxkc1tpXS5tb250aCA9IFwiMFwiK3NldHRpbmdzLmZhbWlseS5jaGlsZHNbaV0ubW9udGg7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLmZhbWlseS5jaGlsZHNbaV0ueWVhciA9IGJpcnRoRGF0ZS5nZXRGdWxsWWVhcigpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYoc2V0dGluZ3MuZmFtaWx5LnBldHMgPT09IG51bGwgfHwgc2V0dGluZ3MuZmFtaWx5LnBldHMubGVuZ3RoID09IDApe1xyXG4gICAgICAgICAgICBzZXR0aW5ncy5mYW1pbHkucGV0cyA9IFtdO1xyXG4gICAgICAgICAgICBzZXR0aW5ncy5mYW1pbHkucGV0c1swXSA9IG5ldyBjb20udm1lc3Rlb25saW5lLmJlLnRocmlmdC5QZXQoKTtcclxuICAgICAgICAgICAgc2V0dGluZ3MuZmFtaWx5LnBldHNbMF0ubmFtZSA9IFwiXCI7XHJcbiAgICAgICAgICAgIHNldHRpbmdzLmZhbWlseS5wZXRzWzBdLnR5cGUgPSBcIjBcIjtcclxuICAgICAgICAgICAgc2V0dGluZ3MuZmFtaWx5LnBldHNbMF0uYnJlZWQgPSBcIlwiO1xyXG4gICAgICAgICAgICBzZXR0aW5ncy5mYW1pbHkucGV0c1swXS5pc05vdFJlbW92ZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzZXR0aW5ncy5vbGRQYXNzdyA9IFwiXCI7XHJcbiAgICAgICAgc2V0dGluZ3MubmV3UGFzc3cgPSBcIlwiO1xyXG5cclxuICAgICAgICBzZXR0aW5ncy5jYW5TYXZlID0gZnVuY3Rpb24obnVtKXtcclxuICAgICAgICAgICAgc3dpdGNoKG51bSl7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXNlckluZm8uJHZhbGlkO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVByaXZhdGUuJHZhbGlkO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybUFsZXJ0cy4kdmFsaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtQ29udGFjdHMuJHZhbGlkO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA1OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybUZhbWlseS4kdmFsaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDY6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtSW50ZXJlc3RzLiR2YWxpZDtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBzZXR0aW5ncy5wcm9maWxlSW5mbyA9IFwi0KHQvtGF0YDQsNC90LXQvdC+XCI7XHJcblxyXG4gICAgICAgIHNldHRpbmdzLmlzUHJvZmlsZUVycm9yID0gZmFsc2U7XHJcbiAgICAgICAgc2V0dGluZ3MuaXNQcm9maWxlUmVzdWx0ID0gZmFsc2U7XHJcbiAgICAgICAgc2V0dGluZ3MudXBkYXRlVXNlckluZm8gPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB2YXIgdGVtcCA9IG5ldyBjb20udm1lc3Rlb25saW5lLmJlLnRocmlmdC5Vc2VySW5mbygpO1xyXG5cclxuICAgICAgICAgICAgc2V0dGluZ3MudXNlckluZm8uYmlydGhkYXlNZXRhID9cclxuICAgICAgICAgICAgICAgIHRlbXAuYmlydGhkYXkgPSBEYXRlLnBhcnNlKCRjLmdldENvcnJlY3REYXRlKHNldHRpbmdzLnVzZXJJbmZvLmJpcnRoZGF5TWV0YSkpLzEwMDAgOlxyXG4gICAgICAgICAgICAgICAgdGVtcC5iaXJ0aGRheSA9IDA7XHJcblxyXG4gICAgICAgICAgICB0ZW1wLmdlbmRlciA9IHNldHRpbmdzLnVzZXJJbmZvLmdlbmRlcjtcclxuICAgICAgICAgICAgdGVtcC5maXJzdE5hbWUgPSAkcm9vdFNjb3BlLmJhc2UubWUuZmlyc3ROYW1lID0gc2V0dGluZ3MudXNlckluZm8uZmlyc3ROYW1lO1xyXG4gICAgICAgICAgICB0ZW1wLmxhc3ROYW1lID0gJHJvb3RTY29wZS5iYXNlLm1lLmxhc3ROYW1lID0gc2V0dGluZ3MudXNlckluZm8ubGFzdE5hbWU7XHJcblxyXG4gICAgICAgICAgICAkYy51c2VyQ2xpZW50LnVwZGF0ZVVzZXJJbmZvKHRlbXApO1xyXG4gICAgICAgICAgICBzZXR0aW5ncy5pc1Byb2ZpbGVSZXN1bHQgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXR0aW5ncy5pc1Byb2ZpbGVFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICAgICBzZXR0aW5ncy5wcm9maWxlSW5mbyA9IFwi0KHQvtGF0YDQsNC90LXQvdC+XCI7XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHNldHRpbmdzLmlzUGFzc3dFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgIHNldHRpbmdzLmlzUGFzc3dSZXN1bHQgPSBmYWxzZTtcclxuICAgICAgICBzZXR0aW5ncy51cGRhdGVQYXNzd29yZCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIGlmIChzZXR0aW5ncy5uZXdQYXNzdy5sZW5ndGggPCAzKXtcclxuICAgICAgICAgICAgICAgIHNldHRpbmdzLmlzUGFzc3dSZXN1bHQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MuaXNQYXNzd0Vycm9yID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHNldHRpbmdzLnBhc3N3SW5mbyA9IFwi0JLRiyDRg9C60LDQt9Cw0LvQuCDRgdC70LjRiNC60L7QvCDQutC+0YDQvtGC0LrQuNC5INC/0LDRgNC+0LvRjFwiO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHNldHRpbmdzLmlzUGFzc3dSZXN1bHQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAkYy51c2VyQ2xpZW50LmNoYW5nZVBhc3N3b3JkKHNldHRpbmdzLm9sZFBhc3N3LCBzZXR0aW5ncy5uZXdQYXNzdyk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuaXNQYXNzd0Vycm9yID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MucGFzc3dJbmZvID0gXCLQodC+0YXRgNCw0L3QtdC90L5cIjtcclxuICAgICAgICAgICAgICAgIH1jYXRjaChlKXtcclxuICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5pc1Bhc3N3RXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLnBhc3N3SW5mbyA9IFwi0JLRiyDRg9C60LDQt9Cw0LvQuCDQvdC1INCy0LXRgNC90YvQuSDRgdGC0LDRgNGL0Lkg0L/QsNGA0L7Qu9GMXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgc2V0dGluZ3MuaXNQcml2YWN5RXJyb3IgPSBmYWxzZTtcclxuICAgICAgICBzZXR0aW5ncy5pc1ByaXZhY3lSZXN1bHQgPSBmYWxzZTtcclxuICAgICAgICBzZXR0aW5ncy51cGRhdGVQcml2YWN5ID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgJGMudXNlckNsaWVudC51cGRhdGVQcml2YWN5KHNldHRpbmdzLnVzZXJQcml2YWN5KTtcclxuXHJcbiAgICAgICAgICAgIHNldHRpbmdzLmlzUHJpdmFjeVJlc3VsdCA9IHRydWU7XHJcbiAgICAgICAgICAgIHNldHRpbmdzLmlzUHJpdmFjeUVycm9yID0gZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIHNldHRpbmdzLmlzQ29udGFjdHNFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgIHNldHRpbmdzLmlzQ29udGFjdHNSZXN1bHQgPSBmYWxzZTtcclxuICAgICAgICBzZXR0aW5ncy51cGRhdGVDb250YWN0cyA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHZhciB0ZW1wID0gbmV3IGNvbS52bWVzdGVvbmxpbmUuYmUudGhyaWZ0LlVzZXJDb250YWN0cygpO1xyXG4gICAgICAgICAgICB0ZW1wLmVtYWlsID0gc2V0dGluZ3MudXNlckNvbnRhY3RzLmVtYWlsO1xyXG4gICAgICAgICAgICB0ZW1wLm1vYmlsZVBob25lID0gc2V0dGluZ3MudXNlckNvbnRhY3RzLm1vYmlsZVBob25lO1xyXG4gICAgICAgICAgICAkYy51c2VyQ2xpZW50LnVwZGF0ZUNvbnRhY3RzKHRlbXApO1xyXG5cclxuICAgICAgICAgICAgc2V0dGluZ3MuaXNDb250YWN0c0Vycm9yID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHNldHRpbmdzLmlzQ29udGFjdHNSZXN1bHQgPSB0cnVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHNldHRpbmdzLmlzQWxlcnRzRXJyb3IgPSBmYWxzZTtcclxuICAgICAgICBzZXR0aW5ncy5pc0FsZXJ0c1Jlc3VsdCA9IGZhbHNlO1xyXG4gICAgICAgIHNldHRpbmdzLnVwZGF0ZU5vdGlmaWNhdGlvbnMgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBpZihzZXR0aW5ncy51c2VyTm90aWZpY2F0aW9ucyAmJiAoc2V0dGluZ3MudXNlck5vdGlmaWNhdGlvbnMuZW1haWwgfHwgc2V0dGluZ3MudXNlck5vdGlmaWNhdGlvbnMuZnJlcSkgKXtcclxuICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gbmV3IGNvbS52bWVzdGVvbmxpbmUuYmUudGhyaWZ0Lk5vdGlmaWNhdGlvbnMoKTtcclxuICAgICAgICAgICAgICAgIHRlbXAuZW1haWwgPSBzZXR0aW5ncy51c2VyTm90aWZpY2F0aW9ucy5lbWFpbDtcclxuICAgICAgICAgICAgICAgIHRlbXAuZnJlcSA9IHNldHRpbmdzLnVzZXJOb3RpZmljYXRpb25zLmZyZXE7XHJcblxyXG4gICAgICAgICAgICAgICAgJGMudXNlckNsaWVudC51cGRhdGVOb3RpZmljYXRpb25zKHRlbXApO1xyXG5cclxuICAgICAgICAgICAgICAgIHNldHRpbmdzLmlzQWxlcnRzRXJyb3IgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHNldHRpbmdzLmlzQWxlcnRzUmVzdWx0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHNldHRpbmdzLmlzRmFtaWx5RXJyb3IgPSBmYWxzZTtcclxuICAgICAgICBzZXR0aW5ncy5pc0ZhbWlseVJlc3VsdCA9IGZhbHNlO1xyXG4gICAgICAgIHNldHRpbmdzLnVwZGF0ZUZhbWlseSA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHZhciB0ZW1wID0gbmV3IGNvbS52bWVzdGVvbmxpbmUuYmUudGhyaWZ0LlVzZXJGYW1pbHkoKTtcclxuICAgICAgICAgICAgdGVtcC5yZWxhdGlvbnMgPSBzZXR0aW5ncy5mYW1pbHkucmVsYXRpb25zO1xyXG4gICAgICAgICAgICB0ZW1wLmNoaWxkcyA9IHNldHRpbmdzLmZhbWlseS5jaGlsZHM7XHJcbiAgICAgICAgICAgIC8vdGVtcC5jaGlsZHMgPSBbXTtcclxuICAgICAgICAgICAgLy90ZW1wLmNoaWxkc1swXSA9IHNldHRpbmdzLmZpcnN0Q2hpbGQ7XHJcblxyXG4gICAgICAgICAgICB0ZW1wLnBldHMgPSBzZXR0aW5ncy5mYW1pbHkucGV0cztcclxuXHJcbiAgICAgICAgICAgIHZhciBjaGlsZHNMZW5ndGggPSBzZXR0aW5ncy5mYW1pbHkuY2hpbGRzLmxlbmd0aDtcclxuICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGNoaWxkc0xlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgICAgIGlmKHNldHRpbmdzLmZhbWlseS5jaGlsZHNbaV0ubmFtZSAmJiBzZXR0aW5ncy5mYW1pbHkuY2hpbGRzW2ldLm5hbWUgIT0gXCJcIil7IDwhLS0gICYmIHNldHRpbmdzLmZhbWlseS5jaGlsZHNbaV0ubW9udGggJiYgc2V0dGluZ3MuZmFtaWx5LmNoaWxkc1tpXS55ZWFyIC0tPlxyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcE1vbnRoID0gcGFyc2VJbnQoc2V0dGluZ3MuZmFtaWx5LmNoaWxkc1tpXS5tb250aCkrMStcIlwiO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZih0ZW1wTW9udGgubGVuZ3RoIDwgMikgdGVtcE1vbnRoID0gXCIwXCIgKyB0ZW1wTW9udGg7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKHNldHRpbmdzLmZhbWlseS5jaGlsZHNbaV0ueWVhciAmJiBzZXR0aW5ncy5mYW1pbHkuY2hpbGRzW2ldLnllYXIgIT0gJzE5MTEnICYmIHNldHRpbmdzLmZhbWlseS5jaGlsZHNbaV0ubW9udGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcC5jaGlsZHNbaV0uYmlydGhkYXkgPSBEYXRlLnBhcnNlKCRjLmdldENvcnJlY3REYXRlKFwiMTUuXCIrdGVtcE1vbnRoICtcIi5cIiArIHNldHRpbmdzLmZhbWlseS5jaGlsZHNbaV0ueWVhcikpIC8gMTAwMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9hbGVydCh0ZW1wTW9udGgrXCIgXCIrJGMuZ2V0Q29ycmVjdERhdGUoXCIxNS5cIit0ZW1wTW9udGggK1wiLlwiICsgc2V0dGluZ3MuZmFtaWx5LmNoaWxkc1tpXS55ZWFyKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAuY2hpbGRzW2ldLmJpcnRoZGF5ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHBldHNMZW5ndGggPSBzZXR0aW5ncy5mYW1pbHkucGV0cy5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBwZXRzTGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICAgICAgaWYodGVtcC5wZXRzW2ldICYmICF0ZW1wLnBldHNbaV0ubmFtZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgLy90ZW1wLnBldHMuc3BsaWNlKGksMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRjLnVzZXJDbGllbnQudXBkYXRlRmFtaWx5KHRlbXApO1xyXG5cclxuICAgICAgICAgICAgc2V0dGluZ3MuaXNGYW1pbHlFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICAgICBzZXR0aW5ncy5pc0ZhbWlseVJlc3VsdCA9IHRydWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgc2V0dGluZ3MuaXNJbnRlcmVzdHNFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgIHNldHRpbmdzLmlzSW50ZXJlc3RzUmVzdWx0ID0gZmFsc2U7XHJcbiAgICAgICAgc2V0dGluZ3MudXBkYXRlSW50ZXJlc3RzID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdmFyIHRlbXAgPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQuVXNlckludGVyZXN0cygpO1xyXG4gICAgICAgICAgICB0ZW1wLmpvYiA9IHNldHRpbmdzLmludGVyZXN0cy5qb2I7XHJcbiAgICAgICAgICAgIHRlbXAudXNlckludGVyZXN0cyA9IHNldHRpbmdzLmludGVyZXN0cy51c2VySW50ZXJlc3RzO1xyXG4gICAgICAgICAgICAkYy51c2VyQ2xpZW50LnVwZGF0ZUludGVyZXN0cyh0ZW1wKTtcclxuXHJcbiAgICAgICAgICAgIHNldHRpbmdzLmlzSW50ZXJlc3RzRXJyb3IgPSBmYWxzZTtcclxuICAgICAgICAgICAgc2V0dGluZ3MuaXNJbnRlcmVzdHNSZXN1bHQgPSB0cnVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHNldHRpbmdzLmNoaWxkQWRkID0gZnVuY3Rpb24oZXZlbnQpe1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgdmFyIG5ld0NoaWxkID0gbmV3IGNvbS52bWVzdGVvbmxpbmUuYmUudGhyaWZ0LkNoaWxkcmVuKCk7XHJcbiAgICAgICAgICAgIG5ld0NoaWxkLm5hbWUgPSBcIiBcIjtcclxuICAgICAgICAgICAgdmFyIG5vd1llYXIgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICBub3dZZWFyID0gbm93WWVhci5nZXRGdWxsWWVhcigpO1xyXG4gICAgICAgICAgICBuZXdDaGlsZC5iaXJ0aGRheSA9IERhdGUucGFyc2UoJGMuZ2V0Q29ycmVjdERhdGUoJzE1LjAxLicrbm93WWVhcikpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGJpcnRoRGF0ZSA9IG5ldyBEYXRlKG5ld0NoaWxkLmJpcnRoZGF5KTtcclxuICAgICAgICAgICAgLy9uZXdDaGlsZC5tb250aCA9IFwiXCIrYmlydGhEYXRlLmdldE1vbnRoKCk7XHJcbiAgICAgICAgICAgIG5ld0NoaWxkLm1vbnRoID0gXCJcIjtcclxuXHJcbiAgICAgICAgICAgIGlmKG5ld0NoaWxkLmxlbmd0aCA9PSAxKVxyXG4gICAgICAgICAgICAgICAgbmV3Q2hpbGQubW9udGggPSBcIjBcIituZXdDaGlsZC5tb250aDtcclxuXHJcbiAgICAgICAgICAgIC8vbmV3Q2hpbGQueWVhciA9IGJpcnRoRGF0ZS5nZXRGdWxsWWVhcigpO1xyXG4gICAgICAgICAgICBuZXdDaGlsZC55ZWFyID0gXCJcIjtcclxuXHJcblxyXG4gICAgICAgICAgICBpZihzZXR0aW5ncy5mYW1pbHkgPT0gbnVsbCl7XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5mYW1pbHkgPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQuVXNlckZhbWlseSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmZhbWlseS5jaGlsZHMgPT0gbnVsbCl7XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5mYW1pbHkuY2hpbGRzPSBbXTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2V0dGluZ3MuZmFtaWx5LmNoaWxkcy5sZW5ndGggPT0gMCA/XHJcbiAgICAgICAgICAgIHNldHRpbmdzLmZhbWlseS5jaGlsZHNbMF0gPSBuZXdDaGlsZCA6XHJcbiAgICAgICAgICAgIHNldHRpbmdzLmZhbWlseS5jaGlsZHMucHVzaChuZXdDaGlsZCk7XHJcblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgc2V0dGluZ3MucmVtb3ZlQ2hpbGQgPSBmdW5jdGlvbihjaGlsZE5hbWUpe1xyXG4gICAgICAgICAgICB2YXIgY2hpbGRzTGVuZ3RoID0gc2V0dGluZ3MuZmFtaWx5LmNoaWxkcy5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBjaGlsZHNMZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICBpZihzZXR0aW5ncy5mYW1pbHkuY2hpbGRzW2ldLm5hbWUgPT0gY2hpbGROYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuZmFtaWx5LmNoaWxkcy5zcGxpY2UoaSwxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHNldHRpbmdzLnBldEFkZCA9IGZ1bmN0aW9uKGV2ZW50KXtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBuZXdQZXQgPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQuUGV0KCk7XHJcbiAgICAgICAgICAgIG5ld1BldC5uYW1lID0gXCIgXCI7XHJcbiAgICAgICAgICAgIG5ld1BldC50eXBlID0gXCIwXCI7XHJcblxyXG4gICAgICAgICAgICBpZihzZXR0aW5ncy5mYW1pbHkgPT0gbnVsbCl7XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5mYW1pbHkgPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQuVXNlckZhbWlseSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmZhbWlseS5wZXRzID09IG51bGwpe1xyXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MuZmFtaWx5LnBldHM9IFtdO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZXR0aW5ncy5mYW1pbHkucGV0cy5sZW5ndGggPT0gMCA/XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5mYW1pbHkucGV0c1swXSA9IG5ld1BldCA6XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5mYW1pbHkucGV0cy5wdXNoKG5ld1BldCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBzZXR0aW5ncy5yZW1vdmVQZXQgPSBmdW5jdGlvbihwZXROYW1lKXtcclxuICAgICAgICAgICAgdmFyIHBldHNMZW5ndGggPSBzZXR0aW5ncy5mYW1pbHkucGV0cy5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBwZXRzTGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICAgICAgaWYoc2V0dGluZ3MuZmFtaWx5LnBldHNbaV0ubmFtZSA9PSBwZXROYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuZmFtaWx5LnBldHMuc3BsaWNlKGksMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgc2V0dGluZ3MucGFzc3dDaGFuZ2UgPSBmYWxzZTtcclxuICAgICAgICBzZXR0aW5ncy5jaGFuZ2VQYXNzdyA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHNldHRpbmdzLnBhc3N3Q2hhbmdlID0gdHJ1ZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKihzZXR0aW5ncy51c2VySW5mby5iaXJ0aGRheSAhPSAwKSA/XHJcbiAgICAgICAgc2V0dGluZ3MuYmlydGhkYXkgPSBzZXR0aW5ncy51c2VySW5mby5iaXJ0aGRheSA6XHJcbiAgICAgICAgc2V0dGluZ3MuYmlydGhkYXkgPSBcIlwiOyovXHJcblxyXG4gICAgICAgICQoJyNzZXR0aW5ncy1pbnB1dC0zJykuZGF0ZXBpY2tlcih7Y2hhbmdlTW9udGg6dHJ1ZSwgY2hhbmdlWWVhcjp0cnVlLGRhdGVGb3JtYXQ6IFwiZGQubW0ueXlcIix5ZWFyUmFuZ2U6J2MtMTAwOitjJ30pO1xyXG4gICAgICAgICQuZGF0ZXBpY2tlci5zZXREZWZhdWx0cygkLmRhdGVwaWNrZXIucmVnaW9uYWxbJ3J1J10pO1xyXG5cclxuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJCgnLnNldHRpbmdzJykpLmNzcyh7J21pbi1oZWlnaHQnOiAkKHdpbmRvdykuaGVpZ2h0KCktMTI1fSk7XHJcblxyXG4gICAgICAgICQoJy5uZy1jbG9haycpLnJlbW92ZUNsYXNzKCduZy1jbG9haycpO1xyXG5cclxuICAgICAgICB2YXIgaHJlZiA9IGRvY3VtZW50LmxvY2F0aW9uLmhyZWY7XHJcbiAgICAgICAgdmFyIGhyZWZJbmQgPSBocmVmLmluZGV4T2YoXCIvXCIsOSk7XHJcbiAgICAgICAgJCgnaW5wdXRbbmFtZT1cInJlZGlyZWN0X3VyaVwiXScpLnZhbChocmVmLnN1YnN0cmluZygwLGhyZWZJbmQpK1wiL29hdXRoXCIpO1xyXG5cclxuICAgIH07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFsgJyRyb290U2NvcGUnLCckc2NvcGUnLCckYycsIHNldHRpbmdzQ3RybCBdOyIsIlxyXG52YXIgdGFsa3NDdHJsID0gZnVuY3Rpb24oJHJvb3RTY29wZSwkYykge1xyXG4gICAgICAgIC8qXHJcbiAgICAgICAgKiDQv9GA0Lgg0YDQsNCx0L7RgtC1INGBINC+0LHRgdC20LTQtdC90LjRj9C80Lgg0L3Rg9C20L3QviDRg9GH0LXRgdGC0Ywg0YHQu9C10LTRg9GO0YnQtdC1OlxyXG4gICAgICAgICog0LXRgdGC0Ywg0YLRgNC4INGC0LjQv9CwINGB0L7QvtCx0YnQtdC90LjRjyA6XHJcbiAgICAgICAgKiAxKSDRgtC+0L/QuNC6LiDQndCwINGB0YLRgNCw0L3QuNGG0LUg0L7QsdGB0YPQttC00LXQvdC40Y8g0LzQvtC20LXRgiDQsdGL0YLRjCDRgtC+0LvRjNC60L4g0L7QtNC40L0uINCV0LPQviDQtNC10YLQuFxyXG4gICAgICAgICog0Y3RgtC+INGB0L7QvtCx0YnQtdC90LjRjyDQv9C10YDQstC+0LPQviDRg9GA0L7QstC90Y8uINCV0LPQviDQtNC10YLQuCDQstGB0LXQs9C00LAg0L7RgtC60YDRi9GC0YssINC/0L7RjdGC0L7QvNGDINGDINC90LXQs9C+XHJcbiAgICAgICAgKiDQvdC10YIg0LrQvtC90YLRgNC+0LvQsCDQv9C70Y7RgS3QvNC40L3Rg9GBLiDQodGC0YDQsNC90LjRhtCwINGC0L7Qv9C40LrQsCDQt9Cw0LPRgNGD0LbQsNC10YLRgdGPINCyINC80LXRgtC+0LTQtSBzaG93RnVsbFRhbGtcclxuICAgICAgICAqINGH0LXRgNC10LcgdG9waWNJZCDQutC+0YLQvtGA0YvQuSDQv9C10YDQtdC00LDQtdGC0YHRjyDQsiDRhNGD0L3QutGG0LjRjiDQv9GA0Lgg0LLRi9C30L7QstC1XHJcbiAgICAgICAgKiDQpdGA0LDQvdC40YLRgdGPINCyINC+0LHRitC10LrRgtC1IHRhbGsuZnVsbFRhbGtUb3BpYy5cclxuICAgICAgICAqXHJcbiAgICAgICAgKiAyKSDQodC+0L7QsdGJ0LXQvdC40LUg0L/QtdGA0LLQvtCz0L4g0YPRgNC+0LLQvdGPLiDQkdC10YDRg9GC0YHRjyDRh9C10YDQtdC3IGdldEZpcnN0TGV2ZWxNZXNzYWdlcy4g0JjQt9C90LDRh9Cw0LvRjNC90L5cclxuICAgICAgICAqINCy0YHQtSDQv9C+0YLQvtC80LrQuCDRgdC60YDRi9GC0Ysg0Lgg0L3QtSDQv9C+0LTQs9GA0YPQttC10L3Riy4g0J/RgNC4INC/0LXRgNCy0L7QvCDQvdCw0LbQsNGC0LjQuCDQvdCwINC60L7QvdGC0YDQvtC7INC/0LvRjtGBLdC80LjQvdGD0YFcclxuICAgICAgICAqINC/0L7QtNCz0YDRg9C20LDRjtGC0YHRjywg0L/QvtGC0L7QvCDQv9GA0L7RgdGC0L4g0L/QtdGA0LXQutC70Y7Rh9Cw0LXRgtGB0Y8gc2hvdy1oaWRlLiBQYXJlbnRJZCDRgyDRgtCw0LrQuNGFINGB0L7QvtCx0YnQtdC90LjQuVxyXG4gICAgICAgICog0YDQsNCy0LXQvSAwLiDQktC90LjQvNCw0L3QuNC1ISA6IFBhcmVudElkINC/0LXRgNC10LTQsNC10YLRgdGPINCyIGdldEZpcnN0TGV2ZWxNZXNzYWdlcyDRh9C10YDQtdC3IGxhc3RMb2FkZWRJZC4gICAgICAgICpcclxuICAgICAgICAqINCjINC60LDQttC00L7Qs9C+INGB0L7QvtCx0YnQtdC90LjRjyDQv9C10YDQstC+0LPQviDRg9GA0L7QstC90Y8g0LXRgdGC0Ywg0YHQstC+0Lkg0LzQsNGB0YHQuNCyINGB0L7QvtCx0YnQtdC90LjQuSAz0LPQviDRgtC40L/QsC5cclxuICAgICAgICAqINCl0YDQsNC90Y/RgtGB0Y8g0LIg0LzQsNGB0YHQuNCy0LUgdGFsay5mdWxsVGFsa0ZpcnN0TWVzc2FnZXMuXHJcbiAgICAgICAgKlxyXG4gICAgICAgICogMykg0J/RgNC+0YHRgtC+INGB0L7QvtCx0YnQtdC90LjQtS4g0JHQtdGA0LXRg9GC0YHRjyDRh9C10YDQtdC3IGdldE1lc3NhZ2VzKCkuINCn0LXRgNC10Lcg0L/QsNGA0LDQvNC10YLRgCBsYXN0TG9hZGVkSWQg0L/QtdGA0LXQtNCw0LXRgtGB0Y9cclxuICAgICAgICAqIGlkINC/0L7RgdC70LXQtNC90LXQs9C+INC30LDQs9GA0YPQttC10L3QvdC+0LPQviDQv9GA0L7RgdGC0L7Qs9C+INGB0L7QvtCx0YnQtdC90LjRjywg0LTQu9GPINC/0L7QtNCz0YDRg9C30LrQuC4g0KMg0LrQsNC20LTQvtCz0L4g0L/RgNC+0YHRgtC+0LPQviDRgdC+0L7QsdGJ0LXQvdC40Y9cclxuICAgICAgICAqINC10YHRgtGMIG9mZnNldCwg0LrQvtGC0L7RgNGL0Lkg0LfQsNC00LDQtdGC0YHRjyDQvdCwINCR0JUuIG9mZnNldCfRiyDQvtC/0YDQtdC00LXQu9GP0Y7RgiDQstC70L7QttC10L3QvdC+0YHRgtGMINGB0L7QvtCx0YnQtdC90LjQuSDQuCDQt9CwINGB0YfQtdGCINC90LjRhVxyXG4gICAgICAgICog0YHQvtC30LTQsNC10YLRgdGPINC00YDQtdCy0L7QstC40LTQvdCw0Y8g0YHRgtGA0YPQutGC0YPRgNCwINGE0L7RgNGD0LzQsC5cclxuICAgICAgICAqINCl0YDQsNC90Y/RgtGB0Y8g0LIg0LTQstGD0LzQtdGA0L3QvtC8INC80LDRgdGB0LjQstC1IHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW11cclxuICAgICAgICAqXHJcbiAgICAgICAgKlxyXG4gICAgICAgICog0JXRgdGC0Ywg0YHQu9C10LTRg9GO0YnQuNC1INGC0LjQv9GLINC60L7QvdGC0YDQvtC70L7Qsiwg0YDQtdCw0LvQuNC30L7QstCw0L3QvdGL0LUg0LTQu9GPINGA0LDQt9C90YvRhSDRgtC40L/QvtCyINGB0L7QvtCx0YnQtdC90LjQuTpcclxuICAgICAgICAqIDEpIHNob3dBbnN3ZXJJbnB1dCA6INGA0LXQsNC70LjQt9GD0LXRgiDQutC70LjQuiDQvdCwIFwi0J7RgtCy0LXRgtC40YLRjFwiLCDQv9C+0LrQsNC30LLQsNC10YIg0L/QvtC70LUg0LTQu9GPINC+0YLQv9GA0LDQstC60LhcclxuICAgICAgICAqINGB0L7QvtCx0YnQtdC90LjRjy5cclxuICAgICAgICAqIDIpIGFkZE1lc3NhZ2U6INC60LvQuNC6INC90LAgXCLQntGC0L/RgNCw0LLQuNGC0YxcIiwg0YHQvtC30LTQsNC10YIg0Lgg0L7RgtC+0LHRgNCw0LbQsNC10YIg0L3QvtCy0L7QtSDRgdC+0L7QsdGJ0LXQvdC40LVcclxuICAgICAgICAqIDMpIHRvZ2dsZVRyZWU6INC60L7QvdGC0YDQvtC7IFwi0L/Qu9GO0YEt0LzQuNC90YPRgVwiLCDRgdC60YDQstCw0LXRgi3Qv9C+0LrQsNC30LLQsNC10YIg0LLQvdGD0YLRgNC10L3QvdC40LUg0YHQvtC+0LHRidC10L3QuNGPINGN0YLQvtCz0L5cclxuICAgICAgICAqINGB0L7QvtCx0YnQtdC90LjRjy5cclxuICAgICAgICAqICovXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuc2V0VGFiKDIpO1xyXG4gICAgICAgICAgICB2YXIgdGFsayA9IHRoaXM7XHJcblxyXG4gICAgICAgICAgICB0YWxrLmF0dGFjaElkID0gXCIwMFwiO1xyXG4gICAgICAgICAgICAkYy5pbml0RmFuY3lCb3goJCgnLnRhbGtzJykpO1xyXG5cclxuICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLnNob3dBbGxHcm91cHMoKTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmlzRm9vdGVyQm90dG9tID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UuY3JlYXRlVG9waWNJc0hpZGUgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgdGFsay5pc1RhbGtzTG9hZGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRhbGsuZ3JvdXBzID0gJGMudXNlckNsaWVudEdyb3VwcztcclxuXHJcbiAgICAgICAgICAgIHRhbGsubWVzc2FnZSA9IHt9O1xyXG4gICAgICAgICAgICB0YWxrLm1lc3NhZ2UuY29udGVudCA9IHRhbGsubWVzc2FnZS5kZWZhdWx0ID0gJGMuVEVYVF9ERUZBVUxUXzM7XHJcbiAgICAgICAgICAgIHRhbGsuc3ViamVjdCA9ICRjLlRFWFRfREVGQVVMVF80O1xyXG5cclxuICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmJ1ZmZlclNlbGVjdGVkR3JvdXAgPSB0YWxrLnNlbGVjdGVkR3JvdXAgPVxyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRHcm91cCA9ICRjLnVzZXJDbGllbnRHcm91cHNbM107XHJcblxyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRSdWJyaWMgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmluaXRTdGFydFBhcmFtc0ZvckNyZWF0ZVRvcGljKHRhbGspO1xyXG5cclxuICAgICAgICAgICAgdGFsay5pc1RhbGsgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgdGFsay5mdWxsVGFsa1RvcGljID0ge307XHJcbiAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtUb3BpYy5hbnN3ZXJJbnB1dElzU2hvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0YWxrLmZ1bGxUYWxrTWVzc2FnZXMgPSBbXTtcclxuICAgICAgICAgICAgdGFsay5mdWxsVGFsa0ZpcnN0TWVzc2FnZXMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIHRhbGsuY29tbWVudFRleHQgPSAkYy5URVhUX0RFRkFVTFRfMjtcclxuICAgICAgICAgICAgdmFyIGZ1bGxUYWxrRmlyc3RNZXNzYWdlc0xlbmd0aCxcclxuICAgICAgICAgICAgICAgIHRhbGtJZDtcclxuXHJcbiAgICAgICAgICAgIC8qaWYoISRyb290U2NvcGUuaW1wb3J0YW50SXNMb2FkZWRGcm9tVG9wKVxyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmltcG9ydGFudFRvcGljcyA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0SW1wb3J0YW50TmV3cygkcm9vdFNjb3BlLmN1cnJlbnRHcm91cC5pZCk7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuaW1wb3J0YW50SXNMb2FkZWRGcm9tVG9wID0gZmFsc2U7Ki9cclxuXHJcbiAgICAgICAgICAgIHRhbGsudG9waWNzID0gJGMubWVzc2FnZUNsaWVudC5nZXRUb3BpY3ModGFsay5zZWxlY3RlZEdyb3VwLmlkLCAwLCAwLCAwLCAxMDAwKS50b3BpY3M7XHJcblxyXG4gICAgICAgICAgICBpbml0VGFsa3MoKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghdGFsay50b3BpY3MpIHRhbGsudG9waWNzID0gW107XHJcblxyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLnNlbGVjdEdyb3VwSW5Ecm9wZG93bl90YWxrcyA9IGZ1bmN0aW9uKGdyb3VwSWQpe1xyXG4gICAgICAgICAgICAgICAgdGFsay5zZWxlY3RlZEdyb3VwID0gJHJvb3RTY29wZS5iYXNlLmJ1ZmZlclNlbGVjdGVkR3JvdXAgPSAkYy5zZWxlY3RHcm91cEluRHJvcGRvd24oZ3JvdXBJZCk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGluaXRUYWxrcygpe1xyXG4gICAgICAgICAgICB2YXIgdG9waWNMZW5ndGg7XHJcbiAgICAgICAgICAgIHRhbGsudG9waWNzID8gdG9waWNMZW5ndGggPSB0YWxrLnRvcGljcy5sZW5ndGggOiB0b3BpY0xlbmd0aCA9IDA7XHJcblxyXG4gICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgdG9waWNMZW5ndGg7aSsrKXtcclxuICAgICAgICAgICAgICAgIHRhbGsudG9waWNzW2ldLmxhc3RVcGRhdGVFZGl0ID0gJGMuZ2V0VGltaW5nKHRhbGsudG9waWNzW2ldLmxhc3RVcGRhdGUpO1xyXG4gICAgICAgICAgICAgICAgdGFsay50b3BpY3NbaV0ubGFiZWwgPSAkYy5nZXRMYWJlbCh0YWxrLmdyb3Vwcyx0YWxrLnRvcGljc1tpXS5ncm91cFR5cGUpO1xyXG4gICAgICAgICAgICAgICAgdGFsay50b3BpY3NbaV0udGFnQ29sb3IgPSAkYy5nZXRUYWdDb2xvcih0YWxrLnRvcGljc1tpXS5sYWJlbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYodGFsay50b3BpY3NbaV0ubWVzc2FnZS5pbXBvcnRhbnQgPT0gMSl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFsay50b3BpY3NbaV0ubWVzc2FnZS5pbXBvcnRhbnRUZXh0ID0gJ9Ch0L3Rj9GC0Ywg0LzQtdGC0LrRgyBcItCS0LDQttC90L7QtVwiJztcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIHRhbGsudG9waWNzW2ldLm1lc3NhZ2UuaW1wb3J0YW50VGV4dCA9ICfQn9C+0LzQtdGC0LjRgtGMINC60LDQuiBcItCS0LDQttC90L7QtVwiJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS50YWxrc0NoYW5nZUdyb3VwID0gZnVuY3Rpb24oZ3JvdXBJZCl7XHJcblxyXG4gICAgICAgICAgICB0YWxrLnRvcGljcyA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0VG9waWNzKGdyb3VwSWQsMCwwLDAsMTAwMCkudG9waWNzO1xyXG5cclxuICAgICAgICAgICAgaWYodGFsay50b3BpY3MpIHtcclxuICAgICAgICAgICAgICAgIGluaXRUYWxrcygpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgdGFsay5zZWxSdWJyaWNOYW1lID0gXCLQntCx0YnQtdC1XCI7XHJcbiAgICB0YWxrLnNlbGVjdFJ1YnJpY05ldyA9IGZ1bmN0aW9uKHJ1YnJpYyl7XHJcbiAgICAgICAgaWYocnVicmljKSB7XHJcbiAgICAgICAgICAgIHRhbGsuc2VsUnVicmljTmFtZSA9IHJ1YnJpYy52aXNpYmxlTmFtZTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgdGFsay5zZWxSdWJyaWNOYW1lID0gXCLQntCx0YnQtdC1XCI7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFJ1YnJpYyA9IHt9O1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRSdWJyaWMuaWQgPSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHJ1YnJpY3NMZW5ndGggPSAkYy51c2VyQ2xpZW50UnVicmljcy5sZW5ndGg7XHJcblxyXG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBydWJyaWNzTGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICBpZihydWJyaWMuaWQgPT0gJGMudXNlckNsaWVudFJ1YnJpY3NbaV0uaWQpe1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50UnVicmljID0gJGMudXNlckNsaWVudFJ1YnJpY3NbaV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICAgICAgJCgnLm5nLWNsb2FrJykucmVtb3ZlQ2xhc3MoJ25nLWNsb2FrJyk7XHJcblxyXG4gICAgfTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gWyAnJHJvb3RTY29wZScsJyRjJywgdGFsa3NDdHJsIF07IiwiXHJcbnZhciB0YWxrc1NpbmdsZUN0cmwgPSBmdW5jdGlvbigkcm9vdFNjb3BlLCRzdGF0ZVBhcmFtcywkYyl7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5pc0Zvb3RlckJvdHRvbSA9IGZhbHNlO1xyXG5cclxuICAgICAgICB2YXIgdGFsayA9IHRoaXMsXHJcbiAgICAgICAgICAgIGZ1bGxUYWxrTWVzc2FnZXNMZW5ndGgsXHJcbiAgICAgICAgICAgIHRhbGtJZCA9ICRzdGF0ZVBhcmFtcy50YWxrSWQ7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5sYXN0TG9hZGVkSWQgPSAwO1xyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5pc0VhcmxpZXN0TWVzc2FnZXMgPSBmYWxzZTtcclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UuZW5kT2ZMb2FkZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgdGFsay5hdHRhY2hJZCA9IFwiMDBcIjtcclxuICAgICAgICB0YWxrLnNlbGVjdGVkR3JvdXAgPSAkYy5nZXREZWZhdWx0R3JvdXAoJHJvb3RTY29wZS5iYXNlLmdyb3Vwcyk7Ly8kcm9vdFNjb3BlLmN1cnJlbnRHcm91cDtcclxuXHJcbiAgICAgICAgLyppZighJHJvb3RTY29wZS5pbXBvcnRhbnRJc0xvYWRlZEZyb21Ub3ApXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuaW1wb3J0YW50VG9waWNzID0gJGMubWVzc2FnZUNsaWVudC5nZXRJbXBvcnRhbnROZXdzKCRyb290U2NvcGUuY3VycmVudEdyb3VwLmlkKTtcclxuICAgICAgICAkcm9vdFNjb3BlLmltcG9ydGFudElzTG9hZGVkRnJvbVRvcCA9IGZhbHNlOyovXHJcblxyXG4gICAgLy9jb25zb2xlLmxvZygnMCcsdGFsay5zZWxlY3RlZEdyb3VwLCRjLmdldERlZmF1bHRHcm91cCgkcm9vdFNjb3BlLmJhc2UuZ3JvdXBzKSk7XHJcbiAgICAgICAgdGFsay50b3BpY3MgPSAkYy5tZXNzYWdlQ2xpZW50LmdldFRvcGljcyh0YWxrLnNlbGVjdGVkR3JvdXAuaWQsIDAsIDAsIDAsIDEwMDApLnRvcGljcztcclxuICAgICAgICB0YWxrLmZ1bGxUYWxrVG9waWMgPSB7fTtcclxuICAgICAgICB0YWxrLmZ1bGxUYWxrTWVzc2FnZXMgPSB7fTtcclxuICAgICAgICB0YWxrLmZ1bGxUYWxrRmlyc3RNZXNzYWdlcyA9IFtdO1xyXG4gICAgICAgIHRhbGsuZ3JvdXBzID0gJGMudXNlckNsaWVudEdyb3VwcztcclxuXHJcbiAgICAgICAgdGFsay5pc1RhbGsgPSB0cnVlO1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UuaW5pdFN0YXJ0UGFyYW1zRm9yQ3JlYXRlTWVzc2FnZSh0YWxrKTtcclxuXHJcbiAgICAgICAgdmFyIHNob3dGdWxsVGFsayA9IGZ1bmN0aW9uKHRhbGssdGFsa091dHNpZGVJZCl7XHJcblxyXG4gICAgICAgICAgICAkYy5pbml0RmFuY3lCb3goJCgnLnRhbGtzLXNpbmdsZScpKTtcclxuICAgICAgICAgICAgdmFyIHRvcGljTGVuZ3RoO1xyXG4gICAgICAgICAgICB0YWxrLnRvcGljcyA/IHRvcGljTGVuZ3RoID0gdGFsay50b3BpY3MubGVuZ3RoIDogdG9waWNMZW5ndGggPSAwO1xyXG5cclxuICAgICAgICAgICAgdmFyIHRhbGtJZCA9IHRhbGtPdXRzaWRlSWQ7XHJcbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB0b3BpY0xlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgICAgIGlmKHRhbGtJZCA9PSB0YWxrLnRvcGljc1tpXS5pZCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa1RvcGljID0gdGFsay50b3BpY3NbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa1RvcGljLnJ1YnJpYyA9ICRjLmdldFRvcGljUnVicmljKHRhbGsuZnVsbFRhbGtUb3BpYyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoIXRhbGsuZnVsbFRhbGtUb3BpYy5ydWJyaWMpIHRhbGsuZnVsbFRhbGtUb3BpYy5zZWxSdWJyaWNOYW1lID0gXCLQntCx0YnQtdC1XCI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtUb3BpYy5zZWxlY3RSdWJyaWNOZXcgPSBmdW5jdGlvbihydWJyaWMpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihydWJyaWMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtUb3BpYy5zZWxSdWJyaWNOYW1lID0gcnVicmljLnZpc2libGVOYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtUb3BpYy5zZWxSdWJyaWNOYW1lID0gXCLQntCx0YnQtdC1XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRSdWJyaWMgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFJ1YnJpYy5pZCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJ1YnJpY3NMZW5ndGggPSAkYy51c2VyQ2xpZW50UnVicmljcy5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgcnVicmljc0xlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJ1YnJpYy5pZCA9PSAkYy51c2VyQ2xpZW50UnVicmljc1tpXS5pZCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50UnVicmljID0gJGMudXNlckNsaWVudFJ1YnJpY3NbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd0YWxrLXNpbmdsZScsJHJvb3RTY29wZS5jdXJyZW50UnVicmljKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmluaXRTdGFydFBhcmFtc0ZvckNyZWF0ZVRvcGljKHRhbGsuZnVsbFRhbGtUb3BpYyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtUb3BpYy5pc1RhbGsgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtUb3BpYy5tZXNzYWdlLmNyZWF0ZWRFZGl0ID0gJGMuZ2V0VGltaW5nKHRhbGsuZnVsbFRhbGtUb3BpYy5tZXNzYWdlLmNyZWF0ZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtUb3BpYy5sYWJlbCA9ICRjLmdldExhYmVsKHRhbGsuZ3JvdXBzLHRhbGsuZnVsbFRhbGtUb3BpYy5ncm91cFR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtUb3BpYy50YWdDb2xvciA9ICRjLmdldFRhZ0NvbG9yKHRhbGsuZnVsbFRhbGtUb3BpYy5sYWJlbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKHRhbGsuZnVsbFRhbGtUb3BpYy5tZXNzYWdlLmltcG9ydGFudCA9PSAxKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa1RvcGljLm1lc3NhZ2UuaW1wb3J0YW50VGV4dCA9ICfQodC90Y/RgtGMINC80LXRgtC60YMgXCLQktCw0LbQvdC+0LVcIic7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtUb3BpYy5tZXNzYWdlLmltcG9ydGFudFRleHQgPSAn0J/QvtC80LXRgtC40YLRjCDQutCw0LogXCLQktCw0LbQvdC+0LVcIic7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGFsay5mdWxsVGFsa1RvcGljLnBvbGwgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgJGMuc2V0UG9sbEVkaXROYW1lcyh0YWxrLmZ1bGxUYWxrVG9waWMucG9sbCk7XHJcbiAgICAgICAgICAgICAgICB0YWxrLmZ1bGxUYWxrVG9waWMubWV0YVR5cGUgPSBcInBvbGxcIjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtUb3BpYy5tZXRhVHlwZSA9IFwibWVzc2FnZVwiO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0YWxrLmZ1bGxUYWxrRmlyc3RNZXNzYWdlcyA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0Rmlyc3RMZXZlbE1lc3NhZ2VzKHRhbGtJZCwgdGFsay5zZWxlY3RlZEdyb3VwLmlkLCAxLCAkcm9vdFNjb3BlLmJhc2UubGFzdExvYWRlZElkLCAwLCAxMCkubWVzc2FnZXM7XHJcblxyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UubGFzdExvYWRlZElkID0gJHJvb3RTY29wZS5iYXNlLmluaXRGaXJzdE1lc3NhZ2VzKHRhbGsuZnVsbFRhbGtGaXJzdE1lc3NhZ2VzKTtcclxuXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5pc1RhbGtUaXRsZXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLm1haW5Db250ZW50VG9wSXNIaWRlID0gdHJ1ZTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmNyZWF0ZVRvcGljSXNIaWRlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgc2hvd0Z1bGxUYWxrKHRhbGssdGFsa0lkKTtcclxuXHJcbiAgICAgICAgdmFyIGluaXRGbGFnc1RvcGljID0gW107XHJcbiAgICAgICAgdGFsay5zaG93VG9waWNBbnN3ZXJJbnB1dCA9IGZ1bmN0aW9uKGV2ZW50LGZ1bGxUYWxrVG9waWMpe1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgdGFsay5hbnN3ZXJTaG93ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIGlmKCFpbml0RmxhZ3NUb3BpY1tmdWxsVGFsa1RvcGljLmlkXSkge1xyXG4gICAgICAgICAgICAgICAgaW5pdEZsYWdzVG9waWNbZnVsbFRhbGtUb3BpYy5pZF0gPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0YWxrLmZ1bGxUYWxrVG9waWMuYW5zd2VySW5wdXRJc1Nob3cgP1xyXG4gICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa1RvcGljLmFuc3dlcklucHV0SXNTaG93ID0gZmFsc2UgOlxyXG4gICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa1RvcGljLmFuc3dlcklucHV0SXNTaG93ID0gdHJ1ZSA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGluaXRGbGFnc01lc3NhZ2UgPSBbXTtcclxuICAgICAgICB0YWxrLnNob3dNZXNzYWdlQW5zd2VySW5wdXQgPSBmdW5jdGlvbihldmVudCxmdWxsVGFsa1RvcGljLGZpcnN0TWVzc2FnZSxtZXNzYWdlKXtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgdmFyIGF0dGFjaElkO1xyXG5cclxuICAgICAgICAgICAgaWYoIW1lc3NhZ2Upe1xyXG4gICAgICAgICAgICAgICAgLy8g0LXRgdC70Lgg0Y3RgtC+INGB0L7QvtCx0YnQtdC90LjQtSDQv9C10YDQstC+0LPQviDRg9GA0L7QstC90Y9cclxuICAgICAgICAgICAgICAgIGZpcnN0TWVzc2FnZS5pc1RhbGsgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy9maXJzdE1lc3NhZ2UuaXNFZGl0ID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgYXR0YWNoSWQgPSBmdWxsVGFsa1RvcGljLmlkKyctJytmaXJzdE1lc3NhZ2UuaWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYoIXRhbGsuZnVsbFRhbGtGaXJzdE1lc3NhZ2VzKSB0YWxrLmZ1bGxUYWxrRmlyc3RNZXNzYWdlcyA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0Rmlyc3RMZXZlbE1lc3NhZ2VzKHRhbGtJZCx0YWxrLnNlbGVjdGVkR3JvdXAuaWQsMSwwLDAsMTAwMCkubWVzc2FnZXM7XHJcbiAgICAgICAgICAgICAgICB2YXIgZnVsbFRhbGtGaXJzdE1lc3NhZ2VzTGVuZ3RoID0gdGFsay5mdWxsVGFsa0ZpcnN0TWVzc2FnZXMubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5pbml0U3RhcnRQYXJhbXNGb3JDcmVhdGVNZXNzYWdlKGZpcnN0TWVzc2FnZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZmlyc3RNZXNzYWdlLmFuc3dlcklucHV0SXNTaG93ID9cclxuICAgICAgICAgICAgICAgICAgICBmaXJzdE1lc3NhZ2UuYW5zd2VySW5wdXRJc1Nob3cgPSBmYWxzZSA6XHJcbiAgICAgICAgICAgICAgICAgICAgZmlyc3RNZXNzYWdlLmFuc3dlcklucHV0SXNTaG93ID0gdHJ1ZTtcclxuXHJcblxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIC8vINC10YHQu9C4INC/0YDQvtGB0YLQvtC1INGB0L7QvtCx0YnQtdC90LjQtVxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZS5pc1RhbGsgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy9tZXNzYWdlLmlzRWRpdCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIGF0dGFjaElkID0gZnVsbFRhbGtUb3BpYy5pZCsnLScrbWVzc2FnZS5pZDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZighdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF0pIHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdID0gJGMubWVzc2FnZUNsaWVudC5nZXRNZXNzYWdlcyh0YWxrSWQsdGFsay5zZWxlY3RlZEdyb3VwLmlkLDEsZmlyc3RNZXNzYWdlLmlkLDAsMTAwMCkubWVzc2FnZXM7XHJcbiAgICAgICAgICAgICAgICB2YXIgIGZ1bGxUYWxrTWVzc2FnZXNMZW5ndGggPSB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXS5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmluaXRTdGFydFBhcmFtc0ZvckNyZWF0ZU1lc3NhZ2UobWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLmFuc3dlcklucHV0SXNTaG93ID9cclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmFuc3dlcklucHV0SXNTaG93ID0gZmFsc2UgOlxyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuYW5zd2VySW5wdXRJc1Nob3cgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYoIWluaXRGbGFnc01lc3NhZ2VbYXR0YWNoSWRdKSB7XHJcbiAgICAgICAgICAgICAgICAvL2luaXRBdHRhY2hJbWFnZSgkKCcjYXR0YWNoSW1hZ2UtJyArIGF0dGFjaElkKSwgJCgnI2F0dGFjaC1hcmVhLScgKyBhdHRhY2hJZCkpO1xyXG4gICAgICAgICAgICAgICAgLy9pbml0QXR0YWNoRG9jKCQoJyNhdHRhY2hEb2MtJyArIGF0dGFjaElkKSwgJCgnI2F0dGFjaC1kb2MtYXJlYS0nICsgYXR0YWNoSWQpKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpbml0RmxhZ3NNZXNzYWdlW2F0dGFjaElkXSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0YWxrLnRvZ2dsZVRyZWVGaXJzdE1lc3NhZ2UgPSBmdW5jdGlvbihldmVudCxmaXJzdE1lc3NhZ2Upe1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgZmlyc3RNZXNzYWdlLmlzVHJlZU9wZW4gP1xyXG4gICAgICAgICAgICAgICAgZmlyc3RNZXNzYWdlLmlzVHJlZU9wZW4gPSBmYWxzZSA6XHJcbiAgICAgICAgICAgICAgICBmaXJzdE1lc3NhZ2UuaXNUcmVlT3BlbiA9IHRydWUgO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vIC0tLS0tLS0tXHJcblxyXG4gICAgICAgICAgICB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXSA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0TWVzc2FnZXModGFsa0lkLHRhbGsuc2VsZWN0ZWRHcm91cC5pZCwxLGZpcnN0TWVzc2FnZS5pZCwwLDEwMDApLm1lc3NhZ2VzO1xyXG4gICAgICAgICAgICB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXSA/XHJcbiAgICAgICAgICAgICAgICBmdWxsVGFsa01lc3NhZ2VzTGVuZ3RoID0gdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF0ubGVuZ3RoOlxyXG4gICAgICAgICAgICAgICAgZnVsbFRhbGtNZXNzYWdlc0xlbmd0aCA9IDA7XHJcbiAgICAgICAgICAgIGlmKHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdID09PSBudWxsKSB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGZ1bGxUYWxrTWVzc2FnZXNMZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXVtpXS5hbnN3ZXJJbnB1dElzU2hvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uaXNUcmVlT3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXVtpXS5pc09wZW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uaXNQYXJlbnRPcGVuID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmNyZWF0ZWRFZGl0ID0gJGMuZ2V0VGltaW5nKHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmNyZWF0ZWQpO1xyXG4gICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uY29tbWVudFRleHQgPSAkYy5URVhUX0RFRkFVTFRfMjtcclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGFsay50b2dnbGVUcmVlID0gZnVuY3Rpb24oZXZlbnQsbWVzc2FnZSxmaXJzdE1lc3NhZ2Upe1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgaWYoIXRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdKSB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXSA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0TWVzc2FnZXModGFsa0lkLHRhbGsuc2VsZWN0ZWRHcm91cC5pZCwxLGZpcnN0TWVzc2FnZS5pZCwwLDEwMDApLm1lc3NhZ2VzO1xyXG4gICAgICAgICAgICB2YXIgZnVsbFRhbGtNZXNzYWdlc0xlbmd0aCA9IHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIG1lc3NhZ2UuaXNUcmVlT3BlbiA/XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLmlzVHJlZU9wZW4gPSBmYWxzZSA6XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLmlzVHJlZU9wZW4gPSB0cnVlIDtcclxuXHJcbiAgICAgICAgICAgIHZhciBhZnRlckN1cnJlbnRJbmRleCA9IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbmV4dE1lc3NhZ2VPbkN1cnJlbnRMZXZlbCA9IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbG9vcE1lc3NhZ2VPZmZzZXQsXHJcbiAgICAgICAgICAgICAgICBwYXJlbnRPcGVuU3RhdHVzLFxyXG4gICAgICAgICAgICAgICAgYXJlQWxsTXlQYXJlbnRzVHJlZU9wZW4gPSBbXSxcclxuICAgICAgICAgICAgICAgIGNoZWNrQXJlQWxsTXlQYXJlbnRzVHJlZU9wZW4gPSB0cnVlLFxyXG4gICAgICAgICAgICAgICAgYmVnaW5PZmZzZXQgPSBtZXNzYWdlLm9mZnNldCxcclxuICAgICAgICAgICAgICAgIHBhcmVudE9wZW5TdGF0dXNBcnJheSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGZ1bGxUYWxrTWVzc2FnZXNMZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICBsb29wTWVzc2FnZU9mZnNldCA9IHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLm9mZnNldDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZihhZnRlckN1cnJlbnRJbmRleCAmJiAhbmV4dE1lc3NhZ2VPbkN1cnJlbnRMZXZlbFxyXG4gICAgICAgICAgICAgICAgICAgICYmIG1lc3NhZ2Uub2Zmc2V0IDwgbG9vcE1lc3NhZ2VPZmZzZXQpe1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBhcmVBbGxNeVBhcmVudHNUcmVlT3Blbltsb29wTWVzc2FnZU9mZnNldF0gPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZihsb29wTWVzc2FnZU9mZnNldCAtIG1lc3NhZ2Uub2Zmc2V0ID09IDEpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL9C10YHQu9C4INGN0YLQviDQvdC10L/QvtGB0YDQtdC00YHRgtCy0LXQvdC90YvQuSDQv9C+0YLQvtC80L7QulxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uaXNPcGVuID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmlzT3BlbiA9IGZhbHNlIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmlzT3BlbiA9IHRydWUgO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50T3BlblN0YXR1c0FycmF5W2xvb3BNZXNzYWdlT2Zmc2V0XSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudE9wZW5TdGF0dXMgPSB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXVtpXS5pc09wZW47XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmlzVHJlZU9wZW4pe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJlQWxsTXlQYXJlbnRzVHJlZU9wZW5bbG9vcE1lc3NhZ2VPZmZzZXRdID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g0LXRgdC70Lgg0Y3RgtC+INC/0YLQvtC80LrQuCDQv9C+0YLQvtC80LrQsFxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tBcmVBbGxNeVBhcmVudHNUcmVlT3BlbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaiA9IGJlZ2luT2Zmc2V0OyBqIDwgbG9vcE1lc3NhZ2VPZmZzZXQ7IGorKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQv9GA0L7QstC10YDRj9C10Lwg0L3QtdGCINC70Lgg0YMg0LrQvtCz0L4g0LIg0L/RgNC10LTQutCw0YUgaXNUcmVlT3BlbiA9IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhcmVBbGxNeVBhcmVudHNUcmVlT3BlbltqXSA9PSBmYWxzZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tBcmVBbGxNeVBhcmVudHNUcmVlT3BlbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudE9wZW5TdGF0dXMgJiYgY2hlY2tBcmVBbGxNeVBhcmVudHNUcmVlT3BlbiA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWxrLmZ1bGxUYWxrTWVzc2FnZXNbZmlyc3RNZXNzYWdlLmlkXVtpXS5pc09wZW4gPSB0cnVlIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhbGsuZnVsbFRhbGtNZXNzYWdlc1tmaXJzdE1lc3NhZ2UuaWRdW2ldLmlzT3BlbiA9IGZhbHNlIDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uaXNUcmVlT3Blbil7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQtdGB0LvQuCDRgyDQutC+0LPQvi3RgtC+INC40Lcg0L/RgNC10LTQutC+0LIg0L3QtSDQvtGC0LrRgNGL0YLQviDQtNC10YDQtdCy0L5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZUFsbE15UGFyZW50c1RyZWVPcGVuW2xvb3BNZXNzYWdlT2Zmc2V0XSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRPcGVuU3RhdHVzQXJyYXlbbG9vcE1lc3NhZ2VPZmZzZXRdID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGFmdGVyQ3VycmVudEluZGV4ICYmIGxvb3BNZXNzYWdlT2Zmc2V0ID09IG1lc3NhZ2Uub2Zmc2V0KXtcclxuICAgICAgICAgICAgICAgICAgICBuZXh0TWVzc2FnZU9uQ3VycmVudExldmVsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKG1lc3NhZ2UuaWQgPT0gdGFsay5mdWxsVGFsa01lc3NhZ2VzW2ZpcnN0TWVzc2FnZS5pZF1baV0uaWQpe1xyXG4gICAgICAgICAgICAgICAgICAgIGFmdGVyQ3VycmVudEluZGV4ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBidWZmLFxyXG4gICAgICAgICAgICBsYXN0TG9hZGVkSWRGRjtcclxuICAgICAgICB0YWxrLmFkZE1vcmVJdGVtcyA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHZhciB0ZW1wID0gJGMubWVzc2FnZUNsaWVudC5nZXRGaXJzdExldmVsTWVzc2FnZXModGFsa0lkLHRhbGsuc2VsZWN0ZWRHcm91cC5pZCwxLCRyb290U2NvcGUuYmFzZS5sYXN0TG9hZGVkSWQsMCwxMCksXHJcbiAgICAgICAgICAgICAgICBidWZmID0gdGVtcC5tZXNzYWdlcztcclxuICAgICAgICAgICAgaWYoYnVmZikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJ1ZmZMZW5ndGggPSBidWZmLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZihidWZmTGVuZ3RoICE9IDApIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmxhc3RMb2FkZWRJZCA9IGJ1ZmZbYnVmZkxlbmd0aCAtIDFdLmlkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZihsYXN0TG9hZGVkSWRGRiAhPSAkcm9vdFNjb3BlLmJhc2UubGFzdExvYWRlZElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5pbml0Rmlyc3RNZXNzYWdlcyhidWZmKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFsay5mdWxsVGFsa0ZpcnN0TWVzc2FnZXMgPSB0YWxrLmZ1bGxUYWxrRmlyc3RNZXNzYWdlcy5jb25jYXQoYnVmZik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBsYXN0TG9hZGVkSWRGRiA9ICRyb290U2NvcGUuYmFzZS5sYXN0TG9hZGVkSWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuYmFzZS5lbmRPZkxvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgICQoJy5uZy1jbG9haycpLnJlbW92ZUNsYXNzKCduZy1jbG9haycpO1xyXG5cclxuICAgIH07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFsgJyRyb290U2NvcGUnLCckc3RhdGVQYXJhbXMnLCckYycsIHRhbGtzU2luZ2xlQ3RybCBdOyIsIlxyXG52YXIgdW5jb25maXJtZWRDdHJsID0gIGZ1bmN0aW9uKCRyb290U2NvcGUsJGMpIHtcclxuICAgICRyb290U2NvcGUuYmFzZS5pc0Zvb3RlckJvdHRvbSA9IHRydWU7XHJcbiAgICAkcm9vdFNjb3BlLmJhc2UubWFpbkNvbnRlbnRUb3BJc0hpZGUgPSB0cnVlO1xyXG4gICAgJHJvb3RTY29wZS5iYXNlLmhpZGVTaWRlYmFyID0gdHJ1ZTtcclxuXHJcbiAgICB2YXIgY3RybCA9IHRoaXM7XHJcbiAgICBjdHJsLnVzZXIgPSAkYy51c2VyQ2xpZW50LmdldFNob3J0VXNlckluZm8oKTtcclxuICAgIGN0cmwuaXNFcnJvckNvbmZpcm0gPSBmYWxzZTtcclxuXHJcbiAgICBjdHJsLnVuY29uZkxvZ2luID0gZnVuY3Rpb24oKXtcclxuXHJcbiAgICAgICAgdmFyIGlzQ29uZmlybSA9ICRjLnVzZXJDbGllbnQuY29uZmlybVVzZXJBZGRyZXNzKGN0cmwuY29kZSk7XHJcbiAgICAgICAgY29uc29sZS5sb2coaXNDb25maXJtKTtcclxuICAgICAgICBpZihpc0NvbmZpcm0pe1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UubWUuYWRkcmVzc0NvbmZpcm1lZCA9IHRydWU7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGN0cmwuaXNFcnJvckNvbmZpcm0gPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIuZWxlbWVudCgkKCcudW5jb25maXJtJykpLmNzcyh7J21pbi1oZWlnaHQnOiAkKHdpbmRvdykuaGVpZ2h0KCktMTA1fSk7XHJcblxyXG4gICAgJCgnLm5nLWNsb2FrJykucmVtb3ZlQ2xhc3MoJ25nLWNsb2FrJyk7XHJcblxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBbICckcm9vdFNjb3BlJywnJGMnLCB1bmNvbmZpcm1lZEN0cmwgXTsiLCJcclxudmFyIHdhbGxDdHJsID0gZnVuY3Rpb24oJHJvb3RTY29wZSwkc3RhdGUsJGMpIHtcclxuXHJcbiAgICB2YXIgbGVudGEgPSB0aGlzO1xyXG5cclxuICAgIC8qKi9cclxuXHJcbiAgICBsZW50YS5pc0dyb3Vwc0luTWVzc1Nob3cgPSBmYWxzZTtcclxuICAgIGxlbnRhLmlzUnVicmljc0luTWVzc1Nob3cgPSBmYWxzZTtcclxuICAgIGxlbnRhLmlzT3Blbk1lc3NhZ2VCYXIgPSBmYWxzZTtcclxuXHJcbiAgICBsZW50YS5zaG93R3JvdXBzID0gZnVuY3Rpb24oKXtcclxuICAgICAgICBsZW50YS5pc0dyb3Vwc0luTWVzc1Nob3cgPyBsZW50YS5pc0dyb3Vwc0luTWVzc1Nob3cgPSBmYWxzZSA6IGxlbnRhLmlzR3JvdXBzSW5NZXNzU2hvdyA9IHRydWVcclxuICAgIH07XHJcblxyXG4gICAgbGVudGEuc2VsZWN0R3JvdXBOZXcgPSBmdW5jdGlvbihncm91cCl7XHJcbiAgICAgICAgbGVudGEuaXNHcm91cHNJbk1lc3NTaG93ID0gZmFsc2U7XHJcbiAgICAgICAgbGVudGEuaXNDcmVhdGVNZXNzYWdlR3JvdXBFcnJvciA9IGZhbHNlO1xyXG5cclxuICAgICAgICAvL2xlbnRhLnNlbEdyb3VwTmFtZSA9IGdyb3VwLnZpc2libGVOYW1lO1xyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5zZWxlY3RHcm91cEluRHJvcGRvd24oZ3JvdXAuaWQsbGVudGEpO1xyXG4gICAgfTtcclxuXHJcbiAgICBsZW50YS5zaG93UnVicmljcyA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgbGVudGEuaXNSdWJyaWNzSW5NZXNzU2hvdyA/IGxlbnRhLmlzUnVicmljc0luTWVzc1Nob3cgPSBmYWxzZSA6IGxlbnRhLmlzUnVicmljc0luTWVzc1Nob3cgPSB0cnVlXHJcbiAgICB9O1xyXG5cclxuICAgIGxlbnRhLnNlbGVjdFJ1YnJpY05ldyA9IGZ1bmN0aW9uKHJ1YnJpYyxjdHJsKXtcclxuICAgICAgICBsZW50YS5pc1J1YnJpY3NJbk1lc3NTaG93ID0gZmFsc2U7XHJcbiAgICAgICAgbGVudGEuaXNDcmVhdGVNZXNzYWdlUnVicmljRXJyb3IgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgaWYocnVicmljKSB7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuc2VsUnVicmljTmFtZSA9IHJ1YnJpYy52aXNpYmxlTmFtZTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS5zZWxSdWJyaWNOYW1lID0gXCLQntCx0YnQtdC1XCI7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFJ1YnJpYyA9IHt9O1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRSdWJyaWMuaWQgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyRyb290U2NvcGUuYmFzZS5zZWxlY3RSdWJyaWNJbkRyb3Bkb3duKHJ1YnJpYy5pZCxsZW50YSk7XHJcbiAgICAgICAgdmFyIHJ1YnJpY3NMZW5ndGggPSAkYy51c2VyQ2xpZW50UnVicmljcy5sZW5ndGgsXHJcbiAgICAgICAgICAgIHNlbGVjdGVkUnVicmljO1xyXG5cclxuICAgICAgICAvL2lmKCFjdHJsLmlzRWRpdCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJ1YnJpY3NMZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJ1YnJpYy5pZCA9PSAkYy51c2VyQ2xpZW50UnVicmljc1tpXS5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFJ1YnJpYyA9ICRjLnVzZXJDbGllbnRSdWJyaWNzW2ldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgLy99XHJcblxyXG4gICAgICAgIGlmKGN0cmwpe1xyXG4gICAgICAgICAgICBydWJyaWMgPyBjdHJsLnNlbFJ1YnJpY05hbWUgPSBydWJyaWMudmlzaWJsZU5hbWUgOiBjdHJsLnNlbFJ1YnJpY05hbWUgPSBcItCe0LHRidC10LVcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vJHJvb3RTY29wZS5iYXNlLmJ1ZmZlclNlbGVjdGVkR3JvdXAgPSBzZWxlY3RHcm91cEluRHJvcGRvd24oZ3JvdXBJZCk7XHJcblxyXG4gICAgICAgIC8vY3RybC5zZWxlY3RlZEdyb3VwID0gJHJvb3RTY29wZS5iYXNlLmJ1ZmZlclNlbGVjdGVkR3JvdXA7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vJHJvb3RTY29wZS5jdXJyZW50UnVicmljLmlkID0gMDtcclxuXHJcbiAgICBsZW50YS5jbG9zZUlucHV0ID0gZnVuY3Rpb24oKXtcclxuICAgICAgICBsZW50YS5pc0NyZWF0ZU1lc3NhZ2VFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgIGxlbnRhLmlzQ3JlYXRlTWVzc2FnZUdyb3VwRXJyb3IgPSBmYWxzZTtcclxuICAgICAgICBsZW50YS5pc0NyZWF0ZU1lc3NhZ2VSdWJyaWNFcnJvciA9IGZhbHNlO1xyXG5cclxuICAgICAgICBsZW50YS5pc09wZW5NZXNzYWdlQmFyID0gZmFsc2U7XHJcbiAgICAgICAgbGVudGEuaXNHcm91cHNJbk1lc3NTaG93ID0gZmFsc2U7XHJcbiAgICAgICAgbGVudGEuaXNSdWJyaWNzSW5NZXNzU2hvdyA9IGZhbHNlO1xyXG4gICAgICAgIGxlbnRhLnNlbGVjdGVkR3JvdXAgPSBsZW50YS5zZWxHcm91cE5hbWUgPSAkcm9vdFNjb3BlLnNlbFJ1YnJpY05hbWUgPSAkcm9vdFNjb3BlLmN1cnJlbnRSdWJyaWMgPSBudWxsO1xyXG4gICAgICAgIGxlbnRhLm1lc3NhZ2UuY29udGVudCA9ICRjLlRFWFRfREVGQVVMVF8xO1xyXG4gICAgfTtcclxuXHJcbiAgICBsZW50YS5pc0NyZWF0ZU1lc3NhZ2VFcnJvciA9IHRydWU7XHJcbiAgICBsZW50YS5jcmVhdGVNZXNzYWdlRXJyb3JUZXh0ID0gXCLQktGLINC90LUg0YPQutCw0LfQsNC70Lgg0LPRgNGD0L/Qv9GDXCI7XHJcblxyXG4gICAgLyoqL1xyXG5cclxuICAgICQoJy5uZy1jbG9haycpLnJlbW92ZUNsYXNzKCduZy1jbG9haycpO1xyXG4gICAgICAgICRyb290U2NvcGUuc2V0VGFiKDEpO1xyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5zaG93QWxsR3JvdXBzKCk7XHJcbiAgICAgICAgJHJvb3RTY29wZS5iYXNlLmlzRm9vdGVyQm90dG9tID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHZhciBsYXN0TG9hZGVkSWQgPSAwLFxyXG4gICAgICAgICAgICBsb2FkZWRMZW5ndGggPSAxMDtcclxuXHJcbiAgICAgICAgdmFyIGxlbiA9ICRjLnVzZXJDbGllbnRHcm91cHMubGVuZ3RoO1xyXG4gICAgICAgIGxlbnRhLmlzQ3JlYXRlTmV3c1Nob3cgPSBbXTtcclxuICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspe1xyXG4gICAgICAgICAgICBsZW50YS5pc0NyZWF0ZU5ld3NTaG93WyRjLnVzZXJDbGllbnRHcm91cHNbaV0uaWRdID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vbGVudGEuaXNDcmVhdGVOZXdzU2hvd1tdID0gZmFsc2U7XHJcbiAgICAgICAgJHJvb3RTY29wZS5DT01NRU5UU19ERUZBVUxUX0NPVU5UID0gMztcclxuXHJcbiAgICAgICAgdmFyIGxzX3NldEluZm9fZ3JvdXBJZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdWT19zZXRJbmZvX2dyb3VwSWQnKSxcclxuICAgICAgICAgICAgY3VycmVudEdyb3VwID0gJGMudXNlckNsaWVudEdyb3Vwc1szXTtcclxuXHJcbiAgICAgICAgaWYobHNfc2V0SW5mb19ncm91cElkKXtcclxuICAgICAgICAgICAgdmFyIGdyb3Vwc0xlbmd0aCA9ICRjLnVzZXJDbGllbnRHcm91cHMubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdyb3Vwc0xlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJGMudXNlckNsaWVudEdyb3Vwc1tpXS5pZCA9PSBsc19zZXRJbmZvX2dyb3VwSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50R3JvdXAgPSAkYy51c2VyQ2xpZW50R3JvdXBzW2ldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdWT19zZXRJbmZvX2dyb3VwSWQnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgbGVudGEuc2VsZWN0ZWRHcm91cEluVG9wID0gJHJvb3RTY29wZS5jdXJyZW50R3JvdXAgPVxyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5idWZmZXJTZWxlY3RlZEdyb3VwID0gY3VycmVudEdyb3VwO1xyXG4gICAgLy9jb25zb2xlLmxvZygnbGVudGEnLCRyb290U2NvcGUuY3VycmVudEdyb3VwLmlkKTtcclxuXHJcbiAgICAgICAgLyppZighJHJvb3RTY29wZS5pbXBvcnRhbnRJc0xvYWRlZEZyb21Ub3ApXHJcbiAgICAgICAgJHJvb3RTY29wZS5pbXBvcnRhbnRUb3BpY3MgPSBjLm1lc3NhZ2VDbGllbnQuZ2V0SW1wb3J0YW50TmV3cygkcm9vdFNjb3BlLmN1cnJlbnRHcm91cC5pZCk7XHJcbiAgICAgICAgJHJvb3RTY29wZS5pbXBvcnRhbnRJc0xvYWRlZEZyb21Ub3AgPSBmYWxzZTsqL1xyXG5cclxuICAgICAgICBsZW50YS5hdHRhY2hJZCA9IFwiMFwiO1xyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5pbml0U3RhcnRQYXJhbXNGb3JDcmVhdGVUb3BpYyhsZW50YSk7XHJcbiAgICAgICAgbGVudGEuc2VsZWN0ZWRHcm91cCA9IG51bGw7XHJcblxyXG4gICAgICAgIGxlbnRhLm1lc3NhZ2UgPSB7fTtcclxuXHJcbiAgICAgICAgbGVudGEubWVzc2FnZS5jb250ZW50ID0gbGVudGEubWVzc2FnZS5kZWZhdWx0ID0gJGMuVEVYVF9ERUZBVUxUXzE7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUud2FsbENoYW5nZVJ1YnJpYyA9IGZ1bmN0aW9uKHJ1YnJpY0lkKXtcclxuXHJcbiAgICAgICAgICAgIGxlbnRhLndhbGxJdGVtcyA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0V2FsbEl0ZW1zKGN1cnJlbnRHcm91cC5pZCwgcnVicmljSWQsMCwgbG9hZGVkTGVuZ3RoKTtcclxuXHJcbiAgICAgICAgICAgIGlmKGxlbnRhLndhbGxJdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGluaXRXYWxsSXRlbShsZW50YS53YWxsSXRlbXMpO1xyXG5cclxuICAgICAgICAgICAgICAgIGxhc3RMb2FkZWRJZCA9IGxlbnRhLndhbGxJdGVtc1tsZW50YS53YWxsSXRlbXMubGVuZ3RoLTFdLnRvcGljLmlkO1xyXG4gICAgICAgICAgICAgICAgbGFzdExvYWRlZElkRkYgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmKCRzdGF0ZS5jdXJyZW50LnJ1YnJpY0lkKSB7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUud2FsbENoYW5nZVJ1YnJpYygkc3RhdGUuY3VycmVudC5ydWJyaWNJZCk7XHJcbiAgICAgICAgICAgICRzdGF0ZS5jdXJyZW50LnJ1YnJpY0lkID0gbnVsbDtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50UnVicmljID0ge307XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZW50YS53YWxsSXRlbXMgPSAkYy5tZXNzYWdlQ2xpZW50LmdldFdhbGxJdGVtcygkcm9vdFNjb3BlLmJhc2UuYnVmZmVyU2VsZWN0ZWRHcm91cC5pZCwkcm9vdFNjb3BlLmN1cnJlbnRSdWJyaWMuaWQsMCxsb2FkZWRMZW5ndGgpO1xyXG5cclxuICAgICAgICB2YXIgd2FsbEl0ZW1zTGVuZ3RoO1xyXG4gICAgICAgIGxlbnRhLndhbGxJdGVtcyA/IHdhbGxJdGVtc0xlbmd0aCA9IGxlbnRhLndhbGxJdGVtcy5sZW5ndGggOlxyXG4gICAgICAgICAgICB3YWxsSXRlbXNMZW5ndGggPSAwO1xyXG5cclxuICAgICAgICBpZih3YWxsSXRlbXNMZW5ndGggIT0gMCkgbGFzdExvYWRlZElkID0gbGVudGEud2FsbEl0ZW1zW3dhbGxJdGVtc0xlbmd0aC0xXS50b3BpYy5pZDtcclxuXHJcbiAgICAgICAgaW5pdFdhbGxJdGVtKGxlbnRhLndhbGxJdGVtcyk7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuc2VsZWN0R3JvdXBJbkRyb3Bkb3duX2xlbnRhID0gZnVuY3Rpb24oZ3JvdXBJZCl7XHJcbiAgICAgICAgICAgIC8vbGVudGEuc2VsZWN0ZWRHcm91cCA9ICRyb290U2NvcGUuYmFzZS5idWZmZXJTZWxlY3RlZEdyb3VwID0gc2VsZWN0R3JvdXBJbkRyb3Bkb3duKGdyb3VwSWQpO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UuYnVmZmVyU2VsZWN0ZWRHcm91cCA9ICRjLnNlbGVjdEdyb3VwSW5Ecm9wZG93bihncm91cElkKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBsZW50YS5nb1RvQW5zd2VySW5wdXQgPSBmdW5jdGlvbihldmVudCl7XHJcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGluaXRGbGFnc0FycmF5ID0gW107XHJcbiAgICAgICAgbGVudGEuc2hvd0Fuc3dlcklucHV0ID0gZnVuY3Rpb24oZXZlbnQsd2FsbEl0ZW0sd2FsbE1lc3NhZ2Upe1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgLyp3YWxsSXRlbS5hbnN3ZXJTaG93ID9cclxuICAgICAgICAgICAgICAgIHdhbGxJdGVtLmFuc3dlclNob3cgPSBmYWxzZSA6Ki9cclxuICAgICAgICAgICAgICAgIHdhbGxJdGVtLmFuc3dlclNob3cgPSB0cnVlIDtcclxuICAgICAgICAgICAgICAgIHdhbGxJdGVtLmlzRm9jdXMgPSB0cnVlIDtcclxuXHJcbiAgICAgICAgICAgIGlmKHdhbGxNZXNzYWdlKXtcclxuICAgICAgICAgICAgICAgIHZhciBhdXRob3JOYW1lO1xyXG4gICAgICAgICAgICAgICAgd2FsbE1lc3NhZ2UudXNlckluZm8gP1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dGhvck5hbWUgPSB3YWxsTWVzc2FnZS51c2VySW5mby5maXJzdE5hbWUgOlxyXG4gICAgICAgICAgICAgICAgICAgIGF1dGhvck5hbWUgPSB3YWxsTWVzc2FnZS5hdXRob3JOYW1lLnNwbGl0KCcgJylbMF07XHJcbiAgICAgICAgICAgICAgICB3YWxsSXRlbS5jb21tZW50VGV4dCA9IGF1dGhvck5hbWUrXCIsIFwiO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHdhbGxJdGVtLmNvbW1lbnRUZXh0ID0gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYoIWluaXRGbGFnc0FycmF5W3dhbGxJdGVtLnRvcGljLmlkXSkge1xyXG4gICAgICAgICAgICAgICAgLy8g0LjQvdC40YTQuNGG0LDQu9C40LfQsNGG0LzRjiBBdHRhY2hJbWFnZSDQvdGD0LbQvdC+INC00LXQu9Cw0YLRjCDRgtC+0LvRjNC60L4g0L7QtNC40L0g0YDQsNC3INC00LvRjyDQutCw0LbQtNC+0LPQviDRgdC+0L7QsdGJ0LXQvdC40Y9cclxuICAgICAgICAgICAgICAgIGluaXRGbGFnc0FycmF5W3dhbGxJdGVtLnRvcGljLmlkXSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS53YWxsQ2hhbmdlR3JvdXAgPSBmdW5jdGlvbihncm91cElkKXtcclxuXHJcbiAgICAgICAgICAgIGxlbnRhLndhbGxJdGVtcyA9ICRjLm1lc3NhZ2VDbGllbnQuZ2V0V2FsbEl0ZW1zKGdyb3VwSWQsICRyb290U2NvcGUuY3VycmVudFJ1YnJpYy5pZCwwLCBsb2FkZWRMZW5ndGgpO1xyXG5cclxuICAgICAgICAgICAgaWYobGVudGEud2FsbEl0ZW1zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgaW5pdFdhbGxJdGVtKGxlbnRhLndhbGxJdGVtcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGFzdExvYWRlZElkID0gbGVudGEud2FsbEl0ZW1zW2xlbnRhLndhbGxJdGVtcy5sZW5ndGgtMV0udG9waWMuaWQ7XHJcbiAgICAgICAgICAgICAgICBsYXN0TG9hZGVkSWRGRiA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaW5pdFdhbGxJdGVtKHdhbGxJdGVtcyl7XHJcbiAgICAgICAgICAgIHdhbGxJdGVtc0xlbmd0aCA9IHdhbGxJdGVtcy5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB3YWxsSXRlbXNMZW5ndGg7IGkrKyl7XHJcblxyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmluaXRTdGFydFBhcmFtc0ZvckNyZWF0ZU1lc3NhZ2Uod2FsbEl0ZW1zW2ldKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UuaW5pdFN0YXJ0UGFyYW1zRm9yQ3JlYXRlVG9waWMod2FsbEl0ZW1zW2ldLnRvcGljKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyAgd2FsbEl0ZW1zW2ldLnRvcGljLm1lc3NhZ2UuZ3JvdXBJZCDRgdC10LnRh9Cw0YEg0L3QtSDQt9Cw0LTQsNC90LAg0L/QvtGH0LXQvNGDLdGC0L5cclxuICAgICAgICAgICAgICAgIHdhbGxJdGVtc1tpXS5sYWJlbCA9ICRjLmdldExhYmVsKCRyb290U2NvcGUuYmFzZS5ncm91cHMsd2FsbEl0ZW1zW2ldLnRvcGljLmdyb3VwVHlwZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgd2FsbEl0ZW1zW2ldLnRhZ0NvbG9yID0gJGMuZ2V0VGFnQ29sb3Iod2FsbEl0ZW1zW2ldLmxhYmVsKTtcclxuXHJcbiAgICAgICAgICAgICAgICB3YWxsSXRlbXNbaV0uaXNPcGVuID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYod2FsbEl0ZW1zW2ldLnRvcGljLm1lc3NhZ2UuaW1wb3J0YW50ID09IDEpe1xyXG4gICAgICAgICAgICAgICAgICAgIHdhbGxJdGVtc1tpXS50b3BpYy5tZXNzYWdlLmltcG9ydGFudFRleHQgPSAn0KHQvdGP0YLRjCDQvNC10YLQutGDIFwi0JLQsNC20L3QvtC1XCInO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgd2FsbEl0ZW1zW2ldLnRvcGljLm1lc3NhZ2UuaW1wb3J0YW50VGV4dCA9ICfQn9C+0LzQtdGC0LjRgtGMINC60LDQuiBcItCS0LDQttC90L7QtVwiJztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZih3YWxsSXRlbXNbaV0udG9waWMubWVzc2FnZS50eXBlID09IDEpe1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB3YWxsSXRlbXNbaV0udG9waWMubGFzdFVwZGF0ZUVkaXQgPSAkYy5nZXRUaW1pbmcod2FsbEl0ZW1zW2ldLnRvcGljLmxhc3RVcGRhdGUpO1xyXG5cclxuICAgICAgICAgICAgICAgIH1lbHNlIGlmKHdhbGxJdGVtc1tpXS50b3BpYy5tZXNzYWdlLnR5cGUgPT0gNSl7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHdhbGxJdGVtc1tpXS50b3BpYy5tZXNzYWdlLmNyZWF0ZWRFZGl0ID0gJGMuZ2V0VGltaW5nKHdhbGxJdGVtc1tpXS50b3BpYy5tZXNzYWdlLmNyZWF0ZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdhbGxJdGVtc1tpXS50b3BpYy5hdXRob3JOYW1lID0gJGMuZ2V0QXV0aG9yTmFtZSh3YWxsSXRlbXNbaV0udG9waWMudXNlckluZm8pO1xyXG4gICAgICAgICAgICAgICAgICAgIHdhbGxJdGVtc1tpXS50b3BpYy5tZXRhVHlwZSA9IFwibWVzc2FnZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHdhbGxJdGVtc1tpXS50b3BpYy5ydWJyaWMgPSAkYy5nZXRUb3BpY1J1YnJpYyh3YWxsSXRlbXNbaV0udG9waWMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzTGVuO1xyXG4gICAgICAgICAgICAgICAgICAgIHdhbGxJdGVtc1tpXS5tZXNzYWdlcyA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc0xlbiA9IHdhbGxJdGVtc1tpXS5tZXNzYWdlcy5sZW5ndGg6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc0xlbiA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaiA9IDA7IGogPCBtZXNMZW47IGorKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhbGxJdGVtc1tpXS5tZXNzYWdlc1tqXS5jcmVhdGVkRWRpdCA9ICRjLmdldFRpbWluZyh3YWxsSXRlbXNbaV0ubWVzc2FnZXNbal0uY3JlYXRlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhbGxJdGVtc1tpXS5tZXNzYWdlc1tqXS5hdXRob3JOYW1lID0gJGMuZ2V0QXV0aG9yTmFtZSh3YWxsSXRlbXNbaV0ubWVzc2FnZXNbal0udXNlckluZm8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3YWxsSXRlbXNbaV0ubWVzc2FnZXNbal0uaXNFZGl0ID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmJhc2UuaW5pdFN0YXJ0UGFyYW1zRm9yQ3JlYXRlTWVzc2FnZSh3YWxsSXRlbXNbaV0ubWVzc2FnZXNbal0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgKG1lc0xlbiA+PSAkcm9vdFNjb3BlLkNPTU1FTlRTX0RFRkFVTFRfQ09VTlQpID9cclxuICAgICAgICAgICAgICAgICAgICB3YWxsSXRlbXNbaV0uYnVmZmVyTWVzc2FnZXMgPSB3YWxsSXRlbXNbaV0ubWVzc2FnZXMuc2xpY2UobWVzTGVuLSRyb290U2NvcGUuQ09NTUVOVFNfREVGQVVMVF9DT1VOVCk6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhbGxJdGVtc1tpXS5idWZmZXJNZXNzYWdlcyA9IHdhbGxJdGVtc1tpXS5tZXNzYWdlcztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYod2FsbEl0ZW1zW2ldLnRvcGljLnBvbGwgIT0gbnVsbCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8v0LfQvdCw0YfQuNGCINGN0YLQviDQvtC/0YDQvtGBXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRjLnNldFBvbGxFZGl0TmFtZXMod2FsbEl0ZW1zW2ldLnRvcGljLnBvbGwpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgd2FsbEl0ZW1zW2ldLnRvcGljLm1ldGFUeXBlID0gXCJwb2xsXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZW50YS50b2dnbGVDb21tZW50cyA9IGZ1bmN0aW9uKGV2ZW50LHdhbGxJdGVtKXtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBtZXNMZW4gPSB3YWxsSXRlbS5tZXNzYWdlcy5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICBpZih3YWxsSXRlbS5pc09wZW4pe1xyXG4gICAgICAgICAgICAgICAgd2FsbEl0ZW0uaXNPcGVuID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgKG1lc0xlbiA+PSAkcm9vdFNjb3BlLkNPTU1FTlRTX0RFRkFVTFRfQ09VTlQpID9cclxuICAgICAgICAgICAgICAgICAgICB3YWxsSXRlbS5idWZmZXJNZXNzYWdlcyA9IHdhbGxJdGVtLm1lc3NhZ2VzLnNsaWNlKG1lc0xlbi0kcm9vdFNjb3BlLkNPTU1FTlRTX0RFRkFVTFRfQ09VTlQpOlxyXG4gICAgICAgICAgICAgICAgICAgIHdhbGxJdGVtLmJ1ZmZlck1lc3NhZ2VzID0gd2FsbEl0ZW0ubWVzc2FnZXM7XHJcblxyXG4gICAgICAgICAgICAgICAgLy93YWxsSXRlbS5idWZmZXJNZXNzYWdlcyA9IHdhbGxJdGVtLm1lc3NhZ2VzLnNsaWNlKG1lc0xlbi1sZW50YS5DT01NRU5UU19ERUZBVUxUX0NPVU5UKTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICB3YWxsSXRlbS5pc09wZW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgd2FsbEl0ZW0uYnVmZmVyTWVzc2FnZXMgPSB3YWxsSXRlbS5tZXNzYWdlcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsYXN0TG9hZGVkSWRGRjtcclxuICAgICAgICBsZW50YS5hZGRNb3JlSXRlbXMgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAvL2xhc3RMb2FkZWRJZEZGID0gbGFzdExvYWRlZElkO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnYWRkTW9yZUl0ZW1zJyxsYXN0TG9hZGVkSWQsbG9hZGVkTGVuZ3RoLCRyb290U2NvcGUuYmFzZS5idWZmZXJTZWxlY3RlZEdyb3VwLmlkLCRyb290U2NvcGUuY3VycmVudFJ1YnJpYyk7XHJcbiAgICAgICAgICAgIGlmKHdhbGxJdGVtc0xlbmd0aCA9PSAxMCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJ1ZmYgPSAkYy5tZXNzYWdlQ2xpZW50LmdldFdhbGxJdGVtcygkcm9vdFNjb3BlLmJhc2UuYnVmZmVyU2VsZWN0ZWRHcm91cC5pZCwkcm9vdFNjb3BlLmN1cnJlbnRSdWJyaWMuaWQsIGxhc3RMb2FkZWRJZCwgbG9hZGVkTGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgIGlmIChidWZmKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBidWZmTGVuZ3RoID0gYnVmZi5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChidWZmTGVuZ3RoICE9IDApIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RMb2FkZWRJZCA9IGJ1ZmZbYnVmZkxlbmd0aCAtIDFdLnRvcGljLmlkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYobGFzdExvYWRlZElkRkYgIT0gbGFzdExvYWRlZElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0V2FsbEl0ZW0oYnVmZik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW50YS53YWxsSXRlbXMgPSBsZW50YS53YWxsSXRlbXMuY29uY2F0KGJ1ZmYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0TG9hZGVkSWRGRiA9IGxhc3RMb2FkZWRJZDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgJHJvb3RTY29wZS5pbml0Q3JlYXRlVG9waWMobGVudGEpO1xyXG5cclxuICAgICAgICAkYy5pbml0RmFuY3lCb3goJCgnLmZvcnVtJykpO1xyXG5cclxuICAgIH07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFsgJyRyb290U2NvcGUnLCckc3RhdGUnLCckYycsIHdhbGxDdHJsIF07IiwiXHJcbnZhciB3YWxsU2luZ2xlQ3RybCA9IGZ1bmN0aW9uKCRyb290U2NvcGUsICRzdGF0ZVBhcmFtcywkYyl7XHJcbiAgICAgICAgdmFyIHdhbGxTaW5nbGUgPSB0aGlzO1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UubWFpbkNvbnRlbnRUb3BJc0hpZGUgPSB0cnVlO1xyXG4gICAgICAgICRyb290U2NvcGUuYmFzZS5pc0Zvb3RlckJvdHRvbSA9IGZhbHNlO1xyXG4gICAgICAgICRjLmluaXRGYW5jeUJveCgkKCcubGVudGEtaXRlbScpKTtcclxuXHJcbiAgICAgICAgLy8g0LLRgNC10LzQtdC90L3Qviwg0L3Rg9C20L3QsCDRhNGD0L3QutGG0LjRjyBnZXRXYWxsSXRlbSh0b3BpY0lkKVxyXG4gICAgICAgICRyb290U2NvcGUuY3VycmVudEdyb3VwLmlkID0gJGMuZ2V0RGVmYXVsdEdyb3VwKCRyb290U2NvcGUuYmFzZS5ncm91cHMpLmlkO1xyXG4gICAgICAgIHZhciB3YWxsSXRlbXMgPSAkYy5tZXNzYWdlQ2xpZW50LmdldFdhbGxJdGVtcygkcm9vdFNjb3BlLmN1cnJlbnRHcm91cC5pZCwwLDAsMTAwMCksXHJcbiAgICAgICAgd2FsbEl0ZW1zTGVuZ3RoID0gd2FsbEl0ZW1zLmxlbmd0aDtcclxuXHJcbiAgICAvL2NvbnNvbGUubG9nKCcwJyx3YWxsSXRlbXMsJHN0YXRlUGFyYW1zLnRvcGljSWQpO1xyXG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB3YWxsSXRlbXNMZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgIGlmKHdhbGxJdGVtc1tpXS50b3BpYy5pZCA9PSAkc3RhdGVQYXJhbXMudG9waWNJZCl7XHJcbiAgICAgICAgICAgICAgICB3YWxsU2luZ2xlLndhbGxJdGVtID0gd2FsbEl0ZW1zW2ldO1xyXG4gICAgICAgICAgICAgICAgd2FsbFNpbmdsZS53YWxsSXRlbS50b3BpYy5pc1dhbGxTaW5nbGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIC8vY29uc29sZS5sb2coJzExJyx3YWxsU2luZ2xlLndhbGxJdGVtLCRyb290U2NvcGUuY3VycmVudEdyb3VwLmlkKTtcclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UuaW5pdFN0YXJ0UGFyYW1zRm9yQ3JlYXRlTWVzc2FnZSh3YWxsU2luZ2xlLndhbGxJdGVtKTtcclxuICAgICAgICAkcm9vdFNjb3BlLmJhc2UuaW5pdFN0YXJ0UGFyYW1zRm9yQ3JlYXRlVG9waWMod2FsbFNpbmdsZS53YWxsSXRlbS50b3BpYyk7XHJcblxyXG4vKlxyXG4gICAgICAgIHdhbGxTaW5nbGUud2FsbEl0ZW0uY29tbWVudFRleHQgPSBURVhUX0RFRkFVTFRfMjtcclxuICAgICAgICB3YWxsU2luZ2xlLndhbGxJdGVtLmFuc3dlclNob3cgPSBmYWxzZTtcclxuICAgICAgICB3YWxsU2luZ2xlLndhbGxJdGVtLmlzRm9jdXMgPSBmYWxzZTtcclxuICAgICAgICB3YWxsU2luZ2xlLndhbGxJdGVtLmlzQ3JlYXRlQ29tbWVudEVycm9yID0gZmFsc2U7XHJcbiovXHJcblxyXG4gICAgICAgIGlmKHdhbGxTaW5nbGUud2FsbEl0ZW0udG9waWMubWVzc2FnZS5pbXBvcnRhbnQgPT0gMSl7XHJcbiAgICAgICAgICAgIHdhbGxTaW5nbGUud2FsbEl0ZW0udG9waWMubWVzc2FnZS5pbXBvcnRhbnRUZXh0ID0gJ9Ch0L3Rj9GC0Ywg0LzQtdGC0LrRgyBcItCS0LDQttC90L7QtVwiJztcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgd2FsbFNpbmdsZS53YWxsSXRlbS50b3BpYy5tZXNzYWdlLmltcG9ydGFudFRleHQgPSAn0J/QvtC80LXRgtC40YLRjCDQutCw0LogXCLQktCw0LbQvdC+0LVcIic7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyAgbGVudGEud2FsbEl0ZW1zW2ldLnRvcGljLm1lc3NhZ2UuZ3JvdXBJZCDRgdC10LnRh9Cw0YEg0L3QtSDQt9Cw0LTQsNC90LAg0L/QvtGH0LXQvNGDLdGC0L5cclxuICAgICAgICB3YWxsU2luZ2xlLndhbGxJdGVtLmxhYmVsID0gJGMuZ2V0TGFiZWwoJGMudXNlckNsaWVudEdyb3Vwcyx3YWxsU2luZ2xlLndhbGxJdGVtLnRvcGljLmdyb3VwVHlwZSk7XHJcblxyXG4gICAgICAgIHdhbGxTaW5nbGUud2FsbEl0ZW0udGFnQ29sb3IgPSAkYy5nZXRUYWdDb2xvcih3YWxsU2luZ2xlLndhbGxJdGVtLmxhYmVsKTtcclxuXHJcbiAgICAgICAgaWYod2FsbFNpbmdsZS53YWxsSXRlbS50b3BpYy5tZXNzYWdlLnR5cGUgPT0gMSl7XHJcblxyXG4gICAgICAgICAgICB3YWxsU2luZ2xlLndhbGxJdGVtLnRvcGljLmxhc3RVcGRhdGVFZGl0ID0gJGMuZ2V0VGltaW5nKHdhbGxTaW5nbGUud2FsbEl0ZW0udG9waWMubGFzdFVwZGF0ZSk7XHJcblxyXG4gICAgICAgIH1lbHNlIGlmKHdhbGxTaW5nbGUud2FsbEl0ZW0udG9waWMubWVzc2FnZS50eXBlID09IDUpe1xyXG5cclxuICAgICAgICAgICAgd2FsbFNpbmdsZS53YWxsSXRlbS50b3BpYy5tZXNzYWdlLmNyZWF0ZWRFZGl0ID0gZ2V0VGltaW5nKHdhbGxTaW5nbGUud2FsbEl0ZW0udG9waWMubWVzc2FnZS5jcmVhdGVkKTtcclxuICAgICAgICAgICAgd2FsbFNpbmdsZS53YWxsSXRlbS50b3BpYy5hdXRob3JOYW1lID0gJGMuZ2V0QXV0aG9yTmFtZSh3YWxsU2luZ2xlLndhbGxJdGVtLnRvcGljLnVzZXJJbmZvKTtcclxuICAgICAgICAgICAgd2FsbFNpbmdsZS53YWxsSXRlbS50b3BpYy5tZXRhVHlwZSA9IFwibWVzc2FnZVwiO1xyXG5cclxuICAgICAgICAgICAgdmFyIG1lc0xlbjtcclxuICAgICAgICAgICAgd2FsbFNpbmdsZS53YWxsSXRlbS5tZXNzYWdlcyA/XHJcbiAgICAgICAgICAgICAgICBtZXNMZW4gPSB3YWxsU2luZ2xlLndhbGxJdGVtLm1lc3NhZ2VzLmxlbmd0aDpcclxuICAgICAgICAgICAgICAgIG1lc0xlbiA9IDA7XHJcblxyXG4gICAgICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgbWVzTGVuOyBqKyspe1xyXG4gICAgICAgICAgICAgICAgd2FsbFNpbmdsZS53YWxsSXRlbS5tZXNzYWdlc1tqXS5jcmVhdGVkRWRpdCA9IGdldFRpbWluZyh3YWxsU2luZ2xlLndhbGxJdGVtLm1lc3NhZ2VzW2pdLmNyZWF0ZWQpO1xyXG4gICAgICAgICAgICAgICAgd2FsbFNpbmdsZS53YWxsSXRlbS5tZXNzYWdlc1tqXS5hdXRob3JOYW1lID0gJGMuZ2V0QXV0aG9yTmFtZSh3YWxsU2luZ2xlLndhbGxJdGVtLm1lc3NhZ2VzW2pdLnVzZXJJbmZvKTtcclxuICAgICAgICAgICAgICAgIHdhbGxTaW5nbGUud2FsbEl0ZW0ubWVzc2FnZXNbal0uaXNFZGl0ID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5iYXNlLmluaXRTdGFydFBhcmFtc0ZvckNyZWF0ZU1lc3NhZ2Uod2FsbFNpbmdsZS53YWxsSXRlbS5tZXNzYWdlc1tqXSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBpZih3YWxsU2luZ2xlLndhbGxJdGVtLnRvcGljLnBvbGwgIT0gbnVsbCl7XHJcbiAgICAgICAgICAgICAgICAvL9C30L3QsNGH0LjRgiDRjdGC0L4g0L7Qv9GA0L7RgVxyXG4gICAgICAgICAgICAgICAgJGMuc2V0UG9sbEVkaXROYW1lcyh3YWxsU2luZ2xlLndhbGxJdGVtLnRvcGljLnBvbGwpO1xyXG5cclxuICAgICAgICAgICAgICAgIHdhbGxTaW5nbGUud2FsbEl0ZW0udG9waWMubWV0YVR5cGUgPSBcInBvbGxcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGluaXRGbGFnc0FycmF5ID0gW107XHJcbiAgICAgICAgd2FsbFNpbmdsZS5zaG93QW5zd2VySW5wdXQgPSBmdW5jdGlvbihldmVudCx3YWxsSXRlbSx3YWxsTWVzc2FnZSl7XHJcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICAvKndhbGxJdGVtLmFuc3dlclNob3cgP1xyXG4gICAgICAgICAgICAgd2FsbEl0ZW0uYW5zd2VyU2hvdyA9IGZhbHNlIDoqL1xyXG4gICAgICAgICAgICB3YWxsSXRlbS5hbnN3ZXJTaG93ID0gdHJ1ZSA7XHJcbiAgICAgICAgICAgIHdhbGxJdGVtLmlzRm9jdXMgPSB0cnVlIDtcclxuXHJcbiAgICAgICAgICAgIGlmKHdhbGxNZXNzYWdlKXtcclxuICAgICAgICAgICAgICAgIHZhciBhdXRob3JOYW1lO1xyXG4gICAgICAgICAgICAgICAgd2FsbE1lc3NhZ2UudXNlckluZm8gP1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dGhvck5hbWUgPSB3YWxsTWVzc2FnZS51c2VySW5mby5maXJzdE5hbWUgOlxyXG4gICAgICAgICAgICAgICAgICAgIGF1dGhvck5hbWUgPSB3YWxsTWVzc2FnZS5hdXRob3JOYW1lLnNwbGl0KCcgJylbMF07XHJcbiAgICAgICAgICAgICAgICB3YWxsSXRlbS5jb21tZW50VGV4dCA9IGF1dGhvck5hbWUrXCIsIFwiO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIHdhbGxJdGVtLmNvbW1lbnRUZXh0ID0gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYoIWluaXRGbGFnc0FycmF5W3dhbGxJdGVtLnRvcGljLmlkXSkge1xyXG4gICAgICAgICAgICAgICAgLy8g0LjQvdC40YTQuNGG0LDQu9C40LfQsNGG0LzRjiBBdHRhY2hJbWFnZSDQvdGD0LbQvdC+INC00LXQu9Cw0YLRjCDRgtC+0LvRjNC60L4g0L7QtNC40L0g0YDQsNC3INC00LvRjyDQutCw0LbQtNC+0LPQviDRgdC+0L7QsdGJ0LXQvdC40Y9cclxuICAgICAgICAgICAgICAgIC8vaW5pdEF0dGFjaEltYWdlKCQoJyNhdHRhY2hJbWFnZS0nICsgd2FsbEl0ZW0udG9waWMuaWQpLCAkKCcjYXR0YWNoLWFyZWEtJyArIHdhbGxJdGVtLnRvcGljLmlkKSk7XHJcbiAgICAgICAgICAgICAgICAvL2luaXRBdHRhY2hEb2MoJCgnI2F0dGFjaERvYy0nICsgd2FsbEl0ZW0udG9waWMuaWQpLCAkKCcjYXR0YWNoLWRvYy1hcmVhLScgKyB3YWxsSXRlbS50b3BpYy5pZCkpO1xyXG4gICAgICAgICAgICAgICAgaW5pdEZsYWdzQXJyYXlbd2FsbEl0ZW0udG9waWMuaWRdID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkKCcubmctY2xvYWsnKS5yZW1vdmVDbGFzcygnbmctY2xvYWsnKTtcclxuICAgIH07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFsgJyRyb290U2NvcGUnLCckc3RhdGVQYXJhbXMnLCckYycsIHdhbGxTaW5nbGVDdHJsIF07IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuLyogRGlyZWN0aXZlcyAqL1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ2ZvcnVtLmRpcmVjdGl2ZXMnLCBbXSkuXHJcbiAgZGlyZWN0aXZlKCduZ0hhc2ZvY3VzJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG5cclxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKGF0dHJzLm5nSGFzZm9jdXMsIGZ1bmN0aW9uIChuVmFsLCBvVmFsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoblZhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRbMF0uZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZihzY29wZS53YWxsSXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRDYXJldFRvUG9zKGVsZW1lbnRbMF0sIHNjb3BlLndhbGxJdGVtLmNvbW1lbnRUZXh0Lmxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoc2NvcGUuY3RybCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmJhc2UudGV4dGFyZWFGb2N1cyhzY29wZS5jdHJsLm1lc3NhZ2UuY29udGVudCxzY29wZS5jdHJsLm1lc3NhZ2UuZGVmYXVsdCxzY29wZS5jdHJsLHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBlbGVtZW50LmJpbmQoJ2JsdXInLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGlmKHNjb3BlLndhbGxJdGVtKXtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS53YWxsSXRlbS5pc0ZvY3VzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGF0dHJzLm5nSGFzZm9jdXMgKyBcIiA9IGZhbHNlXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy9zY29wZS4kYXBwbHkoYXR0cnMubmdTaG93ICsgXCIgPSBmYWxzZVwiKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBlbGVtZW50LmJpbmQoJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGUud2hpY2ggPT0gMTMpXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGF0dHJzLm5nSGFzZm9jdXMgKyBcIiA9IGZhbHNlXCIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG4gICAgLmRpcmVjdGl2ZSgnYnV0dG9uJyxmdW5jdGlvbigpe1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0IDogJ0UnLFxyXG4gICAgICAgICAgICBjb21waWxlOiBmdW5jdGlvbihlbGVtZW50LGF0dHJpYnV0ZXMpe1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnYnRuJyk7XHJcbiAgICAgICAgICAgICAgICBpZihhdHRyaWJ1dGVzLnR5cGUgPT0gXCJzdWJtaXRcIil7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnYnRuLXByaW1hcnknKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKGF0dHJpYnV0ZXMuc2l6ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnYnRuLScrYXR0cmlidXRlcy5zaXplKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgfSlcclxuICAgIC5kaXJlY3RpdmUoJ3BhZ2luYXRpb24nLGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgLypcclxuICAgICAgICAqIDxwYWdpbmF0aW9uIG51bS1wYWdlcz1cInRhc2suY291bnRcIiBjdXJyZW50LXBhZ2U9XCJ0YXNrLmN1cnJlbnRcIiBvbi1zZWxlY3QtcGFnZT1cInNlbGVjdFBhZ2UoKVwiPjwvcGFnaW5hdGlvbj5cclxuICAgICAgICAqICovXHJcbiAgICAgICAgcmV0dXJue1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZSA6ICc8ZGl2IGNsYXNzPVwicGFnaW5hdGlvblwiPicrXHJcbiAgICAgICAgICAgICAgICAnPHVsPicrXHJcbiAgICAgICAgICAgICAgICAnPGxpIG5nLWNsYXNzPVwie2Rpc2FibGVkOiBub1ByZXZpb3VzKCl9XCI+PGEgaHJlZj1cIiNcIiBuZy1jbGljaz1cInNlbGVjdFByZXZpb3VzKClcIj5QcmV2aW91czwvYT48L2xpPicrXHJcbiAgICAgICAgICAgICAgICAnPGxpIG5nLXJlcGVhdD1cInBhZ2UgaW4gcGFnZXNcIiBuZy1jbGFzcz1cInthY3RpdmUgOiBpc0FjdGl2ZShwYWdlKX1cIj48YSBocmVmPVwiI1wiIG5nLWNsaWNrPVwic2VsZWN0UGFnZShwYWdlKVwiPnt7cGFnZX19PC9hPjwvbGk+JytcclxuICAgICAgICAgICAgICAgICc8bGkgbmctY2xhc3M9XCJ7ZGlzYWJsZWQ6IG5vTmV4dCgpfVwiPjxhIGhyZWY9XCIjXCIgbmctY2xpY2s9XCJzZWxlY3ROZXh0KClcIj5OZXh0PC9hPjwvbGk+JytcclxuICAgICAgICAgICAgICAgICc8L3VsPicrXHJcbiAgICAgICAgICAgICAgICAnPC9kaXY+JyxcclxuICAgICAgICAgICAgcmVzdHJpY3Q6XCJFXCIsXHJcbiAgICAgICAgICAgIHNjb3BlIDoge1xyXG4gICAgICAgICAgICAgICAgbnVtUGFnZXM6IFwiPVwiLFxyXG4gICAgICAgICAgICAgICAgY3VycmVudFBhZ2U6IFwiPVwiLFxyXG4gICAgICAgICAgICAgICAgb25TZWxlY3RQYWdlOiBcIiZcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSl7XHJcbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ251bVBhZ2VzJyxmdW5jdGlvbih2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUucGFnZXMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDw9IHZhbHVlOyBpKyspe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5wYWdlcy5wdXNoKGkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZihzY29wZS5jdXJyZW50UGFnZSA+IHZhbHVlKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2VsZWN0UGFnZSh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuaXNBY3RpdmUgPSBmdW5jdGlvbihwYWdlKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUuY3VycmVudFBhZ2UgPT09IHBhZ2U7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLnNlbGVjdFBhZ2UgPSBmdW5jdGlvbihwYWdlKXtcclxuICAgICAgICAgICAgICAgICAgICBpZighc2NvcGUuaXNBY3RpdmUocGFnZSkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jdXJyZW50UGFnZSA9IHBhZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm9uU2VsZWN0UGFnZSh7cGFnZSA6IHBhZ2V9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLnNlbGVjdE5leHQgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghc2NvcGUubm9OZXh0KCkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zZWxlY3RQYWdlKHNjb3BlLmN1cnJlbnRQYWdlICsgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pXHJcblx0LmRpcmVjdGl2ZSgnbmdUaHVtYicsIFsnJHdpbmRvdycsIGZ1bmN0aW9uKCR3aW5kb3cpIHtcclxuICAgICAgICB2YXIgaGVscGVyID0ge1xyXG4gICAgICAgICAgICBzdXBwb3J0OiAhISgkd2luZG93LkZpbGVSZWFkZXIgJiYgJHdpbmRvdy5DYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpLFxyXG4gICAgICAgICAgICBpc0ZpbGU6IGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhbmd1bGFyLmlzT2JqZWN0KGl0ZW0pICYmIGl0ZW0gaW5zdGFuY2VvZiAkd2luZG93LkZpbGU7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGlzSW1hZ2U6IGZ1bmN0aW9uKGZpbGUpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0eXBlID0gICd8JyArIGZpbGUudHlwZS5zbGljZShmaWxlLnR5cGUubGFzdEluZGV4T2YoJy8nKSArIDEpICsgJ3wnO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICd8anBnfHBuZ3xqcGVnfGJtcHxnaWZ8Jy5pbmRleE9mKHR5cGUpICE9PSAtMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGNhbnZhcy8+JyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJpYnV0ZXMpIHtcclxuICAgICAgICAgICAgICAgIGlmICghaGVscGVyLnN1cHBvcnQpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gc2NvcGUuJGV2YWwoYXR0cmlidXRlcy5uZ1RodW1iKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIWhlbHBlci5pc0ZpbGUocGFyYW1zLmZpbGUpKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICBpZiAoIWhlbHBlci5pc0ltYWdlKHBhcmFtcy5maWxlKSkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjYW52YXMgPSBlbGVtZW50LmZpbmQoJ2NhbnZhcycpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IG9uTG9hZEZpbGU7XHJcbiAgICAgICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChwYXJhbXMuZmlsZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gb25Mb2FkRmlsZShldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBpbWcub25sb2FkID0gb25Mb2FkSW1hZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgaW1nLnNyYyA9IGV2ZW50LnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gb25Mb2FkSW1hZ2UoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHdpZHRoID0gcGFyYW1zLndpZHRoIHx8IHRoaXMud2lkdGggLyB0aGlzLmhlaWdodCAqIHBhcmFtcy5oZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IHBhcmFtcy5oZWlnaHQgfHwgdGhpcy5oZWlnaHQgLyB0aGlzLndpZHRoICogcGFyYW1zLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbnZhcy5hdHRyKHsgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCB9KTtcclxuICAgICAgICAgICAgICAgICAgICBjYW52YXNbMF0uZ2V0Q29udGV4dCgnMmQnKS5kcmF3SW1hZ2UodGhpcywgMCwgMCwgd2lkdGgsIGhlaWdodCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vc2NvcGUuJHBhcmVudC5maWxlQmFzZTY0ID0gY2FudmFzWzBdLnRvRGF0YVVSTCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdkaXInLHdpZHRoLGhlaWdodCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRwYXJlbnQuc2V0TG9hZEltYWdlKCd1cmwoJytjYW52YXNbMF0udG9EYXRhVVJMKCkrJyknKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xyXG47XHJcblxyXG5cclxuXHJcbi8vIGZ1bmN0aW9uc1xyXG5cclxuZnVuY3Rpb24gc2V0U2VsZWN0aW9uUmFuZ2UoaW5wdXQsIHNlbGVjdGlvblN0YXJ0LCBzZWxlY3Rpb25FbmQpIHtcclxuICAgIGlmIChpbnB1dC5zZXRTZWxlY3Rpb25SYW5nZSkge1xyXG4gICAgICAgIGlucHV0LmZvY3VzKCk7XHJcbiAgICAgICAgaW5wdXQuc2V0U2VsZWN0aW9uUmFuZ2Uoc2VsZWN0aW9uU3RhcnQsIHNlbGVjdGlvbkVuZCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChpbnB1dC5jcmVhdGVUZXh0UmFuZ2UpIHtcclxuICAgICAgICB2YXIgcmFuZ2UgPSBpbnB1dC5jcmVhdGVUZXh0UmFuZ2UoKTtcclxuICAgICAgICByYW5nZS5jb2xsYXBzZSh0cnVlKTtcclxuICAgICAgICByYW5nZS5tb3ZlRW5kKCdjaGFyYWN0ZXInLCBzZWxlY3Rpb25FbmQpO1xyXG4gICAgICAgIHJhbmdlLm1vdmVTdGFydCgnY2hhcmFjdGVyJywgc2VsZWN0aW9uU3RhcnQpO1xyXG4gICAgICAgIHJhbmdlLnNlbGVjdCgpO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBzZXRDYXJldFRvUG9zIChpbnB1dCwgcG9zKSB7XHJcbiAgICBzZXRTZWxlY3Rpb25SYW5nZShpbnB1dCwgcG9zLCBwb3MpO1xyXG59IiwiXHJcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgYyA9IHt9O1xyXG5cclxuICAgIC8qIGNvbnN0ICovXHJcbiAgICBjLlRFWFRfREVGQVVMVF8xID0gXCLQndCw0L/QuNGB0LDRgtGMINGB0L7QvtCx0YnQtdC90LjQtVwiO1xyXG4gICAgYy5URVhUX0RFRkFVTFRfMiA9IFwi0JLQsNGIINC+0YLQstC10YJcIjtcclxuICAgIGMuVEVYVF9ERUZBVUxUXzMgPSBcItCh0L7QvtCx0YnQtdC90LjQtVwiO1xyXG4gICAgYy5URVhUX0RFRkFVTFRfNCA9IFwi0JfQsNCz0L7Qu9C+0LLQvtC6XCI7XHJcblxyXG4gICAgYy5NQVBfQ09MT1IgPSBcIjZGQjNFMDQwXCI7XHJcblxyXG4gICAgYy5URVhUQVJFQV9ERUZBVUxUX0hFSUdIVCA9IDU0O1xyXG5cclxuICAgIC8qIGZ1bmN0aW9ucyAqL1xyXG5cclxuICAgIHZhciB0cmFuc3BvcnQgPSBuZXcgVGhyaWZ0LlRyYW5zcG9ydChcIi90aHJpZnQvTWVzc2FnZVNlcnZpY2VcIik7XHJcbiAgICB2YXIgcHJvdG9jb2wgPSBuZXcgVGhyaWZ0LlByb3RvY29sKHRyYW5zcG9ydCk7XHJcbiAgICBjLm1lc3NhZ2VDbGllbnQgPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQubWVzc2FnZXNlcnZpY2UuTWVzc2FnZVNlcnZpY2VDbGllbnQocHJvdG9jb2wpO1xyXG5cclxuICAgIHRyYW5zcG9ydCA9IG5ldyBUaHJpZnQuVHJhbnNwb3J0KFwiL3RocmlmdC9BdXRoU2VydmljZVwiKTtcclxuICAgIHByb3RvY29sID0gbmV3IFRocmlmdC5Qcm90b2NvbCh0cmFuc3BvcnQpO1xyXG4gICAgYy5hdXRoQ2xpZW50ID0gbmV3IGNvbS52bWVzdGVvbmxpbmUuYmUudGhyaWZ0LmF1dGhzZXJ2aWNlLkF1dGhTZXJ2aWNlQ2xpZW50KHByb3RvY29sKTtcclxuXHJcbiAgICB2YXIgaXNMb2dpbiA9IGMuYXV0aENsaWVudC5jaGVja0lmQXV0aG9yaXplZCgpO1xyXG4gICAgdmFyIHBhdGggPSBkb2N1bWVudC5sb2NhdGlvbi5wYXRobmFtZTtcclxuICAgIGlmICghaXNMb2dpbiAmJiBwYXRoICE9ICcvYmxvZycgJiYgcGF0aCAhPSAnL2Fib3V0JyAmJiBwYXRoICE9ICcvY29udGFjdHMnKSBkb2N1bWVudC5sb2NhdGlvbi5yZXBsYWNlKCcvbG9naW4nKTtcclxuXHJcbiAgICB0cmFuc3BvcnQgPSBuZXcgVGhyaWZ0LlRyYW5zcG9ydChcIi90aHJpZnQvRGlhbG9nU2VydmljZVwiKTtcclxuICAgIHByb3RvY29sID0gbmV3IFRocmlmdC5Qcm90b2NvbCh0cmFuc3BvcnQpO1xyXG4gICAgYy5kaWFsb2dDbGllbnQgPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQubWVzc2FnZXNlcnZpY2UuRGlhbG9nU2VydmljZUNsaWVudChwcm90b2NvbCk7XHJcblxyXG4gICAgdHJhbnNwb3J0ID0gbmV3IFRocmlmdC5UcmFuc3BvcnQoXCIvdGhyaWZ0L1VzZXJTZXJ2aWNlXCIpO1xyXG4gICAgcHJvdG9jb2wgPSBuZXcgVGhyaWZ0LlByb3RvY29sKHRyYW5zcG9ydCk7XHJcbiAgICBjLnVzZXJDbGllbnQgPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQudXNlcnNlcnZpY2UuVXNlclNlcnZpY2VDbGllbnQocHJvdG9jb2wpO1xyXG5cclxuICAgIHRyYW5zcG9ydCA9IG5ldyBUaHJpZnQuVHJhbnNwb3J0KFwiL3RocmlmdC9CdXNpbmVzc1NlcnZpY2VcIik7XHJcbiAgICBwcm90b2NvbCA9IG5ldyBUaHJpZnQuUHJvdG9jb2wodHJhbnNwb3J0KTtcclxuICAgIGMuYnVzaW5lc3NDbGllbnQgPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQuYnVzaW5lc3NlcnZpY2UuQnVzaW5lc3NTZXJ2aWNlQ2xpZW50KHByb3RvY29sKTtcclxuICAgIC8vQnVzaW5lc3NTZXJ2aWNlQ2xpZW50KHByb3RvY29sKTtcclxuXHJcbiAgICBpZiAoaXNMb2dpbikgeyAvL3BhdGggIT0gJy9ibG9nJyAmJiBwYXRoICE9ICcvYWJvdXQnICYmIHBhdGggIT0gJy9jb250YWN0cydcclxuICAgICAgICBjLnVzZXJDbGllbnRHcm91cHMgPSBjLnVzZXJDbGllbnQuZ2V0VXNlckdyb3VwcygpO1xyXG4gICAgICAgIGMudXNlckNsaWVudFJ1YnJpY3MgPSBjLnVzZXJDbGllbnQuZ2V0VXNlclJ1YnJpY3MoKTtcclxuXHJcbiAgICAgICAgLy9jb25zb2xlLmxvZygnMTExJyxjLnVzZXJDbGllbnRSdWJyaWNzLGMudXNlckNsaWVudEdyb3Vwcyk7XHJcbiAgICAgICAgaWYgKGMudXNlckNsaWVudEdyb3Vwcy5sZW5ndGggPT0gMCkgZG9jdW1lbnQubG9jYXRpb24ucmVwbGFjZSgnL2xvZ2luJyk7XHJcblxyXG4gICAgICAgIGMuc2hvcnRVc2VySW5mbyA9IGMudXNlckNsaWVudC5nZXRTaG9ydFVzZXJJbmZvKCk7XHJcbiAgICAgICAgY29uc29sZS5sb2coJzAnLCBjLnNob3J0VXNlckluZm8pO1xyXG5cclxuICAgICAgICB2YXIgc2VydmljZXNTdHIgPSBjLnNob3J0VXNlckluZm8uc2VydmljZXMuam9pbignOycpO1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhjLnNob3J0VXNlckluZm8pO1xyXG4gICAgICAgIGlmIChzZXJ2aWNlc1N0ci5pbmRleE9mKCcxMCcpICE9IC0xKSBjLnNob3J0VXNlckluZm8uY291bnRlcnNFbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICBpZiAoc2VydmljZXNTdHIuaW5kZXhPZignMTEnKSAhPSAtMSkgYy5zaG9ydFVzZXJJbmZvLmNvdW50ZXJzQ29uZmlybWVkID0gdHJ1ZTtcclxuICAgICAgICBpZiAoc2VydmljZXNTdHIuaW5kZXhPZignMTInKSAhPSAtMSkgYy5zaG9ydFVzZXJJbmZvLmNvdW50ZXJzTm90aWZpY2F0aW9uID0gdHJ1ZTtcclxuICAgIH1cclxuLy9jb25zb2xlLmxvZygnMzMzJyxjLnVzZXJDbGllbnRHcm91cHMpO1xyXG5cclxuICAgIHRyYW5zcG9ydCA9IG5ldyBUaHJpZnQuVHJhbnNwb3J0KFwiL3RocmlmdC9VdGlsaXR5U2VydmljZVwiKTtcclxuICAgIHByb3RvY29sID0gbmV3IFRocmlmdC5Qcm90b2NvbCh0cmFuc3BvcnQpO1xyXG4gICAgYy51dGlsaXR5Q2xpZW50ID0gbmV3IGNvbS52bWVzdGVvbmxpbmUuYmUudGhyaWZ0LnV0aWxpdHlzZXJ2aWNlLlV0aWxpdHlTZXJ2aWNlQ2xpZW50KHByb3RvY29sKTtcclxuXHJcbiAgICB0cmFuc3BvcnQgPSBuZXcgVGhyaWZ0LlRyYW5zcG9ydChcIi90aHJpZnQvZnNcIik7XHJcbiAgICBwcm90b2NvbCA9IG5ldyBUaHJpZnQuUHJvdG9jb2wodHJhbnNwb3J0KTtcclxuICAgIGMuZmlsZUNsaWVudCA9IG5ldyBjb20udm1lc3Rlb25saW5lLmJlLnRocmlmdC5maWxlc2VydmljZS5GaWxlU2VydmljZUNsaWVudChwcm90b2NvbCk7XHJcblxyXG4gICAgYy53aXRoVGFncyA9IGZ1bmN0aW9uKHN0cil7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IHN0ci5yZXBsYWNlKC8mIzEwOy9nLCAnPGJyPicpOyAvLyDQv9GA0L7QsdC10Lsg0L/QvtGB0LvQtSA8YnI+INGB0L/QtdGG0LjQsNC70YzQvdC+LCDRh9GC0L7QsdGLINC90LUg0YHQu9C40L/QsNC70YHRjyDRgSDRgdGB0YvQu9C60LDQvNC4XHJcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LnJlcGxhY2UoL1xcbi9nLCAnPGJyPicpO1xyXG4gICAgICAgIC8qdmFyIHN0ckFyciA9IHJlc3VsdC5zcGxpdChcIiBcIiksXHJcblxyXG4gICAgICAgICBsZW4gPSBzdHJBcnIubGVuZ3RoLFxyXG4gICAgICAgICB0ZW1wU3RyO1xyXG5cclxuICAgICAgICAgcmVzdWx0ID0gXCJcIjtcclxuICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKXtcclxuICAgICAgICAgaWYoc3RyQXJyW2ldLmluZGV4T2YoXCJodHRwOi8vXCIpICE9IC0xIHx8IHN0ckFycltpXS5pbmRleE9mKFwiaHR0cHM6Ly9cIikgIT0gLTEpe1xyXG4gICAgICAgICAvL3RlbXBTdHIgPSBcIjxhIGhyZWY9J1wiKyBzdHJBcnJbaV0gK1wiJyB0YXJnZXQ9J19ibGFuayc+XCIrc3RyQXJyW2ldK1wiPC9hPlwiO1xyXG4gICAgICAgICB0ZW1wU3RyID0gc3RyQXJyW2ldLmxpbmsoc3RyQXJyW2ldKTtcclxuXHJcbiAgICAgICAgIHN0ckFycltpXSA9IHRlbXBTdHI7XHJcbiAgICAgICAgIH1cclxuXHJcbiAgICAgICAgIHJlc3VsdCArPSBzdHJBcnJbaV0rXCIgXCI7XHJcbiAgICAgICAgIH0qL1xyXG5cclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgYy53aXRob3V0VGFncyA9IGZ1bmN0aW9uKHN0cil7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IHN0ci5yZXBsYWNlKC88YnI+L2csICdcXG4nKTtcclxuICAgICAgICByZXN1bHQgPSByZXN1bHQucmVwbGFjZSgvPFtePl0rPi9nLCAnJyk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbi8qICAgIGMuZ2V0U3RyRnJvbUhUTUxDb2RlID0gZnVuY3Rpb24oc3RyKXtcclxuICAgICAgICAvL2FsZXJ0KHN0cik7XHJcbiAgICAgICAgdmFyIHN0ckFyciA9IHN0ci5zcGxpdCgnOycpLFxyXG4gICAgICAgICAgICBsZW4gPSBzdHJBcnIubGVuZ3RoLFxyXG4gICAgICAgICAgICBzeW1iID0gW10sIGNvdW50ZXIgPSAwLCByZXN1bHQgPSBcIlwiO1xyXG5cclxuXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgc3RyQXJyMiA9IHN0ckFycltpXS5zcGxpdChcIiBcIiksXHJcbiAgICAgICAgICAgICAgICBsZW4yID0gc3RyQXJyMi5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICBpZiAobGVuMiA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3RyQXJyMlswXS5pbmRleE9mKCcmJykgIT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2FsZXJ0KHN0ckFycjJbMF0uc3Vic3RyKC00KSA9PSAnJiMxMCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdHJBcnIyWzBdLnN1YnN0cigtNCkgIT0gJyYjMTAnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN5bWJbY291bnRlcl0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHN0ckFycjJbMF0uc3Vic3RyaW5nKDIpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9hbGVydChcIjAgXCIrc3RyQXJyMlswXS5zdWJzdHJpbmcoMikrXCIgXCIrU3RyaW5nLmZyb21DaGFyQ29kZShzdHJBcnIyWzBdLnN1YnN0cmluZygyKSkrXCIgXCIrc3ltYltjb3VudGVyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ltYltjb3VudGVyXSA9IHN0ckFycjJbMF0uc3Vic3RyaW5nKDAsIHN0ckFycjJbMF0ubGVuZ3RoIC0gNCkgKyAnXFxuJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9hbGVydChcIjEgXCIrc3RyQXJyMlswXS5zdWJzdHJpbmcoMikrXCIgXCIrU3RyaW5nLmZyb21DaGFyQ29kZShzdHJBcnIyWzBdLnN1YnN0cmluZygyKSkrXCIgXCIrc3ltYltjb3VudGVyXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzeW1iW2NvdW50ZXJdID0gc3RyQXJyW2ldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IHN5bWJbY291bnRlcisrXTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbGVuMjsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0ckFycjJbal0uaW5kZXhPZignJicpICE9IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHJBcnIyWzBdLnN1YnN0cigtNCkgIT0gJyYjMTAnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeW1iW2NvdW50ZXJdID0gU3RyaW5nLmZyb21DaGFyQ29kZShzdHJBcnIyW2pdLnN1YnN0cmluZygyKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeW1iW2NvdW50ZXJdID0gc3RyQXJyMltqXS5zdWJzdHJpbmcoMCwgc3RyQXJyMltqXS5sZW5ndGggLSA0KSArICdcXG4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ltYltjb3VudGVyXSA9IHN0ckFycjJbal07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIChqID09IGxlbjIgLSAxKSA/IHJlc3VsdCArPSBzeW1iW2NvdW50ZXIrK10gOiByZXN1bHQgKz0gc3ltYltjb3VudGVyKytdICsgXCIgXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vcmV0dXJuIHN5bWIuam9pbignJyk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH0qL1xyXG5cclxuICAgIGMuZ2V0RGVmYXVsdEdyb3VwID0gZnVuY3Rpb24oZ3JvdXBzKXtcclxuICAgICAgICB2YXIgbGVuID0gZ3JvdXBzLmxlbmd0aDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChncm91cHNbaV0udHlwZSA9PSA1KSByZXR1cm4gZ3JvdXBzW2ldO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGdyb3Vwc1swXTtcclxuICAgIH1cclxuXHJcbiAgICBjLnNob3dHcm91cE92ZXJCdWlsZGluZyA9IGZ1bmN0aW9uKGdyb3VwcywgY3VycmVudEdyb3VwKXtcclxuICAgICAgICB2YXIgbGVuID0gZ3JvdXBzLmxlbmd0aDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChncm91cHNbaV0udHlwZSA8IDQpIHtcclxuICAgICAgICAgICAgICAgIGdyb3Vwc1tpXS5pc1Nob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSAvLzQgPSBCVUlMRElOR1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjLmdldEJ1aWxkaW5nR3JvdXAgPSBmdW5jdGlvbihjdXJyZW50R3JvdXApe1xyXG4gICAgICAgIHZhciBsZW4gPSBjLnVzZXJDbGllbnRHcm91cHMubGVuZ3RoLFxyXG4gICAgICAgICAgICBncm91cDtcclxuICAgICAgICBpZiAoY3VycmVudEdyb3VwLnR5cGUgPCA0KSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbGVuOyBqKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChjLnVzZXJDbGllbnRHcm91cHNbal0udHlwZSA9PSA0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXAgPSBjLnVzZXJDbGllbnRHcm91cHNbal07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGdyb3VwO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50R3JvdXA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBjLmdldENvcnJlY3REYXRlID0gZnVuY3Rpb24oc3RyKXtcclxuICAgICAgICB2YXIgYXJyRGF0ZSA9IHN0ci5zcGxpdCgvWy4vXS8pLFxyXG4gICAgICAgICAgICBtb250aCA9IGFyckRhdGVbMV0sXHJcbiAgICAgICAgICAgIG1vbnRoU3RyO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKG1vbnRoKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCIwMVwiOlxyXG4gICAgICAgICAgICAgICAgbW9udGhTdHIgPSBcIkphblwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCIwMlwiOlxyXG4gICAgICAgICAgICAgICAgbW9udGhTdHIgPSBcIkZlYlwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCIwM1wiOlxyXG4gICAgICAgICAgICAgICAgbW9udGhTdHIgPSBcIk1hclwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCIwNFwiOlxyXG4gICAgICAgICAgICAgICAgbW9udGhTdHIgPSBcIkFwclwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCIwNVwiOlxyXG4gICAgICAgICAgICAgICAgbW9udGhTdHIgPSBcIk1heVwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCIwNlwiOlxyXG4gICAgICAgICAgICAgICAgbW9udGhTdHIgPSBcIkp1bmVcIjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwiMDdcIjpcclxuICAgICAgICAgICAgICAgIG1vbnRoU3RyID0gXCJKdWx5XCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcIjA4XCI6XHJcbiAgICAgICAgICAgICAgICBtb250aFN0ciA9IFwiQXVnXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcIjA5XCI6XHJcbiAgICAgICAgICAgICAgICBtb250aFN0ciA9IFwiU2VwXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcIjEwXCI6XHJcbiAgICAgICAgICAgICAgICBtb250aFN0ciA9IFwiT2N0XCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcIjExXCI6XHJcbiAgICAgICAgICAgICAgICBtb250aFN0ciA9IFwiTm92XCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcIjEyXCI6XHJcbiAgICAgICAgICAgICAgICBtb250aFN0ciA9IFwiRGVjXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBhcnJEYXRlWzBdICsgXCIgXCIgKyBtb250aFN0ciArIFwiIFwiICsgYXJyRGF0ZVsyXTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgYy5yZXNldFBhZ2VzID0gZnVuY3Rpb24oYmFzZSl7XHJcbiAgICAgICAgYmFzZS5uZWlnaGJvdXJzSXNBY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICBiYXNlLnByaXZhdGVNZXNzYWdlc0lzQWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgYmFzZS5tYXBzSXNBY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICBiYXNlLnByb2ZpbGVJc0FjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIGJhc2Uuc2V0dGluZ3NJc0FjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIGJhc2UudGFsa3NJc0FjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIGJhc2UubGVudGFJc0FjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIGJhc2UuYWR2ZXJ0c0lzQWN0aXZlID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgYy5yZXNldEFjZU5hdkJ0bnMgPSBmdW5jdGlvbihuYXZiYXIpe1xyXG4gICAgICAgIG5hdmJhci5uZWlnaGJvdXJzQnRuU3RhdHVzID0gXCJcIjtcclxuICAgICAgICBuYXZiYXIucHJpdmF0ZU1lc3NhZ2VzQnRuU3RhdHVzID0gXCJcIjtcclxuICAgICAgICBuYXZiYXIubWFwc0J0blN0YXR1cyA9IFwiXCI7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGJhc2U2NGVuY29kZSA9IGZ1bmN0aW9uKHN0cil7XHJcbiAgICAgICAgLy8g0KHQuNC80LLQvtC70Ysg0LTQu9GPIGJhc2U2NC3Qv9GA0LXQvtCx0YDQsNC30L7QstCw0L3QuNGPXHJcbiAgICAgICAgdmFyIGI2NGNoYXJzID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZycgK1xyXG4gICAgICAgICAgICAnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0nO1xyXG4gICAgICAgIHZhciBiNjRlbmNvZGVkID0gJyc7XHJcbiAgICAgICAgdmFyIGNocjEsIGNocjIsIGNocjM7XHJcbiAgICAgICAgdmFyIGVuYzEsIGVuYzIsIGVuYzMsIGVuYzQ7XHJcblxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDspIHtcclxuICAgICAgICAgICAgY2hyMSA9IHN0ci5jaGFyQ29kZUF0KGkrKyk7XHJcbiAgICAgICAgICAgIGNocjIgPSBzdHIuY2hhckNvZGVBdChpKyspO1xyXG4gICAgICAgICAgICBjaHIzID0gc3RyLmNoYXJDb2RlQXQoaSsrKTtcclxuXHJcbiAgICAgICAgICAgIGVuYzEgPSBjaHIxID4+IDI7XHJcbiAgICAgICAgICAgIGVuYzIgPSAoKGNocjEgJiAzKSA8PCA0KSB8IChjaHIyID4+IDQpO1xyXG5cclxuICAgICAgICAgICAgZW5jMyA9IGlzTmFOKGNocjIpID8gNjQgOiAoKChjaHIyICYgMTUpIDw8IDIpIHwgKGNocjMgPj4gNikpO1xyXG4gICAgICAgICAgICBlbmM0ID0gaXNOYU4oY2hyMykgPyA2NCA6IChjaHIzICYgNjMpO1xyXG5cclxuICAgICAgICAgICAgYjY0ZW5jb2RlZCArPSBiNjRjaGFycy5jaGFyQXQoZW5jMSkgKyBiNjRjaGFycy5jaGFyQXQoZW5jMikgK1xyXG4gICAgICAgICAgICAgICAgYjY0Y2hhcnMuY2hhckF0KGVuYzMpICsgYjY0Y2hhcnMuY2hhckF0KGVuYzQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYjY0ZW5jb2RlZDtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgaW5zZXJ0RG9jID0gZnVuY3Rpb24oc2VsZWN0b3IsIGF0dGFjaEFyZWFTZWxlY3RvciwgZmlsZUxhYmVsKXtcclxuICAgICAgICB2YXIgZG9jTmFtZSA9IGZpbGVMYWJlbC5maW5kKCcuZmlsZS1uYW1lJykuYXR0cignZGF0YS10aXRsZScpO1xyXG5cclxuICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICByZWFkZXIucmVhZEFzQmluYXJ5U3RyaW5nKHNlbGVjdG9yWzBdLmZpbGVzWzBdKTtcclxuICAgICAgICB2YXIgZGF0YVR5cGUgPSBzZWxlY3RvclswXS5maWxlc1swXS50eXBlO1xyXG5cclxuICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgZG9jc0Jhc2U2NFthdHRhY2hBcmVhU2VsZWN0b3JdW2RvY3NJbmRbYXR0YWNoQXJlYVNlbGVjdG9yXV0gPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQubWVzc2FnZXNlcnZpY2UuQXR0YWNoKCk7XHJcbiAgICAgICAgICAgIGRvY3NCYXNlNjRbYXR0YWNoQXJlYVNlbGVjdG9yXVtkb2NzSW5kW2F0dGFjaEFyZWFTZWxlY3Rvcl1dLmZpbGVOYW1lID0gZG9jTmFtZTtcclxuICAgICAgICAgICAgZG9jc0Jhc2U2NFthdHRhY2hBcmVhU2VsZWN0b3JdW2RvY3NJbmRbYXR0YWNoQXJlYVNlbGVjdG9yXV0uY29udGVudFR5cGUgPSBkYXRhVHlwZTtcclxuICAgICAgICAgICAgdmFyIHVybCA9IGRvY3NCYXNlNjRbYXR0YWNoQXJlYVNlbGVjdG9yXVtkb2NzSW5kW2F0dGFjaEFyZWFTZWxlY3Rvcl1dLlVSTCA9IGMuZmlsZUNsaWVudC5zYXZlRmlsZUNvbnRlbnQoYmFzZTY0ZW5jb2RlKHJlYWRlci5yZXN1bHQpKTtcclxuICAgICAgICAgICAgZG9jc0luZFthdHRhY2hBcmVhU2VsZWN0b3JdKys7XHJcblxyXG4gICAgICAgICAgICBhdHRhY2hBcmVhU2VsZWN0b3IuYXBwZW5kKFwiPHNwYW4gY2xhc3M9J2F0dGFjaC1pdGVtIG5ldy1hdHRhY2hlZCcgZGF0YS1ocmVmPSdcIiArIHVybCArIFwiJyBkYXRhLXR5cGU9J1wiICsgZGF0YVR5cGUgKyBcIic+XCIgK1xyXG4gICAgICAgICAgICAgICAgXCI8YSBocmVmPScjJyB0aXRsZT0n0J3QtSDQv9GA0LjQutGA0LXQv9C70Y/RgtGMJyBjbGFzcz0ncmVtb3ZlLWF0dGFjaC1pbWcnPiZ0aW1lczs8L2E+XCIgK1xyXG4gICAgICAgICAgICAgICAgJzxzcGFuPicgKyBkb2NOYW1lICsgJzwvc3Bhbj4nICtcclxuICAgICAgICAgICAgICAgIFwiPC9zcGFuPlwiKTtcclxuXHJcbiAgICAgICAgICAgICQoJy5uZXctYXR0YWNoZWQgLnJlbW92ZS1hdHRhY2gtaW1nJykuY2xpY2soZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIHZhciBhdHRhY2hJdGVtID0gJCh0aGlzKS5jbG9zZXN0KCcuYXR0YWNoLWl0ZW0nKTtcclxuICAgICAgICAgICAgICAgIHZhciBpbmQgPSBhdHRhY2hJdGVtLmluZGV4KCk7XHJcbiAgICAgICAgICAgICAgICBhdHRhY2hJdGVtLmhpZGUoKS5kZXRhY2goKTtcclxuICAgICAgICAgICAgICAgIGRvY3NCYXNlNjRbYXR0YWNoQXJlYVNlbGVjdG9yXS5zcGxpY2UoaW5kLCAxKTtcclxuICAgICAgICAgICAgICAgIGMuZmlsZUNsaWVudC5kZWxldGVGaWxlKHVybCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJCgnLm5ldy1hdHRhY2hlZCcpLnJlbW92ZUNsYXNzKCduZXctYXR0YWNoZWQnKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgIH1cclxuXHJcbiAgICB2YXIgY29weUltYWdlID0gZnVuY3Rpb24oYXR0YWNoQXJlYVNlbGVjdG9yLCBmaWxlTGFiZWwsIHR5cGUpe1xyXG4gICAgICAgIHZhciBjb3B5SW1nU3JjID0gZmlsZUxhYmVsLmZpbmQoJy5maWxlLW5hbWUgaW1nJykuY3NzKCdiYWNrZ3JvdW5kLWltYWdlJyk7XHJcblxyXG4gICAgICAgIGlmIChjb3B5SW1nU3JjID09ICdub25lJyB8fCAhY29weUltZ1NyYykge1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGNvcHlJbWFnZSwgMjAwLCBhdHRhY2hBcmVhU2VsZWN0b3IsIGZpbGVMYWJlbCwgdHlwZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgIHZhciB1cmwgPSBjLmZpbGVDbGllbnQuc2F2ZUZpbGVDb250ZW50KGNvcHlJbWdTcmMsIHRydWUpLFxyXG4gICAgICAgICAgICAgICAgZmlsZU5hbWUgPSBmaWxlTGFiZWwuZmluZCgnLmZpbGUtbmFtZScpLmF0dHIoJ2RhdGEtdGl0bGUnKTtcclxuXHJcbiAgICAgICAgICAgIGF0dGFjaEFyZWFTZWxlY3Rvci5maW5kKCcubG9hZGluZycpLmFkZENsYXNzKCdoaWRkZW4nKTtcclxuXHJcbiAgICAgICAgICAgIGF0dGFjaEFyZWFTZWxlY3Rvci5maW5kKCcubG9hZGluZycpLmJlZm9yZShcIjxzcGFuIGNsYXNzPSdhdHRhY2gtaXRlbSBuZXctYXR0YWNoZWQnPlwiICtcclxuICAgICAgICAgICAgICAgIFwiPGEgaHJlZj0nIycgdGl0bGU9J9Cd0LUg0L/RgNC40LrRgNC10L/Qu9GP0YLRjCcgY2xhc3M9J3JlbW92ZS1hdHRhY2gtaW1nJz4mdGltZXM7PC9hPlwiICtcclxuICAgICAgICAgICAgICAgIFwiPGltZyBkYXRhLXRpdGxlPSdcIiArIGZpbGVOYW1lICsgXCInIGRhdGEtdHlwZT0nXCIgKyB0eXBlICsgXCInIGNsYXNzPSdhdHRhY2hlZC1pbWcnIHN0eWxlPSdiYWNrZ3JvdW5kLWltYWdlOnVybChcIiArIHVybCArIFwiKSc+PC9zcGFuPlwiKTtcclxuXHJcbiAgICAgICAgICAgICQoJy5uZXctYXR0YWNoZWQgLnJlbW92ZS1hdHRhY2gtaW1nJykuY2xpY2soZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgnLmF0dGFjaC1pdGVtJykuaGlkZSgpLmRldGFjaCgpO1xyXG4gICAgICAgICAgICAgICAgYy5maWxlQ2xpZW50LmRlbGV0ZUZpbGUodXJsKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKCcubmV3LWF0dGFjaGVkJykucmVtb3ZlQ2xhc3MoJ25ldy1hdHRhY2hlZCcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjLmluaXRBdHRhY2hJbWFnZSA9IGZ1bmN0aW9uKHNlbGVjdG9yLCBhdHRhY2hBcmVhU2VsZWN0b3Ipe1xyXG4gICAgICAgIHZhciB0aXRsZTtcclxuICAgICAgICAvLyDQvdCwINGB0LvRg9GH0LDQuSDQtdGB0LvQuCDQsdGD0LTQtdGCINC/0YDQuNC60YDQtdC/0LvRj9GC0YzRgdGPINC90LUg0YTQsNC50LtcclxuICAgICAgICBkb2NzQmFzZTY0W2F0dGFjaEFyZWFTZWxlY3Rvcl0gPSBbXTtcclxuICAgICAgICBkb2NzSW5kW2F0dGFjaEFyZWFTZWxlY3Rvcl0gPSAwO1xyXG5cclxuICAgICAgICBzZWxlY3Rvci5hY2VfZmlsZV9pbnB1dCh7XHJcbiAgICAgICAgICAgIHN0eWxlOiAnd2VsbCcsXHJcbiAgICAgICAgICAgIGJ0bl9jaG9vc2U6ICfQmNC30L7QsdGA0LDQttC10L3QuNC1JyxcclxuICAgICAgICAgICAgYnRuX2NoYW5nZTogbnVsbCxcclxuICAgICAgICAgICAgbm9faWNvbjogJycsXHJcbiAgICAgICAgICAgIGRyb3BwYWJsZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGh1bWJuYWlsOiAnbGFyZ2UnLFxyXG4gICAgICAgICAgICBpY29uX3JlbW92ZTogbnVsbCxcclxuICAgICAgICAgICAgYmVmb3JlX2NoYW5nZTogZnVuY3Rpb24gKGZpbGVzLCBkcm9wcGVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aXRsZSA9ICQodGhpcykuZmluZCgnKy5maWxlLWxhYmVsJykuZGF0YSgndGl0bGUnKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSkub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGZpbGVMYWJlbCA9ICQodGhpcykuZmluZCgnKy5maWxlLWxhYmVsJyk7XHJcbiAgICAgICAgICAgIGZpbGVMYWJlbC5hdHRyKCdkYXRhLXRpdGxlJywgdGl0bGUpLnJlbW92ZUNsYXNzKCdoaWRlLXBsYWNlaG9sZGVyJyk7XHJcbiAgICAgICAgICAgIGZpbGVMYWJlbC5maW5kKCcuZmlsZS1uYW1lJykuaGlkZSgpO1xyXG5cclxuICAgICAgICAgICAgdmFyIHR5cGUgPSBzZWxlY3RvclswXS5maWxlc1swXS50eXBlO1xyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGUuaW5kZXhPZignaW1hZ2UnKSAhPSAtMSkge1xyXG4gICAgICAgICAgICAgICAgLy/QtdGB0LvQuCDQutCw0YDRgtC40L3QutCwXHJcbiAgICAgICAgICAgICAgICBhdHRhY2hBcmVhU2VsZWN0b3IuZmluZCgnLmxvYWRpbmcnKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBteUFyZWEgPSBhdHRhY2hBcmVhU2VsZWN0b3I7XHJcbiAgICAgICAgICAgICAgICBpZiAoYXR0YWNoQXJlYVNlbGVjdG9yLnNlbGVjdG9yLmluZGV4T2YoJ2RvYy1hcmVhJykgIT0gLTEpXHJcbiAgICAgICAgICAgICAgICAgICAgbXlBcmVhID0gJChhdHRhY2hBcmVhU2VsZWN0b3Iuc2VsZWN0b3IucmVwbGFjZSgnZG9jLWFyZWEnLCAnYXJlYScpKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGNvcHlJbWFnZSwgMjAwLCBteUFyZWEsIGZpbGVMYWJlbCwgdHlwZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyDQtdGB0LvQuCDQtNGA0YPQs9C+0Lkg0YTQsNC50LtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgbXlBcmVhID0gYXR0YWNoQXJlYVNlbGVjdG9yO1xyXG4gICAgICAgICAgICAgICAgaWYgKGF0dGFjaEFyZWFTZWxlY3Rvci5zZWxlY3Rvci5pbmRleE9mKCdkb2MtYXJlYScpID09IC0xKVxyXG4gICAgICAgICAgICAgICAgICAgIG15QXJlYSA9ICQoYXR0YWNoQXJlYVNlbGVjdG9yLnNlbGVjdG9yLnJlcGxhY2UoJ2FyZWEnLCAnZG9jLWFyZWEnKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChpbnNlcnREb2MsIDIwMCwgc2VsZWN0b3IsIG15QXJlYSwgZmlsZUxhYmVsKTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGRvY3NCYXNlNjQgPSBbXSxcclxuICAgICAgICBkb2NzSW5kID0gW107XHJcblxyXG4gICAgYy5pbml0QXR0YWNoRG9jID0gZnVuY3Rpb24oc2VsZWN0b3IsIGF0dGFjaEFyZWFTZWxlY3Rvcil7XHJcbiAgICAgICAgdmFyIHRpdGxlO1xyXG4gICAgICAgIGRvY3NCYXNlNjRbYXR0YWNoQXJlYVNlbGVjdG9yXSA9IFtdO1xyXG4gICAgICAgIGRvY3NJbmRbYXR0YWNoQXJlYVNlbGVjdG9yXSA9IDA7XHJcblxyXG4gICAgICAgIHNlbGVjdG9yLmFjZV9maWxlX2lucHV0KHtcclxuICAgICAgICAgICAgc3R5bGU6ICd3ZWxsJyxcclxuICAgICAgICAgICAgYnRuX2Nob29zZTogJ9CU0L7QutGD0LzQtdC90YInLFxyXG4gICAgICAgICAgICBidG5fY2hhbmdlOiBudWxsLFxyXG4gICAgICAgICAgICBub19pY29uOiAnJyxcclxuICAgICAgICAgICAgZHJvcHBhYmxlOiB0cnVlLFxyXG4gICAgICAgICAgICB0aHVtYm5haWw6ICdsYXJnZScsXHJcbiAgICAgICAgICAgIGljb25fcmVtb3ZlOiBudWxsLFxyXG4gICAgICAgICAgICBiZWZvcmVfY2hhbmdlOiBmdW5jdGlvbiAoZmlsZXMsIGRyb3BwZWQpIHtcclxuICAgICAgICAgICAgICAgIHRpdGxlID0gJCh0aGlzKS5maW5kKCcrLmZpbGUtbGFiZWwnKS5kYXRhKCd0aXRsZScpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgZmlsZUxhYmVsID0gJCh0aGlzKS5maW5kKCcrLmZpbGUtbGFiZWwnKTtcclxuICAgICAgICAgICAgZmlsZUxhYmVsLmF0dHIoJ2RhdGEtdGl0bGUnLCB0aXRsZSkucmVtb3ZlQ2xhc3MoJ2hpZGUtcGxhY2Vob2xkZXInKTtcclxuICAgICAgICAgICAgZmlsZUxhYmVsLmZpbmQoJy5maWxlLW5hbWUnKS5oaWRlKCk7XHJcblxyXG4gICAgICAgICAgICAvL3NldFRpbWVvdXQoaW5zZXJ0RG9jLDIwMCxzZWxlY3RvcixhdHRhY2hBcmVhU2VsZWN0b3IsZmlsZUxhYmVsKTtcclxuXHJcbiAgICAgICAgICAgIHZhciB0eXBlID0gc2VsZWN0b3JbMF0uZmlsZXNbMF0udHlwZTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0eXBlLmluZGV4T2YoJ2ltYWdlJykgIT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIC8v0LXRgdC70Lgg0LrQsNGA0YLQuNC90LrQsFxyXG4gICAgICAgICAgICAgICAgYXR0YWNoQXJlYVNlbGVjdG9yLmZpbmQoJy5sb2FkaW5nJykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBteUFyZWEgPSBhdHRhY2hBcmVhU2VsZWN0b3I7XHJcbiAgICAgICAgICAgICAgICBpZiAoYXR0YWNoQXJlYVNlbGVjdG9yLnNlbGVjdG9yLmluZGV4T2YoJ2RvYy1hcmVhJykgIT0gLTEpXHJcbiAgICAgICAgICAgICAgICAgICAgbXlBcmVhID0gJChhdHRhY2hBcmVhU2VsZWN0b3Iuc2VsZWN0b3IucmVwbGFjZSgnZG9jLWFyZWEnLCAnYXJlYScpKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGNvcHlJbWFnZSwgMjAwLCBteUFyZWEsIGZpbGVMYWJlbCwgdHlwZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyDQtdGB0LvQuCDQtNGA0YPQs9C+0Lkg0YTQsNC50LtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgbXlBcmVhID0gYXR0YWNoQXJlYVNlbGVjdG9yO1xyXG4gICAgICAgICAgICAgICAgaWYgKGF0dGFjaEFyZWFTZWxlY3Rvci5zZWxlY3Rvci5pbmRleE9mKCdkb2MtYXJlYScpID09IC0xKVxyXG4gICAgICAgICAgICAgICAgICAgIG15QXJlYSA9ICQoYXR0YWNoQXJlYVNlbGVjdG9yLnNlbGVjdG9yLnJlcGxhY2UoJ2FyZWEnLCAnZG9jLWFyZWEnKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChpbnNlcnREb2MsIDIwMCwgc2VsZWN0b3IsIG15QXJlYSwgZmlsZUxhYmVsKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjLnNlbGVjdEdyb3VwSW5Ecm9wZG93biA9IGZ1bmN0aW9uKGdyb3VwSWQpe1xyXG4gICAgICAgIHZhciBncm91cHNMZW5ndGggPSBjLnVzZXJDbGllbnRHcm91cHMubGVuZ3RoLFxyXG4gICAgICAgICAgICBzZWxlY3RlZEdyb3VwO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ3JvdXBzTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGdyb3VwSWQgPT0gYy51c2VyQ2xpZW50R3JvdXBzW2ldLmlkKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEdyb3VwID0gYy51c2VyQ2xpZW50R3JvdXBzW2ldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzZWxlY3RlZEdyb3VwO1xyXG4gICAgfVxyXG5cclxuICAgIGMuZ2V0VGltaW5nID0gZnVuY3Rpb24obWVzc2FnZU9iakRhdGUpe1xyXG4gICAgICAgIHZhciBtaW51dGUgPSA2MCAqIDEwMDAsXHJcbiAgICAgICAgICAgIGhvdXIgPSBtaW51dGUgKiA2MCxcclxuICAgICAgICAgICAgZGF5ID0gaG91ciAqIDI0LFxyXG4gICAgICAgICAgICB0aHJlZURheXMgPSBkYXkgKiAzLFxyXG4gICAgICAgICAgICBub3cgPSBEYXRlLnBhcnNlKG5ldyBEYXRlKCkpLFxyXG4gICAgICAgICAgICB0aW1pbmcgPSAobm93IC0gbWVzc2FnZU9iakRhdGUgKiAxMDAwKSxcclxuICAgICAgICAgICAgdGltZVRlbXA7XHJcblxyXG4gICAgICAgIGlmICh0aW1pbmcgPCBtaW51dGUpIHtcclxuICAgICAgICAgICAgdGltaW5nID0gXCLRgtC+0LvRjNC60L4g0YfRgtC+XCI7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aW1pbmcgPCBob3VyKSB7XHJcbiAgICAgICAgICAgIHRpbWluZyA9IG5ldyBEYXRlKHRpbWluZyk7XHJcbiAgICAgICAgICAgIC8vdGltaW5nID0gdGltaW5nLmdldE1pbnV0ZXMoKStcIiDQvNC40L0g0L3QsNC30LDQtFwiO1xyXG4gICAgICAgICAgICB0aW1pbmcgPSAodGltaW5nIC8gbWludXRlKS50b0ZpeGVkKDApICsgXCIg0LzQuNC9INC90LDQt9Cw0LRcIjtcclxuICAgICAgICB9IGVsc2UgaWYgKHRpbWluZyA8IGRheSkge1xyXG4gICAgICAgICAgICB0aW1pbmcgPSBuZXcgRGF0ZSh0aW1pbmcpO1xyXG4gICAgICAgICAgICAvL3RpbWVUZW1wID0gdGltaW5nLmdldEhvdXJzKCk7XHJcbiAgICAgICAgICAgIHRpbWVUZW1wID0gKHRpbWluZyAvIGhvdXIpLnRvRml4ZWQoMCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGltZVRlbXAgPT0gMSB8fCB0aW1lVGVtcCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aW1pbmcgPSBcIjEg0YfQsNGBINC90LDQt9Cw0LRcIjtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aW1lVGVtcCA+IDEgJiYgdGltZVRlbXAgPCA1KSB7XHJcbiAgICAgICAgICAgICAgICB0aW1pbmcgPSB0aW1lVGVtcCArIFwiINGH0LDRgdCwINC90LDQt9Cw0LRcIjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRpbWluZyA9IHRpbWVUZW1wICsgXCIg0YfQsNGB0L7QsiDQvdCw0LfQsNC0XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKHRpbWluZyA8IHRocmVlRGF5cykge1xyXG4gICAgICAgICAgICB0aW1pbmcgPSBuZXcgRGF0ZSh0aW1pbmcpO1xyXG4gICAgICAgICAgICAvL3RpbWVUZW1wID0gdGltaW5nLmdldERhdGUoKTtcclxuICAgICAgICAgICAgdGltZVRlbXAgPSAodGltaW5nIC8gZGF5KS50b0ZpeGVkKDApO1xyXG4gICAgICAgICAgICBpZiAodGltZVRlbXAgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgdGltaW5nID0gdGltZVRlbXAgKyBcIiDQtNC10L3RjCDQvdCw0LfQsNC0XCI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aW1pbmcgPSB0aW1lVGVtcCArIFwiINC00L3RjyDQvdCw0LfQsNC0XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aW1lVGVtcCA9IG5ldyBEYXRlKG1lc3NhZ2VPYmpEYXRlICogMTAwMCkudG9Mb2NhbGVEYXRlU3RyaW5nKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgYXJyID0gdGltZVRlbXAuc3BsaXQoL1suL10vKTtcclxuICAgICAgICAgICAgaWYgKGFyclswXS5sZW5ndGggPT0gMSkgYXJyWzBdID0gXCIwXCIgKyBhcnJbMF07XHJcbiAgICAgICAgICAgIGlmIChhcnJbMV0ubGVuZ3RoID09IDEpIGFyclsxXSA9IFwiMFwiICsgYXJyWzFdO1xyXG4gICAgICAgICAgICB0aW1pbmcgPSBhcnJbMF0gKyBcIi5cIiArIGFyclsxXSArIFwiLlwiICsgYXJyWzJdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRpbWluZztcclxuICAgIH1cclxuXHJcbiAgICBjLmdldExhYmVsID0gZnVuY3Rpb24oZ3JvdXBzQXJyYXksIGdyb3VwVHlwZSl7XHJcbiAgICAgICAgdmFyIGdyb3Vwc0FycmF5TGVuID0gZ3JvdXBzQXJyYXkubGVuZ3RoO1xyXG4gICAgICAgIHZhciBsYWJlbCA9IFwiXCI7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBncm91cHNBcnJheUxlbjsgaSsrKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoZ3JvdXBzQXJyYXlbaV0udHlwZSA9PSBncm91cFR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGxhYmVsID0gZ3JvdXBzQXJyYXlbaV0udmlzaWJsZU5hbWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBsYWJlbDtcclxuICAgIH1cclxuXHJcbiAgICBjLmdldEF1dGhvck5hbWUgPSBmdW5jdGlvbih1c2VySW5mbyl7XHJcbiAgICAgICAgdmFyIHVzZXJJbmYgPSB1c2VySW5mbztcclxuICAgICAgICBpZiAoIXVzZXJJbmZvKSB7XHJcbiAgICAgICAgICAgIHVzZXJJbmYgPSBjLnNob3J0VXNlckluZm87XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdXNlckluZi5maXJzdE5hbWUgKyBcIiBcIiArIHVzZXJJbmYubGFzdE5hbWU7XHJcbiAgICB9XHJcblxyXG4gICAgYy5nZXRUYWdDb2xvciA9IGZ1bmN0aW9uKGxhYmVsTmFtZSl7XHJcbiAgICAgICAgdmFyIGNvbG9yLFxyXG4gICAgICAgICAgICBsZW4gPSBjLnVzZXJDbGllbnRHcm91cHMubGVuZ3RoO1xyXG5cclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChsYWJlbE5hbWUgPT0gYy51c2VyQ2xpZW50R3JvdXBzW2ldLnZpc2libGVOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaSA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sb3IgPSAnbGFiZWwtcGluayc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yID0gJ2xhYmVsLXN1Y2Nlc3MnOyAvLyBncmVlblxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpID09IDIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb2xvciA9ICdsYWJlbC15ZWxsb3cnO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpID09IDMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb2xvciA9ICdsYWJlbC1wdXJwbGUnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjb2xvcjtcclxuICAgIH1cclxuXHJcbiAgICBjLmdldFRvcGljUnVicmljID0gZnVuY3Rpb24odG9waWMpe1xyXG4gICAgICAgIHZhciBsZW4gPSBjLnVzZXJDbGllbnRSdWJyaWNzLmxlbmd0aCxcclxuICAgICAgICAgICAgcnVicmljO1xyXG5cclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChjLnVzZXJDbGllbnRSdWJyaWNzW2ldLmlkID09IHRvcGljLnJ1YnJpY0lkKSB7XHJcbiAgICAgICAgICAgICAgICBydWJyaWMgPSBjLnVzZXJDbGllbnRSdWJyaWNzW2ldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcnVicmljXHJcbiAgICB9O1xyXG5cclxuICAgIGMuc2V0UG9sbCA9IGZ1bmN0aW9uKHBvbGwsIHBvbGxJbnB1dHMpe1xyXG4gICAgICAgIHZhciBjb3VudGVyRm9yUG9sbCA9IDAsXHJcbiAgICAgICAgICAgIHBvbGxJbnB1dHNMZW5ndGggPSBwb2xsSW5wdXRzLmxlbmd0aDtcclxuXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwb2xsSW5wdXRzTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKHBvbGxJbnB1dHNbaV0ubmFtZSAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICBwb2xsLm5hbWVzW2NvdW50ZXJGb3JQb2xsXSA9IHBvbGxJbnB1dHNbaV0ubmFtZTtcclxuICAgICAgICAgICAgICAgIHBvbGwuZWRpdE5hbWVzW2NvdW50ZXJGb3JQb2xsXSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogY291bnRlckZvclBvbGwrKyxcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBwb2xsSW5wdXRzW2ldLm5hbWVcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGMucG9zdFRvcGljID0gZnVuY3Rpb24ob2JqLCBpc1dhbGwsIGlzQWR2ZXJ0cywgJGZpbHRlcil7XHJcbiAgICAgICAgaWYgKG9iai5pZCkge1xyXG4gICAgICAgICAgICAvLyDQt9C90LDRh9C40YIg0YDQtdC00LDQutGC0LjRgNC+0LLQsNC90LjQtVxyXG4gICAgICAgICAgICBpZiAob2JqLmlzUG9sbFNob3cpIHtcclxuICAgICAgICAgICAgICAgIC8vINGBINC+0L/RgNC+0YHQvtC8XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLnBvbGwgJiYgb2JqLnBvbGwucG9sbElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g0YDQtdC00LDQutGC0LjRgNC+0LLQsNC90LjQtSDQvtC/0YDQvtGB0LBcclxuICAgICAgICAgICAgICAgICAgICBvYmoucG9sbC5zdWJqZWN0ID0gb2JqLnBvbGxTdWJqZWN0O1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5wb2xsLm5hbWVzID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGMuc2V0UG9sbChvYmoucG9sbCwgb2JqLnBvbGxJbnB1dHMpO1xyXG5cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g0YHQvtC30LTQsNC90LjQtSDQvtC/0YDQvtGB0LBcclxuICAgICAgICAgICAgICAgICAgICBwb2xsID0gbmV3IGNvbS52bWVzdGVvbmxpbmUuYmUudGhyaWZ0Lm1lc3NhZ2VzZXJ2aWNlLlBvbGwoKTtcclxuICAgICAgICAgICAgICAgICAgICBwb2xsLnBvbGxJZCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgcG9sbC5lZGl0TmFtZXMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBwb2xsLm5hbWVzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgcG9sbC5zdWJqZWN0ID0gb2JqLnBvbGxTdWJqZWN0O1xyXG4gICAgICAgICAgICAgICAgICAgIHBvbGwuYWxyZWFkeVBvbGwgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYy5zZXRQb2xsKHBvbGwsIG9iai5wb2xsSW5wdXRzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnBvbGwgPSBwb2xsO1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5tZXRhVHlwZSA9IFwicG9sbFwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb2JqLnBvbGwgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBvYmoubWVzc2FnZS5pbWFnZXMgPSBvYmouYXR0YWNoZWRJbWFnZXM7XHJcbiAgICAgICAgICAgIG9iai5tZXNzYWdlLmRvY3VtZW50cyA9IG9iai5hdHRhY2hlZERvY3M7XHJcbiAgICAgICAgICAgIG9iai5tZXNzYWdlLmdyb3VwSWQgPSBvYmouc2VsZWN0ZWRHcm91cC5pZDtcclxuICAgICAgICAgICAgLy9vYmoubWVzc2FnZS5jb250ZW50ID0gYy53aXRoVGFncyhvYmoubWVzc2FnZS5jb250ZW50KTtcclxuXHJcbiAgICAgICAgICAgIG9iai5tZXNzYWdlLmNvbnRlbnQgPSAkZmlsdGVyKCdsaW5reScpKG9iai5tZXNzYWdlLmNvbnRlbnQsICdibGFuaycpO1xyXG4gICAgICAgICAgICBvYmoubWVzc2FnZS5jb250ZW50ID0gYy53aXRoVGFncyhvYmoubWVzc2FnZS5jb250ZW50KTtcclxuXHJcbiAgICAgICAgICAgIG9iai5sYWJlbCA9IGMuZ2V0TGFiZWwoYy51c2VyQ2xpZW50R3JvdXBzLCBvYmouc2VsZWN0ZWRHcm91cC50eXBlKTtcclxuICAgICAgICAgICAgb2JqLnRhZ0NvbG9yID0gYy5nZXRUYWdDb2xvcihvYmoubGFiZWwpO1xyXG4gICAgICAgICAgICBvYmouc2VsZWN0ZWRSdWJyaWMuaWQgPyBvYmoucnVicmljSWQgPSBvYmouc2VsZWN0ZWRSdWJyaWMuaWQgOiBvYmoucnVicmljSWQgPSAwO1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ3Bvc3RUb3BpYy0yJywgb2JqLnJ1YnJpY0lkKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBuZXdUb3BpYyA9IGMubWVzc2FnZUNsaWVudC5wb3N0VG9waWMob2JqKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyDQt9C90LDRh9C40YIg0YHQvtC30LTQsNC90LjQtVxyXG5cclxuICAgICAgICAgICAgdmFyIG1lc3NhZ2VUeXBlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZUNvbnRlbnQsXHJcbiAgICAgICAgICAgICAgICBzdWJqZWN0O1xyXG4gICAgICAgICAgICBpZiAoaXNXYWxsKSB7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlVHlwZSA9IDU7IC8vIHdhbGxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2VDb250ZW50ID0gb2JqLm1lc3NhZ2UuY29udGVudDtcclxuICAgICAgICAgICAgICAgIG9iai5tZXNzYWdlLmNvbnRlbnQgPSBjLlRFWFRfREVGQVVMVF8xO1xyXG4gICAgICAgICAgICAgICAgc3ViamVjdCA9IFwiXCI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWlzQWR2ZXJ0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUeXBlID0gMTsgLy8gdGFsa3NcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVR5cGUgPSA2OyAvLyBhZHZlcnRzXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlQ29udGVudCA9IG9iai5tZXNzYWdlLmNvbnRlbnQ7XHJcbiAgICAgICAgICAgICAgICBvYmoubWVzc2FnZS5jb250ZW50ID0gYy5URVhUX0RFRkFVTFRfMztcclxuICAgICAgICAgICAgICAgIHN1YmplY3QgPSBvYmouc3ViamVjdDtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhtZXNzYWdlQ29udGVudCArIFwiIFwiICsgbWVzc2FnZVR5cGUgKyBcIiBcIiArIHN1YmplY3QpO1xyXG5cclxuICAgICAgICAgICAgbmV3VG9waWMgPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQubWVzc2FnZXNlcnZpY2UuVG9waWMoKTtcclxuICAgICAgICAgICAgbmV3VG9waWMubWVzc2FnZSA9IG5ldyBjb20udm1lc3Rlb25saW5lLmJlLnRocmlmdC5tZXNzYWdlc2VydmljZS5NZXNzYWdlKCk7XHJcbiAgICAgICAgICAgIG5ld1RvcGljLm1lc3NhZ2UuZ3JvdXBJZCA9IG9iai5zZWxlY3RlZEdyb3VwLmlkO1xyXG4gICAgICAgICAgICBuZXdUb3BpYy5tZXNzYWdlLnR5cGUgPSBtZXNzYWdlVHlwZTtcclxuXHJcbiAgICAgICAgICAgIG1lc3NhZ2VDb250ZW50ID0gJGZpbHRlcignbGlua3knKShtZXNzYWdlQ29udGVudCwgJ2JsYW5rJyk7XHJcbiAgICAgICAgICAgIG5ld1RvcGljLm1lc3NhZ2UuY29udGVudCA9IGMud2l0aFRhZ3MobWVzc2FnZUNvbnRlbnQpO1xyXG5cclxuICAgICAgICAgICAgbmV3VG9waWMubWVzc2FnZS5pbWFnZXMgPSBvYmouYXR0YWNoZWRJbWFnZXM7XHJcbiAgICAgICAgICAgIG5ld1RvcGljLm1lc3NhZ2UuZG9jdW1lbnRzID0gb2JqLmF0dGFjaGVkRG9jcztcclxuICAgICAgICAgICAgbmV3VG9waWMubWVzc2FnZS5pZCA9IDA7XHJcbiAgICAgICAgICAgIG5ld1RvcGljLm1lc3NhZ2UuY3JlYXRlZCA9IERhdGUucGFyc2UobmV3IERhdGUoKSkgLyAxMDAwO1xyXG5cclxuICAgICAgICAgICAgbmV3VG9waWMuc3ViamVjdCA9IHN1YmplY3Q7XHJcbiAgICAgICAgICAgIG5ld1RvcGljLmlkID0gMDtcclxuICAgICAgICAgICAgbmV3VG9waWMubWV0YVR5cGUgPSBcIm1lc3NhZ2VcIjtcclxuICAgICAgICAgICAgbmV3VG9waWMubWVzc2FnZU51bSA9IDA7XHJcblxyXG4gICAgICAgICAgICBpZiAob2JqLmlkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDQt9C90LDRh9C40YIg0YDQtdC00LDQutGC0LjRgNC+0LLQsNC90LjQtVxyXG4gICAgICAgICAgICAgICAgbmV3VG9waWMuaWQgPSBvYmouaWQ7XHJcbiAgICAgICAgICAgICAgICBuZXdUb3BpYy5tZXNzYWdlLmlkID0gb2JqLm1lc3NhZ2UuaWQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBwb2xsO1xyXG4gICAgICAgICAgICBpZiAob2JqLmlzUG9sbFNob3cpIHtcclxuICAgICAgICAgICAgICAgIHBvbGwgPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQubWVzc2FnZXNlcnZpY2UuUG9sbCgpO1xyXG4gICAgICAgICAgICAgICAgcG9sbC5wb2xsSWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgcG9sbC5lZGl0TmFtZXMgPSBbXTtcclxuICAgICAgICAgICAgICAgIHBvbGwubmFtZXMgPSBbXTtcclxuICAgICAgICAgICAgICAgIHBvbGwuc3ViamVjdCA9IG9iai5wb2xsU3ViamVjdDtcclxuICAgICAgICAgICAgICAgIHBvbGwuYWxyZWFkeVBvbGwgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICBjLnNldFBvbGwocG9sbCwgb2JqLnBvbGxJbnB1dHMpO1xyXG5cclxuICAgICAgICAgICAgICAgIG5ld1RvcGljLnBvbGwgPSBwb2xsO1xyXG4gICAgICAgICAgICAgICAgbmV3VG9waWMubWV0YVR5cGUgPSBcInBvbGxcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL25ld1RvcGljLnJ1YnJpY0lkID0gb2JqLnNlbGVjdGVkUnVicmljLmlkO1xyXG4gICAgICAgICAgICBvYmouc2VsZWN0ZWRSdWJyaWMuaWQgPyBuZXdUb3BpYy5ydWJyaWNJZCA9IG9iai5zZWxlY3RlZFJ1YnJpYy5pZCA6IG5ld1RvcGljLnJ1YnJpY0lkID0gMDtcclxuXHJcbiAgICAgICAgICAgIC8vYWxlcnQobmV3VG9waWMubWVzc2FnZS5jb250ZW50KTtcclxuICAgICAgICAgICAgdmFyIHRlbXBUb3BpYyA9IGMubWVzc2FnZUNsaWVudC5wb3N0VG9waWMobmV3VG9waWMpO1xyXG4gICAgICAgICAgICBuZXdUb3BpYy5pZCA9IHRlbXBUb3BpYy5pZDtcclxuICAgICAgICAgICAgbmV3VG9waWMubWVzc2FnZS5pbWFnZXMgPSB0ZW1wVG9waWMubWVzc2FnZS5pbWFnZXM7XHJcbiAgICAgICAgICAgIG5ld1RvcGljLm1lc3NhZ2UuZG9jdW1lbnRzID0gdGVtcFRvcGljLm1lc3NhZ2UuZG9jdW1lbnRzO1xyXG4gICAgICAgICAgICBuZXdUb3BpYy51c2VySW5mbyA9IHRlbXBUb3BpYy51c2VySW5mbztcclxuXHJcbiAgICAgICAgICAgIGlmIChvYmouaXNQb2xsU2hvdykge1xyXG4gICAgICAgICAgICAgICAgbmV3VG9waWMucG9sbC5wb2xsSWQgPSB0ZW1wVG9waWMucG9sbC5wb2xsSWQ7XHJcbiAgICAgICAgICAgICAgICBvYmouaXNQb2xsU2hvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgb2JqLnBvbGxTdWJqZWN0ID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIG9iai5pc1BvbGxBdmFpbGFibGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpc1dhbGwpIHtcclxuICAgICAgICAgICAgICAgIG5ld1RvcGljLm1lc3NhZ2UuY3JlYXRlZEVkaXQgPSBjLmdldFRpbWluZyhuZXdUb3BpYy5tZXNzYWdlLmNyZWF0ZWQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbmV3VG9waWMubGFzdFVwZGF0ZUVkaXQgPSBjLmdldFRpbWluZyhuZXdUb3BpYy5tZXNzYWdlLmNyZWF0ZWQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG5ld1RvcGljO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBjLmdldEF0dGFjaGVkSW1hZ2VzID0gZnVuY3Rpb24oc2VsZWN0b3Ipe1xyXG4gICAgICAgIHZhciBpbWdMaXN0ID0gW10sIGluZCA9IDA7XHJcblxyXG4gICAgICAgIHNlbGVjdG9yLmZpbmQoJy5hdHRhY2gtaXRlbScpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvL9C30L3QsNGH0LjRgiDQutCw0YDRgtC40L3QutCwXHJcbiAgICAgICAgICAgIHZhciBiZ0ltZyA9ICQodGhpcykuZmluZCgnaW1nJykuY3NzKCdiYWNrZ3JvdW5kLWltYWdlJyksXHJcbiAgICAgICAgICAgICAgICBuYW1lID0gJCh0aGlzKS5maW5kKCdpbWcnKS5hdHRyKCdkYXRhLXRpdGxlJyksXHJcbiAgICAgICAgICAgICAgICB0eXBlID0gJCh0aGlzKS5maW5kKCdpbWcnKS5hdHRyKCdkYXRhLXR5cGUnKSxcclxuICAgICAgICAgICAgICAgIHJlc3VsdCwgY29udGVudDtcclxuXHJcbiAgICAgICAgICAgIHZhciBpID0gYmdJbWcuaW5kZXhPZignYmFzZTY0LCcpO1xyXG4gICAgICAgICAgICBjb250ZW50ID0gYmdJbWcuc2xpY2UoNCwgYmdJbWcubGVuZ3RoIC0gMSk7XHJcblxyXG4gICAgICAgICAgICByZXN1bHQgPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQubWVzc2FnZXNlcnZpY2UuQXR0YWNoKCk7XHJcbiAgICAgICAgICAgIHJlc3VsdC5maWxlTmFtZSA9IG5hbWU7XHJcbiAgICAgICAgICAgIHJlc3VsdC5jb250ZW50VHlwZSA9IHR5cGU7XHJcblxyXG4gICAgICAgICAgICB2YXIgaW5kZXhGaWxlID0gY29udGVudC5pbmRleE9mKCcvZmlsZScpO1xyXG4gICAgICAgICAgICBjb250ZW50ID0gY29udGVudC5zdWJzdHJpbmcoaW5kZXhGaWxlKTtcclxuXHJcbiAgICAgICAgICAgIHJlc3VsdC5VUkwgPSBjb250ZW50O1xyXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKGNvbnRlbnQpO1xyXG4gICAgICAgICAgICAvL3Jlc3VsdCA9ICdvYmoobmFtZTonKyBiYXNlNjRlbmNvZGUobmFtZSkgKyc7ZGF0YTonKyB0eXBlICsnO2NvbnRlbnQ6Jytjb250ZW50K1wiKVwiO1xyXG5cclxuICAgICAgICAgICAgaW1nTGlzdFtpbmQrK10gPSByZXN1bHQ7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gaW1nTGlzdDtcclxuICAgIH1cclxuXHJcbiAgICBjLmdldEF0dGFjaGVkRG9jcyA9IGZ1bmN0aW9uKHNlbGVjdG9yLCBpc0VkaXQpe1xyXG4gICAgICAgIGlmIChpc0VkaXQpIHtcclxuICAgICAgICAgICAgdmFyIGRvY0xpc3QgPSBbXSwgaW5kID0gMDtcclxuICAgICAgICAgICAgZG9jc0Jhc2U2NFtzZWxlY3Rvcl0gPSBbXTtcclxuXHJcbiAgICAgICAgICAgIHNlbGVjdG9yLmZpbmQoJy5hdHRhY2gtaXRlbScpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgZG9jc0Jhc2U2NFtzZWxlY3Rvcl1baW5kXSA9IG5ldyBjb20udm1lc3Rlb25saW5lLmJlLnRocmlmdC5tZXNzYWdlc2VydmljZS5BdHRhY2goKTtcclxuICAgICAgICAgICAgICAgIGRvY3NCYXNlNjRbc2VsZWN0b3JdW2luZF0uZmlsZU5hbWUgPSAkKHRoaXMpLmZpbmQoJ3NwYW4nKS50ZXh0KCk7XHJcbiAgICAgICAgICAgICAgICBkb2NzQmFzZTY0W3NlbGVjdG9yXVtpbmRdLmNvbnRlbnRUeXBlID0gJCh0aGlzKS5hdHRyKCdkYXRhLXR5cGUnKTtcclxuICAgICAgICAgICAgICAgIGRvY3NCYXNlNjRbc2VsZWN0b3JdW2luZF0uVVJMID0gJCh0aGlzKS5hdHRyKCdkYXRhLWhyZWYnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpbmQrKztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZG9jc0Jhc2U2NFtzZWxlY3Rvcl07XHJcblxyXG5cclxuICAgIH1cclxuXHJcbiAgICBjLmNsZWFuQXR0YWNoZWQgPSBmdW5jdGlvbihzZWxlY3Rvcil7XHJcbiAgICAgICAgLy9zZWxlY3Rvci5odG1sKCcnKS5hcHBlbmQoJzxkaXYgY2xhc3M9XCJsb2FkaW5nIGhpZGRlblwiPjxpbWcgc3JjPVwiaS9sb2FkaW5nMi5naWZcIj48L2Rpdj4nKTtcclxuICAgICAgICBzZWxlY3Rvci5maW5kKCcuYXR0YWNoLWl0ZW0nKS5kZXRhY2goKTtcclxuICAgICAgICAvL2RvY3NCYXNlNjQgPSBbXTtcclxuICAgICAgICBkb2NzSW5kW3NlbGVjdG9yXSA9IDA7XHJcbiAgICAgICAgZG9jc0Jhc2U2NFtzZWxlY3Rvcl0gPSBbXTtcclxuICAgIH1cclxuXHJcbiAgICBjLnBvc3RNZXNzYWdlTXkgPSBmdW5jdGlvbihvYmosIGlzV2FsbCwgaXNGaXJzdExldmVsLCAkZmlsdGVyKXtcclxuXHJcbiAgICAgICAgaWYgKChvYmouaWQgJiYgb2JqLmlzRWRpdCkgfHwgKG9iai5tZXNzYWdlICYmIG9iai5tZXNzYWdlLmlzRWRpdCkpIHtcclxuICAgICAgICAgICAgLy8g0LfQvdCw0YfQuNGCINGA0LXQtNCw0LrRgtC40YDQvtCy0LDQvdC40LVcclxuICAgICAgICAgICAgdmFyIG1lc3NhZ2U7XHJcbiAgICAgICAgICAgIGlmIChvYmoubWVzc2FnZSAmJiBvYmoubWVzc2FnZS5pc0VkaXQpIHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBvYmoubWVzc2FnZTtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2UuY29udGVudCA9IG9iai5jb21tZW50VGV4dDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG9iai5jb250ZW50ID0gb2JqLmNvbW1lbnRUZXh0O1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZSA9IG9iajtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIGF0dGFjaElkO1xyXG4gICAgICAgICAgICBpZiAoIW9iai5pZCB8fCBpc0ZpcnN0TGV2ZWwpIHtcclxuICAgICAgICAgICAgICAgIGF0dGFjaElkID0gb2JqLnRvcGljSWQgKyBcIi1cIiArIG9iai5tZXNzYWdlSWQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBhdHRhY2hJZCA9IG9iai5pZDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbWVzc2FnZS5pbWFnZXMgPSBjLmdldEF0dGFjaGVkSW1hZ2VzKCQoJyNhdHRhY2gtYXJlYS1lZGl0LScgKyBhdHRhY2hJZCkpO1xyXG4gICAgICAgICAgICBtZXNzYWdlLmRvY3VtZW50cyA9IGMuZ2V0QXR0YWNoZWREb2NzKCQoJyNhdHRhY2gtZG9jLWFyZWEtZWRpdC0nICsgYXR0YWNoSWQpLCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChtZXNzYWdlLmNvbnRlbnQgPT0gXCJcIiAmJiBtZXNzYWdlLmltYWdlcy5sZW5ndGggPT0gMCAmJiAobWVzc2FnZS5kb2N1bWVudHMgPT09IHVuZGVmaW5lZCB8fCBtZXNzYWdlLmRvY3VtZW50cy5sZW5ndGggPT0gMCkpIHtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRyeSDQvdCwINGB0LvRg9GH0LDQuSDQtdGB0LvQuCDRgtC+0L/QuNC6INCx0YvQuyDRg9C00LDQu9C10L0g0YHQvtC30LTQsNGC0LXQu9C10LwsINCwINGO0LfQtdGAINC/0YvRgtCw0LXRgtGB0Y9cclxuICAgICAgICAgICAgICAgICAgICAvLyDQtdCz0L4g0LrQvtC80LzQtdC90YLQuNGA0L7QstCw0YLRjFxyXG5cclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmNvbnRlbnQgPSAkZmlsdGVyKCdsaW5reScpKG1lc3NhZ2UuY29udGVudCwgJ2JsYW5rJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5jb250ZW50ID0gYy53aXRoVGFncyhtZXNzYWdlLmNvbnRlbnQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3TWVzc2FnZSA9IGMubWVzc2FnZUNsaWVudC5wb3N0TWVzc2FnZShtZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5yZXBsYWNlKCcvJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgYy5jbGVhbkF0dGFjaGVkKCQoJyNhdHRhY2gtYXJlYS1lZGl0LScgKyBhdHRhY2hJZCkpO1xyXG4gICAgICAgICAgICAgICAgYy5jbGVhbkF0dGFjaGVkKCQoJyNhdHRhY2gtZG9jLWFyZWEtZWRpdC0nICsgYXR0YWNoSWQpKTtcclxuXHJcbiAgICAgICAgICAgICAgICBvYmouaXNFZGl0ID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ld01lc3NhZ2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8g0LfQvdCw0YfQuNGCINGB0L7Qt9C00LDQvdC40LVcclxuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBuZXcgY29tLnZtZXN0ZW9ubGluZS5iZS50aHJpZnQubWVzc2FnZXNlcnZpY2UuTWVzc2FnZSgpLFxyXG4gICAgICAgICAgICAgICAgYXR0YWNoSWQsIGlzRW1wdHlUZXh0ID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICBpZiAoaXNXYWxsKSB7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLnR5cGUgPSBjb20udm1lc3Rlb25saW5lLmJlLnRocmlmdC5tZXNzYWdlc2VydmljZS5NZXNzYWdlVHlwZS5XQUxMOy8vNTtcclxuICAgICAgICAgICAgICAgIGF0dGFjaElkID0gbWVzc2FnZS50b3BpY0lkID0gb2JqLnRvcGljLmlkO1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZS5ncm91cElkID0gb2JqLmdyb3VwSWQ7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLmNvbnRlbnQgPSBvYmouY29tbWVudFRleHQ7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLnBhcmVudElkID0gMDtcclxuICAgICAgICAgICAgICAgIGlzRW1wdHlUZXh0ID0gKG9iai5jb21tZW50VGV4dCA9PSBjLlRFWFRfREVGQVVMVF8yIHx8IG9iai5jb21tZW50VGV4dCA9PSBcIlwiKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2UudHlwZSA9IGNvbS52bWVzdGVvbmxpbmUuYmUudGhyaWZ0Lm1lc3NhZ2VzZXJ2aWNlLk1lc3NhZ2VUeXBlLkJBU0U7Ly8xO1xyXG4gICAgICAgICAgICAgICAgYXR0YWNoSWQgPSBtZXNzYWdlLnRvcGljSWQgPSBvYmoudG9waWNJZDtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2UuZ3JvdXBJZCA9IG9iai5zZWxlY3RlZEdyb3VwLmlkO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChpc0ZpcnN0TGV2ZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL21lc3NhZ2UuY29udGVudCA9IG9iai5hbnN3ZXJGaXJzdE1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5jb250ZW50ID0gb2JqLmNvbW1lbnRUZXh0O1xyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucGFyZW50SWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmNvbnRlbnQgPSBvYmouY29tbWVudFRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5wYXJlbnRJZCA9IG9iai5wYXJlbnRJZDtcclxuICAgICAgICAgICAgICAgICAgICBhdHRhY2hJZCA9IGF0dGFjaElkICsgXCItXCIgKyBvYmoubWVzc2FnZUlkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlzRW1wdHlUZXh0ID0gKG1lc3NhZ2UuY29udGVudCA9PSBjLlRFWFRfREVGQVVMVF8yIHx8IG1lc3NhZ2UuY29udGVudCA9PSBcIlwiIHx8IG1lc3NhZ2UuY29udGVudCA9PT0gdW5kZWZpbmVkKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbWVzc2FnZS5pZCA9IDA7XHJcbiAgICAgICAgICAgIG1lc3NhZ2UuaW1hZ2VzID0gYy5nZXRBdHRhY2hlZEltYWdlcygkKCcjYXR0YWNoLWFyZWEtJyArIGF0dGFjaElkKSk7XHJcblxyXG4gICAgICAgICAgICBtZXNzYWdlLmRvY3VtZW50cyA9IGMuZ2V0QXR0YWNoZWREb2NzKCQoJyNhdHRhY2gtZG9jLWFyZWEtJyArIGF0dGFjaElkKSk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gbWVzc2FnZS5kb2N1bWVudHNbMF0pIHtcclxuICAgICAgICAgICAgICAgIGFsZXJ0KHAgKyBcIiBcIiArIG1lc3NhZ2UuZG9jdW1lbnRzWzBdW3BdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjLmNsZWFuQXR0YWNoZWQoJCgnI2F0dGFjaC1hcmVhLScgKyBhdHRhY2hJZCkpO1xyXG4gICAgICAgICAgICBjLmNsZWFuQXR0YWNoZWQoJCgnI2F0dGFjaC1kb2MtYXJlYS0nICsgYXR0YWNoSWQpKTtcclxuICAgICAgICAgICAgLy9tZXNzYWdlLmltYWdlcyA9IG9iai5hdHRhY2hlZEltYWdlcztcclxuICAgICAgICAgICAgbWVzc2FnZS5jcmVhdGVkID0gRGF0ZS5wYXJzZShuZXcgRGF0ZSkgLyAxMDAwO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzRW1wdHlUZXh0ICYmIG1lc3NhZ2UuaW1hZ2VzLmxlbmd0aCA9PSAwICYmIChtZXNzYWdlLmRvY3VtZW50cyA9PT0gdW5kZWZpbmVkIHx8IG1lc3NhZ2UuZG9jdW1lbnRzLmxlbmd0aCA9PSAwKSkge1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmNvbnRlbnQgPT0gYy5URVhUX0RFRkFVTFRfMiAmJiAobWVzc2FnZS5pbWFnZXMubGVuZ3RoICE9IDAgfHwgbWVzc2FnZS5kb2N1bWVudHMubGVuZ3RoICE9IDApKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5jb250ZW50ID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLmNvbnRlbnQgPSAkZmlsdGVyKCdsaW5reScpKG1lc3NhZ2UuY29udGVudCwgJ2JsYW5rJyk7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLmNvbnRlbnQgPSBjLndpdGhUYWdzKG1lc3NhZ2UuY29udGVudCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBuZXdNZXNzYWdlID0gYy5tZXNzYWdlQ2xpZW50LnBvc3RNZXNzYWdlKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmxvY2F0aW9uLnJlcGxhY2UoJy8nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBvYmouY29tbWVudFRleHQgPSBjLlRFWFRfREVGQVVMVF8yO1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZS5jcmVhdGVkRWRpdCA9IGMuZ2V0VGltaW5nKG5ld01lc3NhZ2UuY3JlYXRlZCk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhuZXdNZXNzYWdlLmNyZWF0ZWQpO1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZS5hdXRob3JOYW1lID0gYy5nZXRBdXRob3JOYW1lKCk7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLnVzZXJJbmZvID0gbmV3TWVzc2FnZS51c2VySW5mbztcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2UuaW1hZ2VzID0gbmV3TWVzc2FnZS5pbWFnZXM7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLmRvY3VtZW50cyA9IG5ld01lc3NhZ2UuZG9jdW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZS5pZCA9IG5ld01lc3NhZ2UuaWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYy5zZXRQb2xsRWRpdE5hbWVzID0gZnVuY3Rpb24ocG9sbCl7XHJcbiAgICAgICAgLy8gb2JqLndhbGxJdGVtc1tpXS50b3BpY1xyXG4gICAgICAgIHBvbGwuZWRpdE5hbWVzID0gW107XHJcbiAgICAgICAgdmFyIG5hbWVzTGVuZ3RoLFxyXG4gICAgICAgICAgICBhbW91bnQgPSAwLFxyXG4gICAgICAgICAgICB2b3RlcnNOdW0gPSAwLFxyXG4gICAgICAgICAgICB2b3RlcnNQZXJjZW50ID0gMDtcclxuICAgICAgICBwb2xsLm5hbWVzID9cclxuICAgICAgICAgICAgbmFtZXNMZW5ndGggPSBwb2xsLm5hbWVzLmxlbmd0aCA6XHJcbiAgICAgICAgICAgIG5hbWVzTGVuZ3RoID0gMDtcclxuICAgICAgICAvL2NvbnNvbGUubG9nKHBvbGwuYWxyZWFkeVBvbGwpO1xyXG5cclxuICAgICAgICAvLyDQvdGD0LbQvdC+INC30L3QsNGC0Ywg0L/QvtC70L3Ri9C5IGFtb3VudCDQtNC70Y8g0LLRi9GH0LjRgdC70LXQvdC40Y8g0L/RgNC+0YbQtdC90YLQvdC+0Lkg0LTQu9C40L3Ri1xyXG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbmFtZXNMZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICBpZiAocG9sbCAmJiBwb2xsLnZhbHVlcyAmJiBwb2xsLnZhbHVlc1tqXSkge1xyXG4gICAgICAgICAgICAgICAgYW1vdW50ICs9IHBvbGwudmFsdWVzW2pdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG5hbWVzTGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgaWYgKHBvbGwgJiYgcG9sbC52YWx1ZXMgJiYgcG9sbC52YWx1ZXNbal0pIHtcclxuICAgICAgICAgICAgICAgIHZvdGVyc051bSA9IHBvbGwudmFsdWVzW2pdO1xyXG4gICAgICAgICAgICAgICAgdm90ZXJzUGVyY2VudCA9IHZvdGVyc051bSAqIDEwMCAvIGFtb3VudDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZvdGVyc051bSA9IHZvdGVyc1BlcmNlbnQgPSAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBwb2xsLmVkaXROYW1lc1tqXSA9IHtcclxuICAgICAgICAgICAgICAgIGlkOiBqLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IDAsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiBwb2xsLm5hbWVzW2pdLFxyXG4gICAgICAgICAgICAgICAgdm90ZXJzTnVtOiB2b3RlcnNOdW0sXHJcbiAgICAgICAgICAgICAgICB2b3RlcnNQZXJjZW50OiB2b3RlcnNQZXJjZW50LnRvRml4ZWQoMSkgKyBcIiVcIlxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgcG9sbC5hbW91bnQgPSBhbW91bnQ7XHJcbiAgICB9XHJcblxyXG4gICAgYy5pbml0RmFuY3lCb3ggPSBmdW5jdGlvbihzZWxlY3Rvcil7XHJcbiAgICAgICAgc2VsZWN0b3IuZmluZChcIi5mYW5jeWJveFwiKS5mYW5jeWJveCh7XHJcbiAgICAgICAgICAgICd0cmFuc2l0aW9uSW4nOiAnZWxhc3RpYycsXHJcbiAgICAgICAgICAgICd0cmFuc2l0aW9uT3V0JzogJ2VsYXN0aWMnLFxyXG4gICAgICAgICAgICAnc3BlZWRJbic6IDYwMCxcclxuICAgICAgICAgICAgJ3NwZWVkT3V0JzogMjAwLFxyXG4gICAgICAgICAgICAnb3ZlcmxheVNob3cnOiBmYWxzZVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGMuY2xvbmUgPSBmdW5jdGlvbihvYmope1xyXG4gICAgICAgIGlmIChvYmogPT0gbnVsbCB8fCB0eXBlb2Yob2JqKSAhPSAnb2JqZWN0JylcclxuICAgICAgICAgICAgcmV0dXJuIG9iajtcclxuICAgICAgICB2YXIgdGVtcCA9IG5ldyBvYmouY29uc3RydWN0b3IoKTtcclxuICAgICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKVxyXG4gICAgICAgICAgICB0ZW1wW2tleV0gPSBjLmNsb25lKG9ialtrZXldKTtcclxuICAgICAgICByZXR1cm4gdGVtcDtcclxuICAgIH1cclxuXHJcbiAgICAkLndpZGdldChcImN1c3RvbS5jYXRjb21wbGV0ZVwiLCAkLnVpLmF1dG9jb21wbGV0ZSwge1xyXG4gICAgICAgIF9yZW5kZXJNZW51OiBmdW5jdGlvbiAodWwsIGl0ZW1zKSB7XHJcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcyxcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRDYXRlZ29yeSA9IFwiXCI7XHJcbiAgICAgICAgICAgICQuZWFjaChpdGVtcywgZnVuY3Rpb24gKGluZGV4LCBpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5jYXRlZ29yeSAhPSBjdXJyZW50Q2F0ZWdvcnkpIHtcclxuICAgICAgICAgICAgICAgICAgICB1bC5hcHBlbmQoXCI8bGkgY2xhc3M9J3VpLWF1dG9jb21wbGV0ZS1jYXRlZ29yeSc+XCIgKyBpdGVtLmNhdGVnb3J5ICsgXCI8L2xpPlwiKTtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q2F0ZWdvcnkgPSBpdGVtLmNhdGVnb3J5O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhhdC5fcmVuZGVySXRlbURhdGEodWwsIGl0ZW0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBib290Ym94LnNldERlZmF1bHRzKHtsb2NhbGU6IFwicnVcIn0pO1xyXG5cclxuICAgIHJldHVybiBjO1xyXG5cclxufTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG52YXIgY291bnRlcnMgPSBmdW5jdGlvbigkYyl7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZ2V0Q291bnRlcnMgOiAkYy51dGlsaXR5Q2xpZW50LmdldENvdW50ZXJzKCksXHJcbiAgICAgICAgICAgIGdldFR5cGVTdHJpbmcgOiBmdW5jdGlvbiAodHlwZSl7XHJcbiAgICAgICAgICAgICAgICB2YXIgdHlwZVN0cmluZztcclxuXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHBhcnNlSW50KHR5cGUpKXtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVTdHJpbmcgPSBcItCT0L7RgNGP0YfQsNGPINCy0L7QtNCwXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZVN0cmluZyA9IFwi0KXQvtC70L7QtNC90LDRjyDQstC+0LTQsFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVTdHJpbmcgPSBcItCt0LvQtdC60YLRgNC40YfQtdGB0YLQstC+KNC+0LHRidC40LkpXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZVN0cmluZyA9IFwi0K3Qu9C10LrRgtGA0LjRh9C10YHRgtCy0L4o0L3QvtGH0YwpXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZVN0cmluZyA9IFwi0K3Qu9C10LrRgtGA0LjRh9C10YHRgtCy0L4o0LTQtdC90YwpXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZVN0cmluZyA9IFwi0JPQsNC3XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZVN0cmluZyA9IFwi0JTRgNGD0LPQvtC1XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiB0eXBlU3RyaW5nO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBbJyRjJyxjb3VudGVyc107IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBhbmd1bGFyLm1vZHVsZSgnZm9ydW0uc2VydmljZXMnLCBbXSlcclxuICAgIC5mYWN0b3J5KCAnJGMnLCByZXF1aXJlKCcuL2NvbW1vbi5qcycpKVxyXG4gICAgLmZhY3RvcnkoICckY291bnRlcnMnLCByZXF1aXJlKCcuL2NvdW50ZXJzLmpzJykpXHJcbjtcclxuXHJcbi8qYW5ndWxhci5tb2R1bGUoJ2ZvcnVtLnNlcnZpY2VzJywgW10pLlxyXG4gICAgZmFjdG9yeSggJyRjb3VudGVycycsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGdldENvdW50ZXJzIDogYy51dGlsaXR5Q2xpZW50LmdldENvdW50ZXJzKCksXHJcbiAgICAgICAgICAgIGdldFR5cGVTdHJpbmcgOiBmdW5jdGlvbiAodHlwZSl7XHJcbiAgICAgICAgICAgICAgICB2YXIgdHlwZVN0cmluZztcclxuXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHBhcnNlSW50KHR5cGUpKXtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVTdHJpbmcgPSBcItCT0L7RgNGP0YfQsNGPINCy0L7QtNCwXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZVN0cmluZyA9IFwi0KXQvtC70L7QtNC90LDRjyDQstC+0LTQsFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVTdHJpbmcgPSBcItCt0LvQtdC60YLRgNC40YfQtdGB0YLQstC+KNC+0LHRidC40LkpXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZVN0cmluZyA9IFwi0K3Qu9C10LrRgtGA0LjRh9C10YHRgtCy0L4o0L3QvtGH0YwpXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZVN0cmluZyA9IFwi0K3Qu9C10LrRgtGA0LjRh9C10YHRgtCy0L4o0LTQtdC90YwpXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZVN0cmluZyA9IFwi0JPQsNC3XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZVN0cmluZyA9IFwi0JTRgNGD0LPQvtC1XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiB0eXBlU3RyaW5nO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxuICAgIC5mYWN0b3J5KCckYycsIHJlcXVpcmUoJy4vY29tbW9uLmpzJykpOyovXHJcbiJdfQ==
